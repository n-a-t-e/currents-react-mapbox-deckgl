function F3(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in e)){const l=Object.getOwnPropertyDescriptor(r,o);l&&Object.defineProperty(e,o,l.get?l:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var N3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function B3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Rt={},U3={get exports(){return Rt},set exports(e){Rt=e}},Rn={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var gE=Object.getOwnPropertySymbols,V3=Object.prototype.hasOwnProperty,j3=Object.prototype.propertyIsEnumerable;function G3(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function W3(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(l){return t[l]});if(r.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(l){o[l]=l}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var GA=W3()?Object.assign:function(e,t){for(var n,r=G3(e),o,l=1;l<arguments.length;l++){n=Object(arguments[l]);for(var s in n)V3.call(n,s)&&(r[s]=n[s]);if(gE){o=gE(n);for(var p=0;p<o.length;p++)j3.call(n,o[p])&&(r[o[p]]=n[o[p]])}}return r};/** @license React v16.14.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q1=GA,ds=typeof Symbol=="function"&&Symbol.for,kd=ds?Symbol.for("react.element"):60103,H3=ds?Symbol.for("react.portal"):60106,q3=ds?Symbol.for("react.fragment"):60107,Z3=ds?Symbol.for("react.strict_mode"):60108,X3=ds?Symbol.for("react.profiler"):60114,$3=ds?Symbol.for("react.provider"):60109,Y3=ds?Symbol.for("react.context"):60110,K3=ds?Symbol.for("react.forward_ref"):60112,J3=ds?Symbol.for("react.suspense"):60113,Q3=ds?Symbol.for("react.memo"):60115,tR=ds?Symbol.for("react.lazy"):60116,yE=typeof Symbol=="function"&&Symbol.iterator;function Od(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var WA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HA={};function vf(e,t,n){this.props=e,this.context=t,this.refs=HA,this.updater=n||WA}vf.prototype.isReactComponent={};vf.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error(Od(85));this.updater.enqueueSetState(this,e,t,"setState")};vf.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function qA(){}qA.prototype=vf.prototype;function Z1(e,t,n){this.props=e,this.context=t,this.refs=HA,this.updater=n||WA}var X1=Z1.prototype=new qA;X1.constructor=Z1;q1(X1,vf.prototype);X1.isPureReactComponent=!0;var $1={current:null},ZA=Object.prototype.hasOwnProperty,XA={key:!0,ref:!0,__self:!0,__source:!0};function $A(e,t,n){var r,o={},l=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(l=""+t.key),t)ZA.call(t,r)&&!XA.hasOwnProperty(r)&&(o[r]=t[r]);var p=arguments.length-2;if(p===1)o.children=n;else if(1<p){for(var g=Array(p),_=0;_<p;_++)g[_]=arguments[_+2];o.children=g}if(e&&e.defaultProps)for(r in p=e.defaultProps,p)o[r]===void 0&&(o[r]=p[r]);return{$$typeof:kd,type:e,key:l,ref:s,props:o,_owner:$1.current}}function eR(e,t){return{$$typeof:kd,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Y1(e){return typeof e=="object"&&e!==null&&e.$$typeof===kd}function nR(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(n){return t[n]})}var YA=/\/+/g,Iy=[];function KA(e,t,n,r){if(Iy.length){var o=Iy.pop();return o.result=e,o.keyPrefix=t,o.func=n,o.context=r,o.count=0,o}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function JA(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>Iy.length&&Iy.push(e)}function ox(e,t,n,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case kd:case H3:l=!0}}if(l)return n(r,e,t===""?"."+Y_(e,0):t),1;if(l=0,t=t===""?".":t+":",Array.isArray(e))for(var s=0;s<e.length;s++){o=e[s];var p=t+Y_(o,s);l+=ox(o,p,n,r)}else if(e===null||typeof e!="object"?p=null:(p=yE&&e[yE]||e["@@iterator"],p=typeof p=="function"?p:null),typeof p=="function")for(e=p.call(e),s=0;!(o=e.next()).done;)o=o.value,p=t+Y_(o,s++),l+=ox(o,p,n,r);else if(o==="object")throw n=""+e,Error(Od(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return l}function sx(e,t,n){return e==null?0:ox(e,"",t,n)}function Y_(e,t){return typeof e=="object"&&e!==null&&e.key!=null?nR(e.key):t.toString(36)}function rR(e,t){e.func.call(e.context,t,e.count++)}function iR(e,t,n){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?ax(e,r,n,function(l){return l}):e!=null&&(Y1(e)&&(e=eR(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(YA,"$&/")+"/")+n)),r.push(e))}function ax(e,t,n,r,o){var l="";n!=null&&(l=(""+n).replace(YA,"$&/")+"/"),t=KA(t,l,r,o),sx(e,iR,t),JA(t)}var QA={current:null};function ul(){var e=QA.current;if(e===null)throw Error(Od(321));return e}var oR={ReactCurrentDispatcher:QA,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:$1,IsSomeRendererActing:{current:!1},assign:q1};Rn.Children={map:function(e,t,n){if(e==null)return e;var r=[];return ax(e,r,null,t,n),r},forEach:function(e,t,n){if(e==null)return e;t=KA(null,null,t,n),sx(e,rR,t),JA(t)},count:function(e){return sx(e,function(){return null},null)},toArray:function(e){var t=[];return ax(e,t,null,function(n){return n}),t},only:function(e){if(!Y1(e))throw Error(Od(143));return e}};Rn.Component=vf;Rn.Fragment=q3;Rn.Profiler=X3;Rn.PureComponent=Z1;Rn.StrictMode=Z3;Rn.Suspense=J3;Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oR;Rn.cloneElement=function(e,t,n){if(e==null)throw Error(Od(267,e));var r=q1({},e.props),o=e.key,l=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,s=$1.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var p=e.type.defaultProps;for(g in t)ZA.call(t,g)&&!XA.hasOwnProperty(g)&&(r[g]=t[g]===void 0&&p!==void 0?p[g]:t[g])}var g=arguments.length-2;if(g===1)r.children=n;else if(1<g){p=Array(g);for(var _=0;_<g;_++)p[_]=arguments[_+2];r.children=p}return{$$typeof:kd,type:e.type,key:o,ref:l,props:r,_owner:s}};Rn.createContext=function(e,t){return t===void 0&&(t=null),e={$$typeof:Y3,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider={$$typeof:$3,_context:e},e.Consumer=e};Rn.createElement=$A;Rn.createFactory=function(e){var t=$A.bind(null,e);return t.type=e,t};Rn.createRef=function(){return{current:null}};Rn.forwardRef=function(e){return{$$typeof:K3,render:e}};Rn.isValidElement=Y1;Rn.lazy=function(e){return{$$typeof:tR,_ctor:e,_status:-1,_result:null}};Rn.memo=function(e,t){return{$$typeof:Q3,type:e,compare:t===void 0?null:t}};Rn.useCallback=function(e,t){return ul().useCallback(e,t)};Rn.useContext=function(e,t){return ul().useContext(e,t)};Rn.useDebugValue=function(){};Rn.useEffect=function(e,t){return ul().useEffect(e,t)};Rn.useImperativeHandle=function(e,t,n){return ul().useImperativeHandle(e,t,n)};Rn.useLayoutEffect=function(e,t){return ul().useLayoutEffect(e,t)};Rn.useMemo=function(e,t){return ul().useMemo(e,t)};Rn.useReducer=function(e,t,n){return ul().useReducer(e,t,n)};Rn.useRef=function(e){return ul().useRef(e)};Rn.useState=function(e){return ul().useState(e)};Rn.version="16.14.0";(function(e){e.exports=Rn})(U3);const zp=B3(Rt);var lx={},sR={get exports(){return lx},set exports(e){lx=e}},Wo={},ux={},aR={get exports(){return ux},set exports(e){ux=e}},tC={};/** @license React v0.19.1
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){var t,n,r,o,l;if(typeof window>"u"||typeof MessageChannel!="function"){var s=null,p=null,g=function(){if(s!==null)try{var Jt=e.unstable_now();s(!0,Jt),s=null}catch(Te){throw setTimeout(g,0),Te}},_=Date.now();e.unstable_now=function(){return Date.now()-_},t=function(Jt){s!==null?setTimeout(t,0,Jt):(s=Jt,setTimeout(g,0))},n=function(Jt,Te){p=setTimeout(Jt,Te)},r=function(){clearTimeout(p)},o=function(){return!1},l=e.unstable_forceFrameRate=function(){}}else{var w=window.performance,P=window.Date,A=window.setTimeout,M=window.clearTimeout;if(typeof console<"u"){var F=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),typeof F!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if(typeof w=="object"&&typeof w.now=="function")e.unstable_now=function(){return w.now()};else{var X=P.now();e.unstable_now=function(){return P.now()-X}}var B=!1,U=null,H=-1,tt=5,st=0;o=function(){return e.unstable_now()>=st},l=function(){},e.unstable_forceFrameRate=function(Jt){0>Jt||125<Jt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):tt=0<Jt?Math.floor(1e3/Jt):5};var pt=new MessageChannel,_t=pt.port2;pt.port1.onmessage=function(){if(U!==null){var Jt=e.unstable_now();st=Jt+tt;try{U(!0,Jt)?_t.postMessage(null):(B=!1,U=null)}catch(Te){throw _t.postMessage(null),Te}}else B=!1},t=function(Jt){U=Jt,B||(B=!0,_t.postMessage(null))},n=function(Jt,Te){H=A(function(){Jt(e.unstable_now())},Te)},r=function(){M(H),H=-1}}function Ot(Jt,Te){var Je=Jt.length;Jt.push(Te);t:for(;;){var Oe=Je-1>>>1,an=Jt[Oe];if(an!==void 0&&0<qt(an,Te))Jt[Oe]=Te,Jt[Je]=an,Je=Oe;else break t}}function Dt(Jt){return Jt=Jt[0],Jt===void 0?null:Jt}function kt(Jt){var Te=Jt[0];if(Te!==void 0){var Je=Jt.pop();if(Je!==Te){Jt[0]=Je;t:for(var Oe=0,an=Jt.length;Oe<an;){var Se=2*(Oe+1)-1,dn=Jt[Se],jr=Se+1,Un=Jt[jr];if(dn!==void 0&&0>qt(dn,Je))Un!==void 0&&0>qt(Un,dn)?(Jt[Oe]=Un,Jt[jr]=Je,Oe=jr):(Jt[Oe]=dn,Jt[Se]=Je,Oe=Se);else if(Un!==void 0&&0>qt(Un,Je))Jt[Oe]=Un,Jt[jr]=Je,Oe=jr;else break t}}return Te}return null}function qt(Jt,Te){var Je=Jt.sortIndex-Te.sortIndex;return Je!==0?Je:Jt.id-Te.id}var ee=[],_e=[],ae=1,he=null,sn=3,ar=!1,gr=!1,mi=!1;function $i(Jt){for(var Te=Dt(_e);Te!==null;){if(Te.callback===null)kt(_e);else if(Te.startTime<=Jt)kt(_e),Te.sortIndex=Te.expirationTime,Ot(ee,Te);else break;Te=Dt(_e)}}function gi(Jt){if(mi=!1,$i(Jt),!gr)if(Dt(ee)!==null)gr=!0,t(Vr);else{var Te=Dt(_e);Te!==null&&n(gi,Te.startTime-Jt)}}function Vr(Jt,Te){gr=!1,mi&&(mi=!1,r()),ar=!0;var Je=sn;try{for($i(Te),he=Dt(ee);he!==null&&(!(he.expirationTime>Te)||Jt&&!o());){var Oe=he.callback;if(Oe!==null){he.callback=null,sn=he.priorityLevel;var an=Oe(he.expirationTime<=Te);Te=e.unstable_now(),typeof an=="function"?he.callback=an:he===Dt(ee)&&kt(ee),$i(Te)}else kt(ee);he=Dt(ee)}if(he!==null)var Se=!0;else{var dn=Dt(_e);dn!==null&&n(gi,dn.startTime-Te),Se=!1}return Se}finally{he=null,sn=Je,ar=!1}}function Sr(Jt){switch(Jt){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var ho=l;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Jt){Jt.callback=null},e.unstable_continueExecution=function(){gr||ar||(gr=!0,t(Vr))},e.unstable_getCurrentPriorityLevel=function(){return sn},e.unstable_getFirstCallbackNode=function(){return Dt(ee)},e.unstable_next=function(Jt){switch(sn){case 1:case 2:case 3:var Te=3;break;default:Te=sn}var Je=sn;sn=Te;try{return Jt()}finally{sn=Je}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=ho,e.unstable_runWithPriority=function(Jt,Te){switch(Jt){case 1:case 2:case 3:case 4:case 5:break;default:Jt=3}var Je=sn;sn=Jt;try{return Te()}finally{sn=Je}},e.unstable_scheduleCallback=function(Jt,Te,Je){var Oe=e.unstable_now();if(typeof Je=="object"&&Je!==null){var an=Je.delay;an=typeof an=="number"&&0<an?Oe+an:Oe,Je=typeof Je.timeout=="number"?Je.timeout:Sr(Jt)}else Je=Sr(Jt),an=Oe;return Je=an+Je,Jt={id:ae++,callback:Te,priorityLevel:Jt,startTime:an,expirationTime:Je,sortIndex:-1},an>Oe?(Jt.sortIndex=an,Ot(_e,Jt),Dt(ee)===null&&Jt===Dt(_e)&&(mi?r():mi=!0,n(gi,an-Oe))):(Jt.sortIndex=Je,Ot(ee,Jt),gr||ar||(gr=!0,t(Vr))),Jt},e.unstable_shouldYield=function(){var Jt=e.unstable_now();$i(Jt);var Te=Dt(ee);return Te!==he&&he!==null&&Te!==null&&Te.callback!==null&&Te.startTime<=Jt&&Te.expirationTime<he.expirationTime||o()},e.unstable_wrapCallback=function(Jt){var Te=sn;return function(){var Je=sn;sn=Te;try{return Jt.apply(this,arguments)}finally{sn=Je}}}})(tC);(function(e){e.exports=tC})(aR);/** @license React v16.14.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mv=Rt,qi=GA,pi=ux;function Kt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Mv)throw Error(Kt(227));function lR(e,t,n,r,o,l,s,p,g){var _=Array.prototype.slice.call(arguments,3);try{t.apply(n,_)}catch(w){this.onError(w)}}var jp=!1,My=null,Ly=!1,cx=null,uR={onError:function(e){jp=!0,My=e}};function cR(e,t,n,r,o,l,s,p,g){jp=!1,My=null,lR.apply(uR,arguments)}function hR(e,t,n,r,o,l,s,p,g){if(cR.apply(this,arguments),jp){if(jp){var _=My;jp=!1,My=null}else throw Error(Kt(198));Ly||(Ly=!0,cx=_)}}var K1=null,eC=null,nC=null;function vE(e,t,n){var r=e.type||"unknown-event";e.currentTarget=nC(n),hR(r,t,void 0,e),e.currentTarget=null}var ky=null,Lh={};function rC(){if(ky)for(var e in Lh){var t=Lh[e],n=ky.indexOf(e);if(!(-1<n))throw Error(Kt(96,e));if(!Oy[n]){if(!t.extractEvents)throw Error(Kt(97,e));Oy[n]=t,n=t.eventTypes;for(var r in n){var o=void 0,l=n[r],s=t,p=r;if(hx.hasOwnProperty(p))throw Error(Kt(99,p));hx[p]=l;var g=l.phasedRegistrationNames;if(g){for(o in g)g.hasOwnProperty(o)&&_E(g[o],s,p);o=!0}else l.registrationName?(_E(l.registrationName,s,p),o=!0):o=!1;if(!o)throw Error(Kt(98,r,e))}}}}function _E(e,t,n){if(ef[e])throw Error(Kt(100,e));ef[e]=t,J1[e]=t.eventTypes[n].dependencies}var Oy=[],hx={},ef={},J1={};function iC(e){var t=!1,n;for(n in e)if(e.hasOwnProperty(n)){var r=e[n];if(!Lh.hasOwnProperty(n)||Lh[n]!==r){if(Lh[n])throw Error(Kt(102,n));Lh[n]=r,t=!0}}t&&rC()}var au=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fx=null,Hh=null,qh=null;function xE(e){if(e=eC(e)){if(typeof fx!="function")throw Error(Kt(280));var t=e.stateNode;t&&(t=K1(t),fx(e.stateNode,e.type,t))}}function oC(e){Hh?qh?qh.push(e):qh=[e]:Hh=e}function sC(){if(Hh){var e=Hh,t=qh;if(qh=Hh=null,xE(e),t)for(e=0;e<t.length;e++)xE(t[e])}}function Q1(e,t){return e(t)}function aC(e,t,n,r,o){return e(t,n,r,o)}function tb(){}var lC=Q1,Yu=!1,K_=!1;function eb(){(Hh!==null||qh!==null)&&(tb(),sC())}function uC(e,t,n){if(K_)return e(t,n);K_=!0;try{return lC(e,t,n)}finally{K_=!1,eb()}}var fR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bE=Object.prototype.hasOwnProperty,wE={},TE={};function pR(e){return bE.call(TE,e)?!0:bE.call(wE,e)?!1:fR.test(e)?TE[e]=!0:(wE[e]=!0,!1)}function dR(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function mR(e,t,n,r){if(t===null||typeof t>"u"||dR(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Xi(e,t,n,r,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=l}var di={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){di[e]=new Xi(e,0,!1,e,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];di[t]=new Xi(t,1,!1,e[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){di[e]=new Xi(e,2,!1,e.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){di[e]=new Xi(e,2,!1,e,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){di[e]=new Xi(e,3,!1,e.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(e){di[e]=new Xi(e,3,!0,e,null,!1)});["capture","download"].forEach(function(e){di[e]=new Xi(e,4,!1,e,null,!1)});["cols","rows","size","span"].forEach(function(e){di[e]=new Xi(e,6,!1,e,null,!1)});["rowSpan","start"].forEach(function(e){di[e]=new Xi(e,5,!1,e.toLowerCase(),null,!1)});var nb=/[\-:]([a-z])/g;function rb(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(nb,rb);di[t]=new Xi(t,1,!1,e,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(nb,rb);di[t]=new Xi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(nb,rb);di[t]=new Xi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(e){di[e]=new Xi(e,1,!1,e.toLowerCase(),null,!1)});di.xlinkHref=new Xi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(e){di[e]=new Xi(e,1,!1,e.toLowerCase(),null,!0)});var hs=Mv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;hs.hasOwnProperty("ReactCurrentDispatcher")||(hs.ReactCurrentDispatcher={current:null});hs.hasOwnProperty("ReactCurrentBatchConfig")||(hs.ReactCurrentBatchConfig={suspense:null});function ib(e,t,n,r){var o=di.hasOwnProperty(t)?di[t]:null,l=o!==null?o.type===0:r?!1:!(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N");l||(mR(t,n,o,r)&&(n=null),r||o===null?pR(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var gR=/^(.*)[\\\/]/,co=typeof Symbol=="function"&&Symbol.for,ug=co?Symbol.for("react.element"):60103,kh=co?Symbol.for("react.portal"):60106,$u=co?Symbol.for("react.fragment"):60107,cC=co?Symbol.for("react.strict_mode"):60108,Qg=co?Symbol.for("react.profiler"):60114,hC=co?Symbol.for("react.provider"):60109,fC=co?Symbol.for("react.context"):60110,yR=co?Symbol.for("react.concurrent_mode"):60111,ob=co?Symbol.for("react.forward_ref"):60112,ty=co?Symbol.for("react.suspense"):60113,px=co?Symbol.for("react.suspense_list"):60120,sb=co?Symbol.for("react.memo"):60115,pC=co?Symbol.for("react.lazy"):60116,dC=co?Symbol.for("react.block"):60121,EE=typeof Symbol=="function"&&Symbol.iterator;function _p(e){return e===null||typeof e!="object"?null:(e=EE&&e[EE]||e["@@iterator"],typeof e=="function"?e:null)}function vR(e){if(e._status===-1){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then(function(n){e._status===0&&(n=n.default,e._status=1,e._result=n)},function(n){e._status===0&&(e._status=2,e._result=n)})}}function rl(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case $u:return"Fragment";case kh:return"Portal";case Qg:return"Profiler";case cC:return"StrictMode";case ty:return"Suspense";case px:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case fC:return"Context.Consumer";case hC:return"Context.Provider";case ob:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case sb:return rl(e.type);case dC:return rl(e.render);case pC:if(e=e._status===1?e._result:null)return rl(e)}return null}function ab(e){var t="";do{t:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break t;default:var r=e._debugOwner,o=e._debugSource,l=rl(e.type);n=null,r&&(n=rl(r.type)),r=l,l="",o?l=" (at "+o.fileName.replace(gR,"")+":"+o.lineNumber+")":n&&(l=" (created by "+n+")"),n=`
    in `+(r||"Unknown")+l}t+=n,e=e.return}while(e);return t}function eu(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function mC(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function _R(e){var t=mC(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(s){r=""+s,l.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function cg(e){e._valueTracker||(e._valueTracker=_R(e))}function gC(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=mC(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function dx(e,t){var n=t.checked;return qi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function SE(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=eu(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function yC(e,t){t=t.checked,t!=null&&ib(e,"checked",t,!1)}function mx(e,t){yC(e,t);var n=eu(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?gx(e,t.type,n):t.hasOwnProperty("defaultValue")&&gx(e,t.type,eu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function PE(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function gx(e,t,n){(t!=="number"||e.ownerDocument.activeElement!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function xR(e){var t="";return Mv.Children.forEach(e,function(n){n!=null&&(t+=n)}),t}function yx(e,t){return e=qi({children:void 0},t),(t=xR(t.children))&&(e.children=t),e}function Zh(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+eu(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function vx(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Kt(91));return qi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function AE(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Kt(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(Kt(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:eu(n)}}function vC(e,t){var n=eu(t.value),r=eu(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function CE(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}var _C={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function xC(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _x(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xC(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var hg,bC=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!==_C.svg||"innerHTML"in e)e.innerHTML=t;else{for(hg=hg||document.createElement("div"),hg.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=hg.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function od(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}function fg(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Oh={animationend:fg("Animation","AnimationEnd"),animationiteration:fg("Animation","AnimationIteration"),animationstart:fg("Animation","AnimationStart"),transitionend:fg("Transition","TransitionEnd")},J_={},wC={};au&&(wC=document.createElement("div").style,"AnimationEvent"in window||(delete Oh.animationend.animation,delete Oh.animationiteration.animation,delete Oh.animationstart.animation),"TransitionEvent"in window||delete Oh.transitionend.transition);function Lv(e){if(J_[e])return J_[e];if(!Oh[e])return e;var t=Oh[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in wC)return J_[e]=t[n];return e}var TC=Lv("animationend"),EC=Lv("animationiteration"),SC=Lv("animationstart"),PC=Lv("transitionend"),Dp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IE=new(typeof WeakMap=="function"?WeakMap:Map);function lb(e){var t=IE.get(e);return t===void 0&&(t=new Map,IE.set(e,t)),t}function bc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.effectTag&1026&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function AC(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ME(e){if(bc(e)!==e)throw Error(Kt(188))}function bR(e){var t=e.alternate;if(!t){if(t=bc(e),t===null)throw Error(Kt(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var l=o.alternate;if(l===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===n)return ME(o),e;if(l===r)return ME(o),t;l=l.sibling}throw Error(Kt(188))}if(n.return!==r.return)n=o,r=l;else{for(var s=!1,p=o.child;p;){if(p===n){s=!0,n=o,r=l;break}if(p===r){s=!0,r=o,n=l;break}p=p.sibling}if(!s){for(p=l.child;p;){if(p===n){s=!0,n=l,r=o;break}if(p===r){s=!0,r=l,n=o;break}p=p.sibling}if(!s)throw Error(Kt(189))}}if(n.alternate!==r)throw Error(Kt(190))}if(n.tag!==3)throw Error(Kt(188));return n.stateNode.current===n?e:t}function CC(e){if(e=bR(e),!e)return null;for(var t=e;;){if(t.tag===5||t.tag===6)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function nf(e,t){if(t==null)throw Error(Kt(30));return e==null?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function ub(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var xp=null;function wR(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)vE(e,t[r],n[r]);else t&&vE(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function kv(e){if(e!==null&&(xp=nf(xp,e)),e=xp,xp=null,e){if(ub(e,wR),xp)throw Error(Kt(95));if(Ly)throw e=cx,Ly=!1,cx=null,e}}function cb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}function IC(e){if(!au)return!1;e="on"+e;var t=e in document;return t||(t=document.createElement("div"),t.setAttribute(e,"return;"),t=typeof t[e]=="function"),t}var Ry=[];function MC(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>Ry.length&&Ry.push(e)}function LC(e,t,n,r){if(Ry.length){var o=Ry.pop();return o.topLevelType=e,o.eventSystemFlags=r,o.nativeEvent=t,o.targetInst=n,o}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function kC(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(r.tag===3)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=r.tag!==3?null:r.stateNode.containerInfo}if(!r)break;t=n.tag,t!==5&&t!==6||e.ancestors.push(n),n=zd(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var o=cb(e.nativeEvent);r=e.topLevelType;var l=e.nativeEvent,s=e.eventSystemFlags;n===0&&(s|=64);for(var p=null,g=0;g<Oy.length;g++){var _=Oy[g];_&&(_=_.extractEvents(r,t,l,o,s))&&(p=nf(p,_))}kv(p)}}function xx(e,t,n){if(!n.has(e)){switch(e){case"scroll":Fp(t,"scroll",!0);break;case"focus":case"blur":Fp(t,"focus",!0),Fp(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":IC(e)&&Fp(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:Dp.indexOf(e)===-1&&pr(e,t)}n.set(e,null)}}var OC,hb,RC,bx=!1,Js=[],Zl=null,Xl=null,$l=null,sd=new Map,ad=new Map,bp=[],wx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),TR="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function ER(e,t){var n=lb(t);wx.forEach(function(r){xx(r,t,n)}),TR.forEach(function(r){xx(r,t,n)})}function Tx(e,t,n,r,o){return{blockedOn:e,topLevelType:t,eventSystemFlags:n|32,nativeEvent:o,container:r}}function LE(e,t){switch(e){case"focus":case"blur":Zl=null;break;case"dragenter":case"dragleave":Xl=null;break;case"mouseover":case"mouseout":$l=null;break;case"pointerover":case"pointerout":sd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ad.delete(t.pointerId)}}function wp(e,t,n,r,o,l){return e===null||e.nativeEvent!==l?(e=Tx(t,n,r,o,l),t!==null&&(t=Dd(t),t!==null&&hb(t)),e):(e.eventSystemFlags|=r,e)}function SR(e,t,n,r,o){switch(t){case"focus":return Zl=wp(Zl,e,t,n,r,o),!0;case"dragenter":return Xl=wp(Xl,e,t,n,r,o),!0;case"mouseover":return $l=wp($l,e,t,n,r,o),!0;case"pointerover":var l=o.pointerId;return sd.set(l,wp(sd.get(l)||null,e,t,n,r,o)),!0;case"gotpointercapture":return l=o.pointerId,ad.set(l,wp(ad.get(l)||null,e,t,n,r,o)),!0}return!1}function PR(e){var t=zd(e.target);if(t!==null){var n=bc(t);if(n!==null){if(t=n.tag,t===13){if(t=AC(n),t!==null){e.blockedOn=t,pi.unstable_runWithPriority(e.priority,function(){RC(n)});return}}else if(t===3&&n.stateNode.hydrate){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ey(e){if(e.blockedOn!==null)return!1;var t=db(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(t!==null){var n=Dd(t);return n!==null&&hb(n),e.blockedOn=t,!1}return!0}function kE(e,t,n){ey(e)&&n.delete(t)}function AR(){for(bx=!1;0<Js.length;){var e=Js[0];if(e.blockedOn!==null){e=Dd(e.blockedOn),e!==null&&OC(e);break}var t=db(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);t!==null?e.blockedOn=t:Js.shift()}Zl!==null&&ey(Zl)&&(Zl=null),Xl!==null&&ey(Xl)&&(Xl=null),$l!==null&&ey($l)&&($l=null),sd.forEach(kE),ad.forEach(kE)}function Tp(e,t){e.blockedOn===t&&(e.blockedOn=null,bx||(bx=!0,pi.unstable_scheduleCallback(pi.unstable_NormalPriority,AR)))}function zC(e){function t(o){return Tp(o,e)}if(0<Js.length){Tp(Js[0],e);for(var n=1;n<Js.length;n++){var r=Js[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Zl!==null&&Tp(Zl,e),Xl!==null&&Tp(Xl,e),$l!==null&&Tp($l,e),sd.forEach(t),ad.forEach(t),n=0;n<bp.length;n++)r=bp[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<bp.length&&(n=bp[0],n.blockedOn===null);)PR(n),n.blockedOn===null&&bp.shift()}var DC={},FC=new Map,fb=new Map,CR=["abort","abort",TC,"animationEnd",EC,"animationIteration",SC,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",PC,"transitionEnd","waiting","waiting"];function pb(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],o=e[n+1],l="on"+(o[0].toUpperCase()+o.slice(1));l={phasedRegistrationNames:{bubbled:l,captured:l+"Capture"},dependencies:[r],eventPriority:t},fb.set(r,t),FC.set(r,l),DC[o]=l}}pb("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);pb("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);pb(CR,2);for(var OE="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Q_=0;Q_<OE.length;Q_++)fb.set(OE[Q_],0);var IR=pi.unstable_UserBlockingPriority,MR=pi.unstable_runWithPriority,ny=!0;function pr(e,t){Fp(t,e,!1)}function Fp(e,t,n){var r=fb.get(t);switch(r===void 0?2:r){case 0:r=LR.bind(null,t,1,e);break;case 1:r=kR.bind(null,t,1,e);break;default:r=Ov.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function LR(e,t,n,r){Yu||tb();var o=Ov,l=Yu;Yu=!0;try{aC(o,e,t,n,r)}finally{(Yu=l)||eb()}}function kR(e,t,n,r){MR(IR,Ov.bind(null,e,t,n,r))}function Ov(e,t,n,r){if(ny)if(0<Js.length&&-1<wx.indexOf(e))e=Tx(null,e,t,n,r),Js.push(e);else{var o=db(e,t,n,r);if(o===null)LE(e,r);else if(-1<wx.indexOf(e))e=Tx(o,e,t,n,r),Js.push(e);else if(!SR(o,e,t,n,r)){LE(e,r),e=LC(e,r,null,t);try{uC(kC,e)}finally{MC(e)}}}}function db(e,t,n,r){if(n=cb(r),n=zd(n),n!==null){var o=bc(n);if(o===null)n=null;else{var l=o.tag;if(l===13){if(n=AC(o),n!==null)return n;n=null}else if(l===3){if(o.stateNode.hydrate)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}e=LC(e,r,n,t);try{uC(kC,e)}finally{MC(e)}return null}var Gp={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},OR=["Webkit","ms","Moz","O"];Object.keys(Gp).forEach(function(e){OR.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Gp[t]=Gp[e]})});function NC(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Gp.hasOwnProperty(e)&&Gp[e]?(""+t).trim():t+"px"}function BC(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=NC(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var RR=qi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ex(e,t){if(t){if(RR[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Kt(137,e,""));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Kt(60));if(!(typeof t.dangerouslySetInnerHTML=="object"&&"__html"in t.dangerouslySetInnerHTML))throw Error(Kt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Kt(62,""))}}function Sx(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var RE=_C.html;function Ha(e,t){e=e.nodeType===9||e.nodeType===11?e:e.ownerDocument;var n=lb(e);t=J1[t];for(var r=0;r<t.length;r++)xx(t[r],e,n)}function zy(){}function Px(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function zE(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function DE(e,t){var n=zE(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}t:{for(;n;){if(n.nextSibling){n=n.nextSibling;break t}n=n.parentNode}n=void 0}n=zE(n)}}function UC(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?UC(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function FE(){for(var e=window,t=Px();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Px(e.document)}return t}function Ax(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var VC="$",jC="/$",mb="$?",gb="$!",t0=null,e0=null;function GC(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Cx(e,t){return e==="textarea"||e==="option"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var n0=typeof setTimeout=="function"?setTimeout:void 0,zR=typeof clearTimeout=="function"?clearTimeout:void 0;function Xh(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break}return e}function NE(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===VC||n===gb||n===mb){if(t===0)return e;t--}else n===jC&&t++}e=e.previousSibling}return null}var yb=Math.random().toString(36).slice(2),Ul="__reactInternalInstance$"+yb,Dy="__reactEventHandlers$"+yb,Rd="__reactContainere$"+yb;function zd(e){var t=e[Ul];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Rd]||n[Ul]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=NE(e);e!==null;){if(n=e[Ul])return n;e=NE(e)}return t}e=n,n=e.parentNode}return null}function Dd(e){return e=e[Ul]||e[Rd],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function lc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Kt(33))}function vb(e){return e[Dy]||null}function qa(e){do e=e.return;while(e&&e.tag!==5);return e||null}function WC(e,t){var n=e.stateNode;if(!n)return null;var r=K1(n);if(!r)return null;n=r[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break t;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Kt(231,t,typeof n));return n}function BE(e,t,n){(t=WC(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=nf(n._dispatchListeners,t),n._dispatchInstances=nf(n._dispatchInstances,e))}function DR(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=qa(t);for(t=n.length;0<t--;)BE(n[t],"captured",e);for(t=0;t<n.length;t++)BE(n[t],"bubbled",e)}}function Ix(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=WC(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=nf(n._dispatchListeners,t),n._dispatchInstances=nf(n._dispatchInstances,e))}function FR(e){e&&e.dispatchConfig.registrationName&&Ix(e._targetInst,null,e)}function rf(e){ub(e,DR)}var Vl=null,_b=null,ry=null;function HC(){if(ry)return ry;var e,t=_b,n=t.length,r,o="value"in Vl?Vl.value:Vl.textContent,l=o.length;for(e=0;e<n&&t[e]===o[e];e++);var s=n-e;for(r=1;r<=s&&t[n-r]===o[l-r];r++);return ry=o.slice(e,1<r?1-r:void 0)}function iy(){return!0}function Fy(){return!1}function Mo(e,t,n,r){this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface;for(var o in e)e.hasOwnProperty(o)&&((t=e[o])?this[o]=t(n):o==="target"?this.target=r:this[o]=n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?iy:Fy,this.isPropagationStopped=Fy,this}qi(Mo.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!="unknown"&&(e.returnValue=!1),this.isDefaultPrevented=iy)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!="unknown"&&(e.cancelBubble=!0),this.isPropagationStopped=iy)},persist:function(){this.isPersistent=iy},isPersistent:Fy,destructor:function(){var e=this.constructor.Interface,t;for(t in e)this[t]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Fy,this._dispatchInstances=this._dispatchListeners=null}});Mo.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};Mo.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var o=new t;return qi(o,n.prototype),n.prototype=o,n.prototype.constructor=n,n.Interface=qi({},r.Interface,e),n.extend=r.extend,qC(n),n};qC(Mo);function NR(e,t,n,r){if(this.eventPool.length){var o=this.eventPool.pop();return this.call(o,e,t,n,r),o}return new this(e,t,n,r)}function BR(e){if(!(e instanceof this))throw Error(Kt(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function qC(e){e.eventPool=[],e.getPooled=NR,e.release=BR}var UR=Mo.extend({data:null}),VR=Mo.extend({data:null}),jR=[9,13,27,32],xb=au&&"CompositionEvent"in window,Wp=null;au&&"documentMode"in document&&(Wp=document.documentMode);var GR=au&&"TextEvent"in window&&!Wp,ZC=au&&(!xb||Wp&&8<Wp&&11>=Wp),UE=String.fromCharCode(32),Ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},VE=!1;function XC(e,t){switch(e){case"keyup":return jR.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function $C(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rh=!1;function WR(e,t){switch(e){case"compositionend":return $C(t);case"keypress":return t.which!==32?null:(VE=!0,UE);case"textInput":return e=t.data,e===UE&&VE?null:e;default:return null}}function HR(e,t){if(Rh)return e==="compositionend"||!xb&&XC(e,t)?(e=HC(),ry=_b=Vl=null,Rh=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ZC&&t.locale!=="ko"?null:t.data;default:return null}}var qR={eventTypes:Ua,extractEvents:function(e,t,n,r){var o;if(xb)t:{switch(e){case"compositionstart":var l=Ua.compositionStart;break t;case"compositionend":l=Ua.compositionEnd;break t;case"compositionupdate":l=Ua.compositionUpdate;break t}l=void 0}else Rh?XC(e,n)&&(l=Ua.compositionEnd):e==="keydown"&&n.keyCode===229&&(l=Ua.compositionStart);return l?(ZC&&n.locale!=="ko"&&(Rh||l!==Ua.compositionStart?l===Ua.compositionEnd&&Rh&&(o=HC()):(Vl=r,_b="value"in Vl?Vl.value:Vl.textContent,Rh=!0)),l=UR.getPooled(l,t,n,r),o?l.data=o:(o=$C(n),o!==null&&(l.data=o)),rf(l),o=l):o=null,(e=GR?WR(e,n):HR(e,n))?(t=VR.getPooled(Ua.beforeInput,t,n,r),t.data=e,rf(t)):t=null,o===null?t:t===null?o:[o,t]}},ZR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function YC(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ZR[e.type]:t==="textarea"}var KC={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function JC(e,t,n){return e=Mo.getPooled(KC.change,e,t,n),e.type="change",oC(n),rf(e),e}var Hp=null,ld=null;function XR(e){kv(e)}function Rv(e){var t=lc(e);if(gC(t))return e}function $R(e,t){if(e==="change")return t}var Mx=!1;au&&(Mx=IC("input")&&(!document.documentMode||9<document.documentMode));function jE(){Hp&&(Hp.detachEvent("onpropertychange",QC),ld=Hp=null)}function QC(e){if(e.propertyName==="value"&&Rv(ld))if(e=JC(ld,e,cb(e)),Yu)kv(e);else{Yu=!0;try{Q1(XR,e)}finally{Yu=!1,eb()}}}function YR(e,t,n){e==="focus"?(jE(),Hp=t,ld=n,Hp.attachEvent("onpropertychange",QC)):e==="blur"&&jE()}function KR(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Rv(ld)}function JR(e,t){if(e==="click")return Rv(t)}function QR(e,t){if(e==="input"||e==="change")return Rv(t)}var tz={eventTypes:KC,_isInputEventSupported:Mx,extractEvents:function(e,t,n,r){var o=t?lc(t):window,l=o.nodeName&&o.nodeName.toLowerCase();if(l==="select"||l==="input"&&o.type==="file")var s=$R;else if(YC(o))if(Mx)s=QR;else{s=KR;var p=YR}else(l=o.nodeName)&&l.toLowerCase()==="input"&&(o.type==="checkbox"||o.type==="radio")&&(s=JR);if(s&&(s=s(e,t)))return JC(s,n,r);p&&p(e,o,t),e==="blur"&&(e=o._wrapperState)&&e.controlled&&o.type==="number"&&gx(o,"number",o.value)}},Fd=Mo.extend({view:null,detail:null}),ez={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nz(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ez[e])?!!t[e]:!1}function bb(){return nz}var GE=0,WE=0,HE=!1,qE=!1,Nd=Fd.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:bb,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=GE;return GE=e.screenX,HE?e.type==="mousemove"?e.screenX-t:0:(HE=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=WE;return WE=e.screenY,qE?e.type==="mousemove"?e.screenY-t:0:(qE=!0,0)}}),tI=Nd.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Ep={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},rz={eventTypes:Ep,extractEvents:function(e,t,n,r,o){var l=e==="mouseover"||e==="pointerover",s=e==="mouseout"||e==="pointerout";if(l&&!(o&32)&&(n.relatedTarget||n.fromElement)||!s&&!l)return null;if(l=r.window===r?r:(l=r.ownerDocument)?l.defaultView||l.parentWindow:window,s){if(s=t,t=(t=n.relatedTarget||n.toElement)?zd(t):null,t!==null){var p=bc(t);(t!==p||t.tag!==5&&t.tag!==6)&&(t=null)}}else s=null;if(s===t)return null;if(e==="mouseout"||e==="mouseover")var g=Nd,_=Ep.mouseLeave,w=Ep.mouseEnter,P="mouse";else(e==="pointerout"||e==="pointerover")&&(g=tI,_=Ep.pointerLeave,w=Ep.pointerEnter,P="pointer");if(e=s==null?l:lc(s),l=t==null?l:lc(t),_=g.getPooled(_,s,n,r),_.type=P+"leave",_.target=e,_.relatedTarget=l,n=g.getPooled(w,t,n,r),n.type=P+"enter",n.target=l,n.relatedTarget=e,r=s,P=t,r&&P)t:{for(g=r,w=P,s=0,e=g;e;e=qa(e))s++;for(e=0,t=w;t;t=qa(t))e++;for(;0<s-e;)g=qa(g),s--;for(;0<e-s;)w=qa(w),e--;for(;s--;){if(g===w||g===w.alternate)break t;g=qa(g),w=qa(w)}g=null}else g=null;for(w=g,g=[];r&&r!==w&&(s=r.alternate,!(s!==null&&s===w));)g.push(r),r=qa(r);for(r=[];P&&P!==w&&(s=P.alternate,!(s!==null&&s===w));)r.push(P),P=qa(P);for(P=0;P<g.length;P++)Ix(g[P],"bubbled",_);for(P=r.length;0<P--;)Ix(r[P],"captured",n);return o&64?[_,n]:[_]}};function iz(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var uc=typeof Object.is=="function"?Object.is:iz,oz=Object.prototype.hasOwnProperty;function ud(e,t){if(uc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!oz.call(t,n[r])||!uc(e[n[r]],t[n[r]]))return!1;return!0}var sz=au&&"documentMode"in document&&11>=document.documentMode,eI={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},zh=null,Lx=null,qp=null,kx=!1;function ZE(e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;return kx||zh==null||zh!==Px(n)?null:(n=zh,"selectionStart"in n&&Ax(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),qp&&ud(qp,n)?null:(qp=n,e=Mo.getPooled(eI.select,Lx,e,t),e.type="select",e.target=zh,rf(e),e))}var az={eventTypes:eI,extractEvents:function(e,t,n,r,o,l){if(o=l||(r.window===r?r.document:r.nodeType===9?r:r.ownerDocument),!(l=!o)){t:{o=lb(o),l=J1.onSelect;for(var s=0;s<l.length;s++)if(!o.has(l[s])){o=!1;break t}o=!0}l=!o}if(l)return null;switch(o=t?lc(t):window,e){case"focus":(YC(o)||o.contentEditable==="true")&&(zh=o,Lx=t,qp=null);break;case"blur":qp=Lx=zh=null;break;case"mousedown":kx=!0;break;case"contextmenu":case"mouseup":case"dragend":return kx=!1,ZE(n,r);case"selectionchange":if(sz)break;case"keydown":case"keyup":return ZE(n,r)}return null}},lz=Mo.extend({animationName:null,elapsedTime:null,pseudoElement:null}),uz=Mo.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),cz=Fd.extend({relatedTarget:null});function oy(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}var hz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pz=Fd.extend({key:function(e){if(e.key){var t=hz[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=oy(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?fz[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:bb,charCode:function(e){return e.type==="keypress"?oy(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?oy(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),dz=Nd.extend({dataTransfer:null}),mz=Fd.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:bb}),gz=Mo.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),yz=Nd.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),vz={eventTypes:DC,extractEvents:function(e,t,n,r){var o=FC.get(e);if(!o)return null;switch(e){case"keypress":if(oy(n)===0)return null;case"keydown":case"keyup":e=pz;break;case"blur":case"focus":e=cz;break;case"click":if(n.button===2)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Nd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=dz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=mz;break;case TC:case EC:case SC:e=lz;break;case PC:e=gz;break;case"scroll":e=Fd;break;case"wheel":e=yz;break;case"copy":case"cut":case"paste":e=uz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=tI;break;default:e=Mo}return t=e.getPooled(o,t,n,r),rf(t),t}};if(ky)throw Error(Kt(101));ky=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));rC();var _z=Dd;K1=vb;eC=_z;nC=lc;iC({SimpleEventPlugin:vz,EnterLeaveEventPlugin:rz,ChangeEventPlugin:tz,SelectEventPlugin:az,BeforeInputEventPlugin:qR});var Ox=[],Dh=-1;function sr(e){0>Dh||(e.current=Ox[Dh],Ox[Dh]=null,Dh--)}function Or(e,t){Dh++,Ox[Dh]=e.current,e.current=t}var nu={},Fi={current:nu},ao={current:!1},cc=nu;function of(e,t){var n=e.type.contextTypes;if(!n)return nu;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},l;for(l in n)o[l]=t[l];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function lo(e){return e=e.childContextTypes,e!=null}function Ny(){sr(ao),sr(Fi)}function XE(e,t,n){if(Fi.current!==nu)throw Error(Kt(168));Or(Fi,t),Or(ao,n)}function nI(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in e))throw Error(Kt(108,rl(t)||"Unknown",o));return qi({},n,{},r)}function sy(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||nu,cc=Fi.current,Or(Fi,e),Or(ao,ao.current),!0}function $E(e,t,n){var r=e.stateNode;if(!r)throw Error(Kt(169));n?(e=nI(e,t,cc),r.__reactInternalMemoizedMergedChildContext=e,sr(ao),sr(Fi),Or(Fi,e)):sr(ao),Or(ao,n)}var xz=pi.unstable_runWithPriority,wb=pi.unstable_scheduleCallback,rI=pi.unstable_cancelCallback,YE=pi.unstable_requestPaint,Rx=pi.unstable_now,bz=pi.unstable_getCurrentPriorityLevel,zv=pi.unstable_ImmediatePriority,iI=pi.unstable_UserBlockingPriority,oI=pi.unstable_NormalPriority,sI=pi.unstable_LowPriority,aI=pi.unstable_IdlePriority,lI={},wz=pi.unstable_shouldYield,Tz=YE!==void 0?YE:function(){},$a=null,ay=null,r0=!1,KE=Rx(),Bo=1e4>KE?Rx:function(){return Rx()-KE};function Dv(){switch(bz()){case zv:return 99;case iI:return 98;case oI:return 97;case sI:return 96;case aI:return 95;default:throw Error(Kt(332))}}function uI(e){switch(e){case 99:return zv;case 98:return iI;case 97:return oI;case 96:return sI;case 95:return aI;default:throw Error(Kt(332))}}function ru(e,t){return e=uI(e),xz(e,t)}function cI(e,t,n){return e=uI(e),wb(e,t,n)}function JE(e){return $a===null?($a=[e],ay=wb(zv,hI)):$a.push(e),lI}function ua(){if(ay!==null){var e=ay;ay=null,rI(e)}hI()}function hI(){if(!r0&&$a!==null){r0=!0;var e=0;try{var t=$a;ru(99,function(){for(;e<t.length;e++){var n=t[e];do n=n(!0);while(n!==null)}}),$a=null}catch(n){throw $a!==null&&($a=$a.slice(e+1)),wb(zv,ua),n}finally{r0=!1}}}function ly(e,t,n){return n/=10,1073741821-(((1073741821-e+t/10)/n|0)+1)*n}function is(e,t){if(e&&e.defaultProps){t=qi({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n])}return t}var By={current:null},Uy=null,Fh=null,Vy=null;function Tb(){Vy=Fh=Uy=null}function Eb(e){var t=By.current;sr(By),e.type._context._currentValue=t}function fI(e,t){for(;e!==null;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,n!==null&&n.childExpirationTime<t&&(n.childExpirationTime=t);else if(n!==null&&n.childExpirationTime<t)n.childExpirationTime=t;else break;e=e.return}}function $h(e,t){Uy=e,Vy=Fh=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.expirationTime>=t&&(Qs=!0),e.firstContext=null)}function Go(e,t){if(Vy!==e&&t!==!1&&t!==0)if((typeof t!="number"||t===1073741823)&&(Vy=e,t=1073741823),t={context:e,observedBits:t,next:null},Fh===null){if(Uy===null)throw Error(Kt(308));Fh=t,Uy.dependencies={expirationTime:0,firstContext:t,responders:null}}else Fh=Fh.next=t;return e._currentValue}var Bl=!1;function Sb(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function Pb(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function Yl(e,t){return e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null},e.next=e}function Kl(e,t){if(e=e.updateQueue,e!==null){e=e.shared;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function QE(e,t){var n=e.alternate;n!==null&&Pb(n,e),e=e.updateQueue,n=e.baseQueue,n===null?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function cd(e,t,n,r){var o=e.updateQueue;Bl=!1;var l=o.baseQueue,s=o.shared.pending;if(s!==null){if(l!==null){var p=l.next;l.next=s.next,s.next=p}l=s,o.shared.pending=null,p=e.alternate,p!==null&&(p=p.updateQueue,p!==null&&(p.baseQueue=s))}if(l!==null){p=l.next;var g=o.baseState,_=0,w=null,P=null,A=null;if(p!==null){var M=p;do{if(s=M.expirationTime,s<r){var F={expirationTime:M.expirationTime,suspenseConfig:M.suspenseConfig,tag:M.tag,payload:M.payload,callback:M.callback,next:null};A===null?(P=A=F,w=g):A=A.next=F,s>_&&(_=s)}else{A!==null&&(A=A.next={expirationTime:1073741823,suspenseConfig:M.suspenseConfig,tag:M.tag,payload:M.payload,callback:M.callback,next:null}),jI(s,M.suspenseConfig);t:{var X=e,B=M;switch(s=t,F=n,B.tag){case 1:if(X=B.payload,typeof X=="function"){g=X.call(F,g,s);break t}g=X;break t;case 3:X.effectTag=X.effectTag&-4097|64;case 0:if(X=B.payload,s=typeof X=="function"?X.call(F,g,s):X,s==null)break t;g=qi({},g,s);break t;case 2:Bl=!0}}M.callback!==null&&(e.effectTag|=32,s=o.effects,s===null?o.effects=[M]:s.push(M))}if(M=M.next,M===null||M===p){if(s=o.shared.pending,s===null)break;M=l.next=s.next,s.next=p,o.baseQueue=l=s,o.shared.pending=null}}while(1)}A===null?w=g:A.next=P,o.baseState=w,o.baseQueue=A,Vv(_),e.expirationTime=_,e.memoizedState=g}}function tS(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=o,o=n,typeof r!="function")throw Error(Kt(191,r));r.call(o)}}}var Zp=hs.ReactCurrentBatchConfig,pI=new Mv.Component().refs;function jy(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:qi({},t,n),e.memoizedState=n,e.expirationTime===0&&(e.updateQueue.baseState=n)}var Fv={isMounted:function(e){return(e=e._reactInternalFiber)?bc(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=na(),o=Zp.suspense;r=sc(r,e,o),o=Yl(r,o),o.payload=t,n!=null&&(o.callback=n),Kl(e,o),Ql(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=na(),o=Zp.suspense;r=sc(r,e,o),o=Yl(r,o),o.tag=1,o.payload=t,n!=null&&(o.callback=n),Kl(e,o),Ql(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=na(),r=Zp.suspense;n=sc(n,e,r),r=Yl(n,r),r.tag=2,t!=null&&(r.callback=t),Kl(e,r),Ql(e,n)}};function eS(e,t,n,r,o,l,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,l,s):t.prototype&&t.prototype.isPureReactComponent?!ud(n,r)||!ud(o,l):!0}function dI(e,t,n){var r=!1,o=nu,l=t.contextType;return typeof l=="object"&&l!==null?l=Go(l):(o=lo(t)?cc:Fi.current,r=t.contextTypes,l=(r=r!=null)?of(e,o):nu),t=new t(n,l),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Fv,e.stateNode=t,t._reactInternalFiber=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=l),t}function nS(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Fv.enqueueReplaceState(t,t.state,null)}function zx(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=pI,Sb(e);var l=t.contextType;typeof l=="object"&&l!==null?o.context=Go(l):(l=lo(t)?cc:Fi.current,o.context=of(e,l)),cd(e,n,o,r),o.state=e.memoizedState,l=t.getDerivedStateFromProps,typeof l=="function"&&(jy(e,t,l,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Fv.enqueueReplaceState(o,o.state,null),cd(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.effectTag|=4)}var pg=Array.isArray;function Sp(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Kt(309));var r=n.stateNode}if(!r)throw Error(Kt(147,e));var o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var s=r.refs;s===pI&&(s=r.refs={}),l===null?delete s[o]:s[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(Kt(284));if(!n._owner)throw Error(Kt(290,e))}return e}function dg(e,t){if(e.type!=="textarea")throw Error(Kt(31,Object.prototype.toString.call(t)==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function mI(e){function t(B,U){if(e){var H=B.lastEffect;H!==null?(H.nextEffect=U,B.lastEffect=U):B.firstEffect=B.lastEffect=U,U.nextEffect=null,U.effectTag=8}}function n(B,U){if(!e)return null;for(;U!==null;)t(B,U),U=U.sibling;return null}function r(B,U){for(B=new Map;U!==null;)U.key!==null?B.set(U.key,U):B.set(U.index,U),U=U.sibling;return B}function o(B,U){return B=hc(B,U),B.index=0,B.sibling=null,B}function l(B,U,H){return B.index=H,e?(H=B.alternate,H!==null?(H=H.index,H<U?(B.effectTag=2,U):H):(B.effectTag=2,U)):U}function s(B){return e&&B.alternate===null&&(B.effectTag=2),B}function p(B,U,H,tt){return U===null||U.tag!==6?(U=u0(H,B.mode,tt),U.return=B,U):(U=o(U,H),U.return=B,U)}function g(B,U,H,tt){return U!==null&&U.elementType===H.type?(tt=o(U,H.props),tt.ref=Sp(B,U,H),tt.return=B,tt):(tt=fy(H.type,H.key,H.props,null,B.mode,tt),tt.ref=Sp(B,U,H),tt.return=B,tt)}function _(B,U,H,tt){return U===null||U.tag!==4||U.stateNode.containerInfo!==H.containerInfo||U.stateNode.implementation!==H.implementation?(U=c0(H,B.mode,tt),U.return=B,U):(U=o(U,H.children||[]),U.return=B,U)}function w(B,U,H,tt,st){return U===null||U.tag!==7?(U=Wl(H,B.mode,tt,st),U.return=B,U):(U=o(U,H),U.return=B,U)}function P(B,U,H){if(typeof U=="string"||typeof U=="number")return U=u0(""+U,B.mode,H),U.return=B,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case ug:return H=fy(U.type,U.key,U.props,null,B.mode,H),H.ref=Sp(B,null,U),H.return=B,H;case kh:return U=c0(U,B.mode,H),U.return=B,U}if(pg(U)||_p(U))return U=Wl(U,B.mode,H,null),U.return=B,U;dg(B,U)}return null}function A(B,U,H,tt){var st=U!==null?U.key:null;if(typeof H=="string"||typeof H=="number")return st!==null?null:p(B,U,""+H,tt);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case ug:return H.key===st?H.type===$u?w(B,U,H.props.children,tt,st):g(B,U,H,tt):null;case kh:return H.key===st?_(B,U,H,tt):null}if(pg(H)||_p(H))return st!==null?null:w(B,U,H,tt,null);dg(B,H)}return null}function M(B,U,H,tt,st){if(typeof tt=="string"||typeof tt=="number")return B=B.get(H)||null,p(U,B,""+tt,st);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case ug:return B=B.get(tt.key===null?H:tt.key)||null,tt.type===$u?w(U,B,tt.props.children,st,tt.key):g(U,B,tt,st);case kh:return B=B.get(tt.key===null?H:tt.key)||null,_(U,B,tt,st)}if(pg(tt)||_p(tt))return B=B.get(H)||null,w(U,B,tt,st,null);dg(U,tt)}return null}function F(B,U,H,tt){for(var st=null,pt=null,_t=U,Ot=U=0,Dt=null;_t!==null&&Ot<H.length;Ot++){_t.index>Ot?(Dt=_t,_t=null):Dt=_t.sibling;var kt=A(B,_t,H[Ot],tt);if(kt===null){_t===null&&(_t=Dt);break}e&&_t&&kt.alternate===null&&t(B,_t),U=l(kt,U,Ot),pt===null?st=kt:pt.sibling=kt,pt=kt,_t=Dt}if(Ot===H.length)return n(B,_t),st;if(_t===null){for(;Ot<H.length;Ot++)_t=P(B,H[Ot],tt),_t!==null&&(U=l(_t,U,Ot),pt===null?st=_t:pt.sibling=_t,pt=_t);return st}for(_t=r(B,_t);Ot<H.length;Ot++)Dt=M(_t,B,Ot,H[Ot],tt),Dt!==null&&(e&&Dt.alternate!==null&&_t.delete(Dt.key===null?Ot:Dt.key),U=l(Dt,U,Ot),pt===null?st=Dt:pt.sibling=Dt,pt=Dt);return e&&_t.forEach(function(qt){return t(B,qt)}),st}function X(B,U,H,tt){var st=_p(H);if(typeof st!="function")throw Error(Kt(150));if(H=st.call(H),H==null)throw Error(Kt(151));for(var pt=st=null,_t=U,Ot=U=0,Dt=null,kt=H.next();_t!==null&&!kt.done;Ot++,kt=H.next()){_t.index>Ot?(Dt=_t,_t=null):Dt=_t.sibling;var qt=A(B,_t,kt.value,tt);if(qt===null){_t===null&&(_t=Dt);break}e&&_t&&qt.alternate===null&&t(B,_t),U=l(qt,U,Ot),pt===null?st=qt:pt.sibling=qt,pt=qt,_t=Dt}if(kt.done)return n(B,_t),st;if(_t===null){for(;!kt.done;Ot++,kt=H.next())kt=P(B,kt.value,tt),kt!==null&&(U=l(kt,U,Ot),pt===null?st=kt:pt.sibling=kt,pt=kt);return st}for(_t=r(B,_t);!kt.done;Ot++,kt=H.next())kt=M(_t,B,Ot,kt.value,tt),kt!==null&&(e&&kt.alternate!==null&&_t.delete(kt.key===null?Ot:kt.key),U=l(kt,U,Ot),pt===null?st=kt:pt.sibling=kt,pt=kt);return e&&_t.forEach(function(ee){return t(B,ee)}),st}return function(B,U,H,tt){var st=typeof H=="object"&&H!==null&&H.type===$u&&H.key===null;st&&(H=H.props.children);var pt=typeof H=="object"&&H!==null;if(pt)switch(H.$$typeof){case ug:t:{for(pt=H.key,st=U;st!==null;){if(st.key===pt){switch(st.tag){case 7:if(H.type===$u){n(B,st.sibling),U=o(st,H.props.children),U.return=B,B=U;break t}break;default:if(st.elementType===H.type){n(B,st.sibling),U=o(st,H.props),U.ref=Sp(B,st,H),U.return=B,B=U;break t}}n(B,st);break}else t(B,st);st=st.sibling}H.type===$u?(U=Wl(H.props.children,B.mode,tt,H.key),U.return=B,B=U):(tt=fy(H.type,H.key,H.props,null,B.mode,tt),tt.ref=Sp(B,U,H),tt.return=B,B=tt)}return s(B);case kh:t:{for(st=H.key;U!==null;){if(U.key===st)if(U.tag===4&&U.stateNode.containerInfo===H.containerInfo&&U.stateNode.implementation===H.implementation){n(B,U.sibling),U=o(U,H.children||[]),U.return=B,B=U;break t}else{n(B,U);break}else t(B,U);U=U.sibling}U=c0(H,B.mode,tt),U.return=B,B=U}return s(B)}if(typeof H=="string"||typeof H=="number")return H=""+H,U!==null&&U.tag===6?(n(B,U.sibling),U=o(U,H),U.return=B,B=U):(n(B,U),U=u0(H,B.mode,tt),U.return=B,B=U),s(B);if(pg(H))return F(B,U,H,tt);if(_p(H))return X(B,U,H,tt);if(pt&&dg(B,H),typeof H>"u"&&!st)switch(B.tag){case 1:case 0:throw B=B.type,Error(Kt(152,B.displayName||B.name||"Component"))}return n(B,U)}}var sf=mI(!0),Ab=mI(!1),Bd={},ea={current:Bd},hd={current:Bd},fd={current:Bd};function Ku(e){if(e===Bd)throw Error(Kt(174));return e}function Dx(e,t){switch(Or(fd,t),Or(hd,e),Or(ea,Bd),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_x(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_x(t,e)}sr(ea),Or(ea,t)}function af(){sr(ea),sr(hd),sr(fd)}function rS(e){Ku(fd.current);var t=Ku(ea.current),n=_x(t,e.type);t!==n&&(Or(hd,e),Or(ea,n))}function Cb(e){hd.current===e&&(sr(ea),sr(hd))}var Er={current:0};function Gy(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data===mb||n.data===gb))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.effectTag&64)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Ib(e,t){return{responder:e,props:t}}var uy=hs.ReactCurrentDispatcher,Vo=hs.ReactCurrentBatchConfig,jl=0,$r=null,ki=null,Oi=null,Wy=!1;function bo(){throw Error(Kt(321))}function Mb(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!uc(e[n],t[n]))return!1;return!0}function Lb(e,t,n,r,o,l){if(jl=l,$r=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,uy.current=e===null||e.memoizedState===null?Ez:Sz,e=n(r,o),t.expirationTime===jl){l=0;do{if(t.expirationTime=0,!(25>l))throw Error(Kt(301));l+=1,Oi=ki=null,t.updateQueue=null,uy.current=Pz,e=n(r,o)}while(t.expirationTime===jl)}if(uy.current=Zy,t=ki!==null&&ki.next!==null,jl=0,Oi=ki=$r=null,Wy=!1,t)throw Error(Kt(300));return e}function Yh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?$r.memoizedState=Oi=e:Oi=Oi.next=e,Oi}function _f(){if(ki===null){var e=$r.alternate;e=e!==null?e.memoizedState:null}else e=ki.next;var t=Oi===null?$r.memoizedState:Oi.next;if(t!==null)Oi=t,ki=e;else{if(e===null)throw Error(Kt(310));ki=e,e={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},Oi===null?$r.memoizedState=Oi=e:Oi=Oi.next=e}return Oi}function rc(e,t){return typeof t=="function"?t(e):t}function mg(e){var t=_f(),n=t.queue;if(n===null)throw Error(Kt(311));n.lastRenderedReducer=e;var r=ki,o=r.baseQueue,l=n.pending;if(l!==null){if(o!==null){var s=o.next;o.next=l.next,l.next=s}r.baseQueue=o=l,n.pending=null}if(o!==null){o=o.next,r=r.baseState;var p=s=l=null,g=o;do{var _=g.expirationTime;if(_<jl){var w={expirationTime:g.expirationTime,suspenseConfig:g.suspenseConfig,action:g.action,eagerReducer:g.eagerReducer,eagerState:g.eagerState,next:null};p===null?(s=p=w,l=r):p=p.next=w,_>$r.expirationTime&&($r.expirationTime=_,Vv(_))}else p!==null&&(p=p.next={expirationTime:1073741823,suspenseConfig:g.suspenseConfig,action:g.action,eagerReducer:g.eagerReducer,eagerState:g.eagerState,next:null}),jI(_,g.suspenseConfig),r=g.eagerReducer===e?g.eagerState:e(r,g.action);g=g.next}while(g!==null&&g!==o);p===null?l=r:p.next=s,uc(r,t.memoizedState)||(Qs=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=p,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function gg(e){var t=_f(),n=t.queue;if(n===null)throw Error(Kt(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,l=t.memoizedState;if(o!==null){n.pending=null;var s=o=o.next;do l=e(l,s.action),s=s.next;while(s!==o);uc(l,t.memoizedState)||(Qs=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),n.lastRenderedState=l}return[l,r]}function i0(e){var t=Yh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e=t.queue={pending:null,dispatch:null,lastRenderedReducer:rc,lastRenderedState:e},e=e.dispatch=bI.bind(null,$r,e),[t.memoizedState,e]}function Fx(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=$r.updateQueue,t===null?(t={lastEffect:null},$r.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function gI(){return _f().memoizedState}function Nx(e,t,n,r){var o=Yh();$r.effectTag|=e,o.memoizedState=Fx(1|t,n,void 0,r===void 0?null:r)}function kb(e,t,n,r){var o=_f();r=r===void 0?null:r;var l=void 0;if(ki!==null){var s=ki.memoizedState;if(l=s.destroy,r!==null&&Mb(r,s.deps)){Fx(t,n,l,r);return}}$r.effectTag|=e,o.memoizedState=Fx(1|t,n,l,r)}function iS(e,t){return Nx(516,4,e,t)}function Hy(e,t){return kb(516,4,e,t)}function yI(e,t){return kb(4,2,e,t)}function vI(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function _I(e,t,n){return n=n!=null?n.concat([e]):null,kb(4,2,vI.bind(null,t,e),n)}function Ob(){}function oS(e,t){return Yh().memoizedState=[e,t===void 0?null:t],e}function qy(e,t){var n=_f();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Mb(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function xI(e,t){var n=_f();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Mb(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Rb(e,t,n){var r=Dv();ru(98>r?98:r,function(){e(!0)}),ru(97<r?97:r,function(){var o=Vo.suspense;Vo.suspense=t===void 0?null:t;try{e(!1),n()}finally{Vo.suspense=o}})}function bI(e,t,n){var r=na(),o=Zp.suspense;r=sc(r,e,o),o={expirationTime:r,suspenseConfig:o,action:n,eagerReducer:null,eagerState:null,next:null};var l=t.pending;if(l===null?o.next=o:(o.next=l.next,l.next=o),t.pending=o,l=e.alternate,e===$r||l!==null&&l===$r)Wy=!0,o.expirationTime=jl,$r.expirationTime=jl;else{if(e.expirationTime===0&&(l===null||l.expirationTime===0)&&(l=t.lastRenderedReducer,l!==null))try{var s=t.lastRenderedState,p=l(s,n);if(o.eagerReducer=l,o.eagerState=p,uc(p,s))return}catch{}finally{}Ql(e,r)}}var Zy={readContext:Go,useCallback:bo,useContext:bo,useEffect:bo,useImperativeHandle:bo,useLayoutEffect:bo,useMemo:bo,useReducer:bo,useRef:bo,useState:bo,useDebugValue:bo,useResponder:bo,useDeferredValue:bo,useTransition:bo},Ez={readContext:Go,useCallback:oS,useContext:Go,useEffect:iS,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Nx(4,2,vI.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Nx(4,2,e,t)},useMemo:function(e,t){var n=Yh();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Yh();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=bI.bind(null,$r,e),[r.memoizedState,e]},useRef:function(e){var t=Yh();return e={current:e},t.memoizedState=e},useState:i0,useDebugValue:Ob,useResponder:Ib,useDeferredValue:function(e,t){var n=i0(e),r=n[0],o=n[1];return iS(function(){var l=Vo.suspense;Vo.suspense=t===void 0?null:t;try{o(e)}finally{Vo.suspense=l}},[e,t]),r},useTransition:function(e){var t=i0(!1),n=t[0];return t=t[1],[oS(Rb.bind(null,t,e),[t,e]),n]}},Sz={readContext:Go,useCallback:qy,useContext:Go,useEffect:Hy,useImperativeHandle:_I,useLayoutEffect:yI,useMemo:xI,useReducer:mg,useRef:gI,useState:function(){return mg(rc)},useDebugValue:Ob,useResponder:Ib,useDeferredValue:function(e,t){var n=mg(rc),r=n[0],o=n[1];return Hy(function(){var l=Vo.suspense;Vo.suspense=t===void 0?null:t;try{o(e)}finally{Vo.suspense=l}},[e,t]),r},useTransition:function(e){var t=mg(rc),n=t[0];return t=t[1],[qy(Rb.bind(null,t,e),[t,e]),n]}},Pz={readContext:Go,useCallback:qy,useContext:Go,useEffect:Hy,useImperativeHandle:_I,useLayoutEffect:yI,useMemo:xI,useReducer:gg,useRef:gI,useState:function(){return gg(rc)},useDebugValue:Ob,useResponder:Ib,useDeferredValue:function(e,t){var n=gg(rc),r=n[0],o=n[1];return Hy(function(){var l=Vo.suspense;Vo.suspense=t===void 0?null:t;try{o(e)}finally{Vo.suspense=l}},[e,t]),r},useTransition:function(e){var t=gg(rc),n=t[0];return t=t[1],[qy(Rb.bind(null,t,e),[t,e]),n]}},Qa=null,Gl=null,ic=!1;function wI(e,t){var n=ta(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,e.lastEffect!==null?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function sS(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,!0):!1;case 13:return!1;default:return!1}}function Bx(e){if(ic){var t=Gl;if(t){var n=t;if(!sS(e,t)){if(t=Xh(n.nextSibling),!t||!sS(e,t)){e.effectTag=e.effectTag&-1025|2,ic=!1,Qa=e;return}wI(Qa,n)}Qa=e,Gl=Xh(t.firstChild)}else e.effectTag=e.effectTag&-1025|2,ic=!1,Qa=e}}function aS(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Qa=e}function yg(e){if(e!==Qa)return!1;if(!ic)return aS(e),ic=!0,!1;var t=e.type;if(e.tag!==5||t!=="head"&&t!=="body"&&!Cx(t,e.memoizedProps))for(t=Gl;t;)wI(e,t),t=Xh(t.nextSibling);if(aS(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Kt(317));t:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n===jC){if(t===0){Gl=Xh(e.nextSibling);break t}t--}else n!==VC&&n!==gb&&n!==mb||t++}e=e.nextSibling}Gl=null}}else Gl=Qa?Xh(e.stateNode.nextSibling):null;return!0}function o0(){Gl=Qa=null,ic=!1}var Az=hs.ReactCurrentOwner,Qs=!1;function Eo(e,t,n,r){t.child=e===null?Ab(t,null,n,r):sf(t,e.child,n,r)}function lS(e,t,n,r,o){n=n.render;var l=t.ref;return $h(t,o),r=Lb(e,t,n,r,l,o),e!==null&&!Qs?(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=o&&(e.expirationTime=0),tl(e,t,o)):(t.effectTag|=1,Eo(e,t,r,o),t.child)}function uS(e,t,n,r,o,l){if(e===null){var s=n.type;return typeof s=="function"&&!Bb(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=s,TI(e,t,s,r,o,l)):(e=fy(n.type,null,r,null,t.mode,l),e.ref=t.ref,e.return=t,t.child=e)}return s=e.child,o<l&&(o=s.memoizedProps,n=n.compare,n=n!==null?n:ud,n(o,r)&&e.ref===t.ref)?tl(e,t,l):(t.effectTag|=1,e=hc(s,r),e.ref=t.ref,e.return=t,t.child=e)}function TI(e,t,n,r,o,l){return e!==null&&ud(e.memoizedProps,r)&&e.ref===t.ref&&(Qs=!1,o<l)?(t.expirationTime=e.expirationTime,tl(e,t,l)):Ux(e,t,n,r,l)}function EI(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.effectTag|=128)}function Ux(e,t,n,r,o){var l=lo(n)?cc:Fi.current;return l=of(t,l),$h(t,o),n=Lb(e,t,n,r,l,o),e!==null&&!Qs?(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=o&&(e.expirationTime=0),tl(e,t,o)):(t.effectTag|=1,Eo(e,t,n,o),t.child)}function cS(e,t,n,r,o){if(lo(n)){var l=!0;sy(t)}else l=!1;if($h(t,o),t.stateNode===null)e!==null&&(e.alternate=null,t.alternate=null,t.effectTag|=2),dI(t,n,r),zx(t,n,r,o),r=!0;else if(e===null){var s=t.stateNode,p=t.memoizedProps;s.props=p;var g=s.context,_=n.contextType;typeof _=="object"&&_!==null?_=Go(_):(_=lo(n)?cc:Fi.current,_=of(t,_));var w=n.getDerivedStateFromProps,P=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function";P||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(p!==r||g!==_)&&nS(t,s,r,_),Bl=!1;var A=t.memoizedState;s.state=A,cd(t,r,s,o),g=t.memoizedState,p!==r||A!==g||ao.current||Bl?(typeof w=="function"&&(jy(t,n,w,r),g=t.memoizedState),(p=Bl||eS(t,n,p,r,A,g,_))?(P||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.effectTag|=4)):(typeof s.componentDidMount=="function"&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=g),s.props=r,s.state=g,s.context=_,r=p):(typeof s.componentDidMount=="function"&&(t.effectTag|=4),r=!1)}else s=t.stateNode,Pb(e,t),p=t.memoizedProps,s.props=t.type===t.elementType?p:is(t.type,p),g=s.context,_=n.contextType,typeof _=="object"&&_!==null?_=Go(_):(_=lo(n)?cc:Fi.current,_=of(t,_)),w=n.getDerivedStateFromProps,(P=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(p!==r||g!==_)&&nS(t,s,r,_),Bl=!1,g=t.memoizedState,s.state=g,cd(t,r,s,o),A=t.memoizedState,p!==r||g!==A||ao.current||Bl?(typeof w=="function"&&(jy(t,n,w,r),A=t.memoizedState),(w=Bl||eS(t,n,p,r,g,A,_))?(P||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,A,_),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,A,_)),typeof s.componentDidUpdate=="function"&&(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.effectTag|=256)):(typeof s.componentDidUpdate!="function"||p===e.memoizedProps&&g===e.memoizedState||(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate!="function"||p===e.memoizedProps&&g===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=A),s.props=r,s.state=A,s.context=_,r=w):(typeof s.componentDidUpdate!="function"||p===e.memoizedProps&&g===e.memoizedState||(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate!="function"||p===e.memoizedProps&&g===e.memoizedState||(t.effectTag|=256),r=!1);return Vx(e,t,n,r,l,o)}function Vx(e,t,n,r,o,l){EI(e,t);var s=(t.effectTag&64)!==0;if(!r&&!s)return o&&$E(t,n,!1),tl(e,t,l);r=t.stateNode,Az.current=t;var p=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.effectTag|=1,e!==null&&s?(t.child=sf(t,e.child,null,l),t.child=sf(t,null,p,l)):Eo(e,t,p,l),t.memoizedState=r.state,o&&$E(t,n,!0),t.child}function hS(e){var t=e.stateNode;t.pendingContext?XE(e,t.pendingContext,t.pendingContext!==t.context):t.context&&XE(e,t.context,!1),Dx(e,t.containerInfo)}var s0={dehydrated:null,retryTime:0};function fS(e,t,n){var r=t.mode,o=t.pendingProps,l=Er.current,s=!1,p;if((p=(t.effectTag&64)!==0)||(p=(l&2)!==0&&(e===null||e.memoizedState!==null)),p?(s=!0,t.effectTag&=-65):e!==null&&e.memoizedState===null||o.fallback===void 0||o.unstable_avoidThisFallback===!0||(l|=1),Or(Er,l&1),e===null){if(o.fallback!==void 0&&Bx(t),s){if(s=o.fallback,o=Wl(null,r,0,null),o.return=t,!(t.mode&2))for(e=t.memoizedState!==null?t.child.child:t.child,o.child=e;e!==null;)e.return=o,e=e.sibling;return n=Wl(s,r,n,null),n.return=t,o.sibling=n,t.memoizedState=s0,t.child=o,n}return r=o.children,t.memoizedState=null,t.child=Ab(t,null,r,n)}if(e.memoizedState!==null){if(e=e.child,r=e.sibling,s){if(o=o.fallback,n=hc(e,e.pendingProps),n.return=t,!(t.mode&2)&&(s=t.memoizedState!==null?t.child.child:t.child,s!==e.child))for(n.child=s;s!==null;)s.return=n,s=s.sibling;return r=hc(r,o),r.return=t,n.sibling=r,n.childExpirationTime=0,t.memoizedState=s0,t.child=n,r}return n=sf(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=o.fallback,o=Wl(null,r,0,null),o.return=t,o.child=e,e!==null&&(e.return=o),!(t.mode&2))for(e=t.memoizedState!==null?t.child.child:t.child,o.child=e;e!==null;)e.return=o,e=e.sibling;return n=Wl(s,r,n,null),n.return=t,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,t.memoizedState=s0,t.child=o,n}return t.memoizedState=null,t.child=sf(t,e,o.children,n)}function pS(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;n!==null&&n.expirationTime<t&&(n.expirationTime=t),fI(e.return,t)}function a0(e,t,n,r,o,l){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:o,lastEffect:l}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailExpiration=0,s.tailMode=o,s.lastEffect=l)}function dS(e,t,n){var r=t.pendingProps,o=r.revealOrder,l=r.tail;if(Eo(e,t,r.children,n),r=Er.current,r&2)r=r&1|2,t.effectTag|=64;else{if(e!==null&&e.effectTag&64)t:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&pS(e,n);else if(e.tag===19)pS(e,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;e.sibling===null;){if(e.return===null||e.return===t)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Or(Er,r),!(t.mode&2))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&Gy(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),a0(t,!1,o,n,l,t.lastEffect);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Gy(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}a0(t,!0,n,null,l,t.lastEffect);break;case"together":a0(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function tl(e,t,n){e!==null&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(r!==0&&Vv(r),t.childExpirationTime<n)return null;if(e!==null&&t.child!==e.child)throw Error(Kt(153));if(t.child!==null){for(e=t.child,n=hc(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=hc(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}var SI,jx,PI,AI;SI=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};jx=function(){};PI=function(e,t,n,r,o){var l=e.memoizedProps;if(l!==r){var s=t.stateNode;switch(Ku(ea.current),e=null,n){case"input":l=dx(s,l),r=dx(s,r),e=[];break;case"option":l=yx(s,l),r=yx(s,r),e=[];break;case"select":l=qi({},l,{value:void 0}),r=qi({},r,{value:void 0}),e=[];break;case"textarea":l=vx(s,l),r=vx(s,r),e=[];break;default:typeof l.onClick!="function"&&typeof r.onClick=="function"&&(s.onclick=zy)}Ex(n,r);var p,g;n=null;for(p in l)if(!r.hasOwnProperty(p)&&l.hasOwnProperty(p)&&l[p]!=null)if(p==="style")for(g in s=l[p],s)s.hasOwnProperty(g)&&(n||(n={}),n[g]="");else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(ef.hasOwnProperty(p)?e||(e=[]):(e=e||[]).push(p,null));for(p in r){var _=r[p];if(s=l!=null?l[p]:void 0,r.hasOwnProperty(p)&&_!==s&&(_!=null||s!=null))if(p==="style")if(s){for(g in s)!s.hasOwnProperty(g)||_&&_.hasOwnProperty(g)||(n||(n={}),n[g]="");for(g in _)_.hasOwnProperty(g)&&s[g]!==_[g]&&(n||(n={}),n[g]=_[g])}else n||(e||(e=[]),e.push(p,n)),n=_;else p==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,s=s?s.__html:void 0,_!=null&&s!==_&&(e=e||[]).push(p,_)):p==="children"?s===_||typeof _!="string"&&typeof _!="number"||(e=e||[]).push(p,""+_):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&(ef.hasOwnProperty(p)?(_!=null&&Ha(o,p),e||s===_||(e=[])):(e=e||[]).push(p,_))}n&&(e=e||[]).push("style",n),o=e,(t.updateQueue=o)&&(t.effectTag|=4)}};AI=function(e,t,n,r){n!==r&&(t.effectTag|=4)};function vg(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Cz(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return lo(t.type)&&Ny(),null;case 3:return af(),sr(ao),sr(Fi),n=t.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),e!==null&&e.child!==null||!yg(t)||(t.effectTag|=4),jx(t),null;case 5:Cb(t),n=Ku(fd.current);var o=t.type;if(e!==null&&t.stateNode!=null)PI(e,t,o,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(t.stateNode===null)throw Error(Kt(166));return null}if(e=Ku(ea.current),yg(t)){r=t.stateNode,o=t.type;var l=t.memoizedProps;switch(r[Ul]=t,r[Dy]=l,o){case"iframe":case"object":case"embed":pr("load",r);break;case"video":case"audio":for(e=0;e<Dp.length;e++)pr(Dp[e],r);break;case"source":pr("error",r);break;case"img":case"image":case"link":pr("error",r),pr("load",r);break;case"form":pr("reset",r),pr("submit",r);break;case"details":pr("toggle",r);break;case"input":SE(r,l),pr("invalid",r),Ha(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!l.multiple},pr("invalid",r),Ha(n,"onChange");break;case"textarea":AE(r,l),pr("invalid",r),Ha(n,"onChange")}Ex(o,l),e=null;for(var s in l)if(l.hasOwnProperty(s)){var p=l[s];s==="children"?typeof p=="string"?r.textContent!==p&&(e=["children",p]):typeof p=="number"&&r.textContent!==""+p&&(e=["children",""+p]):ef.hasOwnProperty(s)&&p!=null&&Ha(n,s)}switch(o){case"input":cg(r),PE(r,l,!0);break;case"textarea":cg(r),CE(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=zy)}n=e,t.updateQueue=n,n!==null&&(t.effectTag|=4)}else{switch(s=n.nodeType===9?n:n.ownerDocument,e===RE&&(e=xC(o)),e===RE?o==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(o,{is:r.is}):(e=s.createElement(o),o==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,o),e[Ul]=t,e[Dy]=r,SI(e,t,!1,!1),t.stateNode=e,s=Sx(o,r),o){case"iframe":case"object":case"embed":pr("load",e),p=r;break;case"video":case"audio":for(p=0;p<Dp.length;p++)pr(Dp[p],e);p=r;break;case"source":pr("error",e),p=r;break;case"img":case"image":case"link":pr("error",e),pr("load",e),p=r;break;case"form":pr("reset",e),pr("submit",e),p=r;break;case"details":pr("toggle",e),p=r;break;case"input":SE(e,r),p=dx(e,r),pr("invalid",e),Ha(n,"onChange");break;case"option":p=yx(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},p=qi({},r,{value:void 0}),pr("invalid",e),Ha(n,"onChange");break;case"textarea":AE(e,r),p=vx(e,r),pr("invalid",e),Ha(n,"onChange");break;default:p=r}Ex(o,p);var g=p;for(l in g)if(g.hasOwnProperty(l)){var _=g[l];l==="style"?BC(e,_):l==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&bC(e,_)):l==="children"?typeof _=="string"?(o!=="textarea"||_!=="")&&od(e,_):typeof _=="number"&&od(e,""+_):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ef.hasOwnProperty(l)?_!=null&&Ha(n,l):_!=null&&ib(e,l,_,s))}switch(o){case"input":cg(e),PE(e,r,!1);break;case"textarea":cg(e),CE(e);break;case"option":r.value!=null&&e.setAttribute("value",""+eu(r.value));break;case"select":e.multiple=!!r.multiple,n=r.value,n!=null?Zh(e,!!r.multiple,n,!1):r.defaultValue!=null&&Zh(e,!!r.multiple,r.defaultValue,!0);break;default:typeof p.onClick=="function"&&(e.onclick=zy)}GC(o,r)&&(t.effectTag|=4)}t.ref!==null&&(t.effectTag|=128)}return null;case 6:if(e&&t.stateNode!=null)AI(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Kt(166));n=Ku(fd.current),Ku(ea.current),yg(t)?(n=t.stateNode,r=t.memoizedProps,n[Ul]=t,n.nodeValue!==r&&(t.effectTag|=4)):(n=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),n[Ul]=t,t.stateNode=n)}return null;case 13:return sr(Er),r=t.memoizedState,t.effectTag&64?(t.expirationTime=n,t):(n=r!==null,r=!1,e===null?t.memoizedProps.fallback!==void 0&&yg(t):(o=e.memoizedState,r=o!==null,n||o===null||(o=e.child.sibling,o!==null&&(l=t.firstEffect,l!==null?(t.firstEffect=o,o.nextEffect=l):(t.firstEffect=t.lastEffect=o,o.nextEffect=null),o.effectTag=8))),n&&!r&&t.mode&2&&(e===null&&t.memoizedProps.unstable_avoidThisFallback!==!0||Er.current&1?ni===oc&&(ni=Yy):((ni===oc||ni===Yy)&&(ni=Nv),dd!==0&&Ao!==null&&(tc(Ao,uo),ZI(Ao,dd)))),(n||r)&&(t.effectTag|=4),null);case 4:return af(),jx(t),null;case 10:return Eb(t),null;case 17:return lo(t.type)&&Ny(),null;case 19:if(sr(Er),r=t.memoizedState,r===null)return null;if(o=(t.effectTag&64)!==0,l=r.rendering,l===null){if(o)vg(r,!1);else if(ni!==oc||e!==null&&e.effectTag&64)for(l=t.child;l!==null;){if(e=Gy(l),e!==null){for(t.effectTag|=64,vg(r,!1),o=e.updateQueue,o!==null&&(t.updateQueue=o,t.effectTag|=4),r.lastEffect===null&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;r!==null;)o=r,l=n,o.effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,e=o.alternate,e===null?(o.childExpirationTime=0,o.expirationTime=l,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=e.childExpirationTime,o.expirationTime=e.expirationTime,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,l=e.dependencies,o.dependencies=l===null?null:{expirationTime:l.expirationTime,firstContext:l.firstContext,responders:l.responders}),r=r.sibling;return Or(Er,Er.current&1|2),t.child}l=l.sibling}}else{if(!o)if(e=Gy(l),e!==null){if(t.effectTag|=64,o=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.effectTag|=4),vg(r,!0),r.tail===null&&r.tailMode==="hidden"&&!l.alternate)return t=t.lastEffect=r.lastEffect,t!==null&&(t.nextEffect=null),null}else 2*Bo()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,o=!0,vg(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(l.sibling=t.child,t.child=l):(n=r.last,n!==null?n.sibling=l:t.child=l,r.last=l)}return r.tail!==null?(r.tailExpiration===0&&(r.tailExpiration=Bo()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Bo(),n.sibling=null,t=Er.current,Or(Er,o?t&1|2:t&1),n):null}throw Error(Kt(156,t.tag))}function Iz(e){switch(e.tag){case 1:lo(e.type)&&Ny();var t=e.effectTag;return t&4096?(e.effectTag=t&-4097|64,e):null;case 3:if(af(),sr(ao),sr(Fi),t=e.effectTag,t&64)throw Error(Kt(285));return e.effectTag=t&-4097|64,e;case 5:return Cb(e),null;case 13:return sr(Er),t=e.effectTag,t&4096?(e.effectTag=t&-4097|64,e):null;case 19:return sr(Er),null;case 4:return af(),null;case 10:return Eb(e),null;default:return null}}function zb(e,t){return{value:e,source:t,stack:ab(t)}}var Mz=typeof WeakSet=="function"?WeakSet:Set;function Gx(e,t){var n=t.source,r=t.stack;r===null&&n!==null&&(r=ab(n)),n!==null&&rl(n.type),t=t.value,e!==null&&e.tag===1&&rl(e.type);try{console.error(t)}catch(o){setTimeout(function(){throw o})}}function Lz(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){ac(e,n)}}function mS(e){var t=e.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){ac(e,n)}else t.current=null}function kz(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(t.effectTag&256&&e!==null){var n=e.memoizedProps,r=e.memoizedState;e=t.stateNode,t=e.getSnapshotBeforeUpdate(t.elementType===t.type?n:is(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(Kt(163))}function CI(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,r!==void 0&&r()}n=n.next}while(n!==t)}}function II(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Oz(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:II(3,n);return;case 1:if(e=n.stateNode,n.effectTag&4)if(t===null)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:is(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}t=n.updateQueue,t!==null&&tS(n,t,e);return;case 3:if(t=n.updateQueue,t!==null){if(e=null,n.child!==null)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}tS(n,t,e)}return;case 5:e=n.stateNode,t===null&&n.effectTag&4&&GC(n.type,n.memoizedProps)&&e.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&zC(n))));return;case 19:case 17:case 20:case 21:return}throw Error(Kt(163))}function gS(e,t,n){switch(typeof Kx=="function"&&Kx(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(e=t.updateQueue,e!==null&&(e=e.lastEffect,e!==null)){var r=e.next;ru(97<n?97:n,function(){var o=r;do{var l=o.destroy;if(l!==void 0){var s=t;try{l()}catch(p){ac(s,p)}}o=o.next}while(o!==r)})}break;case 1:mS(t),n=t.stateNode,typeof n.componentWillUnmount=="function"&&Lz(t,n);break;case 5:mS(t);break;case 4:LI(e,t,n)}}function MI(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,t!==null&&MI(t)}function yS(e){return e.tag===5||e.tag===3||e.tag===4}function vS(e){t:{for(var t=e.return;t!==null;){if(yS(t)){var n=t;break t}t=t.return}throw Error(Kt(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:t=t.containerInfo,r=!0;break;case 4:t=t.containerInfo,r=!0;break;default:throw Error(Kt(161))}n.effectTag&16&&(od(t,""),n.effectTag&=-17);t:e:for(n=e;;){for(;n.sibling===null;){if(n.return===null||yS(n.return)){n=null;break t}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.effectTag&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.effectTag&2)){n=n.stateNode;break t}}r?Wx(e,n,t):Hx(e,n,t)}function Wx(e,t,n){var r=e.tag,o=r===5||r===6;if(o)e=o?e.stateNode:e.stateNode.instance,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=zy));else if(r!==4&&(e=e.child,e!==null))for(Wx(e,t,n),e=e.sibling;e!==null;)Wx(e,t,n),e=e.sibling}function Hx(e,t,n){var r=e.tag,o=r===5||r===6;if(o)e=o?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Hx(e,t,n),e=e.sibling;e!==null;)Hx(e,t,n),e=e.sibling}function LI(e,t,n){for(var r=t,o=!1,l,s;;){if(!o){o=r.return;t:for(;;){if(o===null)throw Error(Kt(160));switch(l=o.stateNode,o.tag){case 5:s=!1;break t;case 3:l=l.containerInfo,s=!0;break t;case 4:l=l.containerInfo,s=!0;break t}o=o.return}o=!0}if(r.tag===5||r.tag===6){t:for(var p=e,g=r,_=n,w=g;;)if(gS(p,w,_),w.child!==null&&w.tag!==4)w.child.return=w,w=w.child;else{if(w===g)break t;for(;w.sibling===null;){if(w.return===null||w.return===g)break t;w=w.return}w.sibling.return=w.return,w=w.sibling}s?(p=l,g=r.stateNode,p.nodeType===8?p.parentNode.removeChild(g):p.removeChild(g)):l.removeChild(r.stateNode)}else if(r.tag===4){if(r.child!==null){l=r.stateNode.containerInfo,s=!0,r.child.return=r,r=r.child;continue}}else if(gS(e,r,n),r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return,r.tag===4&&(o=!1)}r.sibling.return=r.return,r=r.sibling}}function l0(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:CI(3,t);return;case 1:return;case 5:var n=t.stateNode;if(n!=null){var r=t.memoizedProps,o=e!==null?e.memoizedProps:r;e=t.type;var l=t.updateQueue;if(t.updateQueue=null,l!==null){for(n[Dy]=r,e==="input"&&r.type==="radio"&&r.name!=null&&yC(n,r),Sx(e,o),t=Sx(e,r),o=0;o<l.length;o+=2){var s=l[o],p=l[o+1];s==="style"?BC(n,p):s==="dangerouslySetInnerHTML"?bC(n,p):s==="children"?od(n,p):ib(n,s,p,t)}switch(e){case"input":mx(n,r);break;case"textarea":vC(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,e=r.value,e!=null?Zh(n,!!r.multiple,e,!1):t!==!!r.multiple&&(r.defaultValue!=null?Zh(n,!!r.multiple,r.defaultValue,!0):Zh(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(t.stateNode===null)throw Error(Kt(162));t.stateNode.nodeValue=t.memoizedProps;return;case 3:t=t.stateNode,t.hydrate&&(t.hydrate=!1,zC(t.containerInfo));return;case 12:return;case 13:if(n=t,t.memoizedState===null?r=!1:(r=!0,n=t.child,Nb=Bo()),n!==null)t:for(e=n;;){if(e.tag===5)l=e.stateNode,r?(l=l.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(l=e.stateNode,o=e.memoizedProps.style,o=o!=null&&o.hasOwnProperty("display")?o.display:null,l.style.display=NC("display",o));else if(e.tag===6)e.stateNode.nodeValue=r?"":e.memoizedProps;else if(e.tag===13&&e.memoizedState!==null&&e.memoizedState.dehydrated===null){l=e.child.sibling,l.return=e,e=l;continue}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}_S(t);return;case 19:_S(t);return;case 17:return}throw Error(Kt(163))}function _S(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Mz),t.forEach(function(r){var o=Gz.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}var Rz=typeof WeakMap=="function"?WeakMap:Map;function kI(e,t,n){n=Yl(n,null),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Qy||(Qy=!0,qx=r),Gx(e,t)},n}function OI(e,t,n){n=Yl(n,null),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return Gx(e,t),r(o)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){typeof r!="function"&&(Jl===null?Jl=new Set([this]):Jl.add(this),Gx(e,t));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}var zz=Math.ceil,Xy=hs.ReactCurrentDispatcher,RI=hs.ReactCurrentOwner,ii=0,Db=8,fs=16,sa=32,oc=0,$y=1,zI=2,Yy=3,Nv=4,Fb=5,$e=ii,Ao=null,rn=null,uo=0,ni=oc,Bv=null,Ya=1073741823,pd=1073741823,Ky=null,dd=0,Jy=!1,Nb=0,DI=500,Le=null,Qy=!1,qx=null,Jl=null,tv=!1,Xp=null,Np=90,Ju=null,$p=0,Zx=null,cy=0;function na(){return($e&(fs|sa))!==ii?1073741821-(Bo()/10|0):cy!==0?cy:cy=1073741821-(Bo()/10|0)}function sc(e,t,n){if(t=t.mode,!(t&2))return 1073741823;var r=Dv();if(!(t&4))return r===99?1073741823:1073741822;if(($e&fs)!==ii)return uo;if(n!==null)e=ly(e,n.timeoutMs|0||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=ly(e,150,100);break;case 97:case 96:e=ly(e,5e3,250);break;case 95:e=2;break;default:throw Error(Kt(326))}return Ao!==null&&e===uo&&--e,e}function Ql(e,t){if(50<$p)throw $p=0,Zx=null,Error(Kt(185));if(e=Uv(e,t),e!==null){var n=Dv();t===1073741823?($e&Db)!==ii&&($e&(fs|sa))===ii?Xx(e):(Co(e),$e===ii&&ua()):Co(e),($e&4)===ii||n!==98&&n!==99||(Ju===null?Ju=new Map([[e,t]]):(n=Ju.get(e),(n===void 0||n>t)&&Ju.set(e,t)))}}function Uv(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;n!==null&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,o=null;if(r===null&&e.tag===3)o=e.stateNode;else for(;r!==null;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),n!==null&&n.childExpirationTime<t&&(n.childExpirationTime=t),r.return===null&&r.tag===3){o=r.stateNode;break}r=r.return}return o!==null&&(Ao===o&&(Vv(t),ni===Nv&&tc(o,uo)),ZI(o,t)),o}function hy(e){var t=e.lastExpiredTime;if(t!==0||(t=e.firstPendingTime,!qI(e,t)))return t;var n=e.lastPingedTime;return e=e.nextKnownPendingLevel,e=n>e?n:e,2>=e&&t!==e?0:e}function Co(e){if(e.lastExpiredTime!==0)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=JE(Xx.bind(null,e));else{var t=hy(e),n=e.callbackNode;if(t===0)n!==null&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=na();if(t===1073741823?r=99:t===1||t===2?r=95:(r=10*(1073741821-t)-10*(1073741821-r),r=0>=r?99:250>=r?98:5250>=r?97:95),n!==null){var o=e.callbackPriority;if(e.callbackExpirationTime===t&&o>=r)return;n!==lI&&rI(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=t===1073741823?JE(Xx.bind(null,e)):cI(r,FI.bind(null,e),{timeout:10*(1073741821-t)-Bo()}),e.callbackNode=t}}}function FI(e,t){if(cy=0,t)return t=na(),Jx(e,t),Co(e),null;var n=hy(e);if(n!==0){if(t=e.callbackNode,($e&(fs|sa))!==ii)throw Error(Kt(327));if(xf(),e===Ao&&n===uo||Qu(e,n),rn!==null){var r=$e;$e|=fs;var o=VI();do try{Nz();break}catch(p){UI(e,p)}while(1);if(Tb(),$e=r,Xy.current=o,ni===$y)throw t=Bv,Qu(e,n),tc(e,n),Co(e),t;if(rn===null)switch(o=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=ni,Ao=null,r){case oc:case $y:throw Error(Kt(345));case zI:Jx(e,2<n?2:n);break;case Yy:if(tc(e,n),r=e.lastSuspendedTime,n===r&&(e.nextKnownPendingLevel=$x(o)),Ya===1073741823&&(o=Nb+DI-Bo(),10<o)){if(Jy){var l=e.lastPingedTime;if(l===0||l>=n){e.lastPingedTime=n,Qu(e,n);break}}if(l=hy(e),l!==0&&l!==n)break;if(r!==0&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=n0(Zu.bind(null,e),o);break}Zu(e);break;case Nv:if(tc(e,n),r=e.lastSuspendedTime,n===r&&(e.nextKnownPendingLevel=$x(o)),Jy&&(o=e.lastPingedTime,o===0||o>=n)){e.lastPingedTime=n,Qu(e,n);break}if(o=hy(e),o!==0&&o!==n)break;if(r!==0&&r!==n){e.lastPingedTime=r;break}if(pd!==1073741823?r=10*(1073741821-pd)-Bo():Ya===1073741823?r=0:(r=10*(1073741821-Ya)-5e3,o=Bo(),n=10*(1073741821-n)-o,r=o-r,0>r&&(r=0),r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*zz(r/1960))-r,n<r&&(r=n)),10<r){e.timeoutHandle=n0(Zu.bind(null,e),r);break}Zu(e);break;case Fb:if(Ya!==1073741823&&Ky!==null){l=Ya;var s=Ky;if(r=s.busyMinDurationMs|0,0>=r?r=0:(o=s.busyDelayMs|0,l=Bo()-(10*(1073741821-l)-(s.timeoutMs|0||5e3)),r=l<=o?0:o+r-l),10<r){tc(e,n),e.timeoutHandle=n0(Zu.bind(null,e),r);break}}Zu(e);break;default:throw Error(Kt(329))}if(Co(e),e.callbackNode===t)return FI.bind(null,e)}}return null}function Xx(e){var t=e.lastExpiredTime;if(t=t!==0?t:1073741823,($e&(fs|sa))!==ii)throw Error(Kt(327));if(xf(),e===Ao&&t===uo||Qu(e,t),rn!==null){var n=$e;$e|=fs;var r=VI();do try{Fz();break}catch(o){UI(e,o)}while(1);if(Tb(),$e=n,Xy.current=r,ni===$y)throw n=Bv,Qu(e,t),tc(e,t),Co(e),n;if(rn!==null)throw Error(Kt(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ao=null,Zu(e),Co(e)}return null}function Dz(){if(Ju!==null){var e=Ju;Ju=null,e.forEach(function(t,n){Jx(n,t),Co(n)}),ua()}}function NI(e,t){var n=$e;$e|=1;try{return e(t)}finally{$e=n,$e===ii&&ua()}}function BI(e,t){var n=$e;$e&=-2,$e|=Db;try{return e(t)}finally{$e=n,$e===ii&&ua()}}function Qu(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,zR(n)),rn!==null)for(n=rn.return;n!==null;){var r=n;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ny();break;case 3:af(),sr(ao),sr(Fi);break;case 5:Cb(r);break;case 4:af();break;case 13:sr(Er);break;case 19:sr(Er);break;case 10:Eb(r)}n=n.return}Ao=e,rn=hc(e.current,null),uo=t,ni=oc,Bv=null,pd=Ya=1073741823,Ky=null,dd=0,Jy=!1}function UI(e,t){do{try{if(Tb(),uy.current=Zy,Wy)for(var n=$r.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}if(jl=0,Oi=ki=$r=null,Wy=!1,rn===null||rn.return===null)return ni=$y,Bv=t,rn=null;t:{var o=e,l=rn.return,s=rn,p=t;if(t=uo,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,p!==null&&typeof p=="object"&&typeof p.then=="function"){var g=p;if(!(s.mode&2)){var _=s.alternate;_?(s.updateQueue=_.updateQueue,s.memoizedState=_.memoizedState,s.expirationTime=_.expirationTime):(s.updateQueue=null,s.memoizedState=null)}var w=(Er.current&1)!==0,P=l;do{var A;if(A=P.tag===13){var M=P.memoizedState;if(M!==null)A=M.dehydrated!==null;else{var F=P.memoizedProps;A=F.fallback===void 0?!1:F.unstable_avoidThisFallback!==!0?!0:!w}}if(A){var X=P.updateQueue;if(X===null){var B=new Set;B.add(g),P.updateQueue=B}else X.add(g);if(!(P.mode&2)){if(P.effectTag|=64,s.effectTag&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var U=Yl(1073741823,null);U.tag=2,Kl(s,U)}s.expirationTime=1073741823;break t}p=void 0,s=t;var H=o.pingCache;if(H===null?(H=o.pingCache=new Rz,p=new Set,H.set(g,p)):(p=H.get(g),p===void 0&&(p=new Set,H.set(g,p))),!p.has(s)){p.add(s);var tt=jz.bind(null,o,g,s);g.then(tt,tt)}P.effectTag|=4096,P.expirationTime=t;break t}P=P.return}while(P!==null);p=Error((rl(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`+ab(s))}ni!==Fb&&(ni=zI),p=zb(p,s),P=l;do{switch(P.tag){case 3:g=p,P.effectTag|=4096,P.expirationTime=t;var st=kI(P,g,t);QE(P,st);break t;case 1:g=p;var pt=P.type,_t=P.stateNode;if(!(P.effectTag&64)&&(typeof pt.getDerivedStateFromError=="function"||_t!==null&&typeof _t.componentDidCatch=="function"&&(Jl===null||!Jl.has(_t)))){P.effectTag|=4096,P.expirationTime=t;var Ot=OI(P,g,t);QE(P,Ot);break t}}P=P.return}while(P!==null)}rn=WI(rn)}catch(Dt){t=Dt;continue}break}while(1)}function VI(){var e=Xy.current;return Xy.current=Zy,e===null?Zy:e}function jI(e,t){e<Ya&&2<e&&(Ya=e),t!==null&&e<pd&&2<e&&(pd=e,Ky=t)}function Vv(e){e>dd&&(dd=e)}function Fz(){for(;rn!==null;)rn=GI(rn)}function Nz(){for(;rn!==null&&!wz();)rn=GI(rn)}function GI(e){var t=HI(e.alternate,e,uo);return e.memoizedProps=e.pendingProps,t===null&&(t=WI(e)),RI.current=null,t}function WI(e){rn=e;do{var t=rn.alternate;if(e=rn.return,rn.effectTag&2048){if(t=Iz(rn),t!==null)return t.effectTag&=2047,t;e!==null&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}else{if(t=Cz(t,rn,uo),uo===1||rn.childExpirationTime!==1){for(var n=0,r=rn.child;r!==null;){var o=r.expirationTime,l=r.childExpirationTime;o>n&&(n=o),l>n&&(n=l),r=r.sibling}rn.childExpirationTime=n}if(t!==null)return t;e!==null&&!(e.effectTag&2048)&&(e.firstEffect===null&&(e.firstEffect=rn.firstEffect),rn.lastEffect!==null&&(e.lastEffect!==null&&(e.lastEffect.nextEffect=rn.firstEffect),e.lastEffect=rn.lastEffect),1<rn.effectTag&&(e.lastEffect!==null?e.lastEffect.nextEffect=rn:e.firstEffect=rn,e.lastEffect=rn))}if(t=rn.sibling,t!==null)return t;rn=e}while(rn!==null);return ni===oc&&(ni=Fb),null}function $x(e){var t=e.expirationTime;return e=e.childExpirationTime,t>e?t:e}function Zu(e){var t=Dv();return ru(99,Bz.bind(null,e,t)),null}function Bz(e,t){do xf();while(Xp!==null);if(($e&(fs|sa))!==ii)throw Error(Kt(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(n===null)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(Kt(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var o=$x(n);if(e.firstPendingTime=o,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ao&&(rn=Ao=null,uo=0),1<n.effectTag?n.lastEffect!==null?(n.lastEffect.nextEffect=n,o=n.firstEffect):o=n:o=n.firstEffect,o!==null){var l=$e;$e|=sa,RI.current=null,t0=ny;var s=FE();if(Ax(s)){if("selectionStart"in s)var p={start:s.selectionStart,end:s.selectionEnd};else t:{p=(p=s.ownerDocument)&&p.defaultView||window;var g=p.getSelection&&p.getSelection();if(g&&g.rangeCount!==0){p=g.anchorNode;var _=g.anchorOffset,w=g.focusNode;g=g.focusOffset;try{p.nodeType,w.nodeType}catch{p=null;break t}var P=0,A=-1,M=-1,F=0,X=0,B=s,U=null;e:for(;;){for(var H;B!==p||_!==0&&B.nodeType!==3||(A=P+_),B!==w||g!==0&&B.nodeType!==3||(M=P+g),B.nodeType===3&&(P+=B.nodeValue.length),(H=B.firstChild)!==null;)U=B,B=H;for(;;){if(B===s)break e;if(U===p&&++F===_&&(A=P),U===w&&++X===g&&(M=P),(H=B.nextSibling)!==null)break;B=U,U=B.parentNode}B=H}p=A===-1||M===-1?null:{start:A,end:M}}else p=null}p=p||{start:0,end:0}}else p=null;e0={activeElementDetached:null,focusedElem:s,selectionRange:p},ny=!1,Le=o;do try{Uz()}catch(kt){if(Le===null)throw Error(Kt(330));ac(Le,kt),Le=Le.nextEffect}while(Le!==null);Le=o;do try{for(s=e,p=t;Le!==null;){var tt=Le.effectTag;if(tt&16&&od(Le.stateNode,""),tt&128){var st=Le.alternate;if(st!==null){var pt=st.ref;pt!==null&&(typeof pt=="function"?pt(null):pt.current=null)}}switch(tt&1038){case 2:vS(Le),Le.effectTag&=-3;break;case 6:vS(Le),Le.effectTag&=-3,l0(Le.alternate,Le);break;case 1024:Le.effectTag&=-1025;break;case 1028:Le.effectTag&=-1025,l0(Le.alternate,Le);break;case 4:l0(Le.alternate,Le);break;case 8:_=Le,LI(s,_,p),MI(_)}Le=Le.nextEffect}}catch(kt){if(Le===null)throw Error(Kt(330));ac(Le,kt),Le=Le.nextEffect}while(Le!==null);if(pt=e0,st=FE(),tt=pt.focusedElem,p=pt.selectionRange,st!==tt&&tt&&tt.ownerDocument&&UC(tt.ownerDocument.documentElement,tt)){for(p!==null&&Ax(tt)&&(st=p.start,pt=p.end,pt===void 0&&(pt=st),"selectionStart"in tt?(tt.selectionStart=st,tt.selectionEnd=Math.min(pt,tt.value.length)):(pt=(st=tt.ownerDocument||document)&&st.defaultView||window,pt.getSelection&&(pt=pt.getSelection(),_=tt.textContent.length,s=Math.min(p.start,_),p=p.end===void 0?s:Math.min(p.end,_),!pt.extend&&s>p&&(_=p,p=s,s=_),_=DE(tt,s),w=DE(tt,p),_&&w&&(pt.rangeCount!==1||pt.anchorNode!==_.node||pt.anchorOffset!==_.offset||pt.focusNode!==w.node||pt.focusOffset!==w.offset)&&(st=st.createRange(),st.setStart(_.node,_.offset),pt.removeAllRanges(),s>p?(pt.addRange(st),pt.extend(w.node,w.offset)):(st.setEnd(w.node,w.offset),pt.addRange(st)))))),st=[],pt=tt;pt=pt.parentNode;)pt.nodeType===1&&st.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof tt.focus=="function"&&tt.focus(),tt=0;tt<st.length;tt++)pt=st[tt],pt.element.scrollLeft=pt.left,pt.element.scrollTop=pt.top}ny=!!t0,e0=t0=null,e.current=n,Le=o;do try{for(tt=e;Le!==null;){var _t=Le.effectTag;if(_t&36&&Oz(tt,Le.alternate,Le),_t&128){st=void 0;var Ot=Le.ref;if(Ot!==null){var Dt=Le.stateNode;switch(Le.tag){case 5:st=Dt;break;default:st=Dt}typeof Ot=="function"?Ot(st):Ot.current=st}}Le=Le.nextEffect}}catch(kt){if(Le===null)throw Error(Kt(330));ac(Le,kt),Le=Le.nextEffect}while(Le!==null);Le=null,Tz(),$e=l}else e.current=n;if(tv)tv=!1,Xp=e,Np=t;else for(Le=o;Le!==null;)t=Le.nextEffect,Le.nextEffect=null,Le=t;if(t=e.firstPendingTime,t===0&&(Jl=null),t===1073741823?e===Zx?$p++:($p=0,Zx=e):$p=0,typeof Yx=="function"&&Yx(n.stateNode,r),Co(e),Qy)throw Qy=!1,e=qx,qx=null,e;return($e&Db)!==ii||ua(),null}function Uz(){for(;Le!==null;){var e=Le.effectTag;e&256&&kz(Le.alternate,Le),!(e&512)||tv||(tv=!0,cI(97,function(){return xf(),null})),Le=Le.nextEffect}}function xf(){if(Np!==90){var e=97<Np?97:Np;return Np=90,ru(e,Vz)}}function Vz(){if(Xp===null)return!1;var e=Xp;if(Xp=null,($e&(fs|sa))!==ii)throw Error(Kt(331));var t=$e;for($e|=sa,e=e.current.firstEffect;e!==null;){try{var n=e;if(n.effectTag&512)switch(n.tag){case 0:case 11:case 15:case 22:CI(5,n),II(5,n)}}catch(r){if(e===null)throw Error(Kt(330));ac(e,r)}n=e.nextEffect,e.nextEffect=null,e=n}return $e=t,ua(),!0}function xS(e,t,n){t=zb(n,t),t=kI(e,t,1073741823),Kl(e,t),e=Uv(e,1073741823),e!==null&&Co(e)}function ac(e,t){if(e.tag===3)xS(e,e,t);else for(var n=e.return;n!==null;){if(n.tag===3){xS(n,e,t);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Jl===null||!Jl.has(r))){e=zb(t,e),e=OI(n,e,1073741823),Kl(n,e),n=Uv(n,1073741823),n!==null&&Co(n);break}}n=n.return}}function jz(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),Ao===e&&uo===n?ni===Nv||ni===Yy&&Ya===1073741823&&Bo()-Nb<DI?Qu(e,uo):Jy=!0:qI(e,n)&&(t=e.lastPingedTime,t!==0&&t<n||(e.lastPingedTime=n,Co(e)))}function Gz(e,t){var n=e.stateNode;n!==null&&n.delete(t),t=0,t===0&&(t=na(),t=sc(t,e,null)),e=Uv(e,t),e!==null&&Co(e)}var HI;HI=function(e,t,n){var r=t.expirationTime;if(e!==null){var o=t.pendingProps;if(e.memoizedProps!==o||ao.current)Qs=!0;else{if(r<n){switch(Qs=!1,t.tag){case 3:hS(t),o0();break;case 5:if(rS(t),t.mode&4&&n!==1&&o.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:lo(t.type)&&sy(t);break;case 4:Dx(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,o=t.type._context,Or(By,o._currentValue),o._currentValue=r;break;case 13:if(t.memoizedState!==null)return r=t.child.childExpirationTime,r!==0&&r>=n?fS(e,t,n):(Or(Er,Er.current&1),t=tl(e,t,n),t!==null?t.sibling:null);Or(Er,Er.current&1);break;case 19:if(r=t.childExpirationTime>=n,e.effectTag&64){if(r)return dS(e,t,n);t.effectTag|=64}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null),Or(Er,Er.current),!r)return null}return tl(e,t,n)}Qs=!1}}else Qs=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,e!==null&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,o=of(t,Fi.current),$h(t,n),o=Lb(null,t,r,e,o,n),t.effectTag|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,lo(r)){var l=!0;sy(t)}else l=!1;t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Sb(t);var s=r.getDerivedStateFromProps;typeof s=="function"&&jy(t,r,s,e),o.updater=Fv,t.stateNode=o,o._reactInternalFiber=t,zx(t,r,e,n),t=Vx(null,t,r,!0,l,n)}else t.tag=0,Eo(null,t,o,n),t=t.child;return t;case 16:t:{if(o=t.elementType,e!==null&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,vR(o),o._status!==1)throw o._result;switch(o=o._result,t.type=o,l=t.tag=qz(o),e=is(o,e),l){case 0:t=Ux(null,t,o,e,n);break t;case 1:t=cS(null,t,o,e,n);break t;case 11:t=lS(null,t,o,e,n);break t;case 14:t=uS(null,t,o,is(o.type,e),r,n);break t}throw Error(Kt(306,o,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:is(r,o),Ux(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:is(r,o),cS(e,t,r,o,n);case 3:if(hS(t),r=t.updateQueue,e===null||r===null)throw Error(Kt(282));if(r=t.pendingProps,o=t.memoizedState,o=o!==null?o.element:null,Pb(e,t),cd(t,r,null,n),r=t.memoizedState.element,r===o)o0(),t=tl(e,t,n);else{if((o=t.stateNode.hydrate)&&(Gl=Xh(t.stateNode.containerInfo.firstChild),Qa=t,o=ic=!0),o)for(n=Ab(t,null,r,n),t.child=n;n;)n.effectTag=n.effectTag&-3|1024,n=n.sibling;else Eo(e,t,r,n),o0();t=t.child}return t;case 5:return rS(t),e===null&&Bx(t),r=t.type,o=t.pendingProps,l=e!==null?e.memoizedProps:null,s=o.children,Cx(r,o)?s=null:l!==null&&Cx(r,l)&&(t.effectTag|=16),EI(e,t),t.mode&4&&n!==1&&o.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Eo(e,t,s,n),t=t.child),t;case 6:return e===null&&Bx(t),null;case 13:return fS(e,t,n);case 4:return Dx(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=sf(t,null,r,n):Eo(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:is(r,o),lS(e,t,r,o,n);case 7:return Eo(e,t,t.pendingProps,n),t.child;case 8:return Eo(e,t,t.pendingProps.children,n),t.child;case 12:return Eo(e,t,t.pendingProps.children,n),t.child;case 10:t:{r=t.type._context,o=t.pendingProps,s=t.memoizedProps,l=o.value;var p=t.type._context;if(Or(By,p._currentValue),p._currentValue=l,s!==null)if(p=s.value,l=uc(p,l)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(p,l):1073741823)|0,l===0){if(s.children===o.children&&!ao.current){t=tl(e,t,n);break t}}else for(p=t.child,p!==null&&(p.return=t);p!==null;){var g=p.dependencies;if(g!==null){s=p.child;for(var _=g.firstContext;_!==null;){if(_.context===r&&_.observedBits&l){p.tag===1&&(_=Yl(n,null),_.tag=2,Kl(p,_)),p.expirationTime<n&&(p.expirationTime=n),_=p.alternate,_!==null&&_.expirationTime<n&&(_.expirationTime=n),fI(p.return,n),g.expirationTime<n&&(g.expirationTime=n);break}_=_.next}}else s=p.tag===10&&p.type===t.type?null:p.child;if(s!==null)s.return=p;else for(s=p;s!==null;){if(s===t){s=null;break}if(p=s.sibling,p!==null){p.return=s.return,s=p;break}s=s.return}p=s}Eo(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,l=t.pendingProps,r=l.children,$h(t,n),o=Go(o,l.unstable_observedBits),r=r(o),t.effectTag|=1,Eo(e,t,r,n),t.child;case 14:return o=t.type,l=is(o,t.pendingProps),l=is(o.type,l),uS(e,t,o,l,r,n);case 15:return TI(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:is(r,o),e!==null&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,lo(r)?(e=!0,sy(t)):e=!1,$h(t,n),dI(t,r,o),zx(t,r,o,n),Vx(null,t,r,!0,e,n);case 19:return dS(e,t,n)}throw Error(Kt(156,t.tag))};var Yx=null,Kx=null;function Wz(e){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Yx=function(r){try{t.onCommitFiberRoot(n,r,void 0,(r.current.effectTag&64)===64)}catch{}},Kx=function(r){try{t.onCommitFiberUnmount(n,r)}catch{}}}catch{}return!0}function Hz(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function ta(e,t,n,r){return new Hz(e,t,n,r)}function Bb(e){return e=e.prototype,!(!e||!e.isReactComponent)}function qz(e){if(typeof e=="function")return Bb(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ob)return 11;if(e===sb)return 14}return 2}function hc(e,t){var n=e.alternate;return n===null?(n=ta(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function fy(e,t,n,r,o,l){var s=2;if(r=e,typeof e=="function")Bb(e)&&(s=1);else if(typeof e=="string")s=5;else t:switch(e){case $u:return Wl(n.children,o,l,t);case yR:s=8,o|=7;break;case cC:s=8,o|=1;break;case Qg:return e=ta(12,n,t,o|8),e.elementType=Qg,e.type=Qg,e.expirationTime=l,e;case ty:return e=ta(13,n,t,o),e.type=ty,e.elementType=ty,e.expirationTime=l,e;case px:return e=ta(19,n,t,o),e.elementType=px,e.expirationTime=l,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case hC:s=10;break t;case fC:s=9;break t;case ob:s=11;break t;case sb:s=14;break t;case pC:s=16,r=null;break t;case dC:s=22;break t}throw Error(Kt(130,e==null?e:typeof e,""))}return t=ta(s,n,t,o),t.elementType=e,t.type=r,t.expirationTime=l,t}function Wl(e,t,n,r){return e=ta(7,e,r,t),e.expirationTime=n,e}function u0(e,t,n){return e=ta(6,e,null,t),e.expirationTime=n,e}function c0(e,t,n){return t=ta(4,e.children!==null?e.children:[],e.key,t),t.expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zz(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function qI(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,n!==0&&n>=t&&e<=t}function tc(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||n===0)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function ZI(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;n!==0&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Jx(e,t){var n=e.lastExpiredTime;(n===0||n>t)&&(e.lastExpiredTime=t)}function ev(e,t,n,r){var o=t.current,l=na(),s=Zp.suspense;l=sc(l,o,s);t:if(n){n=n._reactInternalFiber;e:{if(bc(n)!==n||n.tag!==1)throw Error(Kt(170));var p=n;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(lo(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(Kt(171))}if(n.tag===1){var g=n.type;if(lo(g)){n=nI(n,g,p);break t}}n=p}else n=nu;return t.context===null?t.context=n:t.pendingContext=n,t=Yl(l,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),Kl(o,t),Ql(o,l),l}function h0(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function bS(e,t){e=e.memoizedState,e!==null&&e.dehydrated!==null&&e.retryTime<t&&(e.retryTime=t)}function Ub(e,t){bS(e,t),(e=e.alternate)&&bS(e,t)}function Vb(e,t,n){n=n!=null&&n.hydrate===!0;var r=new Zz(e,t,n),o=ta(3,null,null,t===2?7:t===1?3:0);r.current=o,o.stateNode=r,Sb(o),e[Rd]=r.current,n&&t!==0&&ER(e,e.nodeType===9?e:e.ownerDocument),this._internalRoot=r}Vb.prototype.render=function(e){ev(e,this._internalRoot,null,null)};Vb.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;ev(null,e,null,function(){t[Rd]=null})};function Ud(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Xz(e,t){if(t||(t=e?e.nodeType===9?e.documentElement:e.firstChild:null,t=!(!t||t.nodeType!==1||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Vb(e,0,t?{hydrate:!0}:void 0)}function jv(e,t,n,r,o){var l=n._reactRootContainer;if(l){var s=l._internalRoot;if(typeof o=="function"){var p=o;o=function(){var _=h0(s);p.call(_)}}ev(t,s,e,o)}else{if(l=n._reactRootContainer=Xz(n,r),s=l._internalRoot,typeof o=="function"){var g=o;o=function(){var _=h0(s);g.call(_)}}BI(function(){ev(t,s,e,o)})}return h0(s)}function $z(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kh,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}OC=function(e){if(e.tag===13){var t=ly(na(),150,100);Ql(e,t),Ub(e,t)}};hb=function(e){e.tag===13&&(Ql(e,3),Ub(e,3))};RC=function(e){if(e.tag===13){var t=na();t=sc(t,e,null),Ql(e,t),Ub(e,t)}};fx=function(e,t,n){switch(t){case"input":if(mx(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=vb(r);if(!o)throw Error(Kt(90));gC(r),mx(r,o)}}}break;case"textarea":vC(e,n);break;case"select":t=n.value,t!=null&&Zh(e,!!n.multiple,t,!1)}};Q1=NI;aC=function(e,t,n,r,o){var l=$e;$e|=4;try{return ru(98,e.bind(null,t,n,r,o))}finally{$e=l,$e===ii&&ua()}};tb=function(){($e&(1|fs|sa))===ii&&(Dz(),xf())};lC=function(e,t){var n=$e;$e|=2;try{return e(t)}finally{$e=n,$e===ii&&ua()}};function XI(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ud(t))throw Error(Kt(200));return $z(e,t,null,n)}var Yz={Events:[Dd,lc,vb,iC,hx,rf,function(e){ub(e,FR)},oC,sC,Ov,kv,xf,{current:!1}]};(function(e){var t=e.findFiberByHostInstance;return Wz(qi({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hs.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=CC(n),n===null?null:n.stateNode},findFiberByHostInstance:function(n){return t?t(n):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:zd,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"});Wo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yz;Wo.createPortal=XI;Wo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternalFiber;if(t===void 0)throw typeof e.render=="function"?Error(Kt(188)):Error(Kt(268,Object.keys(e)));return e=CC(t),e=e===null?null:e.stateNode,e};Wo.flushSync=function(e,t){if(($e&(fs|sa))!==ii)throw Error(Kt(187));var n=$e;$e|=1;try{return ru(99,e.bind(null,t))}finally{$e=n,ua()}};Wo.hydrate=function(e,t,n){if(!Ud(t))throw Error(Kt(200));return jv(null,e,t,!0,n)};Wo.render=function(e,t,n){if(!Ud(t))throw Error(Kt(200));return jv(null,e,t,!1,n)};Wo.unmountComponentAtNode=function(e){if(!Ud(e))throw Error(Kt(40));return e._reactRootContainer?(BI(function(){jv(null,null,e,!1,function(){e._reactRootContainer=null,e[Rd]=null})}),!0):!1};Wo.unstable_batchedUpdates=NI;Wo.unstable_createPortal=function(e,t){return XI(e,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Wo.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ud(n))throw Error(Kt(200));if(e==null||e._reactInternalFiber===void 0)throw Error(Kt(38));return jv(e,t,n,!1,r)};Wo.version="16.14.0";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}t(),e.exports=Wo})(sR);function nv(){return nv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nv.apply(this,arguments)}function Qx(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kz(e){if(Array.isArray(e))return Qx(e)}function Jz(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $I(e,t){if(e){if(typeof e=="string")return Qx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qx(e,t)}}function Qz(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tD(e){return Kz(e)||Jz(e)||$I(e)||Qz()}function lf(e){return lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lf(e)}function eD(e,t){if(lf(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(lf(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function YI(e){var t=eD(e,"string");return lf(t)==="symbol"?t:String(t)}function L(e,t,n){return t=YI(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Tt={},nD={get exports(){return Tt},set exports(e){Tt=e}},rD="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",iD=rD,oD=iD;function KI(){}function JI(){}JI.resetWarningCache=KI;var sD=function(){function e(r,o,l,s,p,g){if(g!==oD){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:JI,resetWarningCache:KI};return n.PropTypes=n,n};nD.exports=sD();function aD(e){if(Array.isArray(e))return e}function lD(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,o,l,s,p=[],g=!0,_=!1;try{if(l=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;g=!1}else for(;!(g=(r=l.call(n)).done)&&(p.push(r.value),p.length!==t);g=!0);}catch(w){_=!0,o=w}finally{try{if(!g&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(_)throw o}}return p}}function uD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Br(e,t){return aD(e)||lD(e,t)||$I(e,t)||uD()}var kr=1e-6,ps=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function cD(){var e=new ps(4);return ps!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function hD(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function jb(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function fD(e){var t=e[0],n=e[1],r=e[2],o=e[3];return Math.hypot(t,n,r,o)}function pD(e){var t=e[0],n=e[1],r=e[2],o=e[3];return t*t+n*n+r*r+o*o}function dD(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=n*n+r*r+o*o+l*l;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=o*s,e[3]=l*s,e}function mD(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function gD(e,t,n,r){var o=t[0],l=t[1],s=t[2],p=t[3];return e[0]=o+r*(n[0]-o),e[1]=l+r*(n[1]-l),e[2]=s+r*(n[2]-s),e[3]=p+r*(n[3]-p),e}function bf(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3];return e[0]=n[0]*r+n[4]*o+n[8]*l+n[12]*s,e[1]=n[1]*r+n[5]*o+n[9]*l+n[13]*s,e[2]=n[2]*r+n[6]*o+n[10]*l+n[14]*s,e[3]=n[3]*r+n[7]*o+n[11]*l+n[15]*s,e}function yD(e,t,n){var r=t[0],o=t[1],l=t[2],s=n[0],p=n[1],g=n[2],_=n[3],w=_*r+p*l-g*o,P=_*o+g*r-s*l,A=_*l+s*o-p*r,M=-s*r-p*o-g*l;return e[0]=w*_+M*-s+P*-g-A*-p,e[1]=P*_+M*-p+A*-s-w*-g,e[2]=A*_+M*-g+w*-p-P*-s,e[3]=t[3],e}(function(){var e=cD();return function(t,n,r,o,l,s){var p,g;for(n||(n=4),r||(r=0),o?g=Math.min(o*n+r,t.length):g=t.length,p=r;p<g;p+=n)e[0]=t[p],e[1]=t[p+1],e[2]=t[p+2],e[3]=t[p+3],l(e,e,s),t[p]=e[0],t[p+1]=e[1],t[p+2]=e[2],t[p+3]=e[3];return t}})();function py(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Kh(e,t){const n=bf([],t,e);return jb(n,n,1/n[3]),n}function wS(e,t){const n=e%t;return n<0?t+n:n}function vD(e,t,n){return n*t+(1-n)*e}function t1(e,t,n){return e<t?t:e>n?n:e}function _D(e){return Math.log(e)*Math.LOG2E}const Gb=Math.log2||_D;function xD(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bD(e,t){if(e===t){var n=t[1],r=t[2],o=t[3],l=t[6],s=t[7],p=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=l,e[11]=t[14],e[12]=o,e[13]=s,e[14]=p}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function rv(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=t[4],p=t[5],g=t[6],_=t[7],w=t[8],P=t[9],A=t[10],M=t[11],F=t[12],X=t[13],B=t[14],U=t[15],H=n*p-r*s,tt=n*g-o*s,st=n*_-l*s,pt=r*g-o*p,_t=r*_-l*p,Ot=o*_-l*g,Dt=w*X-P*F,kt=w*B-A*F,qt=w*U-M*F,ee=P*B-A*X,_e=P*U-M*X,ae=A*U-M*B,he=H*ae-tt*_e+st*ee+pt*qt-_t*kt+Ot*Dt;return he?(he=1/he,e[0]=(p*ae-g*_e+_*ee)*he,e[1]=(o*_e-r*ae-l*ee)*he,e[2]=(X*Ot-B*_t+U*pt)*he,e[3]=(A*_t-P*Ot-M*pt)*he,e[4]=(g*qt-s*ae-_*kt)*he,e[5]=(n*ae-o*qt+l*kt)*he,e[6]=(B*st-F*Ot-U*tt)*he,e[7]=(w*Ot-A*st+M*tt)*he,e[8]=(s*_e-p*qt+_*Dt)*he,e[9]=(r*qt-n*_e-l*Dt)*he,e[10]=(F*_t-X*st+U*H)*he,e[11]=(P*st-w*_t-M*H)*he,e[12]=(p*kt-s*ee-g*Dt)*he,e[13]=(n*ee-r*kt+o*Dt)*he,e[14]=(X*tt-F*pt-B*H)*he,e[15]=(w*pt-P*tt+A*H)*he,e):null}function wD(e){var t=e[0],n=e[1],r=e[2],o=e[3],l=e[4],s=e[5],p=e[6],g=e[7],_=e[8],w=e[9],P=e[10],A=e[11],M=e[12],F=e[13],X=e[14],B=e[15],U=t*s-n*l,H=t*p-r*l,tt=t*g-o*l,st=n*p-r*s,pt=n*g-o*s,_t=r*g-o*p,Ot=_*F-w*M,Dt=_*X-P*M,kt=_*B-A*M,qt=w*X-P*F,ee=w*B-A*F,_e=P*B-A*X;return U*_e-H*ee+tt*qt+st*kt-pt*Dt+_t*Ot}function ra(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3],p=t[4],g=t[5],_=t[6],w=t[7],P=t[8],A=t[9],M=t[10],F=t[11],X=t[12],B=t[13],U=t[14],H=t[15],tt=n[0],st=n[1],pt=n[2],_t=n[3];return e[0]=tt*r+st*p+pt*P+_t*X,e[1]=tt*o+st*g+pt*A+_t*B,e[2]=tt*l+st*_+pt*M+_t*U,e[3]=tt*s+st*w+pt*F+_t*H,tt=n[4],st=n[5],pt=n[6],_t=n[7],e[4]=tt*r+st*p+pt*P+_t*X,e[5]=tt*o+st*g+pt*A+_t*B,e[6]=tt*l+st*_+pt*M+_t*U,e[7]=tt*s+st*w+pt*F+_t*H,tt=n[8],st=n[9],pt=n[10],_t=n[11],e[8]=tt*r+st*p+pt*P+_t*X,e[9]=tt*o+st*g+pt*A+_t*B,e[10]=tt*l+st*_+pt*M+_t*U,e[11]=tt*s+st*w+pt*F+_t*H,tt=n[12],st=n[13],pt=n[14],_t=n[15],e[12]=tt*r+st*p+pt*P+_t*X,e[13]=tt*o+st*g+pt*A+_t*B,e[14]=tt*l+st*_+pt*M+_t*U,e[15]=tt*s+st*w+pt*F+_t*H,e}function md(e,t,n){var r=n[0],o=n[1],l=n[2],s,p,g,_,w,P,A,M,F,X,B,U;return t===e?(e[12]=t[0]*r+t[4]*o+t[8]*l+t[12],e[13]=t[1]*r+t[5]*o+t[9]*l+t[13],e[14]=t[2]*r+t[6]*o+t[10]*l+t[14],e[15]=t[3]*r+t[7]*o+t[11]*l+t[15]):(s=t[0],p=t[1],g=t[2],_=t[3],w=t[4],P=t[5],A=t[6],M=t[7],F=t[8],X=t[9],B=t[10],U=t[11],e[0]=s,e[1]=p,e[2]=g,e[3]=_,e[4]=w,e[5]=P,e[6]=A,e[7]=M,e[8]=F,e[9]=X,e[10]=B,e[11]=U,e[12]=s*r+w*o+F*l+t[12],e[13]=p*r+P*o+X*l+t[13],e[14]=g*r+A*o+B*l+t[14],e[15]=_*r+M*o+U*l+t[15]),e}function Gv(e,t,n){var r=n[0],o=n[1],l=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*l,e[9]=t[9]*l,e[10]=t[10]*l,e[11]=t[11]*l,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function TD(e,t,n,r){var o=r[0],l=r[1],s=r[2],p=Math.hypot(o,l,s),g,_,w,P,A,M,F,X,B,U,H,tt,st,pt,_t,Ot,Dt,kt,qt,ee,_e,ae,he,sn;return p<kr?null:(p=1/p,o*=p,l*=p,s*=p,g=Math.sin(n),_=Math.cos(n),w=1-_,P=t[0],A=t[1],M=t[2],F=t[3],X=t[4],B=t[5],U=t[6],H=t[7],tt=t[8],st=t[9],pt=t[10],_t=t[11],Ot=o*o*w+_,Dt=l*o*w+s*g,kt=s*o*w-l*g,qt=o*l*w-s*g,ee=l*l*w+_,_e=s*l*w+o*g,ae=o*s*w+l*g,he=l*s*w-o*g,sn=s*s*w+_,e[0]=P*Ot+X*Dt+tt*kt,e[1]=A*Ot+B*Dt+st*kt,e[2]=M*Ot+U*Dt+pt*kt,e[3]=F*Ot+H*Dt+_t*kt,e[4]=P*qt+X*ee+tt*_e,e[5]=A*qt+B*ee+st*_e,e[6]=M*qt+U*ee+pt*_e,e[7]=F*qt+H*ee+_t*_e,e[8]=P*ae+X*he+tt*sn,e[9]=A*ae+B*he+st*sn,e[10]=M*ae+U*he+pt*sn,e[11]=F*ae+H*he+_t*sn,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function QI(e,t,n){var r=Math.sin(n),o=Math.cos(n),l=t[4],s=t[5],p=t[6],g=t[7],_=t[8],w=t[9],P=t[10],A=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=l*o+_*r,e[5]=s*o+w*r,e[6]=p*o+P*r,e[7]=g*o+A*r,e[8]=_*o-l*r,e[9]=w*o-s*r,e[10]=P*o-p*r,e[11]=A*o-g*r,e}function ED(e,t,n){var r=Math.sin(n),o=Math.cos(n),l=t[0],s=t[1],p=t[2],g=t[3],_=t[8],w=t[9],P=t[10],A=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*o-_*r,e[1]=s*o-w*r,e[2]=p*o-P*r,e[3]=g*o-A*r,e[8]=l*r+_*o,e[9]=s*r+w*o,e[10]=p*r+P*o,e[11]=g*r+A*o,e}function tM(e,t,n){var r=Math.sin(n),o=Math.cos(n),l=t[0],s=t[1],p=t[2],g=t[3],_=t[4],w=t[5],P=t[6],A=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*o+_*r,e[1]=s*o+w*r,e[2]=p*o+P*r,e[3]=g*o+A*r,e[4]=_*o-l*r,e[5]=w*o-s*r,e[6]=P*o-p*r,e[7]=A*o-g*r,e}function SD(e,t){var n=t[0],r=t[1],o=t[2],l=t[4],s=t[5],p=t[6],g=t[8],_=t[9],w=t[10];return e[0]=Math.hypot(n,r,o),e[1]=Math.hypot(l,s,p),e[2]=Math.hypot(g,_,w),e}function PD(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=n+n,p=r+r,g=o+o,_=n*s,w=r*s,P=r*p,A=o*s,M=o*p,F=o*g,X=l*s,B=l*p,U=l*g;return e[0]=1-P-F,e[1]=w+U,e[2]=A-B,e[3]=0,e[4]=w-U,e[5]=1-_-F,e[6]=M+X,e[7]=0,e[8]=A+B,e[9]=M-X,e[10]=1-_-P,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function AD(e,t,n,r,o,l,s){var p=1/(n-t),g=1/(o-r),_=1/(l-s);return e[0]=l*2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l*2*g,e[6]=0,e[7]=0,e[8]=(n+t)*p,e[9]=(o+r)*g,e[10]=(s+l)*_,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*l*2*_,e[15]=0,e}function CD(e,t,n,r,o){var l=1/Math.tan(t/2),s;return e[0]=l/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0?(s=1/(r-o),e[10]=(o+r)*s,e[14]=2*o*r*s):(e[10]=-1,e[14]=-2*r),e}var eM=CD;function ID(e,t,n,r,o,l,s){var p=1/(t-n),g=1/(r-o),_=1/(l-s);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*_,e[11]=0,e[12]=(t+n)*p,e[13]=(o+r)*g,e[14]=(s+l)*_,e[15]=1,e}var MD=ID;function LD(e,t,n,r){var o,l,s,p,g,_,w,P,A,M,F=t[0],X=t[1],B=t[2],U=r[0],H=r[1],tt=r[2],st=n[0],pt=n[1],_t=n[2];return Math.abs(F-st)<kr&&Math.abs(X-pt)<kr&&Math.abs(B-_t)<kr?xD(e):(w=F-st,P=X-pt,A=B-_t,M=1/Math.hypot(w,P,A),w*=M,P*=M,A*=M,o=H*A-tt*P,l=tt*w-U*A,s=U*P-H*w,M=Math.hypot(o,l,s),M?(M=1/M,o*=M,l*=M,s*=M):(o=0,l=0,s=0),p=P*s-A*l,g=A*o-w*s,_=w*l-P*o,M=Math.hypot(p,g,_),M?(M=1/M,p*=M,g*=M,_*=M):(p=0,g=0,_=0),e[0]=o,e[1]=p,e[2]=w,e[3]=0,e[4]=l,e[5]=g,e[6]=P,e[7]=0,e[8]=s,e[9]=_,e[10]=A,e[11]=0,e[12]=-(o*F+l*X+s*B),e[13]=-(p*F+g*X+_*B),e[14]=-(w*F+P*X+A*B),e[15]=1,e)}function TS(e,t){var n=e[0],r=e[1],o=e[2],l=e[3],s=e[4],p=e[5],g=e[6],_=e[7],w=e[8],P=e[9],A=e[10],M=e[11],F=e[12],X=e[13],B=e[14],U=e[15],H=t[0],tt=t[1],st=t[2],pt=t[3],_t=t[4],Ot=t[5],Dt=t[6],kt=t[7],qt=t[8],ee=t[9],_e=t[10],ae=t[11],he=t[12],sn=t[13],ar=t[14],gr=t[15];return Math.abs(n-H)<=kr*Math.max(1,Math.abs(n),Math.abs(H))&&Math.abs(r-tt)<=kr*Math.max(1,Math.abs(r),Math.abs(tt))&&Math.abs(o-st)<=kr*Math.max(1,Math.abs(o),Math.abs(st))&&Math.abs(l-pt)<=kr*Math.max(1,Math.abs(l),Math.abs(pt))&&Math.abs(s-_t)<=kr*Math.max(1,Math.abs(s),Math.abs(_t))&&Math.abs(p-Ot)<=kr*Math.max(1,Math.abs(p),Math.abs(Ot))&&Math.abs(g-Dt)<=kr*Math.max(1,Math.abs(g),Math.abs(Dt))&&Math.abs(_-kt)<=kr*Math.max(1,Math.abs(_),Math.abs(kt))&&Math.abs(w-qt)<=kr*Math.max(1,Math.abs(w),Math.abs(qt))&&Math.abs(P-ee)<=kr*Math.max(1,Math.abs(P),Math.abs(ee))&&Math.abs(A-_e)<=kr*Math.max(1,Math.abs(A),Math.abs(_e))&&Math.abs(M-ae)<=kr*Math.max(1,Math.abs(M),Math.abs(ae))&&Math.abs(F-he)<=kr*Math.max(1,Math.abs(F),Math.abs(he))&&Math.abs(X-sn)<=kr*Math.max(1,Math.abs(X),Math.abs(sn))&&Math.abs(B-ar)<=kr*Math.max(1,Math.abs(B),Math.abs(ar))&&Math.abs(U-gr)<=kr*Math.max(1,Math.abs(U),Math.abs(gr))}function kD(){var e=new ps(2);return ps!=Float32Array&&(e[0]=0,e[1]=0),e}function fc(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function OD(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function RD(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function zD(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function Wb(e,t){return e[0]=-t[0],e[1]=-t[1],e}function nM(e,t,n,r){var o=t[0],l=t[1];return e[0]=o+r*(n[0]-o),e[1]=l+r*(n[1]-l),e}function DD(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[3]*o+n[6],e[1]=n[1]*r+n[4]*o+n[7],e}function FD(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[4]*o+n[12],e[1]=n[1]*r+n[5]*o+n[13],e}var ND=OD;(function(){var e=kD();return function(t,n,r,o,l,s){var p,g;for(n||(n=2),r||(r=0),o?g=Math.min(o*n+r,t.length):g=t.length,p=r;p<g;p+=n)e[0]=t[p],e[1]=t[p+1],l(e,e,s),t[p]=e[0],t[p+1]=e[1];return t}})();function rM(){var e=new ps(3);return ps!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function BD(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function ES(e,t,n){var r=new ps(3);return r[0]=e,r[1]=t,r[2]=n,r}function UD(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function VD(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function jD(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function GD(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function WD(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function HD(e,t){var n=t[0],r=t[1],o=t[2],l=n*n+r*r+o*o;return l>0&&(l=1/Math.sqrt(l)),e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e}function iM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dy(e,t,n){var r=t[0],o=t[1],l=t[2],s=n[0],p=n[1],g=n[2];return e[0]=o*g-l*p,e[1]=l*s-r*g,e[2]=r*p-o*s,e}function qD(e,t,n,r){var o=t[0],l=t[1],s=t[2];return e[0]=o+r*(n[0]-o),e[1]=l+r*(n[1]-l),e[2]=s+r*(n[2]-s),e}function Hb(e,t,n){var r=t[0],o=t[1],l=t[2],s=n[3]*r+n[7]*o+n[11]*l+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*o+n[8]*l+n[12])/s,e[1]=(n[1]*r+n[5]*o+n[9]*l+n[13])/s,e[2]=(n[2]*r+n[6]*o+n[10]*l+n[14])/s,e}function oM(e,t,n){var r=t[0],o=t[1],l=t[2];return e[0]=r*n[0]+o*n[3]+l*n[6],e[1]=r*n[1]+o*n[4]+l*n[7],e[2]=r*n[2]+o*n[5]+l*n[8],e}function sM(e,t,n){var r=n[0],o=n[1],l=n[2],s=n[3],p=t[0],g=t[1],_=t[2],w=o*_-l*g,P=l*p-r*_,A=r*g-o*p,M=o*A-l*P,F=l*w-r*A,X=r*P-o*w,B=s*2;return w*=B,P*=B,A*=B,M*=2,F*=2,X*=2,e[0]=p+w+M,e[1]=g+P+F,e[2]=_+A+X,e}function ZD(e,t,n,r){var o=[],l=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],l[0]=o[0],l[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),l[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e}function XD(e,t,n,r){var o=[],l=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],l[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),l[1]=o[1],l[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e}function $D(e,t,n,r){var o=[],l=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],l[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),l[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),l[2]=o[2],e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e}function YD(e,t){var n=e[0],r=e[1],o=e[2],l=t[0],s=t[1],p=t[2],g=Math.sqrt(n*n+r*r+o*o),_=Math.sqrt(l*l+s*s+p*p),w=g*_,P=w&&iM(e,t)/w;return Math.acos(Math.min(Math.max(P,-1),1))}var aM=VD,KD=jD,lM=BD,f0=GD;(function(){var e=rM();return function(t,n,r,o,l,s){var p,g;for(n||(n=3),r||(r=0),o?g=Math.min(o*n+r,t.length):g=t.length,p=r;p<g;p+=n)e[0]=t[p],e[1]=t[p+1],e[2]=t[p+2],l(e,e,s),t[p]=e[0],t[p+1]=e[1],t[p+2]=e[2];return t}})();function ol(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const as=Math.PI,uM=as/4,cs=as/180,e1=180/as,gd=512,n1=4003e4,_g=85.051129,cM=1.5;function r1(e){return Math.pow(2,e)}function hM(e){return Gb(e)}function Uo(e){const[t,n]=e;ol(Number.isFinite(t)),ol(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=t*cs,o=n*cs,l=gd*(r+as)/(2*as),s=gd*(as+Math.log(Math.tan(uM+o*.5)))/(2*as);return[l,s]}function ia(e){const[t,n]=e,r=t/gd*(2*as)-as,o=2*(Math.atan(Math.exp(n/gd*(2*as)-as))-uM);return[r*e1,o*e1]}function JD(e){const{latitude:t}=e;ol(Number.isFinite(t));const n=Math.cos(t*cs);return hM(n1*n)-9}function iv(e){const{latitude:t,longitude:n,highPrecision:r=!1}=e;ol(Number.isFinite(t)&&Number.isFinite(n));const o=gd,l=Math.cos(t*cs),s=o/360,p=s/l,g=o/n1/l,_={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[s,p,g],degreesPerUnit:[1/s,1/p,1/g]};if(r){const w=cs*Math.tan(t*cs)/l,P=s*w/2,A=o/n1*w,M=A/p*g;_.unitsPerDegree2=[0,P,A],_.unitsPerMeter2=[M,0,M]}return _}function fM(e,t){const[n,r,o]=e,[l,s,p]=t,{unitsPerMeter:g,unitsPerMeter2:_}=iv({longitude:n,latitude:r,highPrecision:!0}),w=Uo(e);w[0]+=l*(g[0]+_[0]*s),w[1]+=s*(g[1]+_[1]*s);const P=ia(w),A=(o||0)+(p||0);return Number.isFinite(o)||Number.isFinite(p)?[P[0],P[1],A]:P}function pM(e){const{height:t,pitch:n,bearing:r,altitude:o,scale:l,center:s}=e,p=py();md(p,p,[0,0,-o]),QI(p,p,-n*cs),tM(p,p,r*cs);const g=l/t;return Gv(p,p,[g,g,g]),s&&md(p,p,WD([],s)),p}function dM(e){const{width:t,height:n,altitude:r,pitch:o=0,offset:l,center:s,scale:p,nearZMultiplier:g=1,farZMultiplier:_=1}=e;let{fovy:w=uf(cM)}=e;r!==void 0&&(w=uf(r));const P=w*cs,A=o*cs,M=qb(w);let F=M;s&&(F+=s[2]*p/Math.cos(A)/n);const X=P*(.5+(l?l[1]:0)/n),B=Math.sin(X)*F/Math.sin(t1(Math.PI/2-A-X,.01,Math.PI-.01)),U=Math.sin(A)*B+F,H=F*10,tt=Math.min(U*_,H);return{fov:P,aspect:t/n,focalDistance:M,near:g,far:tt}}function QD(e){const{fov:t,aspect:n,near:r,far:o}=dM(e);return eM([],t,n,r,o)}function uf(e){return 2*Math.atan(.5/e)*e1}function qb(e){return .5/Math.tan(.5*e*cs)}function Zb(e,t){const[n,r,o=0]=e;return ol(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o)),Kh(t,[n,r,o,1])}function cf(e,t,n=0){const[r,o,l]=e;if(ol(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(l))return Kh(t,[r,o,l,1]);const s=Kh(t,[r,o,0,1]),p=Kh(t,[r,o,1,1]),g=s[2],_=p[2],w=g===_?0:((n||0)-g)/(_-g);return nM([],s,p,w)}function Xb(e){const{width:t,height:n,bounds:r,minExtent:o=0,maxZoom:l=24,offset:s=[0,0]}=e,[[p,g],[_,w]]=r,P=tF(e.padding),A=Uo([p,t1(w,-_g,_g)]),M=Uo([_,t1(g,-_g,_g)]),F=[Math.max(Math.abs(M[0]-A[0]),o),Math.max(Math.abs(M[1]-A[1]),o)],X=[t-P.left-P.right-Math.abs(s[0])*2,n-P.top-P.bottom-Math.abs(s[1])*2];ol(X[0]>0&&X[1]>0);const B=X[0]/F[0],U=X[1]/F[1],H=(P.right-P.left)/2/B,tt=(P.top-P.bottom)/2/U,st=[(M[0]+A[0])/2+H,(M[1]+A[1])/2+tt],pt=ia(st),_t=Math.min(l,Gb(Math.abs(Math.min(B,U))));return ol(Number.isFinite(_t)),{longitude:pt[0],latitude:pt[1],zoom:_t}}function tF(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ol(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const SS=Math.PI/180;function mM(e,t=0){const{width:n,height:r,unproject:o}=e,l={targetZ:t},s=o([0,r],l),p=o([n,r],l);let g,_;const w=e.fovy?.5*e.fovy*SS:Math.atan(.5/e.altitude),P=(90-e.pitch)*SS;return w>P-.01?(g=PS(e,0,t),_=PS(e,n,t)):(g=o([0,0],l),_=o([n,0],l)),[s,p,_,g]}function PS(e,t,n){const{pixelUnprojectionMatrix:r}=e,o=Kh(r,[t,0,1,1]),l=Kh(r,[t,e.height,1,1]),p=(n*e.distanceScales.unitsPerMeter[2]-o[2])/(l[2]-o[2]),g=nM([],o,l,p),_=ia(g);return _.push(n),_}let il=class{constructor(t={width:1,height:1}){L(this,"latitude",void 0),L(this,"longitude",void 0),L(this,"zoom",void 0),L(this,"pitch",void 0),L(this,"bearing",void 0),L(this,"altitude",void 0),L(this,"fovy",void 0),L(this,"meterOffset",void 0),L(this,"center",void 0),L(this,"width",void 0),L(this,"height",void 0),L(this,"scale",void 0),L(this,"distanceScales",void 0),L(this,"viewMatrix",void 0),L(this,"projectionMatrix",void 0),L(this,"viewProjectionMatrix",void 0),L(this,"pixelProjectionMatrix",void 0),L(this,"pixelUnprojectionMatrix",void 0),L(this,"equals",U=>U instanceof il?U.width===this.width&&U.height===this.height&&TS(U.projectionMatrix,this.projectionMatrix)&&TS(U.viewMatrix,this.viewMatrix):!1),L(this,"project",(U,H={})=>{const{topLeft:tt=!0}=H,st=this.projectPosition(U),pt=Zb(st,this.pixelProjectionMatrix),[_t,Ot]=pt,Dt=tt?Ot:this.height-Ot;return U.length===2?[_t,Dt]:[_t,Dt,pt[2]]}),L(this,"unproject",(U,H={})=>{const{topLeft:tt=!0,targetZ:st=void 0}=H,[pt,_t,Ot]=U,Dt=tt?_t:this.height-_t,kt=st&&st*this.distanceScales.unitsPerMeter[2],qt=cf([pt,Dt,Ot],this.pixelUnprojectionMatrix,kt),[ee,_e,ae]=this.unprojectPosition(qt);return Number.isFinite(Ot)?[ee,_e,ae]:Number.isFinite(st)?[ee,_e,st]:[ee,_e]}),L(this,"projectPosition",U=>{const[H,tt]=Uo(U),st=(U[2]||0)*this.distanceScales.unitsPerMeter[2];return[H,tt,st]}),L(this,"unprojectPosition",U=>{const[H,tt]=ia(U),st=(U[2]||0)*this.distanceScales.metersPerUnit[2];return[H,tt,st]});let{width:n,height:r,altitude:o=null,fovy:l=null}=t;const{latitude:s=0,longitude:p=0,zoom:g=0,pitch:_=0,bearing:w=0,position:P=null,nearZMultiplier:A=.02,farZMultiplier:M=1.01}=t;n=n||1,r=r||1,l===null&&o===null?(o=cM,l=uf(o)):l===null?l=uf(o):o===null&&(o=qb(l));const F=r1(g);o=Math.max(.75,o);const X=iv({longitude:p,latitude:s}),B=Uo([p,s]);B.push(0),P&&UD(B,B,KD([],P,X.unitsPerMeter)),this.projectionMatrix=QD({width:n,height:r,scale:F,center:B,pitch:_,fovy:l,nearZMultiplier:A,farZMultiplier:M}),this.viewMatrix=pM({height:r,scale:F,center:B,pitch:_,bearing:w,altitude:o}),this.width=n,this.height=r,this.scale=F,this.latitude=s,this.longitude=p,this.zoom=g,this.pitch=_,this.bearing=w,this.altitude=o,this.fovy=l,this.center=B,this.meterOffset=P||[0,0,0],this.distanceScales=X,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:n,projectionMatrix:r,viewMatrix:o}=this,l=py();ra(l,l,r),ra(l,l,o),this.viewProjectionMatrix=l;const s=py();Gv(s,s,[t/2,-n/2,1]),md(s,s,[1,-1,0]),ra(s,s,l);const p=rv(py(),s);if(!p)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=p}projectFlat(t){return Uo(t)}unprojectFlat(t){return ia(t)}getMapCenterByLngLatPosition({lngLat:t,pos:n}){const r=cf(n,this.pixelUnprojectionMatrix),o=Uo(t),l=fc([],o,Wb([],r)),s=fc([],this.center,l);return ia(s)}fitBounds(t,n={}){const{width:r,height:o}=this,{longitude:l,latitude:s,zoom:p}=Xb(Object.assign({width:r,height:o,bounds:t},n));return new il({width:r,height:o,longitude:l,latitude:s,zoom:p})}getBounds(t){const n=this.getBoundingRegion(t),r=Math.min(...n.map(p=>p[0])),o=Math.max(...n.map(p=>p[0])),l=Math.min(...n.map(p=>p[1])),s=Math.max(...n.map(p=>p[1]));return[[r,l],[o,s]]}getBoundingRegion(t={}){return mM(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:n}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}};const AS=512;function gM(e){const{width:t,height:n,pitch:r=0}=e;let{longitude:o,latitude:l,zoom:s,bearing:p=0}=e;(o<-180||o>180)&&(o=wS(o+180,360)-180),(p<-180||p>180)&&(p=wS(p+180,360)-180);const g=Gb(n/AS);if(s<=g)s=g,l=0;else{const _=n/2/Math.pow(2,s),w=ia([0,_])[1];if(l<w)l=w;else{const P=ia([0,AS-_])[1];l>P&&(l=P)}}return{width:t,height:n,longitude:o,latitude:l,zoom:s,pitch:r,bearing:p}}const yM=.01,eF=["longitude","latitude","zoom"],vM={curve:1.414,speed:1.2};function nF(e,t,n,r){const{startZoom:o,startCenterXY:l,uDelta:s,w0:p,u1:g,S:_,rho:w,rho2:P,r0:A}=_M(e,t,r);if(g<yM){const st={};for(const pt of eF){const _t=e[pt],Ot=t[pt];st[pt]=vD(_t,Ot,n)}return st}const M=n*_,F=Math.cosh(A)/Math.cosh(A+w*M),X=p*((Math.cosh(A)*Math.tanh(A+w*M)-Math.sinh(A))/P)/g,B=1/F,U=o+hM(B),H=RD([],s,X);fc(H,H,l);const tt=ia(H);return{longitude:tt[0],latitude:tt[1],zoom:U}}function rF(e,t,n){const r={...vM,...n},{screenSpeed:o,speed:l,maxDuration:s}=r,{S:p,rho:g}=_M(e,t,r),_=1e3*p;let w;return Number.isFinite(o)?w=_/(o/g):w=_/l,Number.isFinite(s)&&w>s?0:w}function _M(e,t,n){n=Object.assign({},vM,n);const r=n.curve,o=e.zoom,l=[e.longitude,e.latitude],s=r1(o),p=t.zoom,g=[t.longitude,t.latitude],_=r1(p-o),w=Uo(l),P=Uo(g),A=ND([],P,w),M=Math.max(e.width,e.height),F=M/_,X=zD(A)*s,B=Math.max(X,yM),U=r*r,H=(F*F-M*M+U*U*B*B)/(2*M*U*B),tt=(F*F-M*M-U*U*B*B)/(2*F*U*B),st=Math.log(Math.sqrt(H*H+1)-H),pt=Math.log(Math.sqrt(tt*tt+1)-tt),_t=(pt-st)/r;return{startZoom:o,startCenterXY:w,uDelta:A,w0:M,u1:X,S:_t,rho:r,rho2:U,r0:st,r1:pt}}var xM=function(){if(typeof Map<"u")return Map;function e(t,n){var r=-1;return t.some(function(o,l){return o[0]===n?(r=l,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var r=e(this.__entries__,n),o=this.__entries__[r];return o&&o[1]},t.prototype.set=function(n,r){var o=e(this.__entries__,n);~o?this.__entries__[o][1]=r:this.__entries__.push([n,r])},t.prototype.delete=function(n){var r=this.__entries__,o=e(r,n);~o&&r.splice(o,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,r){r===void 0&&(r=null);for(var o=0,l=this.__entries__;o<l.length;o++){var s=l[o];n.call(r,s[1],s[0])}},t}()}(),i1=typeof window<"u"&&typeof document<"u"&&window.document===document,ov=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),iF=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(ov):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),oF=2;function sF(e,t){var n=!1,r=!1,o=0;function l(){n&&(n=!1,e()),r&&p()}function s(){iF(l)}function p(){var g=Date.now();if(n){if(g-o<oF)return;r=!0}else n=!0,r=!1,setTimeout(s,t);o=g}return p}var aF=20,lF=["top","right","bottom","left","width","height","size","weight"],uF=typeof MutationObserver<"u",cF=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=sF(this.refresh.bind(this),aF)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var n=this.observers_,r=n.indexOf(t);~r&&n.splice(r,1),!n.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return t.forEach(function(n){return n.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!i1||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),uF?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!i1||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var n=t.propertyName,r=n===void 0?"":n,o=lF.some(function(l){return!!~r.indexOf(l)});o&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),bM=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];Object.defineProperty(e,o,{value:t[o],enumerable:!1,writable:!1,configurable:!0})}return e},hf=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||ov},wM=Wv(0,0,0,0);function sv(e){return parseFloat(e)||0}function CS(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(r,o){var l=e["border-"+o+"-width"];return r+sv(l)},0)}function hF(e){for(var t=["top","right","bottom","left"],n={},r=0,o=t;r<o.length;r++){var l=o[r],s=e["padding-"+l];n[l]=sv(s)}return n}function fF(e){var t=e.getBBox();return Wv(0,0,t.width,t.height)}function pF(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return wM;var r=hf(e).getComputedStyle(e),o=hF(r),l=o.left+o.right,s=o.top+o.bottom,p=sv(r.width),g=sv(r.height);if(r.boxSizing==="border-box"&&(Math.round(p+l)!==t&&(p-=CS(r,"left","right")+l),Math.round(g+s)!==n&&(g-=CS(r,"top","bottom")+s)),!mF(e)){var _=Math.round(p+l)-t,w=Math.round(g+s)-n;Math.abs(_)!==1&&(p-=_),Math.abs(w)!==1&&(g-=w)}return Wv(o.left,o.top,p,g)}var dF=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof hf(e).SVGGraphicsElement}:function(e){return e instanceof hf(e).SVGElement&&typeof e.getBBox=="function"}}();function mF(e){return e===hf(e).document.documentElement}function gF(e){return i1?dF(e)?fF(e):pF(e):wM}function yF(e){var t=e.x,n=e.y,r=e.width,o=e.height,l=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(l.prototype);return bM(s,{x:t,y:n,width:r,height:o,top:n,right:t+r,bottom:o+n,left:t}),s}function Wv(e,t,n,r){return{x:e,y:t,width:n,height:r}}var vF=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Wv(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=gF(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),_F=function(){function e(t,n){var r=yF(n);bM(this,{target:t,contentRect:r})}return e}(),xF=function(){function e(t,n,r){if(this.activeObservations_=[],this.observations_=new xM,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof hf(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)||(n.set(t,new vF(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof hf(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)&&(n.delete(t),n.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(n){n.isActive()&&t.activeObservations_.push(n)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,n=this.activeObservations_.map(function(r){return new _F(r.target,r.broadcastRect())});this.callback_.call(t,n,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),TM=typeof WeakMap<"u"?new WeakMap:new xM,EM=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=cF.getInstance(),r=new xF(t,n,this);TM.set(this,r)}return e}();["observe","unobserve","disconnect"].forEach(function(e){EM.prototype[e]=function(){var t;return(t=TM.get(this))[e].apply(t,arguments)}});var bF=function(){return typeof ov.ResizeObserver<"u"?ov.ResizeObserver:EM}();function lu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,YI(r.key),r)}}function uu(e,t,n){return t&&IS(e.prototype,t),n&&IS(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ka=typeof document<"u"?document:{};function MS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MS(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MS(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function LS(e,t){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=wF(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,s=!1,p;return{s:function(){n=e[Symbol.iterator]()},n:function(){var _=n.next();return l=_.done,_},e:function(_){s=!0,p=_},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(s)throw p}}}}function wF(e,t){if(e){if(typeof e=="string")return kS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kS(e,t)}}function kS(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var TF=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function p0(e){if(!e)return null;if(typeof e=="string")return e;e.toJS&&(e=e.toJS());var t={},n=LS(e.layers),r;try{for(n.s();!(r=n.n()).done;){var o=r.value;t[o.id]=o}}catch(s){n.e(s)}finally{n.f()}var l=e.layers.map(function(s){var p=t[s.ref],g=null;if("interactive"in s&&(g=xg({},s),delete g.interactive),p){g=g||xg({},s),delete g.ref;var _=LS(TF),w;try{for(_.s();!(w=_.n()).done;){var P=w.value;P in p&&(g[P]=p[P])}}catch(A){_.e(A)}finally{_.f()}}return g||s});return xg(xg({},e),{},{layers:l})}function EF(){}function SF(e){e&&console.error(e.error)}var SM={container:Tt.object,gl:Tt.object,mapboxApiAccessToken:Tt.string,mapboxApiUrl:Tt.string,attributionControl:Tt.bool,preserveDrawingBuffer:Tt.bool,reuseMaps:Tt.bool,transformRequest:Tt.func,mapOptions:Tt.object,mapStyle:Tt.oneOfType([Tt.string,Tt.object]),preventStyleDiffing:Tt.bool,visible:Tt.bool,asyncRender:Tt.bool,onLoad:Tt.func,onError:Tt.func,width:Tt.number,height:Tt.number,viewState:Tt.object,longitude:Tt.number,latitude:Tt.number,zoom:Tt.number,bearing:Tt.number,pitch:Tt.number,altitude:Tt.number},my={container:Ka.body,mapboxApiAccessToken:PF(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:EF,onError:SF,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function PF(){var e=null;if(typeof window<"u"&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);e=t&&t[1]}return!e&&typeof process<"u"&&(e=e||{}.MapboxAccessToken||{}.REACT_APP_MAPBOX_ACCESS_TOKEN),e||"no-token"}function OS(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";e.debug&&Tt.checkPropTypes(SM,e,"prop",t)}var wc=function(){function e(t){var n=this;if(lu(this,e),L(this,"props",my),L(this,"width",0),L(this,"height",0),L(this,"_fireLoadEvent",function(){n.props.onLoad({type:"load",target:n._map})}),L(this,"_handleError",function(r){n.props.onError(r)}),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return uu(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(n){return this._update(this.props,n),this}},{key:"redraw",value:function(){var n=this._map;n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(n){this._map=e.savedMap;var r=this._map.getContainer(),o=n.container;for(o.classList.add("mapboxgl-map");r.childNodes.length>0;)o.appendChild(r.childNodes[0]);this._map._container=o,e.savedMap=null,n.mapStyle&&this._map.setStyle(p0(n.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(n){if(n.reuseMaps&&e.savedMap)this._reuse(n);else{if(n.gl){var r=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=r,n.gl}}var o={container:n.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:p0(n.mapStyle),interactive:!1,trackResize:!1,attributionControl:n.attributionControl,preserveDrawingBuffer:n.preserveDrawingBuffer};n.transformRequest&&(o.transformRequest=n.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},o,n.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!e.savedMap?(e.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(n){var r=this;n=Object.assign({},my,n),OS(n,"Mapbox"),this.mapboxgl.accessToken=n.mapboxApiAccessToken||my.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=n.mapboxApiUrl,this._create(n);var o=n,l=o.container;Object.defineProperty(l,"offsetWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(l,"clientWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(l,"offsetHeight",{configurable:!0,get:function(){return r.height}}),Object.defineProperty(l,"clientHeight",{configurable:!0,get:function(){return r.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},n),this._updateMapSize({},n),this.props=n}},{key:"_update",value:function(n,r){if(this._map){r=Object.assign({},this.props,r),OS(r,"Mapbox");var o=this._updateMapViewport(n,r),l=this._updateMapSize(n,r);this._updateMapStyle(n,r),!r.asyncRender&&(o||l)&&this.redraw(),this.props=r}}},{key:"_updateMapStyle",value:function(n,r){var o=n.mapStyle!==r.mapStyle;o&&this._map.setStyle(p0(r.mapStyle),{diff:!r.preventStyleDiffing})}},{key:"_updateMapSize",value:function(n,r){var o=n.width!==r.width||n.height!==r.height;return o&&(this.width=r.width,this.height=r.height,this._map.resize()),o}},{key:"_updateMapViewport",value:function(n,r){var o=this._getViewState(n),l=this._getViewState(r),s=l.latitude!==o.latitude||l.longitude!==o.longitude||l.zoom!==o.zoom||l.pitch!==o.pitch||l.bearing!==o.bearing||l.altitude!==o.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(l)),l.altitude!==o.altitude&&(this._map.transform.altitude=l.altitude)),s}},{key:"_getViewState",value:function(n){var r=n.viewState||n,o=r.longitude,l=r.latitude,s=r.zoom,p=r.pitch,g=p===void 0?0:p,_=r.bearing,w=_===void 0?0:_,P=r.altitude,A=P===void 0?1.5:P;return{longitude:o,latitude:l,zoom:s,pitch:g,bearing:w,altitude:A}}},{key:"_checkStyleSheet",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ka>"u"))try{var r=Ka.createElement("div");r.className="mapboxgl-map",r.style.display="none",Ka.body.appendChild(r);var o=window.getComputedStyle(r).position!=="static";if(!o){var l=Ka.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(n,"/mapbox-gl.css")),Ka.head.appendChild(l)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(n){return{center:[n.longitude,n.latitude],zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}}}]),e}();L(wc,"initialized",!1);L(wc,"propTypes",SM);L(wc,"defaultProps",my);L(wc,"savedMap",null);var o1={},AF={get exports(){return o1},set exports(e){o1=e}};(function(e,t){(function(n,r){e.exports=r()})(N3,function(){var n,r,o;function l(s,p){if(!n)n=p;else if(!r)r=p;else{var g="var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk);",_={};n(_),o=p(_),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([g],{type:"text/javascript"})))}}return l(["exports"],function(s){function p(i,a){return i(a={exports:{}},a.exports),a.exports}var g=_;function _(i,a,u,d){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=d,this.p2x=u,this.p2y=d}_.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},_.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},_.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},_.prototype.solveCurveX=function(i,a){var u,d,y,v,b;for(a===void 0&&(a=1e-6),y=i,b=0;b<8;b++){if(v=this.sampleCurveX(y)-i,Math.abs(v)<a)return y;var S=this.sampleCurveDerivativeX(y);if(Math.abs(S)<1e-6)break;y-=v/S}if((y=i)<(u=0))return u;if(y>(d=1))return d;for(;u<d;){if(v=this.sampleCurveX(y),Math.abs(v-i)<a)return y;i>v?u=y:d=y,y=.5*(d-u)+u}return y},_.prototype.solve=function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))};var w=P;function P(i,a){this.x=i,this.y=a}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,a){return this.clone()._rotateAround(i,a)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var a=i.x-this.x,u=i.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,a){return Math.atan2(this.x*a-this.y*i,this.x*i+this.y*a)},_matMult:function(i){var a=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=a,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var a=Math.cos(i),u=Math.sin(i),d=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=d,this},_rotateAround:function(i,a){var u=Math.cos(i),d=Math.sin(i),y=a.y+d*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-d*(this.y-a.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(i){return i instanceof P?i:Array.isArray(i)?new P(i[0],i[1]):i};var A=typeof self<"u"?self:{},M=Math.pow(2,53)-1;function F(i,a,u,d){var y=new g(i,a,u,d);return function(v){return y.solve(v)}}var X=F(.25,.1,.25,1);function B(i,a,u){return Math.min(u,Math.max(a,i))}function U(i,a,u){var d=u-a,y=((i-a)%d+d)%d+a;return y===a?u:y}function H(i){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];for(var d=0,y=a;d<y.length;d+=1){var v=y[d];for(var b in v)i[b]=v[b]}return i}var tt=1;function st(){return tt++}function pt(){return function i(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function _t(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ot(i,a){i.forEach(function(u){a[u]&&(a[u]=a[u].bind(a))})}function Dt(i,a){return i.indexOf(a,i.length-a.length)!==-1}function kt(i,a,u){var d={};for(var y in i)d[y]=a.call(u||this,i[y],y,i);return d}function qt(i,a,u){var d={};for(var y in i)a.call(u||this,i[y],y,i)&&(d[y]=i[y]);return d}function ee(i){return Array.isArray(i)?i.map(ee):typeof i=="object"&&i?kt(i,ee):i}var _e={};function ae(i){_e[i]||(typeof console<"u"&&console.warn(i),_e[i]=!0)}function he(i,a,u){return(u.y-i.y)*(a.x-i.x)>(a.y-i.y)*(u.x-i.x)}function sn(i){for(var a=0,u=0,d=i.length,y=d-1,v=void 0,b=void 0;u<d;y=u++)a+=((b=i[y]).x-(v=i[u]).x)*(v.y+b.y);return a}function ar(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gr(i){var a={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,y,v,b){var S=v||b;return a[y]=!S||S.toLowerCase(),""}),a["max-age"]){var u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a}var mi=null;function $i(i){if(mi==null){var a=i.navigator?i.navigator.userAgent:null;mi=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return mi}function gi(i){try{var a=A[i];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}}var Vr,Sr,ho,Jt,Te=A.performance&&A.performance.now?A.performance.now.bind(A.performance):Date.now.bind(Date),Je=A.requestAnimationFrame||A.mozRequestAnimationFrame||A.webkitRequestAnimationFrame||A.msRequestAnimationFrame,Oe=A.cancelAnimationFrame||A.mozCancelAnimationFrame||A.webkitCancelAnimationFrame||A.msCancelAnimationFrame,an={now:Te,frame:function(i){var a=Je(i);return{cancel:function(){return Oe(a)}}},getImageData:function(i,a){a===void 0&&(a=0);var u=A.document.createElement("canvas"),d=u.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return u.width=i.width,u.height=i.height,d.drawImage(i,0,0,i.width,i.height),d.getImageData(-a,-a,i.width+2*a,i.height+2*a)},resolveURL:function(i){return Vr||(Vr=A.document.createElement("a")),Vr.href=i,Vr.href},hardwareConcurrency:A.navigator&&A.navigator.hardwareConcurrency||4,get devicePixelRatio(){return A.devicePixelRatio},get prefersReducedMotion(){return!!A.matchMedia&&(Sr==null&&(Sr=A.matchMedia("(prefers-reduced-motion: reduce)")),Sr.matches)}},Se={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},dn={supported:!1,testSupport:function(i){!jr&&Jt&&(Un?Ve(i):ho=i)}},jr=!1,Un=!1;function Ve(i){var a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Jt),i.isContextLost())return;dn.supported=!0}catch{}i.deleteTexture(a),jr=!0}A.document&&((Jt=A.document.createElement("img")).onload=function(){ho&&Ve(ho),ho=null,Un=!0},Jt.onerror=function(){jr=!0,ho=null},Jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var yi="01",lr=function(i,a){this._transformRequestFn=i,this._customAccessToken=a,this._createSkuToken()};function Zn(i){return i.indexOf("mapbox:")===0}lr.prototype._createSkuToken=function(){var i=function(){for(var a="",u=0;u<10;u++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yi,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},lr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},lr.prototype.transformRequest=function(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}},lr.prototype.normalizeStyleURL=function(i,a){if(!Zn(i))return i;var u=Gr(i);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||a)},lr.prototype.normalizeGlyphsURL=function(i,a){if(!Zn(i))return i;var u=Gr(i);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||a)},lr.prototype.normalizeSourceURL=function(i,a){if(!Zn(i))return i;var u=Gr(i);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||a)},lr.prototype.normalizeSpriteURL=function(i,a,u,d){var y=Gr(i);return Zn(i)?(y.path="/styles/v1"+y.path+"/sprite"+a+u,this._makeAPIURL(y,this._customAccessToken||d)):(y.path+=""+a+u,yr(y))},lr.prototype.normalizeTileURL=function(i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Zn(i))return i;var u=Gr(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(an.devicePixelRatio>=2||a===512?"@2x":"")+(dn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var d=this._customAccessToken||function(y){for(var v=0,b=y;v<b.length;v+=1){var S=b[v].match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||Se.ACCESS_TOKEN;return Se.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,d)},lr.prototype.canonicalizeTileURL=function(i,a){var u=Gr(i);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return i;var d="mapbox://tiles/";d+=u.path.replace("/v4/","");var y=u.params;return a&&(y=y.filter(function(v){return!v.match(/^access_token=/)})),y.length&&(d+="?"+y.join("&")),d},lr.prototype.canonicalizeTileset=function(i,a){for(var u=!!a&&Zn(a),d=[],y=0,v=i.tiles||[];y<v.length;y+=1){var b=v[y];vi(b)?d.push(this.canonicalizeTileURL(b,u)):d.push(b)}return d},lr.prototype._makeAPIURL=function(i,a){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Gr(Se.API_URL);if(i.protocol=d.protocol,i.authority=d.authority,i.protocol==="http"){var y=i.params.indexOf("secure");y>=0&&i.params.splice(y,1)}if(d.path!=="/"&&(i.path=""+d.path+i.path),!Se.REQUIRE_ACCESS_TOKEN)return yr(i);if(!(a=a||Se.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return i.params=i.params.filter(function(v){return v.indexOf("access_token")===-1}),i.params.push("access_token="+a),yr(i)};var fo=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function vi(i){return fo.test(i)}var gs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Gr(i){var a=i.match(gs);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function yr(i){var a=i.params.length?"?"+i.params.join("&"):"";return i.protocol+"://"+i.authority+i.path+a}function ys(i){if(!i)return null;var a=i.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(A.atob(a[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var _i=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};_i.prototype.getStorageKey=function(i){var a,u=ys(Se.ACCESS_TOKEN);return a=u&&u.u?A.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(d,y){return String.fromCharCode(Number("0x"+y))})):Se.ACCESS_TOKEN||"",i?"mapbox.eventData."+i+":"+a:"mapbox.eventData:"+a},_i.prototype.fetchEventData=function(){var i=gi("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{var d=A.localStorage.getItem(a);d&&(this.eventData=JSON.parse(d));var y=A.localStorage.getItem(u);y&&(this.anonId=y)}catch{ae("Unable to read from LocalStorage")}},_i.prototype.saveEventData=function(){var i=gi("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{A.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&A.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{ae("Unable to write to LocalStorage")}},_i.prototype.processRequests=function(i){},_i.prototype.postEvent=function(i,a,u,d){var y=this;if(Se.EVENTS_URL){var v=Gr(Se.EVENTS_URL);v.params.push("access_token="+(d||Se.ACCESS_TOKEN||""));var b={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:yi,userId:this.anonId},S=a?H(b,a):b,I={url:yr(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=Dn(I,function(k){y.pendingRequest=null,u(k),y.saveEventData(),y.processRequests(d)})}},_i.prototype.queueRequest=function(i,a){this.queue.push(i),this.processRequests(a)};var xi,Ho,Ni=function(i){function a(){i.call(this,"map.load"),this.success={},this.skuToken=""}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(u,d,y,v){this.skuToken=y;var b=!(!v&&!Se.ACCESS_TOKEN),S=Array.isArray(u)&&u.some(function(I){return Zn(I)||vi(I)});Se.EVENTS_URL&&b&&S&&this.queueRequest({id:d,timestamp:Date.now()},v)},a.prototype.processRequests=function(u){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),v=y.id,b=y.timestamp;v&&this.success[v]||(this.anonId||this.fetchEventData(),_t(this.anonId)||(this.anonId=pt()),this.postEvent(b,{skuToken:this.skuToken},function(S){S||v&&(d.success[v]=!0)},u))}},a}(_i),ca=new(function(i){function a(u){i.call(this,"appUserTurnstile"),this._customAccessToken=u}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(u,d){Se.EVENTS_URL&&Se.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Zn(y)||vi(y)})&&this.queueRequest(Date.now(),d)},a.prototype.processRequests=function(u){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=ys(Se.ACCESS_TOKEN),v=y?y.u:Se.ACCESS_TOKEN,b=v!==this.eventData.tokenU;_t(this.anonId)||(this.anonId=pt(),b=!0);var S=this.queue.shift();if(this.eventData.lastSuccess){var I=new Date(this.eventData.lastSuccess),k=new Date(S),R=(S-this.eventData.lastSuccess)/864e5;b=b||R>=1||R<-1||I.getDate()!==k.getDate()}else b=!0;if(!b)return this.processRequests();this.postEvent(S,{"enabled.telemetry":!1},function(z){z||(d.eventData.lastSuccess=S,d.eventData.tokenU=v)},u)}},a}(_i)),ha=ca.postTurnstileEvent.bind(ca),vs=new Ni,_s=vs.postMapLoadEvent.bind(vs),po=500,xs=50;function bs(){A.caches&&!xi&&(xi=A.caches.open("mapbox-tiles"))}function fa(i){var a=i.indexOf("?");return a<0?i:i.slice(0,a)}var qo,pa=1/0;function da(){return qo==null&&(qo=A.OffscreenCanvas&&new A.OffscreenCanvas(1,1).getContext("2d")&&typeof A.createImageBitmap=="function"),qo}var Zo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Zo);var dl=function(i){function a(u,d,y){d===401&&vi(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),i.call(this,u),this.status=d,this.url=y,this.name=this.constructor.name,this.message=u}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Xo=ar()?function(){return self.worker&&self.worker.referrer}:function(){return(A.location.protocol==="blob:"?A.parent:A).location.href},Yi,Ki,Lo=function(i,a){if(!(/^file:/.test(u=i.url)||/^file:/.test(Xo())&&!/^\w+:/.test(u))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(d,y){var v,b=new A.AbortController,S=new A.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Xo(),signal:b.signal}),I=!1,k=!1,R=(v=S.url).indexOf("sku=")>0&&vi(v);d.type==="json"&&S.headers.set("Accept","application/json");var z=function(W,nt,rt){if(!k){if(W&&W.message!=="SecurityError"&&ae(W),nt&&rt)return j(nt);var ft=Date.now();A.fetch(S).then(function(ut){if(ut.ok){var vt=R?ut.clone():null;return j(ut,vt,ft)}return y(new dl(ut.statusText,ut.status,d.url))}).catch(function(ut){ut.code!==20&&y(new Error(ut.message))})}},j=function(W,nt,rt){(d.type==="arrayBuffer"?W.arrayBuffer():d.type==="json"?W.json():W.text()).then(function(ft){k||(nt&&rt&&function(ut,vt,wt){if(bs(),xi){var St={status:vt.status,statusText:vt.statusText,headers:new A.Headers};vt.headers.forEach(function(zt,Vt){return St.headers.set(Vt,zt)});var At=gr(vt.headers.get("Cache-Control")||"");At["no-store"]||(At["max-age"]&&St.headers.set("Expires",new Date(wt+1e3*At["max-age"]).toUTCString()),new Date(St.headers.get("Expires")).getTime()-wt<42e4||function(zt,Vt){if(Ho===void 0)try{new Response(new ReadableStream),Ho=!0}catch{Ho=!1}Ho?Vt(zt.body):zt.blob().then(Vt)}(vt,function(zt){var Vt=new A.Response(zt,St);bs(),xi&&xi.then(function(Xt){return Xt.put(fa(ut.url),Vt)}).catch(function(Xt){return ae(Xt.message)})}))}}(S,nt,rt),I=!0,y(null,ft,W.headers.get("Cache-Control"),W.headers.get("Expires")))}).catch(function(ft){k||y(new Error(ft.message))})};return R?function(W,nt){if(bs(),!xi)return nt(null);var rt=fa(W.url);xi.then(function(ft){ft.match(rt).then(function(ut){var vt=function(wt){if(!wt)return!1;var St=new Date(wt.headers.get("Expires")||0),At=gr(wt.headers.get("Cache-Control")||"");return St>Date.now()&&!At["no-cache"]}(ut);ft.delete(rt),vt&&ft.put(rt,ut.clone()),nt(null,ut,vt)}).catch(nt)}).catch(nt)}(S,z):z(null,null),{cancel:function(){k=!0,I||b.abort()}}}(i,a);if(ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,a,void 0,!0)}var u;return function(d,y){var v=new A.XMLHttpRequest;for(var b in v.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(v.responseType="arraybuffer"),d.headers)v.setRequestHeader(b,d.headers[b]);return d.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=d.credentials==="include",v.onerror=function(){y(new Error(v.statusText))},v.onload=function(){if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){var S=v.response;if(d.type==="json")try{S=JSON.parse(v.response)}catch(I){return y(I)}y(null,S,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else y(new dl(v.statusText,v.status,d.url))},v.send(d.body),{cancel:function(){return v.abort()}}}(i,a)},ma=function(i,a){return Lo(H(i,{type:"arrayBuffer"}),a)},Dn=function(i,a){return Lo(H(i,{method:"POST"}),a)},D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Yi=[],Ki=0;var V=function(i,a){if(dn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ki>=Se.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:i,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return Yi.push(u),u}Ki++;var d=!1,y=function(){if(!d)for(d=!0,Ki--;Yi.length&&Ki<Se.MAX_PARALLEL_IMAGE_REQUESTS;){var b=Yi.shift();b.cancelled||(b.cancel=V(b.requestParameters,b.callback).cancel)}},v=ma(i,function(b,S,I,k){y(),b?a(b):S&&(da()?function(R,z){var j=new A.Blob([new Uint8Array(R)],{type:"image/png"});A.createImageBitmap(j).then(function(W){z(null,W)}).catch(function(W){z(new Error("Could not load image because of "+W.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(S,a):function(R,z,j,W){var nt=new A.Image,rt=A.URL;nt.onload=function(){z(null,nt),rt.revokeObjectURL(nt.src),nt.onload=null,A.requestAnimationFrame(function(){nt.src=D})},nt.onerror=function(){return z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ft=new A.Blob([new Uint8Array(R)],{type:"image/png"});nt.cacheControl=j,nt.expires=W,nt.src=R.byteLength?rt.createObjectURL(ft):D}(S,a,I,k))});return{cancel:function(){v.cancel(),y()}}};function G(i,a,u){u[i]&&u[i].indexOf(a)!==-1||(u[i]=u[i]||[],u[i].push(a))}function J(i,a,u){if(u&&u[i]){var d=u[i].indexOf(a);d!==-1&&u[i].splice(d,1)}}var ot=function(i,a){a===void 0&&(a={}),H(this,a),this.type=i},mt=function(i){function a(u,d){d===void 0&&(d={}),i.call(this,"error",H({error:u},d))}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a}(ot),gt=function(){};gt.prototype.on=function(i,a){return this._listeners=this._listeners||{},G(i,a,this._listeners),this},gt.prototype.off=function(i,a){return J(i,a,this._listeners),J(i,a,this._oneTimeListeners),this},gt.prototype.once=function(i,a){return this._oneTimeListeners=this._oneTimeListeners||{},G(i,a,this._oneTimeListeners),this},gt.prototype.fire=function(i,a){typeof i=="string"&&(i=new ot(i,a||{}));var u=i.type;if(this.listens(u)){i.target=this;for(var d=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];d<y.length;d+=1)y[d].call(this,i);for(var v=0,b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];v<b.length;v+=1){var S=b[v];J(u,S,this._oneTimeListeners),S.call(this,i)}var I=this._eventedParent;I&&(H(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(i))}else i instanceof mt&&console.error(i.error);return this},gt.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},gt.prototype.setEventedParent=function(i,a){return this._eventedParent=i,this._eventedParentData=a,this};var $={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},lt=function(i,a,u,d){this.message=(i?i+": ":"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)};function xt(i){var a=i.value;return a?[new lt(i.key,a,"constants have been deprecated as of v8")]:[]}function Nt(i){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];for(var d=0,y=a;d<y.length;d+=1){var v=y[d];for(var b in v)i[b]=v[b]}return i}function Ut(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function It(i){if(Array.isArray(i))return i.map(It);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){var a={};for(var u in i)a[u]=It(i[u]);return a}return Ut(i)}var Bt=function(i){function a(u,d){i.call(this,d),this.message=d,this.key=u}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a}(Error),le=function(i,a){a===void 0&&(a=[]),this.parent=i,this.bindings={};for(var u=0,d=a;u<d.length;u+=1){var y=d[u];this.bindings[y[0]]=y[1]}};le.prototype.concat=function(i){return new le(this,i)},le.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},le.prototype.has=function(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)};var ie={kind:"null"},Lt={kind:"number"},Qt={kind:"string"},Ht={kind:"boolean"},Zt={kind:"color"},Re={kind:"object"},Yt={kind:"value"},We={kind:"collator"},mn={kind:"formatted"},je={kind:"resolvedImage"};function Ye(i,a){return{kind:"array",itemType:i,N:a}}function ze(i){if(i.kind==="array"){var a=ze(i.itemType);return typeof i.N=="number"?"array<"+a+", "+i.N+">":i.itemType.kind==="value"?"array":"array<"+a+">"}return i.kind}var Xn=[ie,Lt,Qt,Ht,Zt,mn,Re,Ye(Yt),je];function Ze(i,a){if(a.kind==="error")return null;if(i.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Ze(i.itemType,a.itemType))&&(typeof i.N!="number"||i.N===a.N))return null}else{if(i.kind===a.kind)return null;if(i.kind==="value"){for(var u=0,d=Xn;u<d.length;u+=1)if(!Ze(d[u],a))return null}}return"Expected "+ze(i)+" but found "+ze(a)+" instead."}function gn(i,a){return a.some(function(u){return u.kind===i.kind})}function on(i,a){return a.some(function(u){return u==="null"?i===null:u==="array"?Array.isArray(i):u==="object"?i&&!Array.isArray(i)&&typeof i=="object":u===typeof i})}var De=p(function(i,a){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(S){return(S=Math.round(S))<0?0:S>255?255:S}function y(S){return d(S[S.length-1]==="%"?parseFloat(S)/100*255:parseInt(S))}function v(S){return(I=S[S.length-1]==="%"?parseFloat(S)/100:parseFloat(S))<0?0:I>1?1:I;var I}function b(S,I,k){return k<0?k+=1:k>1&&(k-=1),6*k<1?S+(I-S)*k*6:2*k<1?I:3*k<2?S+(I-S)*(2/3-k)*6:S}try{a.parseCSSColor=function(S){var I,k=S.replace(/ /g,"").toLowerCase();if(k in u)return u[k].slice();if(k[0]==="#")return k.length===4?(I=parseInt(k.substr(1),16))>=0&&I<=4095?[(3840&I)>>4|(3840&I)>>8,240&I|(240&I)>>4,15&I|(15&I)<<4,1]:null:k.length===7&&(I=parseInt(k.substr(1),16))>=0&&I<=16777215?[(16711680&I)>>16,(65280&I)>>8,255&I,1]:null;var R=k.indexOf("("),z=k.indexOf(")");if(R!==-1&&z+1===k.length){var j=k.substr(0,R),W=k.substr(R+1,z-(R+1)).split(","),nt=1;switch(j){case"rgba":if(W.length!==4)return null;nt=v(W.pop());case"rgb":return W.length!==3?null:[y(W[0]),y(W[1]),y(W[2]),nt];case"hsla":if(W.length!==4)return null;nt=v(W.pop());case"hsl":if(W.length!==3)return null;var rt=(parseFloat(W[0])%360+360)%360/360,ft=v(W[1]),ut=v(W[2]),vt=ut<=.5?ut*(ft+1):ut+ft-ut*ft,wt=2*ut-vt;return[d(255*b(wt,vt,rt+1/3)),d(255*b(wt,vt,rt)),d(255*b(wt,vt,rt-1/3)),nt];default:return null}}return null}}catch{}}).parseCSSColor,Ge=function(i,a,u,d){d===void 0&&(d=1),this.r=i,this.g=a,this.b=u,this.a=d};Ge.parse=function(i){if(i){if(i instanceof Ge)return i;if(typeof i=="string"){var a=De(i);if(a)return new Ge(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Ge.prototype.toString=function(){var i=this.toArray(),a=i[1],u=i[2],d=i[3];return"rgba("+Math.round(i[0])+","+Math.round(a)+","+Math.round(u)+","+d+")"},Ge.prototype.toArray=function(){var i=this.a;return i===0?[0,0,0,0]:[255*this.r/i,255*this.g/i,255*this.b/i,i]},Ge.black=new Ge(0,0,0,1),Ge.white=new Ge(1,1,1,1),Ge.transparent=new Ge(0,0,0,0),Ge.red=new Ge(1,0,0,1);var Rr=function(i,a,u){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Rr.prototype.compare=function(i,a){return this.collator.compare(i,a)},Rr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ws=function(i,a,u,d,y){this.text=i,this.image=a,this.scale=u,this.fontStack=d,this.textColor=y},Vn=function(i){this.sections=i};Vn.fromString=function(i){return new Vn([new ws(i,null,null,null,null)])},Vn.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},Vn.factory=function(i){return i instanceof Vn?i:Vn.fromString(i)},Vn.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},Vn.prototype.serialize=function(){for(var i=["format"],a=0,u=this.sections;a<u.length;a+=1){var d=u[a];if(d.image)i.push(["image",d.image.name]);else{i.push(d.text);var y={};d.fontStack&&(y["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(y["font-scale"]=d.scale),d.textColor&&(y["text-color"]=["rgba"].concat(d.textColor.toArray())),i.push(y)}}return i};var Cn=function(i){this.name=i.name,this.available=i.available};function Ts(i,a,u,d){return typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[i,a,u,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[i,a,u,d]:[i,a,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function $o(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ge||i instanceof Rr||i instanceof Vn||i instanceof Cn)return!0;if(Array.isArray(i)){for(var a=0,u=i;a<u.length;a+=1)if(!$o(u[a]))return!1;return!0}if(typeof i=="object"){for(var d in i)if(!$o(i[d]))return!1;return!0}return!1}function In(i){if(i===null)return ie;if(typeof i=="string")return Qt;if(typeof i=="boolean")return Ht;if(typeof i=="number")return Lt;if(i instanceof Ge)return Zt;if(i instanceof Rr)return We;if(i instanceof Vn)return mn;if(i instanceof Cn)return je;if(Array.isArray(i)){for(var a,u=i.length,d=0,y=i;d<y.length;d+=1){var v=In(y[d]);if(a){if(a===v)continue;a=Yt;break}a=v}return Ye(a||Yt,u)}return Re}function Yo(i){var a=typeof i;return i===null?"":a==="string"||a==="number"||a==="boolean"?String(i):i instanceof Ge||i instanceof Vn||i instanceof Cn?i.toString():JSON.stringify(i)}Cn.prototype.toString=function(){return this.name},Cn.fromString=function(i){return i?new Cn({name:i,available:!1}):null},Cn.prototype.serialize=function(){return["image",this.name]};var vr=function(i,a){this.type=i,this.value=a};vr.parse=function(i,a){if(i.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!$o(i[1]))return a.error("invalid value");var u=i[1],d=In(u),y=a.expectedType;return d.kind!=="array"||d.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(d=y),new vr(d,u)},vr.prototype.evaluate=function(){return this.value},vr.prototype.eachChild=function(){},vr.prototype.outputDefined=function(){return!0},vr.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ge?["rgba"].concat(this.value.toArray()):this.value instanceof Vn?this.value.serialize():this.value};var jn=function(i){this.name="ExpressionEvaluationError",this.message=i};jn.prototype.toJSON=function(){return this.message};var er={string:Qt,number:Lt,boolean:Ht,object:Re},wn=function(i,a){this.type=i,this.args=a};wn.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var u,d=1,y=i[0];if(y==="array"){var v,b;if(i.length>2){var S=i[1];if(typeof S!="string"||!(S in er)||S==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);v=er[S],d++}else v=Yt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);b=i[2],d++}u=Ye(v,b)}else u=er[y];for(var I=[];d<i.length;d++){var k=a.parse(i[d],d,Yt);if(!k)return null;I.push(k)}return new wn(u,I)},wn.prototype.evaluate=function(i){for(var a=0;a<this.args.length;a++){var u=this.args[a].evaluate(i);if(!Ze(this.type,In(u)))return u;if(a===this.args.length-1)throw new jn("Expected value to be of type "+ze(this.type)+", but found "+ze(In(u))+" instead.")}return null},wn.prototype.eachChild=function(i){this.args.forEach(i)},wn.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},wn.prototype.serialize=function(){var i=this.type,a=[i.kind];if(i.kind==="array"){var u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);var d=i.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(function(y){return y.serialize()}))};var bi=function(i){this.type=mn,this.sections=i};bi.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var u=i[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");for(var d=[],y=!1,v=1;v<=i.length-1;++v){var b=i[v];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;var S=null;if(b["font-scale"]&&!(S=a.parse(b["font-scale"],1,Lt)))return null;var I=null;if(b["text-font"]&&!(I=a.parse(b["text-font"],1,Ye(Qt))))return null;var k=null;if(b["text-color"]&&!(k=a.parse(b["text-color"],1,Zt)))return null;var R=d[d.length-1];R.scale=S,R.font=I,R.textColor=k}else{var z=a.parse(i[v],1,Yt);if(!z)return null;var j=z.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,d.push({content:z,scale:null,font:null,textColor:null})}}return new bi(d)},bi.prototype.evaluate=function(i){return new Vn(this.sections.map(function(a){var u=a.content.evaluate(i);return In(u)===je?new ws("",u,null,null,null):new ws(Yo(u),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))},bi.prototype.eachChild=function(i){for(var a=0,u=this.sections;a<u.length;a+=1){var d=u[a];i(d.content),d.scale&&i(d.scale),d.font&&i(d.font),d.textColor&&i(d.textColor)}},bi.prototype.outputDefined=function(){return!1},bi.prototype.serialize=function(){for(var i=["format"],a=0,u=this.sections;a<u.length;a+=1){var d=u[a];i.push(d.content.serialize());var y={};d.scale&&(y["font-scale"]=d.scale.serialize()),d.font&&(y["text-font"]=d.font.serialize()),d.textColor&&(y["text-color"]=d.textColor.serialize()),i.push(y)}return i};var Wr=function(i){this.type=je,this.input=i};Wr.parse=function(i,a){if(i.length!==2)return a.error("Expected two arguments.");var u=a.parse(i[1],1,Qt);return u?new Wr(u):a.error("No image name provided.")},Wr.prototype.evaluate=function(i){var a=this.input.evaluate(i),u=Cn.fromString(a);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(a)>-1),u},Wr.prototype.eachChild=function(i){i(this.input)},Wr.prototype.outputDefined=function(){return!1},Wr.prototype.serialize=function(){return["image",this.input.serialize()]};var pu={"to-boolean":Ht,"to-color":Zt,"to-number":Lt,"to-string":Qt},wi=function(i,a){this.type=i,this.args=a};wi.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var u=i[0];if((u==="to-boolean"||u==="to-string")&&i.length!==2)return a.error("Expected one argument.");for(var d=pu[u],y=[],v=1;v<i.length;v++){var b=a.parse(i[v],v,Yt);if(!b)return null;y.push(b)}return new wi(d,y)},wi.prototype.evaluate=function(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){for(var a,u,d=0,y=this.args;d<y.length;d+=1){if(u=null,(a=y[d].evaluate(i))instanceof Ge)return a;if(typeof a=="string"){var v=i.parseColor(a);if(v)return v}else if(Array.isArray(a)&&!(u=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":Ts(a[0],a[1],a[2],a[3])))return new Ge(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new jn(u||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var b=null,S=0,I=this.args;S<I.length;S+=1){if((b=I[S].evaluate(i))===null)return 0;var k=Number(b);if(!isNaN(k))return k}throw new jn("Could not convert "+JSON.stringify(b)+" to number.")}return this.type.kind==="formatted"?Vn.fromString(Yo(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Cn.fromString(Yo(this.args[0].evaluate(i))):Yo(this.args[0].evaluate(i))},wi.prototype.eachChild=function(i){this.args.forEach(i)},wi.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},wi.prototype.serialize=function(){if(this.type.kind==="formatted")return new bi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wr(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(a){i.push(a.serialize())}),i};var Ef=["Unknown","Point","LineString","Polygon"],q=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};q.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},q.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ef[this.feature.type]:this.feature.type:null},q.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},q.prototype.canonicalID=function(){return this.canonical},q.prototype.properties=function(){return this.feature&&this.feature.properties||{}},q.prototype.parseColor=function(i){var a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Ge.parse(i)),a};var Q=function(i,a,u,d){this.name=i,this.type=a,this._evaluate=u,this.args=d};Q.prototype.evaluate=function(i){return this._evaluate(i,this.args)},Q.prototype.eachChild=function(i){this.args.forEach(i)},Q.prototype.outputDefined=function(){return!1},Q.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},Q.parse=function(i,a){var u,d=i[0],y=Q.definitions[d];if(!y)return a.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var v=Array.isArray(y)?y[0]:y.type,b=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,S=b.filter(function(ye){var ne=ye[0];return!Array.isArray(ne)||ne.length===i.length-1}),I=null,k=0,R=S;k<R.length;k+=1){var z=R[k],j=z[0],W=z[1];I=new As(a.registry,a.path,null,a.scope);for(var nt=[],rt=!1,ft=1;ft<i.length;ft++){var ut=i[ft],vt=Array.isArray(j)?j[ft-1]:j.type,wt=I.parse(ut,1+nt.length,vt);if(!wt){rt=!0;break}nt.push(wt)}if(!rt)if(Array.isArray(j)&&j.length!==nt.length)I.error("Expected "+j.length+" arguments, but found "+nt.length+" instead.");else{for(var St=0;St<nt.length;St++){var At=Array.isArray(j)?j[St]:j.type,zt=nt[St];I.concat(St+1).checkSubtype(At,zt.type)}if(I.errors.length===0)return new Q(d,v,W,nt)}}if(S.length===1)(u=a.errors).push.apply(u,I.errors);else{for(var Vt=(S.length?S:b).map(function(ye){var ne;return ne=ye[0],Array.isArray(ne)?"("+ne.map(ze).join(", ")+")":"("+ze(ne.type)+"...)"}).join(" | "),Xt=[],fe=1;fe<i.length;fe++){var te=a.parse(i[fe],1+Xt.length);if(!te)return null;Xt.push(ze(te.type))}a.error("Expected arguments of type "+Vt+", but found ("+Xt.join(", ")+") instead.")}return null},Q.register=function(i,a){for(var u in Q.definitions=a,a)i[u]=Q};var dt=function(i,a,u){this.type=We,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=a};function Et(i,a){i[0]=Math.min(i[0],a[0]),i[1]=Math.min(i[1],a[1]),i[2]=Math.max(i[2],a[0]),i[3]=Math.max(i[3],a[1])}function jt(i,a){return!(i[0]<=a[0]||i[2]>=a[2]||i[1]<=a[1]||i[3]>=a[3])}function pe(i,a){var u=(180+i[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*8192),Math.round(d*y*8192)]}function tn(i,a,u){return a[1]>i[1]!=u[1]>i[1]&&i[0]<(u[0]-a[0])*(i[1]-a[1])/(u[1]-a[1])+a[0]}function nr(i,a){for(var u,d,y,v,b,S,I,k=!1,R=0,z=a.length;R<z;R++)for(var j=a[R],W=0,nt=j.length;W<nt-1;W++){if((v=(u=i)[0]-(d=j[W])[0])*(I=u[1]-(y=j[W+1])[1])-(S=u[0]-y[0])*(b=u[1]-d[1])==0&&v*S<=0&&b*I<=0)return!1;tn(i,j[W],j[W+1])&&(k=!k)}return k}function Pr(i,a){for(var u=0;u<a.length;u++)if(nr(i,a[u]))return!0;return!1}function zr(i,a,u,d){var y=d[0]-u[0],v=d[1]-u[1],b=(i[0]-u[0])*v-y*(i[1]-u[1]),S=(a[0]-u[0])*v-y*(a[1]-u[1]);return b>0&&S<0||b<0&&S>0}function Ji(i,a,u){for(var d=0,y=u;d<y.length;d+=1)for(var v=y[d],b=0;b<v.length-1;++b)if((z=[(R=v[b+1])[0]-(k=v[b])[0],R[1]-k[1]])[0]*(j=[(I=a)[0]-(S=i)[0],I[1]-S[1]])[1]-z[1]*j[0]!=0&&zr(S,I,k,R)&&zr(k,R,S,I))return!0;var S,I,k,R,z,j;return!1}function em(i,a){for(var u=0;u<i.length;++u)if(!nr(i[u],a))return!1;for(var d=0;d<i.length-1;++d)if(Ji(i[d],i[d+1],a))return!1;return!0}function nm(i,a){for(var u=0;u<a.length;u++)if(em(i,a[u]))return!0;return!1}function ml(i,a,u){for(var d=[],y=0;y<i.length;y++){for(var v=[],b=0;b<i[y].length;b++){var S=pe(i[y][b],u);Et(a,S),v.push(S)}d.push(v)}return d}function Sf(i,a,u){for(var d=[],y=0;y<i.length;y++){var v=ml(i[y],a,u);d.push(v)}return d}function du(i,a,u,d){if(i[0]<u[0]||i[0]>u[2]){var y=.5*d,v=i[0]-u[0]>y?-d:u[0]-i[0]>y?d:0;v===0&&(v=i[0]-u[2]>y?-d:u[2]-i[0]>y?d:0),i[0]+=v}Et(a,i)}function rm(i,a,u,d){for(var y=8192*Math.pow(2,d.z),v=[8192*d.x,8192*d.y],b=[],S=0,I=i;S<I.length;S+=1)for(var k=0,R=I[S];k<R.length;k+=1){var z=R[k],j=[z.x+v[0],z.y+v[1]];du(j,a,u,y),b.push(j)}return b}function Pc(i,a,u,d){for(var y,v=8192*Math.pow(2,d.z),b=[8192*d.x,8192*d.y],S=[],I=0,k=i;I<k.length;I+=1){for(var R=[],z=0,j=k[I];z<j.length;z+=1){var W=j[z],nt=[W.x+b[0],W.y+b[1]];Et(a,nt),R.push(nt)}S.push(R)}if(a[2]-a[0]<=v/2){(y=a)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var rt=0,ft=S;rt<ft.length;rt+=1)for(var ut=0,vt=ft[rt];ut<vt.length;ut+=1)du(vt[ut],a,u,v)}return S}dt.parse=function(i,a){if(i.length!==2)return a.error("Expected one argument.");var u=i[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");var d=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ht);if(!d)return null;var y=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ht);if(!y)return null;var v=null;return u.locale&&!(v=a.parse(u.locale,1,Qt))?null:new dt(d,y,v)},dt.prototype.evaluate=function(i){return new Rr(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},dt.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},dt.prototype.outputDefined=function(){return!1},dt.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var Qi=function(i,a){this.type=Ht,this.geojson=i,this.geometries=a};function Es(i){if(i instanceof Q&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Qi)return!1;var a=!0;return i.eachChild(function(u){a&&!Es(u)&&(a=!1)}),a}function Ss(i){if(i instanceof Q&&i.name==="feature-state")return!1;var a=!0;return i.eachChild(function(u){a&&!Ss(u)&&(a=!1)}),a}function ga(i,a){if(i instanceof Q&&a.indexOf(i.name)>=0)return!1;var u=!0;return i.eachChild(function(d){u&&!ga(d,a)&&(u=!1)}),u}Qi.parse=function(i,a){if(i.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if($o(i[1])){var u=i[1];if(u.type==="FeatureCollection")for(var d=0;d<u.features.length;++d){var y=u.features[d].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Qi(u,u.features[d].geometry)}else if(u.type==="Feature"){var v=u.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Qi(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Qi(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Qi.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,u){var d=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(u.type==="Polygon"){var b=ml(u.coordinates,y,v),S=rm(a.geometry(),d,y,v);if(!jt(d,y))return!1;for(var I=0,k=S;I<k.length;I+=1)if(!nr(k[I],b))return!1}if(u.type==="MultiPolygon"){var R=Sf(u.coordinates,y,v),z=rm(a.geometry(),d,y,v);if(!jt(d,y))return!1;for(var j=0,W=z;j<W.length;j+=1)if(!Pr(W[j],R))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,u){var d=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(u.type==="Polygon"){var b=ml(u.coordinates,y,v),S=Pc(a.geometry(),d,y,v);if(!jt(d,y))return!1;for(var I=0,k=S;I<k.length;I+=1)if(!em(k[I],b))return!1}if(u.type==="MultiPolygon"){var R=Sf(u.coordinates,y,v),z=Pc(a.geometry(),d,y,v);if(!jt(d,y))return!1;for(var j=0,W=z;j<W.length;j+=1)if(!nm(W[j],R))return!1}return!0}(i,this.geometries)}return!1},Qi.prototype.eachChild=function(){},Qi.prototype.outputDefined=function(){return!0},Qi.prototype.serialize=function(){return["within",this.geojson]};var Ps=function(i,a){this.type=a.type,this.name=i,this.boundExpression=a};Ps.parse=function(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var u=i[1];return a.scope.has(u)?new Ps(u,a.scope.get(u)):a.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ps.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},Ps.prototype.eachChild=function(){},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){return["var",this.name]};var As=function(i,a,u,d,y){a===void 0&&(a=[]),d===void 0&&(d=new le),y===void 0&&(y=[]),this.registry=i,this.path=a,this.key=a.map(function(v){return"["+v+"]"}).join(""),this.scope=d,this.errors=y,this.expectedType=u};function Ac(i,a){for(var u,d=i.length-1,y=0,v=d,b=0;y<=v;)if((u=i[b=Math.floor((y+v)/2)])<=a){if(b===d||a<i[b+1])return b;y=b+1}else{if(!(u>a))throw new jn("Input is not a number.");v=b-1}return 0}As.prototype.parse=function(i,a,u,d,y){return y===void 0&&(y={}),a?this.concat(a,u,d)._parse(i,y):this._parse(i,y)},As.prototype._parse=function(i,a){function u(k,R,z){return z==="assert"?new wn(R,[k]):z==="coerce"?new wi(R,[k]):k}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=i[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[d];if(y){var v=y.parse(i,this);if(!v)return null;if(this.expectedType){var b=this.expectedType,S=v.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(b,S))return null}else v=u(v,b,a.typeAnnotation||"coerce");else v=u(v,b,a.typeAnnotation||"assert")}if(!(v instanceof vr)&&v.type.kind!=="resolvedImage"&&function k(R){if(R instanceof Ps)return k(R.boundExpression);if(R instanceof Q&&R.name==="error"||R instanceof dt||R instanceof Qi)return!1;var z=R instanceof wi||R instanceof wn,j=!0;return R.eachChild(function(W){j=z?j&&k(W):j&&W instanceof vr}),!!j&&Es(R)&&ga(R,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(v)){var I=new q;try{v=new vr(v.type,v.evaluate(I))}catch(k){return this.error(k.message),null}}return v}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof i+" instead.")},As.prototype.concat=function(i,a,u){var d=typeof i=="number"?this.path.concat(i):this.path,y=u?this.scope.concat(u):this.scope;return new As(this.registry,d,a||null,y,this.errors)},As.prototype.error=function(i){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];var d=""+this.key+a.map(function(y){return"["+y+"]"}).join("");this.errors.push(new Bt(d,i))},As.prototype.checkSubtype=function(i,a){var u=Ze(i,a);return u&&this.error(u),u};var Ti=function(i,a,u){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(var d=0,y=u;d<y.length;d+=1){var v=y[d],b=v[1];this.labels.push(v[0]),this.outputs.push(b)}};function rr(i,a,u){return i*(1-u)+a*u}Ti.parse=function(i,a){if(i.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");var u=a.parse(i[1],1,Lt);if(!u)return null;var d=[],y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(var v=1;v<i.length;v+=2){var b=v===1?-1/0:i[v],S=i[v+1],I=v,k=v+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);var R=a.parse(S,k,y);if(!R)return null;y=y||R.type,d.push([b,R])}return new Ti(y,u,d)},Ti.prototype.evaluate=function(i){var a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);var d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);var y=a.length;return d>=a[y-1]?u[y-1].evaluate(i):u[Ac(a,d)].evaluate(i)},Ti.prototype.eachChild=function(i){i(this.input);for(var a=0,u=this.outputs;a<u.length;a+=1)i(u[a])},Ti.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Ti.prototype.serialize=function(){for(var i=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i};var gl=Object.freeze({__proto__:null,number:rr,color:function(i,a,u){return new Ge(rr(i.r,a.r,u),rr(i.g,a.g,u),rr(i.b,a.b,u),rr(i.a,a.a,u))},array:function(i,a,u){return i.map(function(d,y){return rr(d,a[y],u)})}}),im=6/29*3*(6/29),u_=Math.PI/180,c_=180/Math.PI;function Pf(i){return i>.008856451679035631?Math.pow(i,1/3):i/im+4/29}function Af(i){return i>6/29?i*i*i:im*(i-4/29)}function Cf(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function If(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function om(i){var a=If(i.r),u=If(i.g),d=If(i.b),y=Pf((.4124564*a+.3575761*u+.1804375*d)/.95047),v=Pf((.2126729*a+.7151522*u+.072175*d)/1);return{l:116*v-16,a:500*(y-v),b:200*(v-Pf((.0193339*a+.119192*u+.9503041*d)/1.08883)),alpha:i.a}}function sm(i){var a=(i.l+16)/116,u=isNaN(i.a)?a:a+i.a/500,d=isNaN(i.b)?a:a-i.b/200;return a=1*Af(a),u=.95047*Af(u),d=1.08883*Af(d),new Ge(Cf(3.2404542*u-1.5371385*a-.4985314*d),Cf(-.969266*u+1.8760108*a+.041556*d),Cf(.0556434*u-.2040259*a+1.0572252*d),i.alpha)}function h_(i,a,u){var d=a-i;return i+u*(d>180||d<-180?d-360*Math.round(d/360):d)}var mu={forward:om,reverse:sm,interpolate:function(i,a,u){return{l:rr(i.l,a.l,u),a:rr(i.a,a.a,u),b:rr(i.b,a.b,u),alpha:rr(i.alpha,a.alpha,u)}}},gu={forward:function(i){var a=om(i),u=a.l,d=a.a,y=a.b,v=Math.atan2(y,d)*c_;return{h:v<0?v+360:v,c:Math.sqrt(d*d+y*y),l:u,alpha:i.a}},reverse:function(i){var a=i.h*u_,u=i.c;return sm({l:i.l,a:Math.cos(a)*u,b:Math.sin(a)*u,alpha:i.alpha})},interpolate:function(i,a,u){return{h:h_(i.h,a.h,u),c:rr(i.c,a.c,u),l:rr(i.l,a.l,u),alpha:rr(i.alpha,a.alpha,u)}}},am=Object.freeze({__proto__:null,lab:mu,hcl:gu}),Dr=function(i,a,u,d,y){this.type=i,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(var v=0,b=y;v<b.length;v+=1){var S=b[v],I=S[1];this.labels.push(S[0]),this.outputs.push(I)}};function Mf(i,a,u,d){var y=d-u,v=i-u;return y===0?0:a===1?v/y:(Math.pow(a,v)-1)/(Math.pow(a,y)-1)}Dr.interpolationFactor=function(i,a,u,d){var y=0;if(i.name==="exponential")y=Mf(a,i.base,u,d);else if(i.name==="linear")y=Mf(a,1,u,d);else if(i.name==="cubic-bezier"){var v=i.controlPoints;y=new g(v[0],v[1],v[2],v[3]).solve(Mf(a,1,u,d))}return y},Dr.parse=function(i,a){var u=i[0],d=i[1],y=i[2],v=i.slice(3);if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var b=d[1];if(typeof b!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:b}}else{if(d[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(d[0]),1,0);var S=d.slice(1);if(S.length!==4||S.some(function(ft){return typeof ft!="number"||ft<0||ft>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:S}}if(i.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(y=a.parse(y,2,Lt)))return null;var I=[],k=null;u==="interpolate-hcl"||u==="interpolate-lab"?k=Zt:a.expectedType&&a.expectedType.kind!=="value"&&(k=a.expectedType);for(var R=0;R<v.length;R+=2){var z=v[R],j=v[R+1],W=R+3,nt=R+4;if(typeof z!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(I.length&&I[I.length-1][0]>=z)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);var rt=a.parse(j,nt,k);if(!rt)return null;k=k||rt.type,I.push([z,rt])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new Dr(k,u,d,y,I):a.error("Type "+ze(k)+" is not interpolatable.")},Dr.prototype.evaluate=function(i){var a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);var d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);var y=a.length;if(d>=a[y-1])return u[y-1].evaluate(i);var v=Ac(a,d),b=Dr.interpolationFactor(this.interpolation,d,a[v],a[v+1]),S=u[v].evaluate(i),I=u[v+1].evaluate(i);return this.operator==="interpolate"?gl[this.type.kind.toLowerCase()](S,I,b):this.operator==="interpolate-hcl"?gu.reverse(gu.interpolate(gu.forward(S),gu.forward(I),b)):mu.reverse(mu.interpolate(mu.forward(S),mu.forward(I),b))},Dr.prototype.eachChild=function(i){i(this.input);for(var a=0,u=this.outputs;a<u.length;a+=1)i(u[a])},Dr.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Dr.prototype.serialize=function(){var i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,i,this.input.serialize()],u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a};var Cs=function(i,a){this.type=i,this.args=a};Cs.parse=function(i,a){if(i.length<2)return a.error("Expectected at least one argument.");var u=null,d=a.expectedType;d&&d.kind!=="value"&&(u=d);for(var y=[],v=0,b=i.slice(1);v<b.length;v+=1){var S=a.parse(b[v],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!S)return null;u=u||S.type,y.push(S)}var I=d&&y.some(function(k){return Ze(d,k.type)});return new Cs(I?Yt:u,y)},Cs.prototype.evaluate=function(i){for(var a,u=null,d=0,y=0,v=this.args;y<v.length&&(d++,(u=v[y].evaluate(i))&&u instanceof Cn&&!u.available&&(a||(a=u.name),u=null,d===this.args.length&&(u=a)),u===null);y+=1);return u},Cs.prototype.eachChild=function(i){this.args.forEach(i)},Cs.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Cs.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(a){i.push(a.serialize())}),i};var Is=function(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a};Is.prototype.evaluate=function(i){return this.result.evaluate(i)},Is.prototype.eachChild=function(i){for(var a=0,u=this.bindings;a<u.length;a+=1)i(u[a][1]);i(this.result)},Is.parse=function(i,a){if(i.length<4)return a.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var u=[],d=1;d<i.length-1;d+=2){var y=i[d];if(typeof y!="string")return a.error("Expected string, but found "+typeof y+" instead.",d);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",d);var v=a.parse(i[d+1],d+1);if(!v)return null;u.push([y,v])}var b=a.parse(i[i.length-1],i.length-1,a.expectedType,u);return b?new Is(u,b):null},Is.prototype.outputDefined=function(){return this.result.outputDefined()},Is.prototype.serialize=function(){for(var i=["let"],a=0,u=this.bindings;a<u.length;a+=1){var d=u[a];i.push(d[0],d[1].serialize())}return i.push(this.result.serialize()),i};var ya=function(i,a,u){this.type=i,this.index=a,this.input=u};ya.parse=function(i,a){if(i.length!==3)return a.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var u=a.parse(i[1],1,Lt),d=a.parse(i[2],2,Ye(a.expectedType||Yt));return u&&d?new ya(d.type.itemType,u,d):null},ya.prototype.evaluate=function(i){var a=this.index.evaluate(i),u=this.input.evaluate(i);if(a<0)throw new jn("Array index out of bounds: "+a+" < 0.");if(a>=u.length)throw new jn("Array index out of bounds: "+a+" > "+(u.length-1)+".");if(a!==Math.floor(a))throw new jn("Array index must be an integer, but found "+a+" instead.");return u[a]},ya.prototype.eachChild=function(i){i(this.index),i(this.input)},ya.prototype.outputDefined=function(){return!1},ya.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var va=function(i,a){this.type=Ht,this.needle=i,this.haystack=a};va.parse=function(i,a){if(i.length!==3)return a.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var u=a.parse(i[1],1,Yt),d=a.parse(i[2],2,Yt);return u&&d?gn(u.type,[Ht,Qt,Lt,ie,Yt])?new va(u,d):a.error("Expected first argument to be of type boolean, string, number or null, but found "+ze(u.type)+" instead"):null},va.prototype.evaluate=function(i){var a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!u)return!1;if(!on(a,["boolean","string","number","null"]))throw new jn("Expected first argument to be of type boolean, string, number or null, but found "+ze(In(a))+" instead.");if(!on(u,["string","array"]))throw new jn("Expected second argument to be of type array or string, but found "+ze(In(u))+" instead.");return u.indexOf(a)>=0},va.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},va.prototype.outputDefined=function(){return!0},va.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ms=function(i,a,u){this.type=Lt,this.needle=i,this.haystack=a,this.fromIndex=u};Ms.parse=function(i,a){if(i.length<=2||i.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var u=a.parse(i[1],1,Yt),d=a.parse(i[2],2,Yt);if(!u||!d)return null;if(!gn(u.type,[Ht,Qt,Lt,ie,Yt]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+ze(u.type)+" instead");if(i.length===4){var y=a.parse(i[3],3,Lt);return y?new Ms(u,d,y):null}return new Ms(u,d)},Ms.prototype.evaluate=function(i){var a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!on(a,["boolean","string","number","null"]))throw new jn("Expected first argument to be of type boolean, string, number or null, but found "+ze(In(a))+" instead.");if(!on(u,["string","array"]))throw new jn("Expected second argument to be of type array or string, but found "+ze(In(u))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(i);return u.indexOf(a,d)}return u.indexOf(a)},Ms.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var _a=function(i,a,u,d,y,v){this.inputType=i,this.type=a,this.input=u,this.cases=d,this.outputs=y,this.otherwise=v};_a.parse=function(i,a){if(i.length<5)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!=1)return a.error("Expected an even number of arguments.");var u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);for(var y={},v=[],b=2;b<i.length-1;b+=2){var S=i[b],I=i[b+1];Array.isArray(S)||(S=[S]);var k=a.concat(b);if(S.length===0)return k.error("Expected at least one branch label.");for(var R=0,z=S;R<z.length;R+=1){var j=z[R];if(typeof j!="number"&&typeof j!="string")return k.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return k.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof j=="number"&&Math.floor(j)!==j)return k.error("Numeric branch labels must be integer values.");if(u){if(k.checkSubtype(u,In(j)))return null}else u=In(j);if(y[String(j)]!==void 0)return k.error("Branch labels must be unique.");y[String(j)]=v.length}var W=a.parse(I,b,d);if(!W)return null;d=d||W.type,v.push(W)}var nt=a.parse(i[1],1,Yt);if(!nt)return null;var rt=a.parse(i[i.length-1],i.length-1,d);return rt?nt.type.kind!=="value"&&a.concat(1).checkSubtype(u,nt.type)?null:new _a(u,d,nt,y,v,rt):null},_a.prototype.evaluate=function(i){var a=this.input.evaluate(i);return(In(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)},_a.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},_a.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},_a.prototype.serialize=function(){for(var i=this,a=["match",this.input.serialize()],u=[],d={},y=0,v=Object.keys(this.cases).sort();y<v.length;y+=1){var b=v[y];(z=d[this.cases[b]])===void 0?(d[this.cases[b]]=u.length,u.push([this.cases[b],[b]])):u[z][1].push(b)}for(var S=function(W){return i.inputType.kind==="number"?Number(W):W},I=0,k=u;I<k.length;I+=1){var R=k[I],z=R[0],j=R[1];a.push(j.length===1?S(j[0]):j.map(S)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var xa=function(i,a,u){this.type=i,this.branches=a,this.otherwise=u};xa.parse=function(i,a){if(i.length<4)return a.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!=0)return a.error("Expected an odd number of arguments.");var u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);for(var d=[],y=1;y<i.length-1;y+=2){var v=a.parse(i[y],y,Ht);if(!v)return null;var b=a.parse(i[y+1],y+1,u);if(!b)return null;d.push([v,b]),u=u||b.type}var S=a.parse(i[i.length-1],i.length-1,u);return S?new xa(u,d,S):null},xa.prototype.evaluate=function(i){for(var a=0,u=this.branches;a<u.length;a+=1){var d=u[a],y=d[1];if(d[0].evaluate(i))return y.evaluate(i)}return this.otherwise.evaluate(i)},xa.prototype.eachChild=function(i){for(var a=0,u=this.branches;a<u.length;a+=1){var d=u[a],y=d[1];i(d[0]),i(y)}i(this.otherwise)},xa.prototype.outputDefined=function(){return this.branches.every(function(i){return i[1].outputDefined()})&&this.otherwise.outputDefined()},xa.prototype.serialize=function(){var i=["case"];return this.eachChild(function(a){i.push(a.serialize())}),i};var Ls=function(i,a,u,d){this.type=i,this.input=a,this.beginIndex=u,this.endIndex=d};function lm(i,a){return i==="=="||i==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function um(i,a,u,d){return d.compare(a,u)===0}function _n(i,a,u){var d=i!=="=="&&i!=="!=";return function(){function y(v,b,S){this.type=Ht,this.lhs=v,this.rhs=b,this.collator=S,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}return y.parse=function(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");var S=v[0],I=b.parse(v[1],1,Yt);if(!I)return null;if(!lm(S,I.type))return b.concat(1).error('"'+S+`" comparisons are not supported for type '`+ze(I.type)+"'.");var k=b.parse(v[2],2,Yt);if(!k)return null;if(!lm(S,k.type))return b.concat(2).error('"'+S+`" comparisons are not supported for type '`+ze(k.type)+"'.");if(I.type.kind!==k.type.kind&&I.type.kind!=="value"&&k.type.kind!=="value")return b.error("Cannot compare types '"+ze(I.type)+"' and '"+ze(k.type)+"'.");d&&(I.type.kind==="value"&&k.type.kind!=="value"?I=new wn(k.type,[I]):I.type.kind!=="value"&&k.type.kind==="value"&&(k=new wn(I.type,[k])));var R=null;if(v.length===4){if(I.type.kind!=="string"&&k.type.kind!=="string"&&I.type.kind!=="value"&&k.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(!(R=b.parse(v[3],3,We)))return null}return new y(I,k,R)},y.prototype.evaluate=function(v){var b=this.lhs.evaluate(v),S=this.rhs.evaluate(v);if(d&&this.hasUntypedArgument){var I=In(b),k=In(S);if(I.kind!==k.kind||I.kind!=="string"&&I.kind!=="number")throw new jn('Expected arguments for "'+i+'" to be (string, string) or (number, number), but found ('+I.kind+", "+k.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var R=In(b),z=In(S);if(R.kind!=="string"||z.kind!=="string")return a(v,b,S)}return this.collator?u(v,b,S,this.collator.evaluate(v)):a(v,b,S)},y.prototype.eachChild=function(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var v=[i];return this.eachChild(function(b){v.push(b.serialize())}),v},y}()}Ls.parse=function(i,a){if(i.length<=2||i.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var u=a.parse(i[1],1,Yt),d=a.parse(i[2],2,Lt);if(!u||!d)return null;if(!gn(u.type,[Ye(Yt),Qt,Yt]))return a.error("Expected first argument to be of type array or string, but found "+ze(u.type)+" instead");if(i.length===4){var y=a.parse(i[3],3,Lt);return y?new Ls(u.type,u,d,y):null}return new Ls(u.type,u,d)},Ls.prototype.evaluate=function(i){var a=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!on(a,["string","array"]))throw new jn("Expected first argument to be of type array or string, but found "+ze(In(a))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(i);return a.slice(u,d)}return a.slice(u)},Ls.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var f_=_n("==",function(i,a,u){return a===u},um),Cc=_n("!=",function(i,a,u){return a!==u},function(i,a,u,d){return!um(0,a,u,d)}),cm=_n("<",function(i,a,u){return a<u},function(i,a,u,d){return d.compare(a,u)<0}),hm=_n(">",function(i,a,u){return a>u},function(i,a,u,d){return d.compare(a,u)>0}),fm=_n("<=",function(i,a,u){return a<=u},function(i,a,u,d){return d.compare(a,u)<=0}),pm=_n(">=",function(i,a,u){return a>=u},function(i,a,u,d){return d.compare(a,u)>=0}),ba=function(i,a,u,d,y){this.type=Qt,this.number=i,this.locale=a,this.currency=u,this.minFractionDigits=d,this.maxFractionDigits=y};ba.parse=function(i,a){if(i.length!==3)return a.error("Expected two arguments.");var u=a.parse(i[1],1,Lt);if(!u)return null;var d=i[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");var y=null;if(d.locale&&!(y=a.parse(d.locale,1,Qt)))return null;var v=null;if(d.currency&&!(v=a.parse(d.currency,1,Qt)))return null;var b=null;if(d["min-fraction-digits"]&&!(b=a.parse(d["min-fraction-digits"],1,Lt)))return null;var S=null;return d["max-fraction-digits"]&&!(S=a.parse(d["max-fraction-digits"],1,Lt))?null:new ba(u,y,v,b,S)},ba.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},ba.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},ba.prototype.outputDefined=function(){return!1},ba.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var ks=function(i){this.type=Lt,this.input=i};ks.parse=function(i,a){if(i.length!==2)return a.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var u=a.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+ze(u.type)+" instead."):new ks(u):null},ks.prototype.evaluate=function(i){var a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new jn("Expected value to be of type string or array, but found "+ze(In(a))+" instead.")},ks.prototype.eachChild=function(i){i(this.input)},ks.prototype.outputDefined=function(){return!1},ks.prototype.serialize=function(){var i=["length"];return this.eachChild(function(a){i.push(a.serialize())}),i};var wa={"==":f_,"!=":Cc,">":hm,"<":cm,">=":pm,"<=":fm,array:wn,at:ya,boolean:wn,case:xa,coalesce:Cs,collator:dt,format:bi,image:Wr,in:va,"index-of":Ms,interpolate:Dr,"interpolate-hcl":Dr,"interpolate-lab":Dr,length:ks,let:Is,literal:vr,match:_a,number:wn,"number-format":ba,object:wn,slice:Ls,step:Ti,string:wn,"to-boolean":wi,"to-color":wi,"to-number":wi,"to-string":wi,var:Ps,within:Qi};function dm(i,a){var u=a[0],d=a[1],y=a[2],v=a[3];u=u.evaluate(i),d=d.evaluate(i),y=y.evaluate(i);var b=v?v.evaluate(i):1,S=Ts(u,d,y,b);if(S)throw new jn(S);return new Ge(u/255*b,d/255*b,y/255*b,b)}function mm(i,a){return i in a}function Lf(i,a){var u=a[i];return u===void 0?null:u}function Ta(i){return{type:i}}function gm(i){return{result:"success",value:i}}function Ea(i){return{result:"error",value:i}}function Sa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ym(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yu(i){return!!i.expression&&i.expression.interpolated}function Tn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ic(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function p_(i){return i}function yl(i,a,u){return i!==void 0?i:a!==void 0?a:u!==void 0?u:void 0}function vm(i,a,u,d,y){return yl(typeof u===y?d[u]:void 0,i.default,a.default)}function d_(i,a,u){if(Tn(u)!=="number")return yl(i.default,a.default);var d=i.stops.length;if(d===1||u<=i.stops[0][0])return i.stops[0][1];if(u>=i.stops[d-1][0])return i.stops[d-1][1];var y=Ac(i.stops.map(function(v){return v[0]}),u);return i.stops[y][1]}function _m(i,a,u){var d=i.base!==void 0?i.base:1;if(Tn(u)!=="number")return yl(i.default,a.default);var y=i.stops.length;if(y===1||u<=i.stops[0][0])return i.stops[0][1];if(u>=i.stops[y-1][0])return i.stops[y-1][1];var v=Ac(i.stops.map(function(z){return z[0]}),u),b=function(z,j,W,nt){var rt=nt-W,ft=z-W;return rt===0?0:j===1?ft/rt:(Math.pow(j,ft)-1)/(Math.pow(j,rt)-1)}(u,d,i.stops[v][0],i.stops[v+1][0]),S=i.stops[v][1],I=i.stops[v+1][1],k=gl[a.type]||p_;if(i.colorSpace&&i.colorSpace!=="rgb"){var R=am[i.colorSpace];k=function(z,j){return R.reverse(R.interpolate(R.forward(z),R.forward(j),b))}}return typeof S.evaluate=="function"?{evaluate:function(){for(var z=[],j=arguments.length;j--;)z[j]=arguments[j];var W=S.evaluate.apply(void 0,z),nt=I.evaluate.apply(void 0,z);if(W!==void 0&&nt!==void 0)return k(W,nt,b)}}:k(S,I,b)}function Mc(i,a,u){return a.type==="color"?u=Ge.parse(u):a.type==="formatted"?u=Vn.fromString(u.toString()):a.type==="resolvedImage"?u=Cn.fromString(u.toString()):Tn(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0),yl(u,i.default,a.default)}Q.register(wa,{error:[{kind:"error"},[Qt],function(i,a){throw new jn(a[0].evaluate(i))}],typeof:[Qt,[Yt],function(i,a){return ze(In(a[0].evaluate(i)))}],"to-rgba":[Ye(Lt,4),[Zt],function(i,a){return a[0].evaluate(i).toArray()}],rgb:[Zt,[Lt,Lt,Lt],dm],rgba:[Zt,[Lt,Lt,Lt,Lt],dm],has:{type:Ht,overloads:[[[Qt],function(i,a){return mm(a[0].evaluate(i),i.properties())}],[[Qt,Re],function(i,a){var u=a[1];return mm(a[0].evaluate(i),u.evaluate(i))}]]},get:{type:Yt,overloads:[[[Qt],function(i,a){return Lf(a[0].evaluate(i),i.properties())}],[[Qt,Re],function(i,a){var u=a[1];return Lf(a[0].evaluate(i),u.evaluate(i))}]]},"feature-state":[Yt,[Qt],function(i,a){return Lf(a[0].evaluate(i),i.featureState||{})}],properties:[Re,[],function(i){return i.properties()}],"geometry-type":[Qt,[],function(i){return i.geometryType()}],id:[Yt,[],function(i){return i.id()}],zoom:[Lt,[],function(i){return i.globals.zoom}],"heatmap-density":[Lt,[],function(i){return i.globals.heatmapDensity||0}],"line-progress":[Lt,[],function(i){return i.globals.lineProgress||0}],accumulated:[Yt,[],function(i){return i.globals.accumulated===void 0?null:i.globals.accumulated}],"+":[Lt,Ta(Lt),function(i,a){for(var u=0,d=0,y=a;d<y.length;d+=1)u+=y[d].evaluate(i);return u}],"*":[Lt,Ta(Lt),function(i,a){for(var u=1,d=0,y=a;d<y.length;d+=1)u*=y[d].evaluate(i);return u}],"-":{type:Lt,overloads:[[[Lt,Lt],function(i,a){var u=a[1];return a[0].evaluate(i)-u.evaluate(i)}],[[Lt],function(i,a){return-a[0].evaluate(i)}]]},"/":[Lt,[Lt,Lt],function(i,a){var u=a[1];return a[0].evaluate(i)/u.evaluate(i)}],"%":[Lt,[Lt,Lt],function(i,a){var u=a[1];return a[0].evaluate(i)%u.evaluate(i)}],ln2:[Lt,[],function(){return Math.LN2}],pi:[Lt,[],function(){return Math.PI}],e:[Lt,[],function(){return Math.E}],"^":[Lt,[Lt,Lt],function(i,a){var u=a[1];return Math.pow(a[0].evaluate(i),u.evaluate(i))}],sqrt:[Lt,[Lt],function(i,a){return Math.sqrt(a[0].evaluate(i))}],log10:[Lt,[Lt],function(i,a){return Math.log(a[0].evaluate(i))/Math.LN10}],ln:[Lt,[Lt],function(i,a){return Math.log(a[0].evaluate(i))}],log2:[Lt,[Lt],function(i,a){return Math.log(a[0].evaluate(i))/Math.LN2}],sin:[Lt,[Lt],function(i,a){return Math.sin(a[0].evaluate(i))}],cos:[Lt,[Lt],function(i,a){return Math.cos(a[0].evaluate(i))}],tan:[Lt,[Lt],function(i,a){return Math.tan(a[0].evaluate(i))}],asin:[Lt,[Lt],function(i,a){return Math.asin(a[0].evaluate(i))}],acos:[Lt,[Lt],function(i,a){return Math.acos(a[0].evaluate(i))}],atan:[Lt,[Lt],function(i,a){return Math.atan(a[0].evaluate(i))}],min:[Lt,Ta(Lt),function(i,a){return Math.min.apply(Math,a.map(function(u){return u.evaluate(i)}))}],max:[Lt,Ta(Lt),function(i,a){return Math.max.apply(Math,a.map(function(u){return u.evaluate(i)}))}],abs:[Lt,[Lt],function(i,a){return Math.abs(a[0].evaluate(i))}],round:[Lt,[Lt],function(i,a){var u=a[0].evaluate(i);return u<0?-Math.round(-u):Math.round(u)}],floor:[Lt,[Lt],function(i,a){return Math.floor(a[0].evaluate(i))}],ceil:[Lt,[Lt],function(i,a){return Math.ceil(a[0].evaluate(i))}],"filter-==":[Ht,[Qt,Yt],function(i,a){var u=a[0],d=a[1];return i.properties()[u.value]===d.value}],"filter-id-==":[Ht,[Yt],function(i,a){var u=a[0];return i.id()===u.value}],"filter-type-==":[Ht,[Qt],function(i,a){var u=a[0];return i.geometryType()===u.value}],"filter-<":[Ht,[Qt,Yt],function(i,a){var u=a[0],d=a[1],y=i.properties()[u.value],v=d.value;return typeof y==typeof v&&y<v}],"filter-id-<":[Ht,[Yt],function(i,a){var u=a[0],d=i.id(),y=u.value;return typeof d==typeof y&&d<y}],"filter->":[Ht,[Qt,Yt],function(i,a){var u=a[0],d=a[1],y=i.properties()[u.value],v=d.value;return typeof y==typeof v&&y>v}],"filter-id->":[Ht,[Yt],function(i,a){var u=a[0],d=i.id(),y=u.value;return typeof d==typeof y&&d>y}],"filter-<=":[Ht,[Qt,Yt],function(i,a){var u=a[0],d=a[1],y=i.properties()[u.value],v=d.value;return typeof y==typeof v&&y<=v}],"filter-id-<=":[Ht,[Yt],function(i,a){var u=a[0],d=i.id(),y=u.value;return typeof d==typeof y&&d<=y}],"filter->=":[Ht,[Qt,Yt],function(i,a){var u=a[0],d=a[1],y=i.properties()[u.value],v=d.value;return typeof y==typeof v&&y>=v}],"filter-id->=":[Ht,[Yt],function(i,a){var u=a[0],d=i.id(),y=u.value;return typeof d==typeof y&&d>=y}],"filter-has":[Ht,[Yt],function(i,a){return a[0].value in i.properties()}],"filter-has-id":[Ht,[],function(i){return i.id()!==null&&i.id()!==void 0}],"filter-type-in":[Ht,[Ye(Qt)],function(i,a){return a[0].value.indexOf(i.geometryType())>=0}],"filter-id-in":[Ht,[Ye(Yt)],function(i,a){return a[0].value.indexOf(i.id())>=0}],"filter-in-small":[Ht,[Qt,Ye(Yt)],function(i,a){var u=a[0];return a[1].value.indexOf(i.properties()[u.value])>=0}],"filter-in-large":[Ht,[Qt,Ye(Yt)],function(i,a){var u=a[0],d=a[1];return function(y,v,b,S){for(;b<=S;){var I=b+S>>1;if(v[I]===y)return!0;v[I]>y?S=I-1:b=I+1}return!1}(i.properties()[u.value],d.value,0,d.value.length-1)}],all:{type:Ht,overloads:[[[Ht,Ht],function(i,a){var u=a[1];return a[0].evaluate(i)&&u.evaluate(i)}],[Ta(Ht),function(i,a){for(var u=0,d=a;u<d.length;u+=1)if(!d[u].evaluate(i))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],function(i,a){var u=a[1];return a[0].evaluate(i)||u.evaluate(i)}],[Ta(Ht),function(i,a){for(var u=0,d=a;u<d.length;u+=1)if(d[u].evaluate(i))return!0;return!1}]]},"!":[Ht,[Ht],function(i,a){return!a[0].evaluate(i)}],"is-supported-script":[Ht,[Qt],function(i,a){var u=i.globals&&i.globals.isSupportedScript;return!u||u(a[0].evaluate(i))}],upcase:[Qt,[Qt],function(i,a){return a[0].evaluate(i).toUpperCase()}],downcase:[Qt,[Qt],function(i,a){return a[0].evaluate(i).toLowerCase()}],concat:[Qt,Ta(Yt),function(i,a){return a.map(function(u){return Yo(u.evaluate(i))}).join("")}],"resolved-locale":[Qt,[We],function(i,a){return a[0].evaluate(i).resolvedLocale()}]});var vl=function(i,a){this.expression=i,this._warningHistory={},this._evaluator=new q,this._defaultValue=a?function(u){return u.type==="color"&&Ic(u.default)?new Ge(0,0,0,0):u.type==="color"?Ge.parse(u.default)||null:u.default===void 0?null:u.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function vu(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in wa}function Lc(i,a){var u=new As(wa,[],a?function(y){var v={color:Zt,string:Qt,number:Lt,enum:Qt,boolean:Ht,formatted:mn,resolvedImage:je};return y.type==="array"?Ye(v[y.value]||Yt,y.length):v[y.type]}(a):void 0),d=u.parse(i,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?gm(new vl(d,a)):Ea(u.errors)}vl.prototype.evaluateWithoutErrorHandling=function(i,a,u,d,y,v){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)},vl.prototype.evaluate=function(i,a,u,d,y,v){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{var b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new jn("Expected value to be one of "+Object.keys(this._enumValues).map(function(S){return JSON.stringify(S)}).join(", ")+", but found "+JSON.stringify(b)+" instead.");return b}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}};var _u=function(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent=i!=="constant"&&!Ss(a.expression)};_u.prototype.evaluateWithoutErrorHandling=function(i,a,u,d,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,y,v)},_u.prototype.evaluate=function(i,a,u,d,y,v){return this._styleExpression.evaluate(i,a,u,d,y,v)};var _l=function(i,a,u,d){this.kind=i,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!Ss(a.expression),this.interpolationType=d};function xm(i,a){if((i=Lc(i,a)).result==="error")return i;var u=i.value.expression,d=Es(u);if(!d&&!Sa(a))return Ea([new Bt("","data expressions not supported")]);var y=ga(u,["zoom"]);if(!y&&!ym(a))return Ea([new Bt("","zoom expressions not supported")]);var v=function b(S){var I=null;if(S instanceof Is)I=b(S.result);else if(S instanceof Cs)for(var k=0,R=S.args;k<R.length&&!(I=b(R[k]));k+=1);else(S instanceof Ti||S instanceof Dr)&&S.input instanceof Q&&S.input.name==="zoom"&&(I=S);return I instanceof Bt||S.eachChild(function(z){var j=b(z);j instanceof Bt?I=j:!I&&j?I=new Bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&j&&I!==j&&(I=new Bt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(u);return v||y?v instanceof Bt?Ea([v]):v instanceof Dr&&!yu(a)?Ea([new Bt("",'"interpolate" expressions cannot be used with this property')]):gm(v?new _l(d?"camera":"composite",i.value,v.labels,v instanceof Dr?v.interpolation:void 0):new _u(d?"constant":"source",i.value)):Ea([new Bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}_l.prototype.evaluateWithoutErrorHandling=function(i,a,u,d,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,y,v)},_l.prototype.evaluate=function(i,a,u,d,y,v){return this._styleExpression.evaluate(i,a,u,d,y,v)},_l.prototype.interpolationFactor=function(i,a,u){return this.interpolationType?Dr.interpolationFactor(this.interpolationType,i,a,u):0};var xl=function(i,a){this._parameters=i,this._specification=a,Nt(this,function u(d,y){var v,b,S,I=y.type==="color",k=d.stops&&typeof d.stops[0][0]=="object",R=k||!(k||d.property!==void 0),z=d.type||(yu(y)?"exponential":"interval");if(I&&((d=Nt({},d)).stops&&(d.stops=d.stops.map(function(te){return[te[0],Ge.parse(te[1])]})),d.default=Ge.parse(d.default?d.default:y.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!am[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(z==="exponential")v=_m;else if(z==="interval")v=d_;else if(z==="categorical"){v=vm,b=Object.create(null);for(var j=0,W=d.stops;j<W.length;j+=1){var nt=W[j];b[nt[0]]=nt[1]}S=typeof d.stops[0][0]}else{if(z!=="identity")throw new Error('Unknown function type "'+z+'"');v=Mc}if(k){for(var rt={},ft=[],ut=0;ut<d.stops.length;ut++){var vt=d.stops[ut],wt=vt[0].zoom;rt[wt]===void 0&&(rt[wt]={zoom:wt,type:d.type,property:d.property,default:d.default,stops:[]},ft.push(wt)),rt[wt].stops.push([vt[0].value,vt[1]])}for(var St=[],At=0,zt=ft;At<zt.length;At+=1){var Vt=zt[At];St.push([rt[Vt].zoom,u(rt[Vt],y)])}var Xt={name:"linear"};return{kind:"composite",interpolationType:Xt,interpolationFactor:Dr.interpolationFactor.bind(void 0,Xt),zoomStops:St.map(function(te){return te[0]}),evaluate:function(te,ye){var ne=te.zoom;return _m({stops:St,base:d.base},y,ne).evaluate(ne,ye)}}}if(R){var fe=z==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:fe,interpolationFactor:Dr.interpolationFactor.bind(void 0,fe),zoomStops:d.stops.map(function(te){return te[0]}),evaluate:function(te){return v(d,y,te.zoom,b,S)}}}return{kind:"source",evaluate:function(te,ye){var ne=ye&&ye.properties?ye.properties[d.property]:void 0;return ne===void 0?yl(d.default,y.default):v(d,y,ne,b,S)}}}(this._parameters,this._specification))};function mo(i){var a=i.key,u=i.value,d=i.valueSpec||{},y=i.objectElementValidators||{},v=i.style,b=i.styleSpec,S=[],I=Tn(u);if(I!=="object")return[new lt(a,u,"object expected, "+I+" found")];for(var k in u){var R=k.split(".")[0],z=d[R]||d["*"],j=void 0;if(y[R])j=y[R];else if(d[R])j=Ke;else if(y["*"])j=y["*"];else{if(!d["*"]){S.push(new lt(a,u[k],'unknown property "'+k+'"'));continue}j=Ke}S=S.concat(j({key:(a&&a+".")+k,value:u[k],valueSpec:z,style:v,styleSpec:b,object:u,objectKey:k},u))}for(var W in d)y[W]||d[W].required&&d[W].default===void 0&&u[W]===void 0&&S.push(new lt(a,u,'missing required property "'+W+'"'));return S}function bm(i){var a=i.value,u=i.valueSpec,d=i.style,y=i.styleSpec,v=i.key,b=i.arrayElementValidator||Ke;if(Tn(a)!=="array")return[new lt(v,a,"array expected, "+Tn(a)+" found")];if(u.length&&a.length!==u.length)return[new lt(v,a,"array length "+u.length+" expected, length "+a.length+" found")];if(u["min-length"]&&a.length<u["min-length"])return[new lt(v,a,"array length at least "+u["min-length"]+" expected, length "+a.length+" found")];var S={type:u.value,values:u.values};y.$version<7&&(S.function=u.function),Tn(u.value)==="object"&&(S=u.value);for(var I=[],k=0;k<a.length;k++)I=I.concat(b({array:a,arrayIndex:k,value:a[k],valueSpec:S,style:d,styleSpec:y,key:v+"["+k+"]"}));return I}function wm(i){var a=i.key,u=i.value,d=i.valueSpec,y=Tn(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new lt(a,u,"number expected, "+y+" found")]:"minimum"in d&&u<d.minimum?[new lt(a,u,u+" is less than the minimum value "+d.minimum)]:"maximum"in d&&u>d.maximum?[new lt(a,u,u+" is greater than the maximum value "+d.maximum)]:[]}function Tm(i){var a,u,d,y=i.valueSpec,v=Ut(i.value.type),b={},S=v!=="categorical"&&i.value.property===void 0,I=!S,k=Tn(i.value.stops)==="array"&&Tn(i.value.stops[0])==="array"&&Tn(i.value.stops[0][0])==="object",R=mo({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(W){if(v==="identity")return[new lt(W.key,W.value,'identity function may not have a "stops" property')];var nt=[],rt=W.value;return nt=nt.concat(bm({key:W.key,value:rt,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:z})),Tn(rt)==="array"&&rt.length===0&&nt.push(new lt(W.key,rt,"array must have at least one stop")),nt},default:function(W){return Ke({key:W.key,value:W.value,valueSpec:y,style:W.style,styleSpec:W.styleSpec})}}});return v==="identity"&&S&&R.push(new lt(i.key,i.value,'missing required property "property"')),v==="identity"||i.value.stops||R.push(new lt(i.key,i.value,'missing required property "stops"')),v==="exponential"&&i.valueSpec.expression&&!yu(i.valueSpec)&&R.push(new lt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(I&&!Sa(i.valueSpec)?R.push(new lt(i.key,i.value,"property functions not supported")):S&&!ym(i.valueSpec)&&R.push(new lt(i.key,i.value,"zoom functions not supported"))),v!=="categorical"&&!k||i.value.property!==void 0||R.push(new lt(i.key,i.value,'"property" property is required')),R;function z(W){var nt=[],rt=W.value,ft=W.key;if(Tn(rt)!=="array")return[new lt(ft,rt,"array expected, "+Tn(rt)+" found")];if(rt.length!==2)return[new lt(ft,rt,"array length 2 expected, length "+rt.length+" found")];if(k){if(Tn(rt[0])!=="object")return[new lt(ft,rt,"object expected, "+Tn(rt[0])+" found")];if(rt[0].zoom===void 0)return[new lt(ft,rt,"object stop key must have zoom")];if(rt[0].value===void 0)return[new lt(ft,rt,"object stop key must have value")];if(d&&d>Ut(rt[0].zoom))return[new lt(ft,rt[0].zoom,"stop zoom values must appear in ascending order")];Ut(rt[0].zoom)!==d&&(d=Ut(rt[0].zoom),u=void 0,b={}),nt=nt.concat(mo({key:ft+"[0]",value:rt[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:wm,value:j}}))}else nt=nt.concat(j({key:ft+"[0]",value:rt[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},rt));return vu(It(rt[1]))?nt.concat([new lt(ft+"[1]",rt[1],"expressions are not allowed in function stops.")]):nt.concat(Ke({key:ft+"[1]",value:rt[1],valueSpec:y,style:W.style,styleSpec:W.styleSpec}))}function j(W,nt){var rt=Tn(W.value),ft=Ut(W.value),ut=W.value!==null?W.value:nt;if(a){if(rt!==a)return[new lt(W.key,ut,rt+" stop domain type must match previous stop domain type "+a)]}else a=rt;if(rt!=="number"&&rt!=="string"&&rt!=="boolean")return[new lt(W.key,ut,"stop domain value must be a number, string, or boolean")];if(rt!=="number"&&v!=="categorical"){var vt="number expected, "+rt+" found";return Sa(y)&&v===void 0&&(vt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(W.key,ut,vt)]}return v!=="categorical"||rt!=="number"||isFinite(ft)&&Math.floor(ft)===ft?v!=="categorical"&&rt==="number"&&u!==void 0&&ft<u?[new lt(W.key,ut,"stop domain values must appear in ascending order")]:(u=ft,v==="categorical"&&ft in b?[new lt(W.key,ut,"stop domain values must be unique")]:(b[ft]=!0,[])):[new lt(W.key,ut,"integer expected, found "+ft)]}}function Pa(i){var a=(i.expressionContext==="property"?xm:Lc)(It(i.value),i.valueSpec);if(a.result==="error")return a.value.map(function(d){return new lt(""+i.key+d.key,i.value,d.message)});var u=a.value.expression||a.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!u.outputDefined())return[new lt(i.key,i.value,'Invalid data expression for "'+i.propertyKey+'". Output values must be contained as literals within the expression.')];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ss(u))return[new lt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ss(u))return[new lt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ga(u,["zoom","feature-state"]))return[new lt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Es(u))return[new lt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xu(i){var a=i.key,u=i.value,d=i.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(Ut(u))===-1&&y.push(new lt(a,u,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(d.values).indexOf(Ut(u))===-1&&y.push(new lt(a,u,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function kc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(var a=0,u=i.slice(1);a<u.length;a+=1){var d=u[a];if(!kc(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}xl.deserialize=function(i){return new xl(i._parameters,i._specification)},xl.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};var kf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oc(i){if(i==null)return{filter:function(){return!0},needGeometry:!1};kc(i)||(i=Rc(i));var a=Lc(i,kf);if(a.result==="error")throw new Error(a.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,d,y){return a.value.evaluate(u,d,{},y)},needGeometry:function u(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var y=1;y<d.length;y++)if(u(d[y]))return!0;return!1}(i)}}function m_(i,a){return i<a?-1:i>a?1:0}function Rc(i){if(!i)return!0;var a,u=i[0];return i.length<=1?u!=="any":u==="=="?Of(i[1],i[2],"=="):u==="!="?zc(Of(i[1],i[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Of(i[1],i[2],u):u==="any"?(a=i.slice(1),["any"].concat(a.map(Rc))):u==="all"?["all"].concat(i.slice(1).map(Rc)):u==="none"?["all"].concat(i.slice(1).map(Rc).map(zc)):u==="in"?Em(i[1],i.slice(2)):u==="!in"?zc(Em(i[1],i.slice(2))):u==="has"?Sm(i[1]):u==="!has"?zc(Sm(i[1])):u!=="within"||i}function Of(i,a,u){switch(i){case"$type":return["filter-type-"+u,a];case"$id":return["filter-id-"+u,a];default:return["filter-"+u,i,a]}}function Em(i,a){if(a.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(u){return typeof u!=typeof a[0]})?["filter-in-large",i,["literal",a.sort(m_)]]:["filter-in-small",i,["literal",a]]}}function Sm(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zc(i){return["!",i]}function Rf(i){return kc(It(i.value))?Pa(Nt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(u){var d=u.value,y=u.key;if(Tn(d)!=="array")return[new lt(y,d,"array expected, "+Tn(d)+" found")];var v,b=u.styleSpec,S=[];if(d.length<1)return[new lt(y,d,"filter array must have at least 1 element")];switch(S=S.concat(xu({key:y+"[0]",value:d[0],valueSpec:b.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ut(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&Ut(d[1])==="$type"&&S.push(new lt(y,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&S.push(new lt(y,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(v=Tn(d[1]))!=="string"&&S.push(new lt(y+"[1]",d[1],"string expected, "+v+" found"));for(var I=2;I<d.length;I++)v=Tn(d[I]),Ut(d[1])==="$type"?S=S.concat(xu({key:y+"["+I+"]",value:d[I],valueSpec:b.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new lt(y+"["+I+"]",d[I],"string, number, or boolean expected, "+v+" found"));break;case"any":case"all":case"none":for(var k=1;k<d.length;k++)S=S.concat(a({key:y+"["+k+"]",value:d[k],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=Tn(d[1]),d.length!==2?S.push(new lt(y,d,'filter array for "'+d[0]+'" operator must have 2 elements')):v!=="string"&&S.push(new lt(y+"[1]",d[1],"string expected, "+v+" found"));break;case"within":v=Tn(d[1]),d.length!==2?S.push(new lt(y,d,'filter array for "'+d[0]+'" operator must have 2 elements')):v!=="object"&&S.push(new lt(y+"[1]",d[1],"object expected, "+v+" found"))}return S}(i)}function zf(i,a){var u=i.key,d=i.style,y=i.styleSpec,v=i.value,b=i.objectKey,S=y[a+"_"+i.layerType];if(!S)return[];var I=b.match(/^(.*)-transition$/);if(a==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return Ke({key:u,value:v,valueSpec:y.transition,style:d,styleSpec:y});var k,R=i.valueSpec||S[b];if(!R)return[new lt(u,v,'unknown property "'+b+'"')];if(Tn(v)==="string"&&Sa(R)&&!R.tokens&&(k=/^{([^}]+)}$/.exec(v)))return[new lt(u,v,'"'+b+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(k[1])+" }`.")];var z=[];return i.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&z.push(new lt(u,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Ic(It(v))&&Ut(v.type)==="identity"&&z.push(new lt(u,v,'"text-font" does not support identity functions'))),z.concat(Ke({key:i.key,value:v,valueSpec:R,style:d,styleSpec:y,expressionContext:"property",propertyType:a,propertyKey:b}))}function Df(i){return zf(i,"paint")}function bu(i){return zf(i,"layout")}function Pm(i){var a=[],u=i.value,d=i.key,y=i.style,v=i.styleSpec;u.type||u.ref||a.push(new lt(d,u,'either "type" or "ref" is required'));var b,S=Ut(u.type),I=Ut(u.ref);if(u.id)for(var k=Ut(u.id),R=0;R<i.arrayIndex;R++){var z=y.layers[R];Ut(z.id)===k&&a.push(new lt(d,u.id,'duplicate layer id "'+u.id+'", previously used at line '+z.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(nt){nt in u&&a.push(new lt(d,u[nt],'"'+nt+'" is prohibited for ref layers'))}),y.layers.forEach(function(nt){Ut(nt.id)===I&&(b=nt)}),b?b.ref?a.push(new lt(d,u.ref,"ref cannot reference another ref layer")):S=Ut(b.type):a.push(new lt(d,u.ref,'ref layer "'+I+'" not found'));else if(S!=="background")if(u.source){var j=y.sources&&y.sources[u.source],W=j&&Ut(j.type);j?W==="vector"&&S==="raster"?a.push(new lt(d,u.source,'layer "'+u.id+'" requires a raster source')):W==="raster"&&S!=="raster"?a.push(new lt(d,u.source,'layer "'+u.id+'" requires a vector source')):W!=="vector"||u["source-layer"]?W==="raster-dem"&&S!=="hillshade"?a.push(new lt(d,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!u.paint||!u.paint["line-gradient"]||W==="geojson"&&j.lineMetrics||a.push(new lt(d,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new lt(d,u,'layer "'+u.id+'" must specify a "source-layer"')):a.push(new lt(d,u.source,'source "'+u.source+'" not found'))}else a.push(new lt(d,u,'missing required property "source"'));return a=a.concat(mo({key:d,value:u,valueSpec:v.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ke({key:d+".type",value:u.type,valueSpec:v.layer.type,style:i.style,styleSpec:i.styleSpec,object:u,objectKey:"type"})},filter:Rf,layout:function(nt){return mo({layer:u,key:nt.key,value:nt.value,style:nt.style,styleSpec:nt.styleSpec,objectElementValidators:{"*":function(rt){return bu(Nt({layerType:S},rt))}}})},paint:function(nt){return mo({layer:u,key:nt.key,value:nt.value,style:nt.style,styleSpec:nt.styleSpec,objectElementValidators:{"*":function(rt){return Df(Nt({layerType:S},rt))}}})}}}))}function Aa(i){var a=i.value,u=i.key,d=Tn(a);return d!=="string"?[new lt(u,a,"string expected, "+d+" found")]:[]}var Mn={promoteId:function(i){var a=i.key,u=i.value;if(Tn(u)==="string")return Aa({key:a,value:u});var d=[];for(var y in u)d.push.apply(d,Aa({key:a+"."+y,value:u[y]}));return d}};function Dc(i){var a=i.value,u=i.key,d=i.styleSpec,y=i.style;if(!a.type)return[new lt(u,a,'"type" is required')];var v,b=Ut(a.type);switch(b){case"vector":case"raster":case"raster-dem":return mo({key:u,value:a,valueSpec:d["source_"+b.replace("-","_")],style:i.style,styleSpec:d,objectElementValidators:Mn});case"geojson":if(v=mo({key:u,value:a,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:Mn}),a.cluster)for(var S in a.clusterProperties){var I=a.clusterProperties[S],k=I[0],R=typeof k=="string"?[k,["accumulated"],["get",S]]:k;v.push.apply(v,Pa({key:u+"."+S+".map",value:I[1],expressionContext:"cluster-map"})),v.push.apply(v,Pa({key:u+"."+S+".reduce",value:R,expressionContext:"cluster-reduce"}))}return v;case"video":return mo({key:u,value:a,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return mo({key:u,value:a,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new lt(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xu({key:u+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:d})}}function Ca(i){var a=i.value,u=i.styleSpec,d=u.light,y=i.style,v=[],b=Tn(a);if(a===void 0)return v;if(b!=="object")return v.concat([new lt("light",a,"object expected, "+b+" found")]);for(var S in a){var I=S.match(/^(.*)-transition$/);v=v.concat(I&&d[I[1]]&&d[I[1]].transition?Ke({key:S,value:a[S],valueSpec:u.transition,style:y,styleSpec:u}):d[S]?Ke({key:S,value:a[S],valueSpec:d[S],style:y,styleSpec:u}):[new lt(S,a[S],'unknown property "'+S+'"')])}return v}var Os={"*":function(){return[]},array:bm,boolean:function(i){var a=i.value,u=i.key,d=Tn(a);return d!=="boolean"?[new lt(u,a,"boolean expected, "+d+" found")]:[]},number:wm,color:function(i){var a=i.key,u=i.value,d=Tn(u);return d!=="string"?[new lt(a,u,"color expected, "+d+" found")]:De(u)===null?[new lt(a,u,'color expected, "'+u+'" found')]:[]},constants:xt,enum:xu,filter:Rf,function:Tm,layer:Pm,object:mo,source:Dc,light:Ca,string:Aa,formatted:function(i){return Aa(i).length===0?[]:Pa(i)},resolvedImage:function(i){return Aa(i).length===0?[]:Pa(i)}};function Ke(i){var a=i.value,u=i.valueSpec,d=i.styleSpec;return u.expression&&Ic(Ut(a))?Tm(i):u.expression&&vu(It(a))?Pa(i):u.type&&Os[u.type]?Os[u.type](i):mo(Nt({},i,{valueSpec:u.type?d[u.type]:u}))}function En(i){var a=i.value,u=i.key,d=Aa(i);return d.length||(a.indexOf("{fontstack}")===-1&&d.push(new lt(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&d.push(new lt(u,a,'"glyphs" url must include a "{range}" token'))),d}function Bi(i,a){a===void 0&&(a=$);var u=[];return u=u.concat(Ke({key:"",value:i,valueSpec:a.$root,styleSpec:a,style:i,objectElementValidators:{glyphs:En,"*":function(){return[]}}})),i.constants&&(u=u.concat(xt({key:"constants",value:i.constants,style:i,styleSpec:a}))),wu(u)}function wu(i){return[].concat(i).sort(function(a,u){return a.line-u.line})}function bl(i){return function(){for(var a=[],u=arguments.length;u--;)a[u]=arguments[u];return wu(i.apply(this,a))}}Bi.source=bl(Dc),Bi.light=bl(Ca),Bi.layer=bl(Pm),Bi.filter=bl(Rf),Bi.paintProperty=bl(Df),Bi.layoutProperty=bl(bu);var Tu=Bi,g_=Tu.light,y_=Tu.paintProperty,Eu=Tu.layoutProperty;function Su(i,a){var u=!1;if(a&&a.length)for(var d=0,y=a;d<y.length;d+=1)i.fire(new mt(new Error(y[d].message))),u=!0;return u}var Ko=ur;function ur(i,a,u){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var y=new Int32Array(this.arrayBuffer);i=y[0],this.d=(a=y[1])+2*(u=y[2]);for(var v=0;v<this.d*this.d;v++){var b=y[3+v],S=y[3+v+1];d.push(b===S?null:y.subarray(b,S))}var I=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],I),this.bboxes=y.subarray(I),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var k=0;k<this.d*this.d;k++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=u,this.scale=a/i,this.uid=0;var R=u/a*i;this.min=-R,this.max=i+R}ur.prototype.insert=function(i,a,u,d,y){this._forEachCell(a,u,d,y,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)},ur.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ur.prototype._insertCell=function(i,a,u,d,y,v){this.cells[y].push(v)},ur.prototype.query=function(i,a,u,d,y){var v=this.min,b=this.max;if(i<=v&&a<=v&&b<=u&&b<=d&&!y)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(i,a,u,d,this._queryCell,S,{},y),S},ur.prototype._queryCell=function(i,a,u,d,y,v,b,S){var I=this.cells[y];if(I!==null)for(var k=this.keys,R=this.bboxes,z=0;z<I.length;z++){var j=I[z];if(b[j]===void 0){var W=4*j;(S?S(R[W+0],R[W+1],R[W+2],R[W+3]):i<=R[W+2]&&a<=R[W+3]&&u>=R[W+0]&&d>=R[W+1])?(b[j]=!0,v.push(k[j])):b[j]=!1}}},ur.prototype._forEachCell=function(i,a,u,d,y,v,b,S){for(var I=this._convertToCellCoord(i),k=this._convertToCellCoord(a),R=this._convertToCellCoord(u),z=this._convertToCellCoord(d),j=I;j<=R;j++)for(var W=k;W<=z;W++){var nt=this.d*W+j;if((!S||S(this._convertFromCellCoord(j),this._convertFromCellCoord(W),this._convertFromCellCoord(j+1),this._convertFromCellCoord(W+1)))&&y.call(this,i,a,u,d,nt,v,b,S))return}},ur.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ur.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ur.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=3+this.cells.length+1+1,u=0,d=0;d<this.cells.length;d++)u+=this.cells[d].length;var y=new Int32Array(a+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var v=a,b=0;b<i.length;b++){var S=i[b];y[3+b]=v,y.set(S,v),v+=S.length}return y[3+i.length]=v,y.set(this.keys,v),y[3+i.length+1]=v+=this.keys.length,y.set(this.bboxes,v),v+=this.bboxes.length,y.buffer};var Pu=A.ImageData,Am=A.ImageBitmap,ir={};function se(i,a,u){u===void 0&&(u={}),Object.defineProperty(a,"_classRegistryKey",{value:i,writeable:!1}),ir[i]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}for(var Ei in se("Object",Object),Ko.serialize=function(i,a){var u=i.toArrayBuffer();return a&&a.push(u),{buffer:u}},Ko.deserialize=function(i){return new Ko(i.buffer)},se("Grid",Ko),se("Color",Ge),se("Error",Error),se("ResolvedImage",Cn),se("StylePropertyFunction",xl),se("StyleExpression",vl,{omit:["_evaluator"]}),se("ZoomDependentExpression",_l),se("ZoomConstantExpression",_u),se("CompoundExpression",Q,{omit:["_evaluate"]}),wa)wa[Ei]._classRegistryKey||se("Expression_"+Ei,wa[Ei]);function Fc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function wl(i){return Am&&i instanceof Am}function go(i,a){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Fc(i)||wl(i))return a&&a.push(i),i;if(ArrayBuffer.isView(i)){var u=i;return a&&a.push(u.buffer),u}if(i instanceof Pu)return a&&a.push(i.data.buffer),i;if(Array.isArray(i)){for(var d=[],y=0,v=i;y<v.length;y+=1)d.push(go(v[y],a));return d}if(typeof i=="object"){var b=i.constructor,S=b._classRegistryKey;if(!S)throw new Error("can't serialize object of unregistered class");var I=b.serialize?b.serialize(i,a):{};if(!b.serialize){for(var k in i)if(i.hasOwnProperty(k)&&!(ir[S].omit.indexOf(k)>=0)){var R=i[k];I[k]=ir[S].shallow.indexOf(k)>=0?R:go(R,a)}i instanceof Error&&(I.message=i.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return S!=="Object"&&(I.$name=S),I}throw new Error("can't serialize object of type "+typeof i)}function Si(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Fc(i)||wl(i)||ArrayBuffer.isView(i)||i instanceof Pu)return i;if(Array.isArray(i))return i.map(Si);if(typeof i=="object"){var a=i.$name||"Object",u=ir[a].klass;if(!u)throw new Error("can't deserialize unregistered class "+a);if(u.deserialize)return u.deserialize(i);for(var d=Object.create(u.prototype),y=0,v=Object.keys(i);y<v.length;y+=1){var b=v[y];if(b!=="$name"){var S=i[b];d[b]=ir[a].shallow.indexOf(b)>=0?S:Si(S)}}return d}throw new Error("can't deserialize object of type "+typeof i)}var Ff=function(){this.first=!0};Ff.prototype.update=function(i,a){var u=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=a),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=u,!0))};var $t={"Latin-1 Supplement":function(i){return i>=128&&i<=255},Arabic:function(i){return i>=1536&&i<=1791},"Arabic Supplement":function(i){return i>=1872&&i<=1919},"Arabic Extended-A":function(i){return i>=2208&&i<=2303},"Hangul Jamo":function(i){return i>=4352&&i<=4607},"Unified Canadian Aboriginal Syllabics":function(i){return i>=5120&&i<=5759},Khmer:function(i){return i>=6016&&i<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(i){return i>=6320&&i<=6399},"General Punctuation":function(i){return i>=8192&&i<=8303},"Letterlike Symbols":function(i){return i>=8448&&i<=8527},"Number Forms":function(i){return i>=8528&&i<=8591},"Miscellaneous Technical":function(i){return i>=8960&&i<=9215},"Control Pictures":function(i){return i>=9216&&i<=9279},"Optical Character Recognition":function(i){return i>=9280&&i<=9311},"Enclosed Alphanumerics":function(i){return i>=9312&&i<=9471},"Geometric Shapes":function(i){return i>=9632&&i<=9727},"Miscellaneous Symbols":function(i){return i>=9728&&i<=9983},"Miscellaneous Symbols and Arrows":function(i){return i>=11008&&i<=11263},"CJK Radicals Supplement":function(i){return i>=11904&&i<=12031},"Kangxi Radicals":function(i){return i>=12032&&i<=12255},"Ideographic Description Characters":function(i){return i>=12272&&i<=12287},"CJK Symbols and Punctuation":function(i){return i>=12288&&i<=12351},Hiragana:function(i){return i>=12352&&i<=12447},Katakana:function(i){return i>=12448&&i<=12543},Bopomofo:function(i){return i>=12544&&i<=12591},"Hangul Compatibility Jamo":function(i){return i>=12592&&i<=12687},Kanbun:function(i){return i>=12688&&i<=12703},"Bopomofo Extended":function(i){return i>=12704&&i<=12735},"CJK Strokes":function(i){return i>=12736&&i<=12783},"Katakana Phonetic Extensions":function(i){return i>=12784&&i<=12799},"Enclosed CJK Letters and Months":function(i){return i>=12800&&i<=13055},"CJK Compatibility":function(i){return i>=13056&&i<=13311},"CJK Unified Ideographs Extension A":function(i){return i>=13312&&i<=19903},"Yijing Hexagram Symbols":function(i){return i>=19904&&i<=19967},"CJK Unified Ideographs":function(i){return i>=19968&&i<=40959},"Yi Syllables":function(i){return i>=40960&&i<=42127},"Yi Radicals":function(i){return i>=42128&&i<=42191},"Hangul Jamo Extended-A":function(i){return i>=43360&&i<=43391},"Hangul Syllables":function(i){return i>=44032&&i<=55215},"Hangul Jamo Extended-B":function(i){return i>=55216&&i<=55295},"Private Use Area":function(i){return i>=57344&&i<=63743},"CJK Compatibility Ideographs":function(i){return i>=63744&&i<=64255},"Arabic Presentation Forms-A":function(i){return i>=64336&&i<=65023},"Vertical Forms":function(i){return i>=65040&&i<=65055},"CJK Compatibility Forms":function(i){return i>=65072&&i<=65103},"Small Form Variants":function(i){return i>=65104&&i<=65135},"Arabic Presentation Forms-B":function(i){return i>=65136&&i<=65279},"Halfwidth and Fullwidth Forms":function(i){return i>=65280&&i<=65519}};function Nf(i){for(var a=0,u=i;a<u.length;a+=1)if(Nc(u[a].charCodeAt(0)))return!0;return!1}function Nc(i){return!(i!==746&&i!==747&&(i<4352||!($t["Bopomofo Extended"](i)||$t.Bopomofo(i)||$t["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||$t["CJK Compatibility Ideographs"](i)||$t["CJK Compatibility"](i)||$t["CJK Radicals Supplement"](i)||$t["CJK Strokes"](i)||!(!$t["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||$t["CJK Unified Ideographs Extension A"](i)||$t["CJK Unified Ideographs"](i)||$t["Enclosed CJK Letters and Months"](i)||$t["Hangul Compatibility Jamo"](i)||$t["Hangul Jamo Extended-A"](i)||$t["Hangul Jamo Extended-B"](i)||$t["Hangul Jamo"](i)||$t["Hangul Syllables"](i)||$t.Hiragana(i)||$t["Ideographic Description Characters"](i)||$t.Kanbun(i)||$t["Kangxi Radicals"](i)||$t["Katakana Phonetic Extensions"](i)||$t.Katakana(i)&&i!==12540||!(!$t["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!$t["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||$t["Unified Canadian Aboriginal Syllabics"](i)||$t["Unified Canadian Aboriginal Syllabics Extended"](i)||$t["Vertical Forms"](i)||$t["Yijing Hexagram Symbols"](i)||$t["Yi Syllables"](i)||$t["Yi Radicals"](i))))}function Bf(i){return!(Nc(i)||function(a){return!!($t["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||$t["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||$t["Letterlike Symbols"](a)||$t["Number Forms"](a)||$t["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||$t["Control Pictures"](a)&&a!==9251||$t["Optical Character Recognition"](a)||$t["Enclosed Alphanumerics"](a)||$t["Geometric Shapes"](a)||$t["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||$t["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||$t["CJK Symbols and Punctuation"](a)||$t.Katakana(a)||$t["Private Use Area"](a)||$t["CJK Compatibility Forms"](a)||$t["Small Form Variants"](a)||$t["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(i))}function to(i){return i>=1424&&i<=2303||$t["Arabic Presentation Forms-A"](i)||$t["Arabic Presentation Forms-B"](i)}function Pi(i,a){return!(!a&&to(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||$t.Khmer(i))}function Bc(i){for(var a=0,u=i;a<u.length;a+=1)if(to(u[a].charCodeAt(0)))return!0;return!1}var Uc=null,Ai="unavailable",Jo=null,Cm=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Ai="error"),Uc&&Uc(i)};function Au(){Uf.fire(new ot("pluginStateChange",{pluginStatus:Ai,pluginURL:Jo}))}var Uf=new gt,Vf=function(){return Ai},yo=function(){if(Ai!=="deferred"||!Jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ai="loading",Au(),Jo&&ma({url:Jo},function(i){i?Cm(i):(Ai="loaded",Au())})},Ui={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ai==="loaded"||Ui.applyArabicShaping!=null},isLoading:function(){return Ai==="loading"},setState:function(i){Ai=i.pluginStatus,Jo=i.pluginURL},isParsed:function(){return Ui.applyArabicShaping!=null&&Ui.processBidirectionalText!=null&&Ui.processStyledBidirectionalText!=null},getPluginURL:function(){return Jo}},qe=function(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ff,this.transition={})};qe.prototype.isSupportedScript=function(i){return function(a,u){for(var d=0,y=a;d<y.length;d+=1)if(!Pi(y[d].charCodeAt(0),u))return!1;return!0}(i,Ui.isLoaded())},qe.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},qe.prototype.getCrossfadeParameters=function(){var i=this.zoom,a=i-Math.floor(i),u=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*a}};var ko=function(i,a){this.property=i,this.value=a,this.expression=function(u,d){if(Ic(u))return new xl(u,d);if(vu(u)){var y=xm(u,d);if(y.result==="error")throw new Error(y.value.map(function(b){return b.key+": "+b.message}).join(", "));return y.value}var v=u;return typeof u=="string"&&d.type==="color"&&(v=Ge.parse(u)),{kind:"constant",evaluate:function(){return v}}}(a===void 0?i.specification.default:a,i.specification)};ko.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ko.prototype.possiblyEvaluate=function(i,a,u){return this.property.possiblyEvaluate(this,i,a,u)};var eo=function(i){this.property=i,this.value=new ko(i,void 0)};eo.prototype.transitioned=function(i,a){return new Ia(this.property,this.value,a,H({},i.transition,this.transition),i.now)},eo.prototype.untransitioned=function(){return new Ia(this.property,this.value,null,{},0)};var Fr=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};Fr.prototype.getValue=function(i){return ee(this._values[i].value.value)},Fr.prototype.setValue=function(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new eo(this._values[i].property)),this._values[i].value=new ko(this._values[i].property,a===null?void 0:ee(a))},Fr.prototype.getTransition=function(i){return ee(this._values[i].transition)},Fr.prototype.setTransition=function(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new eo(this._values[i].property)),this._values[i].transition=ee(a)||void 0},Fr.prototype.serialize=function(){for(var i={},a=0,u=Object.keys(this._values);a<u.length;a+=1){var d=u[a],y=this.getValue(d);y!==void 0&&(i[d]=y);var v=this.getTransition(d);v!==void 0&&(i[d+"-transition"]=v)}return i},Fr.prototype.transitioned=function(i,a){for(var u=new Rs(this._properties),d=0,y=Object.keys(this._values);d<y.length;d+=1){var v=y[d];u._values[v]=this._values[v].transitioned(i,a._values[v])}return u},Fr.prototype.untransitioned=function(){for(var i=new Rs(this._properties),a=0,u=Object.keys(this._values);a<u.length;a+=1){var d=u[a];i._values[d]=this._values[d].untransitioned()}return i};var Ia=function(i,a,u,d,y){this.property=i,this.value=a,this.begin=y+d.delay||0,this.end=this.begin+d.duration||0,i.specification.transition&&(d.delay||d.duration)&&(this.prior=u)};Ia.prototype.possiblyEvaluate=function(i,a,u){var d=i.now||0,y=this.value.possiblyEvaluate(i,a,u),v=this.prior;if(v){if(d>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(d<this.begin)return v.possiblyEvaluate(i,a,u);var b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,a,u),y,function(S){if(S<=0)return 0;if(S>=1)return 1;var I=S*S,k=I*S;return 4*(S<.5?k:3*(S-I)+k-.75)}(b))}return y};var Rs=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Rs.prototype.possiblyEvaluate=function(i,a,u){for(var d=new Cu(this._properties),y=0,v=Object.keys(this._values);y<v.length;y+=1){var b=v[y];d._values[b]=this._values[b].possiblyEvaluate(i,a,u)}return d},Rs.prototype.hasTransition=function(){for(var i=0,a=Object.keys(this._values);i<a.length;i+=1)if(this._values[a[i]].prior)return!0;return!1};var vo=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};vo.prototype.getValue=function(i){return ee(this._values[i].value)},vo.prototype.setValue=function(i,a){this._values[i]=new ko(this._values[i].property,a===null?void 0:ee(a))},vo.prototype.serialize=function(){for(var i={},a=0,u=Object.keys(this._values);a<u.length;a+=1){var d=u[a],y=this.getValue(d);y!==void 0&&(i[d]=y)}return i},vo.prototype.possiblyEvaluate=function(i,a,u){for(var d=new Cu(this._properties),y=0,v=Object.keys(this._values);y<v.length;y+=1){var b=v[y];d._values[b]=this._values[b].possiblyEvaluate(i,a,u)}return d};var Yr=function(i,a,u){this.property=i,this.value=a,this.parameters=u};Yr.prototype.isConstant=function(){return this.value.kind==="constant"},Yr.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},Yr.prototype.evaluate=function(i,a,u,d){return this.property.evaluate(this.value,this.parameters,i,a,u,d)};var Cu=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};Cu.prototype.get=function(i){return this._values[i]};var me=function(i){this.specification=i};me.prototype.possiblyEvaluate=function(i,a){return i.expression.evaluate(a)},me.prototype.interpolate=function(i,a,u){var d=gl[this.specification.type];return d?d(i,a,u):i};var ue=function(i,a){this.specification=i,this.overrides=a};ue.prototype.possiblyEvaluate=function(i,a,u,d){return new Yr(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},u,d)}:i.expression,a)},ue.prototype.interpolate=function(i,a,u){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new Yr(this,{kind:"constant",value:void 0},i.parameters);var d=gl[this.specification.type];return d?new Yr(this,{kind:"constant",value:d(i.value.value,a.value.value,u)},i.parameters):i},ue.prototype.evaluate=function(i,a,u,d,y,v){return i.kind==="constant"?i.value:i.evaluate(a,u,d,y,v)};var Vc=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(u,d,y,v){if(u.value===void 0)return new Yr(this,{kind:"constant",value:void 0},d);if(u.expression.kind==="constant"){var b=u.expression.evaluate(d,null,{},y,v),S=u.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(S,S,S,d);return new Yr(this,{kind:"constant",value:I},d)}if(u.expression.kind==="camera"){var k=this._calculate(u.expression.evaluate({zoom:d.zoom-1}),u.expression.evaluate({zoom:d.zoom}),u.expression.evaluate({zoom:d.zoom+1}),d);return new Yr(this,{kind:"constant",value:k},d)}return new Yr(this,u.expression,d)},a.prototype.evaluate=function(u,d,y,v,b,S){if(u.kind==="source"){var I=u.evaluate(d,y,v,b,S);return this._calculate(I,I,I,d)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(d.zoom)-1},y,v),u.evaluate({zoom:Math.floor(d.zoom)},y,v),u.evaluate({zoom:Math.floor(d.zoom)+1},y,v),d):u.value},a.prototype._calculate=function(u,d,y,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:u,to:d}:{from:y,to:d}},a.prototype.interpolate=function(u){return u},a}(ue),Kr=function(i){this.specification=i};Kr.prototype.possiblyEvaluate=function(i,a,u,d){if(i.value!==void 0){if(i.expression.kind==="constant"){var y=i.expression.evaluate(a,null,{},u,d);return this._calculate(y,y,y,a)}return this._calculate(i.expression.evaluate(new qe(Math.floor(a.zoom-1),a)),i.expression.evaluate(new qe(Math.floor(a.zoom),a)),i.expression.evaluate(new qe(Math.floor(a.zoom+1),a)),a)}},Kr.prototype._calculate=function(i,a,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:i,to:a}:{from:u,to:a}},Kr.prototype.interpolate=function(i){return i};var _o=function(i){this.specification=i};_o.prototype.possiblyEvaluate=function(i,a,u,d){return!!i.expression.evaluate(a,null,{},u,d)},_o.prototype.interpolate=function(){return!1};var Nr=function(i){for(var a in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){var u=i[a];u.specification.overridable&&this.overridableProperties.push(a);var d=this.defaultPropertyValues[a]=new ko(u,void 0),y=this.defaultTransitionablePropertyValues[a]=new eo(u);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate({})}};se("DataDrivenProperty",ue),se("DataConstantProperty",me),se("CrossFadedDataDrivenProperty",Vc),se("CrossFadedProperty",Kr),se("ColorRampProperty",_o);var Oo=function(i){function a(u,d){if(i.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),d.layout&&(this._unevaluatedLayout=new vo(d.layout)),d.paint)){for(var y in this._transitionablePaint=new Fr(d.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var v in u.layout)this.setLayoutProperty(v,u.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cu(d.paint)}}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},a.prototype.setLayoutProperty=function(u,d,y){y===void 0&&(y={}),d!=null&&this._validate(Eu,"layers."+this.id+".layout."+u,u,d,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,d):this.visibility=d)},a.prototype.getPaintProperty=function(u){return Dt(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)},a.prototype.setPaintProperty=function(u,d,y){if(y===void 0&&(y={}),d!=null&&this._validate(y_,"layers."+this.id+".paint."+u,u,d,y))return!1;if(Dt(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-11),d||void 0),!1;var v=this._transitionablePaint._values[u],b=v.property.specification["property-type"]==="cross-faded-data-driven",S=v.value.isDataDriven(),I=v.value;this._transitionablePaint.setValue(u,d),this._handleSpecialPaintPropertyUpdate(u);var k=this._transitionablePaint._values[u].value;return k.isDataDriven()||S||b||this._handleOverridablePaintPropertyUpdate(u,I,k)},a.prototype._handleSpecialPaintPropertyUpdate=function(u){},a.prototype._handleOverridablePaintPropertyUpdate=function(u,d,y){return!1},a.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(u,d){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,d)},a.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),qt(u,function(d,y){return!(d===void 0||y==="layout"&&!Object.keys(d).length||y==="paint"&&!Object.keys(d).length)})},a.prototype._validate=function(u,d,y,v,b){return b===void 0&&(b={}),(!b||b.validate!==!1)&&Su(this,u.call(Tu,{key:d,layerType:this.type,objectKey:y,value:v,styleSpec:$,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var u in this.paint._values){var d=this.paint.get(u);if(d instanceof Yr&&Sa(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},a}(gt),jf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},jc=function(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},fn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ar(i,a){a===void 0&&(a=1);var u=0,d=0;return{members:i.map(function(y){var v=jf[y.type].BYTES_PER_ELEMENT,b=u=Im(u,Math.max(a,v)),S=y.components||1;return d=Math.max(d,v),u+=v*S,{name:y.name,type:y.type,components:S,offset:b}}),size:Im(u,Math.max(d,a)),alignment:a}}function Im(i,a){return Math.ceil(i/a)*a}fn.serialize=function(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},fn.deserialize=function(i){var a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},fn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},fn.prototype.clear=function(){this.length=0},fn.prototype.resize=function(i){this.reserve(i),this.length=i},fn.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},fn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ma=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d){var y=this.length;return this.resize(y+1),this.emplace(y,u,d)},a.prototype.emplace=function(u,d,y){var v=2*u;return this.int16[v+0]=d,this.int16[v+1]=y,u},a}(fn);Ma.prototype.bytesPerElement=4,se("StructArrayLayout2i4",Ma);var Gf=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,d,y,v)},a.prototype.emplace=function(u,d,y,v,b){var S=4*u;return this.int16[S+0]=d,this.int16[S+1]=y,this.int16[S+2]=v,this.int16[S+3]=b,u},a}(fn);Gf.prototype.bytesPerElement=8,se("StructArrayLayout4i8",Gf);var Qo=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,d,y,v,b,S)},a.prototype.emplace=function(u,d,y,v,b,S,I){var k=6*u;return this.int16[k+0]=d,this.int16[k+1]=y,this.int16[k+2]=v,this.int16[k+3]=b,this.int16[k+4]=S,this.int16[k+5]=I,u},a}(fn);Qo.prototype.bytesPerElement=12,se("StructArrayLayout2i4i12",Qo);var Ci=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,d,y,v,b,S)},a.prototype.emplace=function(u,d,y,v,b,S,I){var k=4*u,R=8*u;return this.int16[k+0]=d,this.int16[k+1]=y,this.uint8[R+4]=v,this.uint8[R+5]=b,this.uint8[R+6]=S,this.uint8[R+7]=I,u},a}(fn);Ci.prototype.bytesPerElement=8,se("StructArrayLayout2i4ub8",Ci);var Tl=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d){var y=this.length;return this.resize(y+1),this.emplace(y,u,d)},a.prototype.emplace=function(u,d,y){var v=2*u;return this.float32[v+0]=d,this.float32[v+1]=y,u},a}(fn);Tl.prototype.bytesPerElement=8,se("StructArrayLayout2f8",Tl);var Ro=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S,I,k,R,z){var j=this.length;return this.resize(j+1),this.emplace(j,u,d,y,v,b,S,I,k,R,z)},a.prototype.emplace=function(u,d,y,v,b,S,I,k,R,z,j){var W=10*u;return this.uint16[W+0]=d,this.uint16[W+1]=y,this.uint16[W+2]=v,this.uint16[W+3]=b,this.uint16[W+4]=S,this.uint16[W+5]=I,this.uint16[W+6]=k,this.uint16[W+7]=R,this.uint16[W+8]=z,this.uint16[W+9]=j,u},a}(fn);Ro.prototype.bytesPerElement=20,se("StructArrayLayout10ui20",Ro);var Gc=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S,I,k,R,z,j,W){var nt=this.length;return this.resize(nt+1),this.emplace(nt,u,d,y,v,b,S,I,k,R,z,j,W)},a.prototype.emplace=function(u,d,y,v,b,S,I,k,R,z,j,W,nt){var rt=12*u;return this.int16[rt+0]=d,this.int16[rt+1]=y,this.int16[rt+2]=v,this.int16[rt+3]=b,this.uint16[rt+4]=S,this.uint16[rt+5]=I,this.uint16[rt+6]=k,this.uint16[rt+7]=R,this.int16[rt+8]=z,this.int16[rt+9]=j,this.int16[rt+10]=W,this.int16[rt+11]=nt,u},a}(fn);Gc.prototype.bytesPerElement=24,se("StructArrayLayout4i4ui4i24",Gc);var El=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,d,y)},a.prototype.emplace=function(u,d,y,v){var b=3*u;return this.float32[b+0]=d,this.float32[b+1]=y,this.float32[b+2]=v,u},a}(fn);El.prototype.bytesPerElement=12,se("StructArrayLayout3f12",El);var Iu=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var d=this.length;return this.resize(d+1),this.emplace(d,u)},a.prototype.emplace=function(u,d){return this.uint32[1*u+0]=d,u},a}(fn);Iu.prototype.bytesPerElement=4,se("StructArrayLayout1ul4",Iu);var Wf=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S,I,k,R){var z=this.length;return this.resize(z+1),this.emplace(z,u,d,y,v,b,S,I,k,R)},a.prototype.emplace=function(u,d,y,v,b,S,I,k,R,z){var j=10*u,W=5*u;return this.int16[j+0]=d,this.int16[j+1]=y,this.int16[j+2]=v,this.int16[j+3]=b,this.int16[j+4]=S,this.int16[j+5]=I,this.uint32[W+3]=k,this.uint16[j+8]=R,this.uint16[j+9]=z,u},a}(fn);Wf.prototype.bytesPerElement=20,se("StructArrayLayout6i1ul2ui20",Wf);var Sl=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,d,y,v,b,S)},a.prototype.emplace=function(u,d,y,v,b,S,I){var k=6*u;return this.int16[k+0]=d,this.int16[k+1]=y,this.int16[k+2]=v,this.int16[k+3]=b,this.int16[k+4]=S,this.int16[k+5]=I,u},a}(fn);Sl.prototype.bytesPerElement=12,se("StructArrayLayout2i2i2i12",Sl);var La=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,d,y,v,b)},a.prototype.emplace=function(u,d,y,v,b,S){var I=4*u,k=8*u;return this.float32[I+0]=d,this.float32[I+1]=y,this.float32[I+2]=v,this.int16[k+6]=b,this.int16[k+7]=S,u},a}(fn);La.prototype.bytesPerElement=16,se("StructArrayLayout2f1f2i16",La);var Hf=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,d,y,v)},a.prototype.emplace=function(u,d,y,v,b){var S=12*u,I=3*u;return this.uint8[S+0]=d,this.uint8[S+1]=y,this.float32[I+1]=v,this.float32[I+2]=b,u},a}(fn);Hf.prototype.bytesPerElement=12,se("StructArrayLayout2ub2f12",Hf);var zs=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,d,y)},a.prototype.emplace=function(u,d,y,v){var b=3*u;return this.uint16[b+0]=d,this.uint16[b+1]=y,this.uint16[b+2]=v,u},a}(fn);zs.prototype.bytesPerElement=6,se("StructArrayLayout3ui6",zs);var Ds=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt){var wt=this.length;return this.resize(wt+1),this.emplace(wt,u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt)},a.prototype.emplace=function(u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt,wt){var St=24*u,At=12*u,zt=48*u;return this.int16[St+0]=d,this.int16[St+1]=y,this.uint16[St+2]=v,this.uint16[St+3]=b,this.uint32[At+2]=S,this.uint32[At+3]=I,this.uint32[At+4]=k,this.uint16[St+10]=R,this.uint16[St+11]=z,this.uint16[St+12]=j,this.float32[At+7]=W,this.float32[At+8]=nt,this.uint8[zt+36]=rt,this.uint8[zt+37]=ft,this.uint8[zt+38]=ut,this.uint32[At+10]=vt,this.int16[St+22]=wt,u},a}(fn);Ds.prototype.bytesPerElement=48,se("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ds);var Wc=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt,wt,St,At,zt,Vt,Xt,fe,te,ye,ne,Ue){var Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt,wt,St,At,zt,Vt,Xt,fe,te,ye,ne,Ue)},a.prototype.emplace=function(u,d,y,v,b,S,I,k,R,z,j,W,nt,rt,ft,ut,vt,wt,St,At,zt,Vt,Xt,fe,te,ye,ne,Ue,Pe){var ce=34*u,He=17*u;return this.int16[ce+0]=d,this.int16[ce+1]=y,this.int16[ce+2]=v,this.int16[ce+3]=b,this.int16[ce+4]=S,this.int16[ce+5]=I,this.int16[ce+6]=k,this.int16[ce+7]=R,this.uint16[ce+8]=z,this.uint16[ce+9]=j,this.uint16[ce+10]=W,this.uint16[ce+11]=nt,this.uint16[ce+12]=rt,this.uint16[ce+13]=ft,this.uint16[ce+14]=ut,this.uint16[ce+15]=vt,this.uint16[ce+16]=wt,this.uint16[ce+17]=St,this.uint16[ce+18]=At,this.uint16[ce+19]=zt,this.uint16[ce+20]=Vt,this.uint16[ce+21]=Xt,this.uint16[ce+22]=fe,this.uint32[He+12]=te,this.float32[He+13]=ye,this.float32[He+14]=ne,this.float32[He+15]=Ue,this.float32[He+16]=Pe,u},a}(fn);Wc.prototype.bytesPerElement=68,se("StructArrayLayout8i15ui1ul4f68",Wc);var Fs=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var d=this.length;return this.resize(d+1),this.emplace(d,u)},a.prototype.emplace=function(u,d){return this.float32[1*u+0]=d,u},a}(fn);Fs.prototype.bytesPerElement=4,se("StructArrayLayout1f4",Fs);var no=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,d,y)},a.prototype.emplace=function(u,d,y,v){var b=3*u;return this.int16[b+0]=d,this.int16[b+1]=y,this.int16[b+2]=v,u},a}(fn);no.prototype.bytesPerElement=6,se("StructArrayLayout3i6",no);var qf=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,d,y)},a.prototype.emplace=function(u,d,y,v){var b=4*u;return this.uint32[2*u+0]=d,this.uint16[b+2]=y,this.uint16[b+3]=v,u},a}(fn);qf.prototype.bytesPerElement=8,se("StructArrayLayout1ul2ui8",qf);var Mu=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d){var y=this.length;return this.resize(y+1),this.emplace(y,u,d)},a.prototype.emplace=function(u,d,y){var v=2*u;return this.uint16[v+0]=d,this.uint16[v+1]=y,u},a}(fn);Mu.prototype.bytesPerElement=4,se("StructArrayLayout2ui4",Mu);var Zf=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var d=this.length;return this.resize(d+1),this.emplace(d,u)},a.prototype.emplace=function(u,d){return this.uint16[1*u+0]=d,u},a}(fn);Zf.prototype.bytesPerElement=2,se("StructArrayLayout1ui2",Zf);var Hc=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,d,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,d,y,v)},a.prototype.emplace=function(u,d,y,v,b){var S=4*u;return this.float32[S+0]=d,this.float32[S+1]=y,this.float32[S+2]=v,this.float32[S+3]=b,u},a}(fn);Hc.prototype.bytesPerElement=16,se("StructArrayLayout4f16",Hc);var c=function(i){function a(){i.apply(this,arguments)}i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new w(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,u),a}(jc);c.prototype.size=20;var f=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.get=function(u){return new c(this,u)},a}(Wf);se("CollisionBoxArray",f);var h=function(i){function a(){i.apply(this,arguments)}i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,u),a}(jc);h.prototype.size=48;var m=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.get=function(u){return new h(this,u)},a}(Ds);se("PlacedSymbolArray",m);var x=function(i){function a(){i.apply(this,arguments)}i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,u),a}(jc);x.prototype.size=68;var T=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.get=function(u){return new x(this,u)},a}(Wc);se("SymbolInstanceArray",T);var E=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.getoffsetX=function(u){return this.float32[1*u+0]},a}(Fs);se("GlyphOffsetArray",E);var C=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.getx=function(u){return this.int16[3*u+0]},a.prototype.gety=function(u){return this.int16[3*u+1]},a.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},a}(no);se("SymbolLineVertexArray",C);var O=function(i){function a(){i.apply(this,arguments)}i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,u),a}(jc);O.prototype.size=8;var N=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.get=function(u){return new O(this,u)},a}(qf);se("FeatureIndexArray",N);var Z=Ar([{name:"a_pos",components:2,type:"Int16"}],4).members,Y=function(i){i===void 0&&(i=[]),this.segments=i};function K(i,a){return 256*(i=B(Math.floor(i),0,255))+B(Math.floor(a),0,255)}Y.prototype.prepareSegment=function(i,a,u,d){var y=this.segments[this.segments.length-1];return i>Y.MAX_VERTEX_ARRAY_LENGTH&&ae("Max vertices per segment is "+Y.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!y||y.vertexLength+i>Y.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==d)&&(y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},d!==void 0&&(y.sortKey=d),this.segments.push(y)),y},Y.prototype.get=function(){return this.segments},Y.prototype.destroy=function(){for(var i=0,a=this.segments;i<a.length;i+=1){var u=a[i];for(var d in u.vaos)u.vaos[d].destroy()}},Y.simpleSegment=function(i,a,u,d){return new Y([{vertexOffset:i,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])},Y.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,se("SegmentVector",Y);var at=Ar([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),it=p(function(i){i.exports=function(a,u){var d,y,v,b,S,I,k,R;for(y=a.length-(d=3&a.length),v=u,S=3432918353,I=461845907,R=0;R<y;)k=255&a.charCodeAt(R)|(255&a.charCodeAt(++R))<<8|(255&a.charCodeAt(++R))<<16|(255&a.charCodeAt(++R))<<24,++R,v=27492+(65535&(b=5*(65535&(v=(v^=k=(65535&(k=(k=(65535&k)*S+(((k>>>16)*S&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(k=0,d){case 3:k^=(255&a.charCodeAt(R+2))<<16;case 2:k^=(255&a.charCodeAt(R+1))<<8;case 1:v^=k=(65535&(k=(k=(65535&(k^=255&a.charCodeAt(R)))*S+(((k>>>16)*S&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295}return v^=a.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}}),ht=p(function(i){i.exports=function(a,u){for(var d,y=a.length,v=u^y,b=0;y>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(d>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:v^=(255&a.charCodeAt(b+2))<<16;case 2:v^=(255&a.charCodeAt(b+1))<<8;case 1:v=1540483477*(65535&(v^=255&a.charCodeAt(b)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}}),et=it,ct=ht;et.murmur3=it,et.murmur2=ct;var yt=function(){this.ids=[],this.positions=[],this.indexed=!1};yt.prototype.add=function(i,a,u,d){this.ids.push(Ct(i)),this.positions.push(a,u,d)},yt.prototype.getPositions=function(i){for(var a=Ct(i),u=0,d=this.ids.length-1;u<d;){var y=u+d>>1;this.ids[y]>=a?d=y:u=y+1}for(var v=[];this.ids[u]===a;)v.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return v},yt.serialize=function(i,a){var u=new Float64Array(i.ids),d=new Uint32Array(i.positions);return function y(v,b,S,I){for(;S<I;){for(var k=v[S+I>>1],R=S-1,z=I+1;;){do R++;while(v[R]<k);do z--;while(v[z]>k);if(R>=z)break;Pt(v,R,z),Pt(b,3*R,3*z),Pt(b,3*R+1,3*z+1),Pt(b,3*R+2,3*z+2)}z-S<I-z?(y(v,b,S,z),S=z+1):(y(v,b,z+1,I),I=z)}}(u,d,0,u.length-1),a&&a.push(u.buffer,d.buffer),{ids:u,positions:d}},yt.deserialize=function(i){var a=new yt;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a};var bt=Math.pow(2,53)-1;function Ct(i){var a=+i;return!isNaN(a)&&a<=bt?a:et(String(i))}function Pt(i,a,u){var d=i[a];i[a]=i[u],i[u]=d}se("FeaturePositionMap",yt);var Mt=function(i,a){this.gl=i.gl,this.location=a},Ft=function(i){function a(u,d){i.call(this,u,d),this.current=0}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},a}(Mt),Wt=function(i){function a(u,d){i.call(this,u,d),this.current=0}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},a}(Mt),Gt=function(i){function a(u,d){i.call(this,u,d),this.current=[0,0]}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},a}(Mt),re=function(i){function a(u,d){i.call(this,u,d),this.current=[0,0,0]}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},a}(Mt),ge=function(i){function a(u,d){i.call(this,u,d),this.current=[0,0,0,0]}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},a}(Mt),we=function(i){function a(u,d){i.call(this,u,d),this.current=Ge.transparent}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},a}(Mt),xe=new Float32Array(16),en=function(i){function a(u,d){i.call(this,u,d),this.current=xe}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},a}(Mt);function oe(i){return[K(255*i.r,255*i.g),K(255*i.b,255*i.a)]}var Me=function(i,a,u){this.value=i,this.uniformNames=a.map(function(d){return"u_"+d}),this.type=u};Me.prototype.setUniform=function(i,a,u){i.set(u.constantOr(this.value))},Me.prototype.getBinding=function(i,a,u){return this.type==="color"?new we(i,a):new Wt(i,a)};var Be=function(i,a){this.uniformNames=a.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Be.prototype.setConstantPatternPositions=function(i,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=i.tlbr},Be.prototype.setUniform=function(i,a,u,d){var y=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&i.set(y)},Be.prototype.getBinding=function(i,a,u){return u.substr(0,9)==="u_pattern"?new ge(i,a):new Wt(i,a)};var Ie=function(i,a,u,d){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new d};Ie.prototype.populatePaintArray=function(i,a,u,d,y){var v=this.paintVertexArray.length,b=this.expression.evaluate(new qe(0),a,{},d,[],y);this.paintVertexArray.resize(i),this._setPaintValue(v,i,b)},Ie.prototype.updatePaintArray=function(i,a,u,d){var y=this.expression.evaluate({zoom:0},u,d);this._setPaintValue(i,a,y)},Ie.prototype._setPaintValue=function(i,a,u){if(this.type==="color")for(var d=oe(u),y=i;y<a;y++)this.paintVertexArray.emplace(y,d[0],d[1]);else{for(var v=i;v<a;v++)this.paintVertexArray.emplace(v,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Ie.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ie.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ce=function(i,a,u,d,y,v){this.expression=i,this.uniformNames=a.map(function(b){return"u_"+b+"_t"}),this.type=u,this.useIntegerZoom=d,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(function(b){return{name:"a_"+b,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new v};Ce.prototype.populatePaintArray=function(i,a,u,d,y){var v=this.expression.evaluate(new qe(this.zoom),a,{},d,[],y),b=this.expression.evaluate(new qe(this.zoom+1),a,{},d,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,v,b)},Ce.prototype.updatePaintArray=function(i,a,u,d){var y=this.expression.evaluate({zoom:this.zoom},u,d),v=this.expression.evaluate({zoom:this.zoom+1},u,d);this._setPaintValue(i,a,y,v)},Ce.prototype._setPaintValue=function(i,a,u,d){if(this.type==="color")for(var y=oe(u),v=oe(d),b=i;b<a;b++)this.paintVertexArray.emplace(b,y[0],y[1],v[0],v[1]);else{for(var S=i;S<a;S++)this.paintVertexArray.emplace(S,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}},Ce.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ce.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ce.prototype.setUniform=function(i,a){var u=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=B(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(d)},Ce.prototype.getBinding=function(i,a,u){return new Wt(i,a)};var Ne=function(i,a,u,d,y,v){this.expression=i,this.type=a,this.useIntegerZoom=u,this.zoom=d,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};Ne.prototype.populatePaintArray=function(i,a,u){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(d,i,a.patterns&&a.patterns[this.layerId],u)},Ne.prototype.updatePaintArray=function(i,a,u,d,y){this._setPaintValues(i,a,u.patterns&&u.patterns[this.layerId],y)},Ne.prototype._setPaintValues=function(i,a,u,d){if(d&&u){var y=d[u.min],v=d[u.mid],b=d[u.max];if(y&&v&&b)for(var S=i;S<a;S++)this.zoomInPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],v.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],v.pixelRatio,b.pixelRatio)}},Ne.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,at.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,at.members,this.expression.isStateDependent))},Ne.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ae=function(i,a,u){this.binders={},this._buffers=[];var d=[];for(var y in i.paint._values)if(u(y)){var v=i.paint.get(y);if(v instanceof Yr&&Sa(v.property.specification)){var b=_r(y,i.type),S=v.value,I=v.property.specification.type,k=v.property.useIntegerZoom,R=v.property.specification["property-type"],z=R==="cross-faded"||R==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=z?new Be(S.value,b):new Me(S.value,b,I),d.push("/u_"+y);else if(S.kind==="source"||z){var j=Gn(y,I,"source");this.binders[y]=z?new Ne(S,I,k,a,j,i.id):new Ie(S,b,I,j),d.push("/a_"+y)}else{var W=Gn(y,I,"composite");this.binders[y]=new Ce(S,b,I,k,a,W),d.push("/z_"+y)}}}this.cacheKey=d.sort().join("")};Ae.prototype.getMaxValue=function(i){var a=this.binders[i];return a instanceof Ie||a instanceof Ce?a.maxValue:0},Ae.prototype.populatePaintArrays=function(i,a,u,d,y){for(var v in this.binders){var b=this.binders[v];(b instanceof Ie||b instanceof Ce||b instanceof Ne)&&b.populatePaintArray(i,a,u,d,y)}},Ae.prototype.setConstantPatternPositions=function(i,a){for(var u in this.binders){var d=this.binders[u];d instanceof Be&&d.setConstantPatternPositions(i,a)}},Ae.prototype.updatePaintArrays=function(i,a,u,d,y){var v=!1;for(var b in i)for(var S=0,I=a.getPositions(b);S<I.length;S+=1){var k=I[S],R=u.feature(k.index);for(var z in this.binders){var j=this.binders[z];if((j instanceof Ie||j instanceof Ce||j instanceof Ne)&&j.expression.isStateDependent===!0){var W=d.paint.get(z);j.expression=W.value,j.updatePaintArray(k.start,k.end,R,i[b],y),v=!0}}}return v},Ae.prototype.defines=function(){var i=[];for(var a in this.binders){var u=this.binders[a];(u instanceof Me||u instanceof Be)&&i.push.apply(i,u.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return i},Ae.prototype.getBinderAttributes=function(){var i=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Ie||u instanceof Ce)for(var d=0;d<u.paintVertexAttributes.length;d++)i.push(u.paintVertexAttributes[d].name);else if(u instanceof Ne)for(var y=0;y<at.members.length;y++)i.push(at.members[y].name)}return i},Ae.prototype.getBinderUniforms=function(){var i=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Me||u instanceof Be||u instanceof Ce)for(var d=0,y=u.uniformNames;d<y.length;d+=1)i.push(y[d])}return i},Ae.prototype.getPaintVertexBuffers=function(){return this._buffers},Ae.prototype.getUniforms=function(i,a){var u=[];for(var d in this.binders){var y=this.binders[d];if(y instanceof Me||y instanceof Be||y instanceof Ce)for(var v=0,b=y.uniformNames;v<b.length;v+=1){var S=b[v];if(a[S]){var I=y.getBinding(i,a[S],S);u.push({name:S,property:d,binding:I})}}}return u},Ae.prototype.setUniforms=function(i,a,u,d){for(var y=0,v=a;y<v.length;y+=1){var b=v[y],S=b.name,I=b.property;this.binders[I].setUniform(b.binding,d,u.get(I),S)}},Ae.prototype.updatePaintBuffers=function(i){for(var a in this._buffers=[],this.binders){var u=this.binders[a];if(i&&u instanceof Ne){var d=i.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(u instanceof Ie||u instanceof Ce)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Ae.prototype.upload=function(i){for(var a in this.binders){var u=this.binders[a];(u instanceof Ie||u instanceof Ce||u instanceof Ne)&&u.upload(i)}this.updatePaintBuffers()},Ae.prototype.destroy=function(){for(var i in this.binders){var a=this.binders[i];(a instanceof Ie||a instanceof Ce||a instanceof Ne)&&a.destroy()}};var Ee=function(i,a,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var d=0,y=i;d<y.length;d+=1){var v=y[d];this.programConfigurations[v.id]=new Ae(v,a,u)}this.needsUpload=!1,this._featureMap=new yt,this._bufferOffset=0};function _r(i,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(a+"-","").replace(/-/g,"_")]}function Gn(i,a,u){var d={color:{source:Tl,composite:Hc},number:{source:Fs,composite:Tl}},y=function(v){return{"line-pattern":{source:Ro,composite:Ro},"fill-pattern":{source:Ro,composite:Ro},"fill-extrusion-pattern":{source:Ro,composite:Ro}}[v]}(i);return y&&y[u]||d[a][u]}Ee.prototype.populatePaintArrays=function(i,a,u,d,y,v){for(var b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(i,a,d,y,v);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},Ee.prototype.updatePaintArrays=function(i,a,u,d){for(var y=0,v=u;y<v.length;y+=1){var b=v[y];this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,a,b,d)||this.needsUpload}},Ee.prototype.get=function(i){return this.programConfigurations[i]},Ee.prototype.upload=function(i){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}},Ee.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()},se("ConstantBinder",Me),se("CrossFadedConstantBinder",Be),se("SourceExpressionBinder",Ie),se("CrossFadedCompositeBinder",Ne),se("CompositeExpressionBinder",Ce),se("ProgramConfiguration",Ae,{omit:["_buffers"]}),se("ProgramConfigurationSet",Ee);var Hr=Math.pow(2,14)-1,Cr=-Hr-1;function Fn(i){for(var a=8192/i.extent,u=i.loadGeometry(),d=0;d<u.length;d++)for(var y=u[d],v=0;v<y.length;v++){var b=y[v],S=Math.round(b.x*a),I=Math.round(b.y*a);b.x=B(S,Cr,Hr),b.y=B(I,Cr,Hr),(S<b.x||S>b.x+1||I<b.y||I>b.y+1)&&ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function $n(i,a){return{type:i.type,id:i.id,properties:i.properties,geometry:a?Fn(i):[]}}function Ii(i,a,u,d,y){i.emplaceBack(2*a+(d+1)/2,2*u+(y+1)/2)}var Jr=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Ma,this.indexArray=new zs,this.segments=new Y,this.programConfigurations=new Ee(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Ns(i,a){for(var u=0;u<i.length;u++)if(zo(a,i[u]))return!0;for(var d=0;d<a.length;d++)if(zo(i,a[d]))return!0;return!!Lu(i,a)}function oi(i,a,u){return!!zo(i,a)||!!Bs(a,i,u)}function xo(i,a){if(i.length===1)return ku(a,i[0]);for(var u=0;u<a.length;u++)for(var d=a[u],y=0;y<d.length;y++)if(zo(i,d[y]))return!0;for(var v=0;v<i.length;v++)if(ku(a,i[v]))return!0;for(var b=0;b<a.length;b++)if(Lu(i,a[b]))return!0;return!1}function ro(i,a,u){if(i.length>1){if(Lu(i,a))return!0;for(var d=0;d<a.length;d++)if(Bs(a[d],i,u))return!0}for(var y=0;y<i.length;y++)if(Bs(i[y],a,u))return!0;return!1}function Lu(i,a){if(i.length===0||a.length===0)return!1;for(var u=0;u<i.length-1;u++)for(var d=i[u],y=i[u+1],v=0;v<a.length-1;v++)if(Pl(d,y,a[v],a[v+1]))return!0;return!1}function Pl(i,a,u,d){return he(i,u,d)!==he(a,u,d)&&he(i,a,u)!==he(i,a,d)}function Bs(i,a,u){var d=u*u;if(a.length===1)return i.distSqr(a[0])<d;for(var y=1;y<a.length;y++)if(Al(i,a[y-1],a[y])<d)return!0;return!1}function Al(i,a,u){var d=a.distSqr(u);if(d===0)return i.distSqr(a);var y=((i.x-a.x)*(u.x-a.x)+(i.y-a.y)*(u.y-a.y))/d;return i.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function ku(i,a){for(var u,d,y,v=!1,b=0;b<i.length;b++)for(var S=0,I=(u=i[b]).length-1;S<u.length;I=S++)(d=u[S]).y>a.y!=(y=u[I]).y>a.y&&a.x<(y.x-d.x)*(a.y-d.y)/(y.y-d.y)+d.x&&(v=!v);return v}function zo(i,a){for(var u=!1,d=0,y=i.length-1;d<i.length;y=d++){var v=i[d],b=i[y];v.y>a.y!=b.y>a.y&&a.x<(b.x-v.x)*(a.y-v.y)/(b.y-v.y)+v.x&&(u=!u)}return u}function Ou(i,a,u){var d=u[0],y=u[2];if(i.x<d.x&&a.x<d.x||i.x>y.x&&a.x>y.x||i.y<d.y&&a.y<d.y||i.y>y.y&&a.y>y.y)return!1;var v=he(i,a,u[0]);return v!==he(i,a,u[1])||v!==he(i,a,u[2])||v!==he(i,a,u[3])}function Do(i,a,u){var d=a.paint.get(i).value;return d.kind==="constant"?d.value:u.programConfigurations.get(a.id).getMaxValue(i)}function xr(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ts(i,a,u,d,y){if(!a[0]&&!a[1])return i;var v=w.convert(a)._mult(y);u==="viewport"&&v._rotate(-d);for(var b=[],S=0;S<i.length;S++)b.push(i[S].sub(v));return b}Jr.prototype.populate=function(i,a,u){var d=this.layers[0],y=[],v=null;d.type==="circle"&&(v=d.layout.get("circle-sort-key"));for(var b=0,S=i;b<S.length;b+=1){var I=S[b],k=I.feature,R=I.id,z=I.index,j=I.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,nt=$n(k,W);if(this.layers[0]._featureFilter.filter(new qe(this.zoom),nt,u)){var rt=v?v.evaluate(nt,{},u):void 0,ft={id:R,properties:k.properties,type:k.type,sourceLayerIndex:j,index:z,geometry:W?nt.geometry:Fn(k),patterns:{},sortKey:rt};y.push(ft)}}v&&y.sort(function(Xt,fe){return Xt.sortKey-fe.sortKey});for(var ut=0,vt=y;ut<vt.length;ut+=1){var wt=vt[ut],St=wt.geometry,At=wt.index,zt=wt.sourceLayerIndex,Vt=i[At].feature;this.addFeature(wt,St,At,u),a.featureIndex.insert(Vt,St,At,zt,this.index)}},Jr.prototype.update=function(i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u)},Jr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jr.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Z),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Jr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jr.prototype.addFeature=function(i,a,u,d){for(var y=0,v=a;y<v.length;y+=1)for(var b=0,S=v[y];b<S.length;b+=1){var I=S[b],k=I.x,R=I.y;if(!(k<0||k>=8192||R<0||R>=8192)){var z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=z.vertexLength;Ii(this.layoutVertexArray,k,R,-1,-1),Ii(this.layoutVertexArray,k,R,1,-1),Ii(this.layoutVertexArray,k,R,1,1),Ii(this.layoutVertexArray,k,R,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),z.vertexLength+=4,z.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},d)},se("CircleBucket",Jr,{omit:["layers"]});var Us=new Nr({"circle-sort-key":new ue($.layout_circle["circle-sort-key"])}),ka={paint:new Nr({"circle-radius":new ue($.paint_circle["circle-radius"]),"circle-color":new ue($.paint_circle["circle-color"]),"circle-blur":new ue($.paint_circle["circle-blur"]),"circle-opacity":new ue($.paint_circle["circle-opacity"]),"circle-translate":new me($.paint_circle["circle-translate"]),"circle-translate-anchor":new me($.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me($.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me($.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ue($.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ue($.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ue($.paint_circle["circle-stroke-opacity"])}),layout:Us},hn=typeof Float32Array<"u"?Float32Array:Array;function Vi(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function si(i,a,u){var d=a[0],y=a[1],v=a[2],b=a[3],S=a[4],I=a[5],k=a[6],R=a[7],z=a[8],j=a[9],W=a[10],nt=a[11],rt=a[12],ft=a[13],ut=a[14],vt=a[15],wt=u[0],St=u[1],At=u[2],zt=u[3];return i[0]=wt*d+St*S+At*z+zt*rt,i[1]=wt*y+St*I+At*j+zt*ft,i[2]=wt*v+St*k+At*W+zt*ut,i[3]=wt*b+St*R+At*nt+zt*vt,i[4]=(wt=u[4])*d+(St=u[5])*S+(At=u[6])*z+(zt=u[7])*rt,i[5]=wt*y+St*I+At*j+zt*ft,i[6]=wt*v+St*k+At*W+zt*ut,i[7]=wt*b+St*R+At*nt+zt*vt,i[8]=(wt=u[8])*d+(St=u[9])*S+(At=u[10])*z+(zt=u[11])*rt,i[9]=wt*y+St*I+At*j+zt*ft,i[10]=wt*v+St*k+At*W+zt*ut,i[11]=wt*b+St*R+At*nt+zt*vt,i[12]=(wt=u[12])*d+(St=u[13])*S+(At=u[14])*z+(zt=u[15])*rt,i[13]=wt*y+St*I+At*j+zt*ft,i[14]=wt*v+St*k+At*W+zt*ut,i[15]=wt*b+St*R+At*nt+zt*vt,i}Math.hypot||(Math.hypot=function(){for(var i=arguments,a=0,u=arguments.length;u--;)a+=i[u]*i[u];return Math.sqrt(a)});var Oa,v_=si;function qc(i,a,u){var d=a[0],y=a[1],v=a[2],b=a[3];return i[0]=u[0]*d+u[4]*y+u[8]*v+u[12]*b,i[1]=u[1]*d+u[5]*y+u[9]*v+u[13]*b,i[2]=u[2]*d+u[6]*y+u[10]*v+u[14]*b,i[3]=u[3]*d+u[7]*y+u[11]*v+u[15]*b,i}Oa=new hn(3),hn!=Float32Array&&(Oa[0]=0,Oa[1]=0,Oa[2]=0),function(){var i=new hn(4);hn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0)}();var __=(function(){var i=new hn(2);hn!=Float32Array&&(i[0]=0,i[1]=0)}(),function(i){function a(u){i.call(this,u,ka)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.createBucket=function(u){return new Jr(u)},a.prototype.queryRadius=function(u){var d=u;return Do("circle-radius",this,d)+Do("circle-stroke-width",this,d)+xr(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(u,d,y,v,b,S,I,k){for(var R=ts(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,I),z=this.paint.get("circle-radius").evaluate(d,y)+this.paint.get("circle-stroke-width").evaluate(d,y),j=this.paint.get("circle-pitch-alignment")==="map",W=j?R:function(Vt,Xt){return Vt.map(function(fe){return Ru(fe,Xt)})}(R,k),nt=j?z*I:z,rt=0,ft=v;rt<ft.length;rt+=1)for(var ut=0,vt=ft[rt];ut<vt.length;ut+=1){var wt=vt[ut],St=j?wt:Ru(wt,k),At=nt,zt=qc([],[wt.x,wt.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?At*=zt[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(At*=S.cameraToCenterDistance/zt[3]),oi(W,St,At))return!0}return!1},a}(Oo));function Ru(i,a){var u=qc([],[i.x,i.y,0,1],a);return new w(u[0]/u[3],u[1]/u[3])}var Mm=function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a}(Jr);function Cl(i,a,u,d){var y=a.width,v=a.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==y*v*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(y*v*u);return i.width=y,i.height=v,i.data=d,i}function Zc(i,a,u){var d=a.width,y=a.height;if(d!==i.width||y!==i.height){var v=Cl({},{width:d,height:y},u);x_(i,v,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,d),height:Math.min(i.height,y)},u),i.width=d,i.height=y,i.data=v.data}}function x_(i,a,u,d,y,v){if(y.width===0||y.height===0)return a;if(y.width>i.width||y.height>i.height||u.x>i.width-y.width||u.y>i.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||d.x>a.width-y.width||d.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var b=i.data,S=a.data,I=0;I<y.height;I++)for(var k=((u.y+I)*i.width+u.x)*v,R=((d.y+I)*a.width+d.x)*v,z=0;z<y.width*v;z++)S[R+z]=b[k+z];return a}se("HeatmapBucket",Mm,{omit:["layers"]});var zu=function(i,a){Cl(this,i,1,a)};zu.prototype.resize=function(i){Zc(this,i,1)},zu.prototype.clone=function(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))},zu.copy=function(i,a,u,d,y){x_(i,a,u,d,y,1)};var Mi=function(i,a){Cl(this,i,4,a)};Mi.prototype.resize=function(i){Zc(this,i,4)},Mi.prototype.replace=function(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i},Mi.prototype.clone=function(){return new Mi({width:this.width,height:this.height},new Uint8Array(this.data))},Mi.copy=function(i,a,u,d,y){x_(i,a,u,d,y,4)},se("AlphaImage",zu),se("RGBAImage",Mi);var oO={paint:new Nr({"heatmap-radius":new ue($.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ue($.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me($.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _o($.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me($.paint_heatmap["heatmap-opacity"])})};function Yw(i){var a={},u=i.resolution||256,d=i.clips?i.clips.length:1,y=i.image||new Mi({width:u,height:d}),v=function(nt,rt,ft){a[i.evaluationKey]=ft;var ut=i.expression.evaluate(a);y.data[nt+rt+0]=Math.floor(255*ut.r/ut.a),y.data[nt+rt+1]=Math.floor(255*ut.g/ut.a),y.data[nt+rt+2]=Math.floor(255*ut.b/ut.a),y.data[nt+rt+3]=Math.floor(255*ut.a)};if(i.clips)for(var b=0,S=0;b<d;++b,S+=4*u)for(var I=0,k=0;I<u;I++,k+=4){var R=I/(u-1),z=i.clips[b];v(S,k,z.start*(1-R)+z.end*R)}else for(var j=0,W=0;j<u;j++,W+=4)v(0,W,j/(u-1));return y}var sO=function(i){function a(u){i.call(this,u,oO),this._updateColorRamp()}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.createBucket=function(u){return new Mm(u)},a.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Yw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(Oo),aO={paint:new Nr({"hillshade-illumination-direction":new me($.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me($.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me($.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me($.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me($.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me($.paint_hillshade["hillshade-accent-color"])})},lO=function(i){function a(u){i.call(this,u,aO)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(Oo),uO=Ar([{name:"a_pos",components:2,type:"Int16"}],4).members,b_=Lm,cO=Lm;function Lm(i,a,u){u=u||2;var d,y,v,b,S,I,k,R=a&&a.length,z=R?a[0]*u:i.length,j=Kw(i,0,z,u,!0),W=[];if(!j||j.next===j.prev)return W;if(R&&(j=function(rt,ft,ut,vt){var wt,St,At,zt=[];for(wt=0,St=ft.length;wt<St;wt++)(At=Kw(rt,ft[wt]*vt,wt<St-1?ft[wt+1]*vt:rt.length,vt,!1))===At.next&&(At.steiner=!0),zt.push(vO(At));for(zt.sort(mO),wt=0;wt<zt.length;wt++)gO(zt[wt],ut),ut=Il(ut,ut.next);return ut}(i,a,j,u)),i.length>80*u){d=v=i[0],y=b=i[1];for(var nt=u;nt<z;nt+=u)(S=i[nt])<d&&(d=S),(I=i[nt+1])<y&&(y=I),S>v&&(v=S),I>b&&(b=I);k=(k=Math.max(v-d,b-y))!==0?1/k:0}return Xf(j,W,u,d,y,k),W}function Kw(i,a,u,d,y){var v,b;if(y===E_(i,a,u,d)>0)for(v=a;v<u;v+=d)b=tT(v,i[v],i[v+1],b);else for(v=u-d;v>=a;v-=d)b=tT(v,i[v],i[v+1],b);return b&&km(b,b.next)&&(Yf(b),b=b.next),b}function Il(i,a){if(!i)return i;a||(a=i);var u,d=i;do if(u=!1,d.steiner||!km(d,d.next)&&cr(d.prev,d,d.next)!==0)d=d.next;else{if(Yf(d),(d=a=d.prev)===d.next)break;u=!0}while(u||d!==a);return a}function Xf(i,a,u,d,y,v,b){if(i){!b&&v&&function(R,z,j,W){var nt=R;do nt.z===null&&(nt.z=w_(nt.x,nt.y,z,j,W)),nt.prevZ=nt.prev,nt.nextZ=nt.next,nt=nt.next;while(nt!==R);nt.prevZ.nextZ=null,nt.prevZ=null,function(rt){var ft,ut,vt,wt,St,At,zt,Vt,Xt=1;do{for(ut=rt,rt=null,St=null,At=0;ut;){for(At++,vt=ut,zt=0,ft=0;ft<Xt&&(zt++,vt=vt.nextZ);ft++);for(Vt=Xt;zt>0||Vt>0&&vt;)zt!==0&&(Vt===0||!vt||ut.z<=vt.z)?(wt=ut,ut=ut.nextZ,zt--):(wt=vt,vt=vt.nextZ,Vt--),St?St.nextZ=wt:rt=wt,wt.prevZ=St,St=wt;ut=vt}St.nextZ=null,Xt*=2}while(At>1)}(nt)}(i,d,y,v);for(var S,I,k=i;i.prev!==i.next;)if(S=i.prev,I=i.next,v?fO(i,d,y,v):hO(i))a.push(S.i/u),a.push(i.i/u),a.push(I.i/u),Yf(i),i=I.next,k=I.next;else if((i=I)===k){b?b===1?Xf(i=pO(Il(i),a,u),a,u,d,y,v,2):b===2&&dO(i,a,u,d,y,v):Xf(Il(i),a,u,d,y,v,1);break}}}function hO(i){var a=i.prev,u=i,d=i.next;if(cr(a,u,d)>=0)return!1;for(var y=i.next.next;y!==i.prev;){if(Xc(a.x,a.y,u.x,u.y,d.x,d.y,y.x,y.y)&&cr(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function fO(i,a,u,d){var y=i.prev,v=i,b=i.next;if(cr(y,v,b)>=0)return!1;for(var S=y.x>v.x?y.x>b.x?y.x:b.x:v.x>b.x?v.x:b.x,I=y.y>v.y?y.y>b.y?y.y:b.y:v.y>b.y?v.y:b.y,k=w_(y.x<v.x?y.x<b.x?y.x:b.x:v.x<b.x?v.x:b.x,y.y<v.y?y.y<b.y?y.y:b.y:v.y<b.y?v.y:b.y,a,u,d),R=w_(S,I,a,u,d),z=i.prevZ,j=i.nextZ;z&&z.z>=k&&j&&j.z<=R;){if(z!==i.prev&&z!==i.next&&Xc(y.x,y.y,v.x,v.y,b.x,b.y,z.x,z.y)&&cr(z.prev,z,z.next)>=0||(z=z.prevZ,j!==i.prev&&j!==i.next&&Xc(y.x,y.y,v.x,v.y,b.x,b.y,j.x,j.y)&&cr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;z&&z.z>=k;){if(z!==i.prev&&z!==i.next&&Xc(y.x,y.y,v.x,v.y,b.x,b.y,z.x,z.y)&&cr(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;j&&j.z<=R;){if(j!==i.prev&&j!==i.next&&Xc(y.x,y.y,v.x,v.y,b.x,b.y,j.x,j.y)&&cr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function pO(i,a,u){var d=i;do{var y=d.prev,v=d.next.next;!km(y,v)&&Jw(y,d,d.next,v)&&$f(y,v)&&$f(v,y)&&(a.push(y.i/u),a.push(d.i/u),a.push(v.i/u),Yf(d),Yf(d.next),d=i=v),d=d.next}while(d!==i);return Il(d)}function dO(i,a,u,d,y,v){var b=i;do{for(var S=b.next.next;S!==b.prev;){if(b.i!==S.i&&_O(b,S)){var I=Qw(b,S);return b=Il(b,b.next),I=Il(I,I.next),Xf(b,a,u,d,y,v),void Xf(I,a,u,d,y,v)}S=S.next}b=b.next}while(b!==i)}function mO(i,a){return i.x-a.x}function gO(i,a){if(a=function(d,y){var v,b=y,S=d.x,I=d.y,k=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var R=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(R<=S&&R>k){if(k=R,R===S){if(I===b.y)return b;if(I===b.next.y)return b.next}v=b.x<b.next.x?b:b.next}}b=b.next}while(b!==y);if(!v)return null;if(S===k)return v;var z,j=v,W=v.x,nt=v.y,rt=1/0;b=v;do S>=b.x&&b.x>=W&&S!==b.x&&Xc(I<nt?S:k,I,W,nt,I<nt?k:S,I,b.x,b.y)&&(z=Math.abs(I-b.y)/(S-b.x),$f(b,d)&&(z<rt||z===rt&&(b.x>v.x||b.x===v.x&&yO(v,b)))&&(v=b,rt=z)),b=b.next;while(b!==j);return v}(i,a)){var u=Qw(a,i);Il(a,a.next),Il(u,u.next)}}function yO(i,a){return cr(i.prev,i,a.prev)<0&&cr(a.next,i,i.next)<0}function w_(i,a,u,d,y){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-u)*y)|i<<8))|i<<4))|i<<2))|i<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-d)*y)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function vO(i){var a=i,u=i;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==i);return u}function Xc(i,a,u,d,y,v,b,S){return(y-b)*(a-S)-(i-b)*(v-S)>=0&&(i-b)*(d-S)-(u-b)*(a-S)>=0&&(u-b)*(v-S)-(y-b)*(d-S)>=0}function _O(i,a){return i.next.i!==a.i&&i.prev.i!==a.i&&!function(u,d){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==d.i&&y.next.i!==d.i&&Jw(y,y.next,u,d))return!0;y=y.next}while(y!==u);return!1}(i,a)&&($f(i,a)&&$f(a,i)&&function(u,d){var y=u,v=!1,b=(u.x+d.x)/2,S=(u.y+d.y)/2;do y.y>S!=y.next.y>S&&y.next.y!==y.y&&b<(y.next.x-y.x)*(S-y.y)/(y.next.y-y.y)+y.x&&(v=!v),y=y.next;while(y!==u);return v}(i,a)&&(cr(i.prev,i,a.prev)||cr(i,a.prev,a))||km(i,a)&&cr(i.prev,i,i.next)>0&&cr(a.prev,a,a.next)>0)}function cr(i,a,u){return(a.y-i.y)*(u.x-a.x)-(a.x-i.x)*(u.y-a.y)}function km(i,a){return i.x===a.x&&i.y===a.y}function Jw(i,a,u,d){var y=Rm(cr(i,a,u)),v=Rm(cr(i,a,d)),b=Rm(cr(u,d,i)),S=Rm(cr(u,d,a));return y!==v&&b!==S||!(y!==0||!Om(i,u,a))||!(v!==0||!Om(i,d,a))||!(b!==0||!Om(u,i,d))||!(S!==0||!Om(u,a,d))}function Om(i,a,u){return a.x<=Math.max(i.x,u.x)&&a.x>=Math.min(i.x,u.x)&&a.y<=Math.max(i.y,u.y)&&a.y>=Math.min(i.y,u.y)}function Rm(i){return i>0?1:i<0?-1:0}function $f(i,a){return cr(i.prev,i,i.next)<0?cr(i,a,i.next)>=0&&cr(i,i.prev,a)>=0:cr(i,a,i.prev)<0||cr(i,i.next,a)<0}function Qw(i,a){var u=new T_(i.i,i.x,i.y),d=new T_(a.i,a.x,a.y),y=i.next,v=a.prev;return i.next=a,a.prev=i,u.next=y,y.prev=u,d.next=u,u.prev=d,v.next=d,d.prev=v,d}function tT(i,a,u,d){var y=new T_(i,a,u);return d?(y.next=d.next,y.prev=d,d.next.prev=y,d.next=y):(y.prev=y,y.next=y),y}function Yf(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function T_(i,a,u){this.i=i,this.x=a,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E_(i,a,u,d){for(var y=0,v=a,b=u-d;v<u;v+=d)y+=(i[b]-i[v])*(i[v+1]+i[b+1]),b=v;return y}function xO(i,a,u,d,y){(function v(b,S,I,k,R){for(;k>I;){if(k-I>600){var z=k-I+1,j=S-I+1,W=Math.log(z),nt=.5*Math.exp(2*W/3),rt=.5*Math.sqrt(W*nt*(z-nt)/z)*(j-z/2<0?-1:1);v(b,S,Math.max(I,Math.floor(S-j*nt/z+rt)),Math.min(k,Math.floor(S+(z-j)*nt/z+rt)),R)}var ft=b[S],ut=I,vt=k;for(Kf(b,I,S),R(b[k],ft)>0&&Kf(b,I,k);ut<vt;){for(Kf(b,ut,vt),ut++,vt--;R(b[ut],ft)<0;)ut++;for(;R(b[vt],ft)>0;)vt--}R(b[I],ft)===0?Kf(b,I,vt):Kf(b,++vt,k),vt<=S&&(I=vt+1),S<=vt&&(k=vt-1)}})(i,a,u||0,d||i.length-1,y||bO)}function Kf(i,a,u){var d=i[a];i[a]=i[u],i[u]=d}function bO(i,a){return i<a?-1:i>a?1:0}function S_(i,a){var u=i.length;if(u<=1)return[i];for(var d,y,v=[],b=0;b<u;b++){var S=sn(i[b]);S!==0&&(i[b].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(d&&v.push(d),d=[i[b]]):d.push(i[b]))}if(d&&v.push(d),a>1)for(var I=0;I<v.length;I++)v[I].length<=a||(xO(v[I],a,1,v[I].length-1,wO),v[I]=v[I].slice(0,a));return v}function wO(i,a){return a.area-i.area}function P_(i,a,u){for(var d=u.patternDependencies,y=!1,v=0,b=a;v<b.length;v+=1){var S=b[v].paint.get(i+"-pattern");S.isConstant()||(y=!0);var I=S.constantOr(null);I&&(y=!0,d[I.to]=!0,d[I.from]=!0)}return y}function A_(i,a,u,d,y){for(var v=y.patternDependencies,b=0,S=a;b<S.length;b+=1){var I=S[b],k=I.paint.get(i+"-pattern").value;if(k.kind!=="constant"){var R=k.evaluate({zoom:d-1},u,{},y.availableImages),z=k.evaluate({zoom:d},u,{},y.availableImages),j=k.evaluate({zoom:d+1},u,{},y.availableImages);z=z&&z.name?z.name:z,j=j&&j.name?j.name:j,v[R=R&&R.name?R.name:R]=!0,v[z]=!0,v[j]=!0,u.patterns[I.id]={min:R,mid:z,max:j}}}return u}Lm.deviation=function(i,a,u,d){var y=a&&a.length,v=Math.abs(E_(i,0,y?a[0]*u:i.length,u));if(y)for(var b=0,S=a.length;b<S;b++)v-=Math.abs(E_(i,a[b]*u,b<S-1?a[b+1]*u:i.length,u));var I=0;for(b=0;b<d.length;b+=3){var k=d[b]*u,R=d[b+1]*u,z=d[b+2]*u;I+=Math.abs((i[k]-i[z])*(i[R+1]-i[k+1])-(i[k]-i[R])*(i[z+1]-i[k+1]))}return v===0&&I===0?0:Math.abs((I-v)/v)},Lm.flatten=function(i){for(var a=i[0][0].length,u={vertices:[],holes:[],dimensions:a},d=0,y=0;y<i.length;y++){for(var v=0;v<i[y].length;v++)for(var b=0;b<a;b++)u.vertices.push(i[y][v][b]);y>0&&u.holes.push(d+=i[y-1].length)}return u},b_.default=cO;var es=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ma,this.indexArray=new zs,this.indexArray2=new Mu,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Y,this.segments2=new Y,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};es.prototype.populate=function(i,a,u){this.hasPattern=P_("fill",this.layers,a);for(var d=this.layers[0].layout.get("fill-sort-key"),y=[],v=0,b=i;v<b.length;v+=1){var S=b[v],I=S.feature,k=S.id,R=S.index,z=S.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,W=$n(I,j);if(this.layers[0]._featureFilter.filter(new qe(this.zoom),W,u)){var nt=d?d.evaluate(W,{},u,a.availableImages):void 0,rt={id:k,properties:I.properties,type:I.type,sourceLayerIndex:z,index:R,geometry:j?W.geometry:Fn(I),patterns:{},sortKey:nt};y.push(rt)}}d&&y.sort(function(Vt,Xt){return Vt.sortKey-Xt.sortKey});for(var ft=0,ut=y;ft<ut.length;ft+=1){var vt=ut[ft],wt=vt.geometry,St=vt.index,At=vt.sourceLayerIndex;if(this.hasPattern){var zt=A_("fill",this.layers,vt,this.zoom,a);this.patternFeatures.push(zt)}else this.addFeature(vt,wt,St,u,{});a.featureIndex.insert(i[St].feature,wt,St,At,this.index)}},es.prototype.update=function(i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u)},es.prototype.addFeatures=function(i,a,u){for(var d=0,y=this.patternFeatures;d<y.length;d+=1){var v=y[d];this.addFeature(v,v.geometry,v.index,a,u)}},es.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},es.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,uO),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},es.prototype.addFeature=function(i,a,u,d,y){for(var v=0,b=S_(a,500);v<b.length;v+=1){for(var S=b[v],I=0,k=0,R=S;k<R.length;k+=1)I+=R[k].length;for(var z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),j=z.vertexLength,W=[],nt=[],rt=0,ft=S;rt<ft.length;rt+=1){var ut=ft[rt];if(ut.length!==0){ut!==S[0]&&nt.push(W.length/2);var vt=this.segments2.prepareSegment(ut.length,this.layoutVertexArray,this.indexArray2),wt=vt.vertexLength;this.layoutVertexArray.emplaceBack(ut[0].x,ut[0].y),this.indexArray2.emplaceBack(wt+ut.length-1,wt),W.push(ut[0].x),W.push(ut[0].y);for(var St=1;St<ut.length;St++)this.layoutVertexArray.emplaceBack(ut[St].x,ut[St].y),this.indexArray2.emplaceBack(wt+St-1,wt+St),W.push(ut[St].x),W.push(ut[St].y);vt.vertexLength+=ut.length,vt.primitiveLength+=ut.length}}for(var At=b_(W,nt),zt=0;zt<At.length;zt+=3)this.indexArray.emplaceBack(j+At[zt],j+At[zt+1],j+At[zt+2]);z.vertexLength+=I,z.primitiveLength+=At.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,d)},se("FillBucket",es,{omit:["layers","patternFeatures"]});var TO=new Nr({"fill-sort-key":new ue($.layout_fill["fill-sort-key"])}),EO={paint:new Nr({"fill-antialias":new me($.paint_fill["fill-antialias"]),"fill-opacity":new ue($.paint_fill["fill-opacity"]),"fill-color":new ue($.paint_fill["fill-color"]),"fill-outline-color":new ue($.paint_fill["fill-outline-color"]),"fill-translate":new me($.paint_fill["fill-translate"]),"fill-translate-anchor":new me($.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vc($.paint_fill["fill-pattern"])}),layout:TO},SO=function(i){function a(u){i.call(this,u,EO)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.recalculate=function(u,d){i.prototype.recalculate.call(this,u,d);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(u){return new es(u)},a.prototype.queryRadius=function(){return xr(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(u,d,y,v,b,S,I){return xo(ts(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,I),v)},a.prototype.isTileClipped=function(){return!0},a}(Oo),PO=Ar([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,eT=$c;function $c(i,a,u,d,y){this.properties={},this.extent=u,this.type=0,this._pbf=i,this._geometry=-1,this._keys=d,this._values=y,i.readFields(AO,this,a)}function AO(i,a,u){i==1?a.id=u.readVarint():i==2?function(d,y){for(var v=d.readVarint()+d.pos;d.pos<v;){var b=y._keys[d.readVarint()],S=y._values[d.readVarint()];y.properties[b]=S}}(u,a):i==3?a.type=u.readVarint():i==4&&(a._geometry=u.pos)}function CO(i){for(var a,u,d=0,y=0,v=i.length,b=v-1;y<v;b=y++)d+=((u=i[b]).x-(a=i[y]).x)*(a.y+u.y);return d}$c.types=["Unknown","Point","LineString","Polygon"],$c.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var a,u=i.readVarint()+i.pos,d=1,y=0,v=0,b=0,S=[];i.pos<u;){if(y<=0){var I=i.readVarint();d=7&I,y=I>>3}if(y--,d===1||d===2)v+=i.readSVarint(),b+=i.readSVarint(),d===1&&(a&&S.push(a),a=[]),a.push(new w(v,b));else{if(d!==7)throw new Error("unknown command "+d);a&&a.push(a[0].clone())}}return a&&S.push(a),S},$c.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var a=i.readVarint()+i.pos,u=1,d=0,y=0,v=0,b=1/0,S=-1/0,I=1/0,k=-1/0;i.pos<a;){if(d<=0){var R=i.readVarint();u=7&R,d=R>>3}if(d--,u===1||u===2)(y+=i.readSVarint())<b&&(b=y),y>S&&(S=y),(v+=i.readSVarint())<I&&(I=v),v>k&&(k=v);else if(u!==7)throw new Error("unknown command "+u)}return[b,I,S,k]},$c.prototype.toGeoJSON=function(i,a,u){var d,y,v=this.extent*Math.pow(2,u),b=this.extent*i,S=this.extent*a,I=this.loadGeometry(),k=$c.types[this.type];function R(W){for(var nt=0;nt<W.length;nt++){var rt=W[nt];W[nt]=[360*(rt.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(rt.y+S)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(d=0;d<I.length;d++)z[d]=I[d][0];R(I=z);break;case 2:for(d=0;d<I.length;d++)R(I[d]);break;case 3:for(I=function(W){var nt=W.length;if(nt<=1)return[W];for(var rt,ft,ut=[],vt=0;vt<nt;vt++){var wt=CO(W[vt]);wt!==0&&(ft===void 0&&(ft=wt<0),ft===wt<0?(rt&&ut.push(rt),rt=[W[vt]]):rt.push(W[vt]))}return rt&&ut.push(rt),ut}(I),d=0;d<I.length;d++)for(y=0;y<I[d].length;y++)R(I[d][y])}I.length===1?I=I[0]:k="Multi"+k;var j={type:"Feature",geometry:{type:k,coordinates:I},properties:this.properties};return"id"in this&&(j.id=this.id),j};var nT=rT;function rT(i,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(IO,this,a),this.length=this._features.length}function IO(i,a,u){i===15?a.version=u.readVarint():i===1?a.name=u.readString():i===5?a.extent=u.readVarint():i===2?a._features.push(u.pos):i===3?a._keys.push(u.readString()):i===4&&a._values.push(function(d){for(var y=null,v=d.readVarint()+d.pos;d.pos<v;){var b=d.readVarint()>>3;y=b===1?d.readString():b===2?d.readFloat():b===3?d.readDouble():b===4?d.readVarint64():b===5?d.readVarint():b===6?d.readSVarint():b===7?d.readBoolean():null}return y}(u))}function MO(i,a,u){if(i===3){var d=new nT(u,u.readVarint()+u.pos);d.length&&(a[d.name]=d)}}rT.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var a=this._pbf.readVarint()+this._pbf.pos;return new eT(this._pbf,a,this.extent,this._keys,this._values)};var Yc={VectorTile:function(i,a){this.layers=i.readFields(MO,{},a)},VectorTileFeature:eT,VectorTileLayer:nT},LO=Yc.VectorTileFeature.types,C_=Math.pow(2,13);function Jf(i,a,u,d,y,v,b,S){i.emplaceBack(a,u,2*Math.floor(d*C_)+b,y*C_*2,v*C_*2,Math.round(S))}var ns=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Qo,this.indexArray=new zs,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Y,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function kO(i,a){return i.x===a.x&&(i.x<0||i.x>8192)||i.y===a.y&&(i.y<0||i.y>8192)}ns.prototype.populate=function(i,a,u){this.features=[],this.hasPattern=P_("fill-extrusion",this.layers,a);for(var d=0,y=i;d<y.length;d+=1){var v=y[d],b=v.feature,S=v.id,I=v.index,k=v.sourceLayerIndex,R=this.layers[0]._featureFilter.needGeometry,z=$n(b,R);if(this.layers[0]._featureFilter.filter(new qe(this.zoom),z,u)){var j={id:S,sourceLayerIndex:k,index:I,geometry:R?z.geometry:Fn(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(A_("fill-extrusion",this.layers,j,this.zoom,a)):this.addFeature(j,j.geometry,I,u,{}),a.featureIndex.insert(b,j.geometry,I,k,this.index,!0)}}},ns.prototype.addFeatures=function(i,a,u){for(var d=0,y=this.features;d<y.length;d+=1){var v=y[d];this.addFeature(v,v.geometry,v.index,a,u)}},ns.prototype.update=function(i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u)},ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ns.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,PO),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ns.prototype.addFeature=function(i,a,u,d,y){for(var v=0,b=S_(a,500);v<b.length;v+=1){for(var S=b[v],I=0,k=0,R=S;k<R.length;k+=1)I+=R[k].length;for(var z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),j=0,W=S;j<W.length;j+=1){var nt=W[j];if(nt.length!==0&&!((He=nt).every(function(Fe){return Fe.x<0})||He.every(function(Fe){return Fe.x>8192})||He.every(function(Fe){return Fe.y<0})||He.every(function(Fe){return Fe.y>8192})))for(var rt=0,ft=0;ft<nt.length;ft++){var ut=nt[ft];if(ft>=1){var vt=nt[ft-1];if(!kO(ut,vt)){z.vertexLength+4>Y.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var wt=ut.sub(vt)._perp()._unit(),St=vt.dist(ut);rt+St>32768&&(rt=0),Jf(this.layoutVertexArray,ut.x,ut.y,wt.x,wt.y,0,0,rt),Jf(this.layoutVertexArray,ut.x,ut.y,wt.x,wt.y,0,1,rt),Jf(this.layoutVertexArray,vt.x,vt.y,wt.x,wt.y,0,0,rt+=St),Jf(this.layoutVertexArray,vt.x,vt.y,wt.x,wt.y,0,1,rt);var At=z.vertexLength;this.indexArray.emplaceBack(At,At+2,At+1),this.indexArray.emplaceBack(At+1,At+2,At+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>Y.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),LO[i.type]==="Polygon"){for(var zt=[],Vt=[],Xt=z.vertexLength,fe=0,te=S;fe<te.length;fe+=1){var ye=te[fe];if(ye.length!==0){ye!==S[0]&&Vt.push(zt.length/2);for(var ne=0;ne<ye.length;ne++){var Ue=ye[ne];Jf(this.layoutVertexArray,Ue.x,Ue.y,0,0,1,1,0),zt.push(Ue.x),zt.push(Ue.y)}}}for(var Pe=b_(zt,Vt),ce=0;ce<Pe.length;ce+=3)this.indexArray.emplaceBack(Xt+Pe[ce],Xt+Pe[ce+2],Xt+Pe[ce+1]);z.primitiveLength+=Pe.length/3,z.vertexLength+=I}}var He;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,d)},se("FillExtrusionBucket",ns,{omit:["layers","features"]});var OO={paint:new Nr({"fill-extrusion-opacity":new me($["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ue($["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me($["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me($["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vc($["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ue($["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ue($["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me($["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},RO=function(i){function a(u){i.call(this,u,OO)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.createBucket=function(u){return new ns(u)},a.prototype.queryRadius=function(){return xr(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(u,d,y,v,b,S,I,k){var R=ts(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,I),z=this.paint.get("fill-extrusion-height").evaluate(d,y),j=this.paint.get("fill-extrusion-base").evaluate(d,y),W=function(rt,ft,ut,vt){for(var wt=[],St=0,At=rt;St<At.length;St+=1){var zt=At[St],Vt=[zt.x,zt.y,0,1];qc(Vt,Vt,ft),wt.push(new w(Vt[0]/Vt[3],Vt[1]/Vt[3]))}return wt}(R,k),nt=function(rt,ft,ut,vt){for(var wt=[],St=[],At=vt[8]*ft,zt=vt[9]*ft,Vt=vt[10]*ft,Xt=vt[11]*ft,fe=vt[8]*ut,te=vt[9]*ut,ye=vt[10]*ut,ne=vt[11]*ut,Ue=0,Pe=rt;Ue<Pe.length;Ue+=1){for(var ce=[],He=[],Fe=0,Qe=Pe[Ue];Fe<Qe.length;Fe+=1){var ve=Qe[Fe],ln=ve.x,kn=ve.y,Wn=vt[0]*ln+vt[4]*kn+vt[12],Nn=vt[1]*ln+vt[5]*kn+vt[13],On=vt[2]*ln+vt[6]*kn+vt[14],Hn=vt[3]*ln+vt[7]*kn+vt[15],br=On+Vt,wr=Hn+Xt,ti=Wn+fe,Mr=Nn+te,ei=On+ye,Yn=Hn+ne,Lr=new w((Wn+At)/wr,(Nn+zt)/wr);Lr.z=br/wr,ce.push(Lr);var Xe=new w(ti/Yn,Mr/Yn);Xe.z=ei/Yn,He.push(Xe)}wt.push(ce),St.push(He)}return[wt,St]}(v,j,z,k);return function(rt,ft,ut){var vt=1/0;xo(ut,ft)&&(vt=iT(ut,ft[0]));for(var wt=0;wt<ft.length;wt++)for(var St=ft[wt],At=rt[wt],zt=0;zt<St.length-1;zt++){var Vt=St[zt],Xt=[Vt,St[zt+1],At[zt+1],At[zt],Vt];Ns(ut,Xt)&&(vt=Math.min(vt,iT(ut,Xt)))}return vt!==1/0&&vt}(nt[0],nt[1],W)},a}(Oo);function Qf(i,a){return i.x*a.x+i.y*a.y}function iT(i,a){if(i.length===1){for(var u,d=0,y=a[d++];!u||y.equals(u);)if(!(u=a[d++]))return 1/0;for(;d<a.length;d++){var v=a[d],b=i[0],S=u.sub(y),I=v.sub(y),k=b.sub(y),R=Qf(S,S),z=Qf(S,I),j=Qf(I,I),W=Qf(k,S),nt=Qf(k,I),rt=R*j-z*z,ft=(j*W-z*nt)/rt,ut=(R*nt-z*W)/rt,vt=y.z*(1-ft-ut)+u.z*ft+v.z*ut;if(isFinite(vt))return vt}return 1/0}for(var wt=1/0,St=0,At=a;St<At.length;St+=1)wt=Math.min(wt,At[St].z);return wt}var zO=Ar([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,DO=Ar([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,FO=Yc.VectorTileFeature.types,NO=Math.cos(Math.PI/180*37.5),oT=Math.pow(2,14)/.5,ai=function(i){var a=this;this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){a.gradients[u.id]={}}),this.layoutVertexArray=new Ci,this.layoutVertexArray2=new Tl,this.indexArray=new zs,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Y,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ai.prototype.populate=function(i,a,u){this.hasPattern=P_("line",this.layers,a);for(var d=this.layers[0].layout.get("line-sort-key"),y=[],v=0,b=i;v<b.length;v+=1){var S=b[v],I=S.feature,k=S.id,R=S.index,z=S.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,W=$n(I,j);if(this.layers[0]._featureFilter.filter(new qe(this.zoom),W,u)){var nt=d?d.evaluate(W,{},u):void 0,rt={id:k,properties:I.properties,type:I.type,sourceLayerIndex:z,index:R,geometry:j?W.geometry:Fn(I),patterns:{},sortKey:nt};y.push(rt)}}d&&y.sort(function(Vt,Xt){return Vt.sortKey-Xt.sortKey});for(var ft=0,ut=y;ft<ut.length;ft+=1){var vt=ut[ft],wt=vt.geometry,St=vt.index,At=vt.sourceLayerIndex;if(this.hasPattern){var zt=A_("line",this.layers,vt,this.zoom,a);this.patternFeatures.push(zt)}else this.addFeature(vt,wt,St,u,{});a.featureIndex.insert(i[St].feature,wt,St,At,this.index)}},ai.prototype.update=function(i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u)},ai.prototype.addFeatures=function(i,a,u){for(var d=0,y=this.patternFeatures;d<y.length;d+=1){var v=y[d];this.addFeature(v,v.geometry,v.index,a,u)}},ai.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ai.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ai.prototype.upload=function(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,DO)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zO),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},ai.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ai.prototype.lineFeatureClips=function(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}},ai.prototype.addFeature=function(i,a,u,d,y){var v=this.layers[0].layout,b=v.get("line-join").evaluate(i,{}),S=v.get("line-cap"),I=v.get("line-miter-limit"),k=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(var R=0,z=a;R<z.length;R+=1)this.addLine(z[R],i,b,S,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,d)},ai.prototype.addLine=function(i,a,u,d,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var b=0;b<i.length-1;b++)this.totalDistance+=i[b].dist(i[b+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var S=FO[a.type]==="Polygon",I=i.length;I>=2&&i[I-1].equals(i[I-2]);)I--;for(var k=0;k<I-1&&i[k].equals(i[k+1]);)k++;if(!(I<(S?3:2))){u==="bevel"&&(y=1.05);var R,z=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),W=void 0,nt=void 0,rt=void 0,ft=void 0;this.e1=this.e2=-1,S&&(ft=i[k].sub(R=i[I-2])._unit()._perp());for(var ut=k;ut<I;ut++)if(!(nt=ut===I-1?S?i[k+1]:void 0:i[ut+1])||!i[ut].equals(nt)){ft&&(rt=ft),R&&(W=R),R=i[ut],ft=nt?nt.sub(R)._unit()._perp():rt;var vt=(rt=rt||ft).add(ft);vt.x===0&&vt.y===0||vt._unit();var wt=rt.x*ft.x+rt.y*ft.y,St=vt.x*ft.x+vt.y*ft.y,At=St!==0?1/St:1/0,zt=2*Math.sqrt(2-2*St),Vt=St<NO&&W&&nt,Xt=rt.x*ft.y-rt.y*ft.x>0;if(Vt&&ut>k){var fe=R.dist(W);if(fe>2*z){var te=R.sub(R.sub(W)._mult(z/fe)._round());this.updateDistance(W,te),this.addCurrentVertex(te,rt,0,0,j),W=te}}var ye=W&&nt,ne=ye?u:S?"butt":d;if(ye&&ne==="round"&&(At<v?ne="miter":At<=2&&(ne="fakeround")),ne==="miter"&&At>y&&(ne="bevel"),ne==="bevel"&&(At>2&&(ne="flipbevel"),At<y&&(ne="miter")),W&&this.updateDistance(W,R),ne==="miter")vt._mult(At),this.addCurrentVertex(R,vt,0,0,j);else if(ne==="flipbevel"){if(At>100)vt=ft.mult(-1);else{var Ue=At*rt.add(ft).mag()/rt.sub(ft).mag();vt._perp()._mult(Ue*(Xt?-1:1))}this.addCurrentVertex(R,vt,0,0,j),this.addCurrentVertex(R,vt.mult(-1),0,0,j)}else if(ne==="bevel"||ne==="fakeround"){var Pe=-Math.sqrt(At*At-1),ce=Xt?Pe:0,He=Xt?0:Pe;if(W&&this.addCurrentVertex(R,rt,ce,He,j),ne==="fakeround")for(var Fe=Math.round(180*zt/Math.PI/20),Qe=1;Qe<Fe;Qe++){var ve=Qe/Fe;if(ve!==.5){var ln=ve-.5;ve+=ve*ln*(ve-1)*((1.0904+wt*(wt*(3.55645-1.43519*wt)-3.2452))*ln*ln+(.848013+wt*(.215638*wt-1.06021)))}var kn=ft.sub(rt)._mult(ve)._add(rt)._unit()._mult(Xt?-1:1);this.addHalfVertex(R,kn.x,kn.y,!1,Xt,0,j)}nt&&this.addCurrentVertex(R,ft,-ce,-He,j)}else if(ne==="butt")this.addCurrentVertex(R,vt,0,0,j);else if(ne==="square"){var Wn=W?1:-1;this.addCurrentVertex(R,vt,Wn,Wn,j)}else ne==="round"&&(W&&(this.addCurrentVertex(R,rt,0,0,j),this.addCurrentVertex(R,rt,1,1,j,!0)),nt&&(this.addCurrentVertex(R,ft,-1,-1,j,!0),this.addCurrentVertex(R,ft,0,0,j)));if(Vt&&ut<I-1){var Nn=R.dist(nt);if(Nn>2*z){var On=R.add(nt.sub(R)._mult(z/Nn)._round());this.updateDistance(R,On),this.addCurrentVertex(On,ft,0,0,j),R=On}}}}},ai.prototype.addCurrentVertex=function(i,a,u,d,y,v){v===void 0&&(v=!1);var b=a.y*d-a.x,S=-a.y-a.x*d;this.addHalfVertex(i,a.x+a.y*u,a.y-a.x*u,v,!1,u,y),this.addHalfVertex(i,b,S,v,!0,-d,y),this.distance>oT/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,a,u,d,y,v))},ai.prototype.addHalfVertex=function(i,a,u,d,y,v,b){var S=.5*(this.lineClips?this.scaledDistance*(oT-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i.x<<1)+(d?1:0),(i.y<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),y?this.e2=I:this.e1=I},ai.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ai.prototype.updateDistance=function(i,a){this.distance+=i.dist(a),this.updateScaledDistance()},se("LineBucket",ai,{omit:["layers","patternFeatures"]});var BO=new Nr({"line-cap":new me($.layout_line["line-cap"]),"line-join":new ue($.layout_line["line-join"]),"line-miter-limit":new me($.layout_line["line-miter-limit"]),"line-round-limit":new me($.layout_line["line-round-limit"]),"line-sort-key":new ue($.layout_line["line-sort-key"])}),sT={paint:new Nr({"line-opacity":new ue($.paint_line["line-opacity"]),"line-color":new ue($.paint_line["line-color"]),"line-translate":new me($.paint_line["line-translate"]),"line-translate-anchor":new me($.paint_line["line-translate-anchor"]),"line-width":new ue($.paint_line["line-width"]),"line-gap-width":new ue($.paint_line["line-gap-width"]),"line-offset":new ue($.paint_line["line-offset"]),"line-blur":new ue($.paint_line["line-blur"]),"line-dasharray":new Kr($.paint_line["line-dasharray"]),"line-pattern":new Vc($.paint_line["line-pattern"]),"line-gradient":new _o($.paint_line["line-gradient"])}),layout:BO},aT=new(function(i){function a(){i.apply(this,arguments)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(u,d){return d=new qe(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),i.prototype.possiblyEvaluate.call(this,u,d)},a.prototype.evaluate=function(u,d,y,v){return d=H({},d,{zoom:Math.floor(d.zoom)}),i.prototype.evaluate.call(this,u,d,y,v)},a}(ue))(sT.paint.properties["line-width"].specification);aT.useIntegerZoom=!0;var UO=function(i){function a(u){i.call(this,u,sT),this.gradientVersion=0}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ti,this.gradientVersion=(this.gradientVersion+1)%M)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(u,d){i.prototype.recalculate.call(this,u,d),this.paint._values["line-floorwidth"]=aT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},a.prototype.createBucket=function(u){return new ai(u)},a.prototype.queryRadius=function(u){var d=u,y=lT(Do("line-width",this,d),Do("line-gap-width",this,d)),v=Do("line-offset",this,d);return y/2+Math.abs(v)+xr(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(u,d,y,v,b,S,I){var k=ts(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,I),R=I/2*lT(this.paint.get("line-width").evaluate(d,y),this.paint.get("line-gap-width").evaluate(d,y)),z=this.paint.get("line-offset").evaluate(d,y);return z&&(v=function(j,W){for(var nt=[],rt=new w(0,0),ft=0;ft<j.length;ft++){for(var ut=j[ft],vt=[],wt=0;wt<ut.length;wt++){var St=ut[wt],At=ut[wt+1],zt=wt===0?rt:St.sub(ut[wt-1])._unit()._perp(),Vt=wt===ut.length-1?rt:At.sub(St)._unit()._perp(),Xt=zt._add(Vt)._unit();Xt._mult(1/(Xt.x*Vt.x+Xt.y*Vt.y)),vt.push(Xt._mult(W)._add(St))}nt.push(vt)}return nt}(v,z*I)),function(j,W,nt){for(var rt=0;rt<W.length;rt++){var ft=W[rt];if(j.length>=3){for(var ut=0;ut<ft.length;ut++)if(zo(j,ft[ut]))return!0}if(ro(j,ft,nt))return!0}return!1}(k,v,R)},a.prototype.isTileClipped=function(){return!0},a}(Oo);function lT(i,a){return a>0?a+2*i:i}var VO=Ar([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jO=Ar([{name:"a_projected_pos",components:3,type:"Float32"}],4),GO=(Ar([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ar([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),uT=(Ar([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ar([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),WO=Ar([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function HO(i,a,u){return i.sections.forEach(function(d){d.text=function(y,v,b){var S=v.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?y=y.toLocaleUpperCase():S==="lowercase"&&(y=y.toLocaleLowerCase()),Ui.applyArabicShaping&&(y=Ui.applyArabicShaping(y)),y}(d.text,a,u)}),i}Ar([{name:"triangle",components:3,type:"Uint16"}]),Ar([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ar([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ar([{type:"Float32",name:"offsetX"}]),Ar([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var tp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},cT=function(i,a,u,d,y){var v,b,S=8*y-d-1,I=(1<<S)-1,k=I>>1,R=-7,z=u?y-1:0,j=u?-1:1,W=i[a+z];for(z+=j,v=W&(1<<-R)-1,W>>=-R,R+=S;R>0;v=256*v+i[a+z],z+=j,R-=8);for(b=v&(1<<-R)-1,v>>=-R,R+=d;R>0;b=256*b+i[a+z],z+=j,R-=8);if(v===0)v=1-k;else{if(v===I)return b?NaN:1/0*(W?-1:1);b+=Math.pow(2,d),v-=k}return(W?-1:1)*b*Math.pow(2,v-d)},hT=function(i,a,u,d,y,v){var b,S,I,k=8*v-y-1,R=(1<<k)-1,z=R>>1,j=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=d?0:v-1,nt=d?1:-1,rt=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(S=isNaN(a)?1:0,b=R):(b=Math.floor(Math.log(a)/Math.LN2),a*(I=Math.pow(2,-b))<1&&(b--,I*=2),(a+=b+z>=1?j/I:j*Math.pow(2,1-z))*I>=2&&(b++,I/=2),b+z>=R?(S=0,b=R):b+z>=1?(S=(a*I-1)*Math.pow(2,y),b+=z):(S=a*Math.pow(2,z-1)*Math.pow(2,y),b=0));y>=8;i[u+W]=255&S,W+=nt,S/=256,y-=8);for(b=b<<y|S,k+=y;k>0;i[u+W]=255&b,W+=nt,b/=256,k-=8);i[u+W-nt]|=128*rt},zm=Sn;function Sn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Sn.Varint=0,Sn.Fixed64=1,Sn.Bytes=2,Sn.Fixed32=5;var fT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ra(i){return i.type===Sn.Bytes?i.readVarint()+i.pos:i.pos+1}function Kc(i,a,u){return u?4294967296*a+(i>>>0):4294967296*(a>>>0)+(i>>>0)}function pT(i,a,u){var d=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(d);for(var y=u.pos-1;y>=i;y--)u.buf[y+d]=u.buf[y]}function qO(i,a){for(var u=0;u<i.length;u++)a.writeVarint(i[u])}function ZO(i,a){for(var u=0;u<i.length;u++)a.writeSVarint(i[u])}function XO(i,a){for(var u=0;u<i.length;u++)a.writeFloat(i[u])}function $O(i,a){for(var u=0;u<i.length;u++)a.writeDouble(i[u])}function YO(i,a){for(var u=0;u<i.length;u++)a.writeBoolean(i[u])}function KO(i,a){for(var u=0;u<i.length;u++)a.writeFixed32(i[u])}function JO(i,a){for(var u=0;u<i.length;u++)a.writeSFixed32(i[u])}function QO(i,a){for(var u=0;u<i.length;u++)a.writeFixed64(i[u])}function t3(i,a){for(var u=0;u<i.length;u++)a.writeSFixed64(i[u])}function Dm(i,a){return(i[a]|i[a+1]<<8|i[a+2]<<16)+16777216*i[a+3]}function Jc(i,a,u){i[u]=a,i[u+1]=a>>>8,i[u+2]=a>>>16,i[u+3]=a>>>24}function dT(i,a){return(i[a]|i[a+1]<<8|i[a+2]<<16)+(i[a+3]<<24)}function e3(i,a,u){i===1&&u.readMessage(n3,a)}function n3(i,a,u){if(i===3){var d=u.readMessage(r3,{}),y=d.width,v=d.height,b=d.left,S=d.top,I=d.advance;a.push({id:d.id,bitmap:new zu({width:y+6,height:v+6},d.bitmap),metrics:{width:y,height:v,left:b,top:S,advance:I}})}}function r3(i,a,u){i===1?a.id=u.readVarint():i===2?a.bitmap=u.readBytes():i===3?a.width=u.readVarint():i===4?a.height=u.readVarint():i===5?a.left=u.readSVarint():i===6?a.top=u.readSVarint():i===7&&(a.advance=u.readVarint())}function mT(i){for(var a=0,u=0,d=0,y=i;d<y.length;d+=1){var v=y[d];a+=v.w*v.h,u=Math.max(u,v.w)}i.sort(function(rt,ft){return ft.h-rt.h});for(var b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}],S=0,I=0,k=0,R=i;k<R.length;k+=1)for(var z=R[k],j=b.length-1;j>=0;j--){var W=b[j];if(!(z.w>W.w||z.h>W.h)){if(z.x=W.x,z.y=W.y,I=Math.max(I,z.y+z.h),S=Math.max(S,z.x+z.w),z.w===W.w&&z.h===W.h){var nt=b.pop();j<b.length&&(b[j]=nt)}else z.h===W.h?(W.x+=z.w,W.w-=z.w):z.w===W.w?(W.y+=z.h,W.h-=z.h):(b.push({x:W.x+z.w,y:W.y,w:W.w-z.w,h:z.h}),W.y+=z.h,W.h-=z.h);break}}return{w:S,h:I,fill:a/(S*I)||0}}Sn.prototype={destroy:function(){this.buf=null},readFields:function(i,a,u){for(u=u||this.length;this.pos<u;){var d=this.readVarint(),y=d>>3,v=this.pos;this.type=7&d,i(y,a,this),this.pos===v&&this.skip(d)}return a},readMessage:function(i,a){return this.readFields(i,a,this.readVarint()+this.pos)},readFixed32:function(){var i=Dm(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=dT(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Dm(this.buf,this.pos)+4294967296*Dm(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=Dm(this.buf,this.pos)+4294967296*dT(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=cT(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=cT(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var a,u,d=this.buf;return a=127&(u=d[this.pos++]),u<128?a:(a|=(127&(u=d[this.pos++]))<<7,u<128?a:(a|=(127&(u=d[this.pos++]))<<14,u<128?a:(a|=(127&(u=d[this.pos++]))<<21,u<128?a:function(y,v,b){var S,I,k=b.buf;if(S=(112&(I=k[b.pos++]))>>4,I<128||(S|=(127&(I=k[b.pos++]))<<3,I<128)||(S|=(127&(I=k[b.pos++]))<<10,I<128)||(S|=(127&(I=k[b.pos++]))<<17,I<128)||(S|=(127&(I=k[b.pos++]))<<24,I<128)||(S|=(1&(I=k[b.pos++]))<<31,I<128))return Kc(y,S,v);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(u=d[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,a=this.pos;return this.pos=i,i-a>=12&&fT?function(u,d,y){return fT.decode(u.subarray(d,y))}(this.buf,a,i):function(u,d,y){for(var v="",b=d;b<y;){var S,I,k,R=u[b],z=null,j=R>239?4:R>223?3:R>191?2:1;if(b+j>y)break;j===1?R<128&&(z=R):j===2?(192&(S=u[b+1]))==128&&(z=(31&R)<<6|63&S)<=127&&(z=null):j===3?(I=u[b+2],(192&(S=u[b+1]))==128&&(192&I)==128&&((z=(15&R)<<12|(63&S)<<6|63&I)<=2047||z>=55296&&z<=57343)&&(z=null)):j===4&&(I=u[b+2],k=u[b+3],(192&(S=u[b+1]))==128&&(192&I)==128&&(192&k)==128&&((z=(15&R)<<18|(63&S)<<12|(63&I)<<6|63&k)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,j=1):z>65535&&(z-=65536,v+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),v+=String.fromCharCode(z),b+=j}return v}(this.buf,a,i)},readBytes:function(){var i=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,i);return this.pos=i,a},readPackedVarint:function(i,a){if(this.type!==Sn.Bytes)return i.push(this.readVarint(a));var u=Ra(this);for(i=i||[];this.pos<u;)i.push(this.readVarint(a));return i},readPackedSVarint:function(i){if(this.type!==Sn.Bytes)return i.push(this.readSVarint());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Sn.Bytes)return i.push(this.readBoolean());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Sn.Bytes)return i.push(this.readFloat());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Sn.Bytes)return i.push(this.readDouble());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Sn.Bytes)return i.push(this.readFixed32());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Sn.Bytes)return i.push(this.readSFixed32());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Sn.Bytes)return i.push(this.readFixed64());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Sn.Bytes)return i.push(this.readSFixed64());var a=Ra(this);for(i=i||[];this.pos<a;)i.push(this.readSFixed64());return i},skip:function(i){var a=7&i;if(a===Sn.Varint)for(;this.buf[this.pos++]>127;);else if(a===Sn.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Sn.Fixed32)this.pos+=4;else{if(a!==Sn.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(i,a){this.writeVarint(i<<3|a)},realloc:function(i){for(var a=this.length||16;a<this.pos+i;)a*=2;if(a!==this.length){var u=new Uint8Array(a);u.set(this.buf),this.buf=u,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Jc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Jc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Jc(this.buf,-1&i,this.pos),Jc(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Jc(this.buf,-1&i,this.pos),Jc(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(a,u){var d,y;if(a>=0?(d=a%4294967296|0,y=a/4294967296|0):(y=~(-a/4294967296),4294967295^(d=~(-a%4294967296))?d=d+1|0:(d=0,y=y+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,b,S){S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,S.buf[S.pos]=127&(v>>>=7)}(d,0,u),function(v,b){var S=(7&v)<<4;b.buf[b.pos++]|=S|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(y,u)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var a=this.pos;this.pos=function(d,y,v){for(var b,S,I=0;I<y.length;I++){if((b=y.charCodeAt(I))>55295&&b<57344){if(!S){b>56319||I+1===y.length?(d[v++]=239,d[v++]=191,d[v++]=189):S=b;continue}if(b<56320){d[v++]=239,d[v++]=191,d[v++]=189,S=b;continue}b=S-55296<<10|b-56320|65536,S=null}else S&&(d[v++]=239,d[v++]=191,d[v++]=189,S=null);b<128?d[v++]=b:(b<2048?d[v++]=b>>6|192:(b<65536?d[v++]=b>>12|224:(d[v++]=b>>18|240,d[v++]=b>>12&63|128),d[v++]=b>>6&63|128),d[v++]=63&b|128)}return v}(this.buf,i,this.pos);var u=this.pos-a;u>=128&&pT(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeFloat:function(i){this.realloc(4),hT(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),hT(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var a=i.length;this.writeVarint(a),this.realloc(a);for(var u=0;u<a;u++)this.buf[this.pos++]=i[u]},writeRawMessage:function(i,a){this.pos++;var u=this.pos;i(a,this);var d=this.pos-u;d>=128&&pT(u,d,this),this.pos=u-1,this.writeVarint(d),this.pos+=d},writeMessage:function(i,a,u){this.writeTag(i,Sn.Bytes),this.writeRawMessage(a,u)},writePackedVarint:function(i,a){a.length&&this.writeMessage(i,qO,a)},writePackedSVarint:function(i,a){a.length&&this.writeMessage(i,ZO,a)},writePackedBoolean:function(i,a){a.length&&this.writeMessage(i,YO,a)},writePackedFloat:function(i,a){a.length&&this.writeMessage(i,XO,a)},writePackedDouble:function(i,a){a.length&&this.writeMessage(i,$O,a)},writePackedFixed32:function(i,a){a.length&&this.writeMessage(i,KO,a)},writePackedSFixed32:function(i,a){a.length&&this.writeMessage(i,JO,a)},writePackedFixed64:function(i,a){a.length&&this.writeMessage(i,QO,a)},writePackedSFixed64:function(i,a){a.length&&this.writeMessage(i,t3,a)},writeBytesField:function(i,a){this.writeTag(i,Sn.Bytes),this.writeBytes(a)},writeFixed32Field:function(i,a){this.writeTag(i,Sn.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(i,a){this.writeTag(i,Sn.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(i,a){this.writeTag(i,Sn.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(i,a){this.writeTag(i,Sn.Fixed64),this.writeSFixed64(a)},writeVarintField:function(i,a){this.writeTag(i,Sn.Varint),this.writeVarint(a)},writeSVarintField:function(i,a){this.writeTag(i,Sn.Varint),this.writeSVarint(a)},writeStringField:function(i,a){this.writeTag(i,Sn.Bytes),this.writeString(a)},writeFloatField:function(i,a){this.writeTag(i,Sn.Fixed32),this.writeFloat(a)},writeDoubleField:function(i,a){this.writeTag(i,Sn.Fixed64),this.writeDouble(a)},writeBooleanField:function(i,a){this.writeVarintField(i,Boolean(a))}};var Fm=function(i,a){var u=a.pixelRatio,d=a.version,y=a.stretchX,v=a.stretchY,b=a.content;this.paddedRect=i,this.pixelRatio=u,this.stretchX=y,this.stretchY=v,this.content=b,this.version=d},ep={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};ep.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},ep.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},ep.tlbr.get=function(){return this.tl.concat(this.br)},ep.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Fm.prototype,ep);var np=function(i,a){var u={},d={};this.haveRenderCallbacks=[];var y=[];this.addImages(i,u,y),this.addImages(a,d,y);var v=mT(y),b=new Mi({width:v.w||1,height:v.h||1});for(var S in i){var I=i[S],k=u[S].paddedRect;Mi.copy(I.data,b,{x:0,y:0},{x:k.x+1,y:k.y+1},I.data)}for(var R in a){var z=a[R],j=d[R].paddedRect,W=j.x+1,nt=j.y+1,rt=z.data.width,ft=z.data.height;Mi.copy(z.data,b,{x:0,y:0},{x:W,y:nt},z.data),Mi.copy(z.data,b,{x:0,y:ft-1},{x:W,y:nt-1},{width:rt,height:1}),Mi.copy(z.data,b,{x:0,y:0},{x:W,y:nt+ft},{width:rt,height:1}),Mi.copy(z.data,b,{x:rt-1,y:0},{x:W-1,y:nt},{width:1,height:ft}),Mi.copy(z.data,b,{x:0,y:0},{x:W+rt,y:nt},{width:1,height:ft})}this.image=b,this.iconPositions=u,this.patternPositions=d};np.prototype.addImages=function(i,a,u){for(var d in i){var y=i[d],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(v),a[d]=new Fm(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},np.prototype.patchUpdatedImages=function(i,a){for(var u in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),a)},np.prototype.patchUpdatedImage=function(i,a,u){if(i&&a&&i.version!==a.version){i.version=a.version;var d=i.tl;u.update(a.data,void 0,{x:d[0],y:d[1]})}},se("ImagePosition",Fm),se("ImageAtlas",np);var io={horizontal:1,vertical:2,horizontalOnly:3},Qc=function(){this.scale=1,this.fontStack="",this.imageName=null};Qc.forText=function(i,a){var u=new Qc;return u.scale=i||1,u.fontStack=a,u},Qc.forImage=function(i){var a=new Qc;return a.imageName=i,a};var Qr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Nm(i,a,u,d,y,v,b,S,I,k,R,z,j,W,nt,rt){var ft,ut=Qr.fromFeature(i,y);z===io.vertical&&ut.verticalizePunctuation();var vt=Ui.processBidirectionalText,wt=Ui.processStyledBidirectionalText;if(vt&&ut.sections.length===1){ft=[];for(var St=0,At=vt(ut.toString(),I_(ut,k,v,a,d,W,nt));St<At.length;St+=1){var zt=At[St],Vt=new Qr;Vt.text=zt,Vt.sections=ut.sections;for(var Xt=0;Xt<zt.length;Xt++)Vt.sectionIndex.push(0);ft.push(Vt)}}else if(wt){ft=[];for(var fe=0,te=wt(ut.text,ut.sectionIndex,I_(ut,k,v,a,d,W,nt));fe<te.length;fe+=1){var ye=te[fe],ne=new Qr;ne.text=ye[0],ne.sectionIndex=ye[1],ne.sections=ut.sections,ft.push(ne)}}else ft=function(ce,He){for(var Fe=[],Qe=ce.text,ve=0,ln=0,kn=He;ln<kn.length;ln+=1){var Wn=kn[ln];Fe.push(ce.substring(ve,Wn)),ve=Wn}return ve<Qe.length&&Fe.push(ce.substring(ve,Qe.length)),Fe}(ut,I_(ut,k,v,a,d,W,nt));var Ue=[],Pe={positionedLines:Ue,text:ut.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(ce,He,Fe,Qe,ve,ln,kn,Wn,Nn,On,Hn,br){for(var wr=0,ti=-17,Mr=0,ei=0,Yn=Wn==="right"?1:Wn==="left"?0:.5,Lr=0,Xe=0,xn=ve;Xe<xn.length;Xe+=1){var yn=xn[Xe];yn.trim();var nn=yn.getMaxScale(),li=24*(nn-1),qr={positionedGlyphs:[],lineOffset:0};ce.positionedLines[Lr]=qr;var An=qr.positionedGlyphs,or=0;if(yn.length()){for(var Zr=0;Zr<yn.length();Zr++){var un=yn.getSection(Zr),Vs=yn.getSectionIndex(Zr),oo=yn.getCharCode(Zr),js=0,Kn=null,Gs=null,Fo=null,ah=24,Bu=!(Nn===io.horizontal||!Hn&&!Nc(oo)||Hn&&(Bm[oo]||(Na=oo,$t.Arabic(Na)||$t["Arabic Supplement"](Na)||$t["Arabic Extended-A"](Na)||$t["Arabic Presentation Forms-A"](Na)||$t["Arabic Presentation Forms-B"](Na))));if(un.imageName){var lh=Qe[un.imageName];if(!lh)continue;Fo=un.imageName,ce.iconsInText=ce.iconsInText||!0,Gs=lh.paddedRect;var Fa=lh.displaySize;un.scale=24*un.scale/br,js=li+(24-Fa[1]*un.scale),ah=(Kn={width:Fa[0],height:Fa[1],left:1,top:-3,advance:Bu?Fa[1]:Fa[0]}).advance;var uh=Bu?Fa[0]*un.scale-24*nn:Fa[1]*un.scale-24*nn;uh>0&&uh>or&&(or=uh)}else{var Xm=Fe[un.fontStack],ch=Xm&&Xm[oo];if(ch&&ch.rect)Gs=ch.rect,Kn=ch.metrics;else{var op=He[un.fontStack],$m=op&&op[oo];if(!$m)continue;Kn=$m.metrics}js=24*(nn-un.scale)}Bu?(ce.verticalizable=!0,An.push({glyph:oo,imageName:Fo,x:wr,y:ti+js,vertical:Bu,scale:un.scale,fontStack:un.fontStack,sectionIndex:Vs,metrics:Kn,rect:Gs}),wr+=ah*un.scale+On):(An.push({glyph:oo,imageName:Fo,x:wr,y:ti+js,vertical:Bu,scale:un.scale,fontStack:un.fontStack,sectionIndex:Vs,metrics:Kn,rect:Gs}),wr+=Kn.advance*un.scale+On)}An.length!==0&&(Mr=Math.max(wr-On,Mr),o3(An,0,An.length-1,Yn,or)),wr=0;var Ym=ln*nn+or;qr.lineOffset=Math.max(or,li),ti+=Ym,ei=Math.max(Ym,ei),++Lr}else ti+=ln,++Lr}var Na,sp=ti- -17,hh=M_(kn),Ll=hh.horizontalAlign,fh=hh.verticalAlign;(function(Km,Jm,ap,lp,Qm,up,cp,hp,tg){var ph,eg=(Jm-ap)*Qm;ph=up!==cp?-hp*lp- -17:(-lp*tg+.5)*cp;for(var dh=0,fp=Km;dh<fp.length;dh+=1)for(var Uu=0,pp=fp[dh].positionedGlyphs;Uu<pp.length;Uu+=1){var mh=pp[Uu];mh.x+=eg,mh.y+=ph}})(ce.positionedLines,Yn,Ll,fh,Mr,ei,ln,sp,ve.length),ce.top+=-fh*sp,ce.bottom=ce.top+sp,ce.left+=-Ll*Mr,ce.right=ce.left+Mr}(Pe,a,u,d,ft,b,S,I,z,k,j,rt),!function(ce){for(var He=0,Fe=ce;He<Fe.length;He+=1)if(Fe[He].positionedGlyphs.length!==0)return!1;return!0}(Ue)&&Pe}Qr.fromFeature=function(i,a){for(var u=new Qr,d=0;d<i.sections.length;d++){var y=i.sections[d];y.image?u.addImageSection(y):u.addTextSection(y,a)}return u},Qr.prototype.length=function(){return this.text.length},Qr.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},Qr.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},Qr.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},Qr.prototype.verticalizePunctuation=function(){this.text=function(i){for(var a="",u=0;u<i.length;u++){var d=i.charCodeAt(u+1)||null,y=i.charCodeAt(u-1)||null;a+=d&&Bf(d)&&!tp[i[u+1]]||y&&Bf(y)&&!tp[i[u-1]]||!tp[i[u]]?i[u]:tp[i[u]]}return a}(this.text)},Qr.prototype.trim=function(){for(var i=0,a=0;a<this.text.length&&Bm[this.text.charCodeAt(a)];a++)i++;for(var u=this.text.length,d=this.text.length-1;d>=0&&d>=i&&Bm[this.text.charCodeAt(d)];d--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)},Qr.prototype.substring=function(i,a){var u=new Qr;return u.text=this.text.substring(i,a),u.sectionIndex=this.sectionIndex.slice(i,a),u.sections=this.sections,u},Qr.prototype.toString=function(){return this.text},Qr.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(a,u){return Math.max(a,i.sections[u].scale)},0)},Qr.prototype.addTextSection=function(i,a){this.text+=i.text,this.sections.push(Qc.forText(i.scale,i.fontStack||a));for(var u=this.sections.length-1,d=0;d<i.text.length;++d)this.sectionIndex.push(u)},Qr.prototype.addImageSection=function(i){var a=i.image?i.image.name:"";if(a.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Qc.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ae("Reached maximum number of images 6401")}else ae("Can't add FormattedSection with an empty image.")},Qr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ji={};function gT(i,a,u,d,y,v){if(a.imageName){var b=d[a.imageName];return b?b.displaySize[0]*a.scale*24/v+y:0}var S=u[a.fontStack],I=S&&S[i];return I?I.metrics.advance*a.scale+y:0}function yT(i,a,u,d){var y=Math.pow(i-a,2);return d?i<a?y/2:2*y:y+Math.abs(u)*u}function i3(i,a,u){var d=0;return i===10&&(d-=1e4),u&&(d+=150),i!==40&&i!==65288||(d+=50),a!==41&&a!==65289||(d+=50),d}function vT(i,a,u,d,y,v){for(var b=null,S=yT(a,u,y,v),I=0,k=d;I<k.length;I+=1){var R=k[I],z=yT(a-R.x,u,y,v)+R.badness;z<=S&&(b=R,S=z)}return{index:i,x:a,priorBreak:b,badness:S}}function I_(i,a,u,d,y,v,b){if(v!=="point")return[];if(!i)return[];for(var S,I=[],k=function(ft,ut,vt,wt,St,At){for(var zt=0,Vt=0;Vt<ft.length();Vt++){var Xt=ft.getSection(Vt);zt+=gT(ft.getCharCode(Vt),Xt,wt,St,ut,At)}return zt/Math.max(1,Math.ceil(zt/vt))}(i,a,u,d,y,b),R=i.text.indexOf("​")>=0,z=0,j=0;j<i.length();j++){var W=i.getSection(j),nt=i.getCharCode(j);if(Bm[nt]||(z+=gT(nt,W,d,y,a,b)),j<i.length()-1){var rt=!((S=nt)<11904||!($t["Bopomofo Extended"](S)||$t.Bopomofo(S)||$t["CJK Compatibility Forms"](S)||$t["CJK Compatibility Ideographs"](S)||$t["CJK Compatibility"](S)||$t["CJK Radicals Supplement"](S)||$t["CJK Strokes"](S)||$t["CJK Symbols and Punctuation"](S)||$t["CJK Unified Ideographs Extension A"](S)||$t["CJK Unified Ideographs"](S)||$t["Enclosed CJK Letters and Months"](S)||$t["Halfwidth and Fullwidth Forms"](S)||$t.Hiragana(S)||$t["Ideographic Description Characters"](S)||$t["Kangxi Radicals"](S)||$t["Katakana Phonetic Extensions"](S)||$t.Katakana(S)||$t["Vertical Forms"](S)||$t["Yi Radicals"](S)||$t["Yi Syllables"](S)));(ji[nt]||rt||W.imageName)&&I.push(vT(j+1,z,k,I,i3(nt,i.getCharCode(j+1),rt&&R),!1))}}return function ft(ut){return ut?ft(ut.priorBreak).concat(ut.index):[]}(vT(i.length(),z,k,I,0,!0))}function M_(i){var a=.5,u=.5;switch(i){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function o3(i,a,u,d,y){if(d||y)for(var v=i[u],b=(i[u].x+v.metrics.advance*v.scale)*d,S=a;S<=u;S++)i[S].x-=b,i[S].y+=y}function _T(i,a,u,d,y,v){var b,S=i.image;if(S.content){var I=S.content,k=S.pixelRatio||1;b=[I[0]/k,I[1]/k,S.displaySize[0]-I[2]/k,S.displaySize[1]-I[3]/k]}var R,z,j,W,nt=a.left*v,rt=a.right*v;u==="width"||u==="both"?(W=y[0]+nt-d[3],z=y[0]+rt+d[1]):z=(W=y[0]+(nt+rt-S.displaySize[0])/2)+S.displaySize[0];var ft=a.top*v,ut=a.bottom*v;return u==="height"||u==="both"?(R=y[1]+ft-d[0],j=y[1]+ut+d[2]):j=(R=y[1]+(ft+ut-S.displaySize[1])/2)+S.displaySize[1],{image:S,top:R,right:z,bottom:j,left:W,collisionPadding:b}}ji[10]=!0,ji[32]=!0,ji[38]=!0,ji[40]=!0,ji[41]=!0,ji[43]=!0,ji[45]=!0,ji[47]=!0,ji[173]=!0,ji[183]=!0,ji[8203]=!0,ji[8208]=!0,ji[8211]=!0,ji[8231]=!0;var th=function(i){function a(u,d,y,v){i.call(this,u,d),this.angle=y,v!==void 0&&(this.segment=v)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(w);function L_(i,a){var u=a.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new qe(i+1))};if(u.kind==="source")return{kind:"source"};for(var d=u.zoomStops,y=u.interpolationType,v=0;v<d.length&&d[v]<=i;)v++;for(var b=v=Math.max(0,v-1);b<d.length&&d[b]<i+1;)b++;b=Math.min(d.length-1,b);var S=d[v],I=d[b];return u.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:I,interpolationType:y}:{kind:"camera",minZoom:S,maxZoom:I,minSize:u.evaluate(new qe(S)),maxSize:u.evaluate(new qe(I)),interpolationType:y}}function xT(i,a,u){var d=a.uSize,y=u.lowerSize;return i.kind==="source"?y/128:i.kind==="composite"?rr(y/128,u.upperSize/128,a.uSizeT):d}function bT(i,a){var u=0,d=0;if(i.kind==="constant")d=i.layoutSize;else if(i.kind!=="source"){var y=i.interpolationType,v=y?B(Dr.interpolationFactor(y,a,i.minZoom,i.maxZoom),0,1):0;i.kind==="camera"?d=rr(i.minSize,i.maxSize,v):u=v}return{uSizeT:u,uSize:d}}se("Anchor",th);var s3=Object.freeze({__proto__:null,getSizeData:L_,evaluateSizeForFeature:xT,evaluateSizeForZoom:bT,SIZE_PACK_FACTOR:128});function wT(i,a,u,d,y){if(a.segment===void 0)return!0;for(var v=a,b=a.segment+1,S=0;S>-u/2;){if(--b<0)return!1;S-=i[b].dist(v),v=i[b]}S+=i[b].dist(i[b+1]),b++;for(var I=[],k=0;S<u/2;){var R=i[b],z=i[b+1];if(!z)return!1;var j=i[b-1].angleTo(R)-R.angleTo(z);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:S,angleDelta:j}),k+=j;S-I[0].distance>d;)k-=I.shift().angleDelta;if(k>y)return!1;b++,S+=R.dist(z)}return!0}function TT(i){for(var a=0,u=0;u<i.length-1;u++)a+=i[u].dist(i[u+1]);return a}function ET(i,a,u){return i?.6*a*u:0}function ST(i,a){return Math.max(i?i.right-i.left:0,a?a.right-a.left:0)}function a3(i,a,u,d,y,v){for(var b=ET(u,y,v),S=ST(u,d)*v,I=0,k=TT(i)/2,R=0;R<i.length-1;R++){var z=i[R],j=i[R+1],W=z.dist(j);if(I+W>k){var nt=(k-I)/W,rt=rr(z.x,j.x,nt),ft=rr(z.y,j.y,nt),ut=new th(rt,ft,j.angleTo(z),R);return ut._round(),!b||wT(i,ut,S,b,a)?ut:void 0}I+=W}}function l3(i,a,u,d,y,v,b,S,I){var k=ET(d,v,b),R=ST(d,y),z=R*b,j=i[0].x===0||i[0].x===I||i[0].y===0||i[0].y===I;return a-z<a/4&&(a=z+a/4),function W(nt,rt,ft,ut,vt,wt,St,At,zt){for(var Vt=wt/2,Xt=TT(nt),fe=0,te=rt-ft,ye=[],ne=0;ne<nt.length-1;ne++){for(var Ue=nt[ne],Pe=nt[ne+1],ce=Ue.dist(Pe),He=Pe.angleTo(Ue);te+ft<fe+ce;){var Fe=((te+=ft)-fe)/ce,Qe=rr(Ue.x,Pe.x,Fe),ve=rr(Ue.y,Pe.y,Fe);if(Qe>=0&&Qe<zt&&ve>=0&&ve<zt&&te-Vt>=0&&te+Vt<=Xt){var ln=new th(Qe,ve,He,ne);ln._round(),ut&&!wT(nt,ln,wt,ut,vt)||ye.push(ln)}}fe+=ce}return At||ye.length||St||(ye=W(nt,fe/2,ft,ut,vt,wt,St,!0,zt)),ye}(i,j?a/2*S%a:(R/2+2*v)*b*S%a,a,k,u,z,j,!1,I)}function PT(i,a,u,d,y){for(var v=[],b=0;b<i.length;b++)for(var S=i[b],I=void 0,k=0;k<S.length-1;k++){var R=S[k],z=S[k+1];R.x<a&&z.x<a||(R.x<a?R=new w(a,R.y+(a-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x<a&&(z=new w(a,R.y+(a-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y<u&&z.y<u||(R.y<u?R=new w(R.x+(u-R.y)/(z.y-R.y)*(z.x-R.x),u)._round():z.y<u&&(z=new w(R.x+(u-R.y)/(z.y-R.y)*(z.x-R.x),u)._round()),R.x>=d&&z.x>=d||(R.x>=d?R=new w(d,R.y+(d-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x>=d&&(z=new w(d,R.y+(d-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y>=y&&z.y>=y||(R.y>=y?R=new w(R.x+(y-R.y)/(z.y-R.y)*(z.x-R.x),y)._round():z.y>=y&&(z=new w(R.x+(y-R.y)/(z.y-R.y)*(z.x-R.x),y)._round()),I&&R.equals(I[I.length-1])||v.push(I=[R]),I.push(z)))))}return v}function AT(i,a,u,d){var y=[],v=i.image,b=v.pixelRatio,S=v.paddedRect.w-2,I=v.paddedRect.h-2,k=i.right-i.left,R=i.bottom-i.top,z=v.stretchX||[[0,S]],j=v.stretchY||[[0,I]],W=function(Qe,ve){return Qe+ve[1]-ve[0]},nt=z.reduce(W,0),rt=j.reduce(W,0),ft=S-nt,ut=I-rt,vt=0,wt=nt,St=0,At=rt,zt=0,Vt=ft,Xt=0,fe=ut;if(v.content&&d){var te=v.content;vt=Um(z,0,te[0]),St=Um(j,0,te[1]),wt=Um(z,te[0],te[2]),At=Um(j,te[1],te[3]),zt=te[0]-vt,Xt=te[1]-St,Vt=te[2]-te[0]-wt,fe=te[3]-te[1]-At}var ye=function(Qe,ve,ln,kn){var Wn=Vm(Qe.stretch-vt,wt,k,i.left),Nn=jm(Qe.fixed-zt,Vt,Qe.stretch,nt),On=Vm(ve.stretch-St,At,R,i.top),Hn=jm(ve.fixed-Xt,fe,ve.stretch,rt),br=Vm(ln.stretch-vt,wt,k,i.left),wr=jm(ln.fixed-zt,Vt,ln.stretch,nt),ti=Vm(kn.stretch-St,At,R,i.top),Mr=jm(kn.fixed-Xt,fe,kn.stretch,rt),ei=new w(Wn,On),Yn=new w(br,On),Lr=new w(br,ti),Xe=new w(Wn,ti),xn=new w(Nn/b,Hn/b),yn=new w(wr/b,Mr/b),nn=a*Math.PI/180;if(nn){var li=Math.sin(nn),qr=Math.cos(nn),An=[qr,-li,li,qr];ei._matMult(An),Yn._matMult(An),Xe._matMult(An),Lr._matMult(An)}var or=Qe.stretch+Qe.fixed,Zr=ve.stretch+ve.fixed;return{tl:ei,tr:Yn,bl:Xe,br:Lr,tex:{x:v.paddedRect.x+1+or,y:v.paddedRect.y+1+Zr,w:ln.stretch+ln.fixed-or,h:kn.stretch+kn.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:yn,minFontScaleX:Vt/b/k,minFontScaleY:fe/b/R,isSDF:u}};if(d&&(v.stretchX||v.stretchY))for(var ne=CT(z,ft,nt),Ue=CT(j,ut,rt),Pe=0;Pe<ne.length-1;Pe++)for(var ce=ne[Pe],He=ne[Pe+1],Fe=0;Fe<Ue.length-1;Fe++)y.push(ye(ce,Ue[Fe],He,Ue[Fe+1]));else y.push(ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:I+1}));return y}function Um(i,a,u){for(var d=0,y=0,v=i;y<v.length;y+=1){var b=v[y];d+=Math.max(a,Math.min(u,b[1]))-Math.max(a,Math.min(u,b[0]))}return d}function CT(i,a,u){for(var d=[{fixed:-1,stretch:0}],y=0,v=i;y<v.length;y+=1){var b=v[y],S=b[0],I=b[1],k=d[d.length-1];d.push({fixed:S-k.stretch,stretch:k.stretch}),d.push({fixed:S-k.stretch,stretch:k.stretch+(I-S)})}return d.push({fixed:a+1,stretch:u}),d}function Vm(i,a,u,d){return i/a*u+d}function jm(i,a,u,d){return i-a*u/d}var Gm=function(i,a,u,d,y,v,b,S,I,k){if(this.boxStartIndex=i.length,I){var R=v.top,z=v.bottom,j=v.collisionPadding;j&&(R-=j[1],z+=j[3]);var W=z-R;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{var nt=v.top*b-S,rt=v.bottom*b+S,ft=v.left*b-S,ut=v.right*b+S,vt=v.collisionPadding;if(vt&&(ft-=vt[0]*b,nt-=vt[1]*b,ut+=vt[2]*b,rt+=vt[3]*b),k){var wt=new w(ft,nt),St=new w(ut,nt),At=new w(ft,rt),zt=new w(ut,rt),Vt=k*Math.PI/180;wt._rotate(Vt),St._rotate(Vt),At._rotate(Vt),zt._rotate(Vt),ft=Math.min(wt.x,St.x,At.x,zt.x),ut=Math.max(wt.x,St.x,At.x,zt.x),nt=Math.min(wt.y,St.y,At.y,zt.y),rt=Math.max(wt.y,St.y,At.y,zt.y)}i.emplaceBack(a.x,a.y,ft,nt,ut,rt,u,d,y)}this.boxEndIndex=i.length},eh=function(i,a){if(i===void 0&&(i=[]),a===void 0&&(a=u3),this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function u3(i,a){return i<a?-1:i>a?1:0}function c3(i,a,u){a===void 0&&(a=1),u===void 0&&(u=!1);for(var d=1/0,y=1/0,v=-1/0,b=-1/0,S=i[0],I=0;I<S.length;I++){var k=S[I];(!I||k.x<d)&&(d=k.x),(!I||k.y<y)&&(y=k.y),(!I||k.x>v)&&(v=k.x),(!I||k.y>b)&&(b=k.y)}var R=Math.min(v-d,b-y),z=R/2,j=new eh([],h3);if(R===0)return new w(d,y);for(var W=d;W<v;W+=R)for(var nt=y;nt<b;nt+=R)j.push(new nh(W+z,nt+z,z,i));for(var rt=function(vt){for(var wt=0,St=0,At=0,zt=vt[0],Vt=0,Xt=zt.length,fe=Xt-1;Vt<Xt;fe=Vt++){var te=zt[Vt],ye=zt[fe],ne=te.x*ye.y-ye.x*te.y;St+=(te.x+ye.x)*ne,At+=(te.y+ye.y)*ne,wt+=3*ne}return new nh(St/wt,At/wt,0,vt)}(i),ft=j.length;j.length;){var ut=j.pop();(ut.d>rt.d||!rt.d)&&(rt=ut,u&&console.log("found best %d after %d probes",Math.round(1e4*ut.d)/1e4,ft)),ut.max-rt.d<=a||(j.push(new nh(ut.p.x-(z=ut.h/2),ut.p.y-z,z,i)),j.push(new nh(ut.p.x+z,ut.p.y-z,z,i)),j.push(new nh(ut.p.x-z,ut.p.y+z,z,i)),j.push(new nh(ut.p.x+z,ut.p.y+z,z,i)),ft+=4)}return u&&(console.log("num probes: "+ft),console.log("best distance: "+rt.d)),rt.p}function h3(i,a){return a.max-i.max}function nh(i,a,u,d){this.p=new w(i,a),this.h=u,this.d=function(y,v){for(var b=!1,S=1/0,I=0;I<v.length;I++)for(var k=v[I],R=0,z=k.length,j=z-1;R<z;j=R++){var W=k[R],nt=k[j];W.y>y.y!=nt.y>y.y&&y.x<(nt.x-W.x)*(y.y-W.y)/(nt.y-W.y)+W.x&&(b=!b),S=Math.min(S,Al(y,W,nt))}return(b?1:-1)*Math.sqrt(S)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}eh.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},eh.prototype.pop=function(){if(this.length!==0){var i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}},eh.prototype.peek=function(){return this.data[0]},eh.prototype._up=function(i){for(var a=this.data,u=this.compare,d=a[i];i>0;){var y=i-1>>1,v=a[y];if(u(d,v)>=0)break;a[i]=v,i=y}a[i]=d},eh.prototype._down=function(i){for(var a=this.data,u=this.compare,d=this.length>>1,y=a[i];i<d;){var v=1+(i<<1),b=a[v],S=v+1;if(S<this.length&&u(a[S],b)<0&&(v=S,b=a[S]),u(b,y)>=0)break;a[i]=b,i=v}a[i]=y};var k_=Number.POSITIVE_INFINITY;function IT(i,a){return a[1]!==k_?function(u,d,y){var v=0,b=0;switch(d=Math.abs(d),y=Math.abs(y),u){case"top-right":case"top-left":case"top":b=y-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-y}switch(u){case"top-right":case"bottom-right":case"right":v=-d;break;case"top-left":case"bottom-left":case"left":v=d}return[v,b]}(i,a[0],a[1]):function(u,d){var y=0,v=0;d<0&&(d=0);var b=d/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-d;break;case"top":v=d-7}switch(u){case"top-right":case"bottom-right":y=-b;break;case"top-left":case"bottom-left":y=b;break;case"left":y=d;break;case"right":y=-d}return[y,v]}(i,a[0])}function O_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function MT(i,a,u,d,y,v,b,S,I,k,R,z,j,W,nt){var rt=function(St,At,zt,Vt,Xt,fe,te,ye){for(var ne=Vt.layout.get("text-rotate").evaluate(fe,{})*Math.PI/180,Ue=[],Pe=0,ce=At.positionedLines;Pe<ce.length;Pe+=1)for(var He=ce[Pe],Fe=0,Qe=He.positionedGlyphs;Fe<Qe.length;Fe+=1){var ve=Qe[Fe];if(ve.rect){var ln=ve.rect||{},kn=4,Wn=!0,Nn=1,On=0,Hn=(Xt||ye)&&ve.vertical,br=ve.metrics.advance*ve.scale/2;if(ye&&At.verticalizable&&(On=He.lineOffset/2-(ve.imageName?-(24-ve.metrics.width*ve.scale)/2:24*(ve.scale-1))),ve.imageName){var wr=te[ve.imageName];Wn=wr.sdf,kn=1/(Nn=wr.pixelRatio)}var ti=Xt?[ve.x+br,ve.y]:[0,0],Mr=Xt?[0,0]:[ve.x+br+zt[0],ve.y+zt[1]-On],ei=[0,0];Hn&&(ei=Mr,Mr=[0,0]);var Yn=(ve.metrics.left-kn)*ve.scale-br+Mr[0],Lr=(-ve.metrics.top-kn)*ve.scale+Mr[1],Xe=Yn+ln.w*ve.scale/Nn,xn=Lr+ln.h*ve.scale/Nn,yn=new w(Yn,Lr),nn=new w(Xe,Lr),li=new w(Yn,xn),qr=new w(Xe,xn);if(Hn){var An=new w(-br,br- -17),or=-Math.PI/2,Zr=12-br,un=new w(22-Zr,-(ve.imageName?Zr:0)),Vs=new(Function.prototype.bind.apply(w,[null].concat(ei)));yn._rotateAround(or,An)._add(un)._add(Vs),nn._rotateAround(or,An)._add(un)._add(Vs),li._rotateAround(or,An)._add(un)._add(Vs),qr._rotateAround(or,An)._add(un)._add(Vs)}if(ne){var oo=Math.sin(ne),js=Math.cos(ne),Kn=[js,-oo,oo,js];yn._matMult(Kn),nn._matMult(Kn),li._matMult(Kn),qr._matMult(Kn)}var Gs=new w(0,0),Fo=new w(0,0);Ue.push({tl:yn,tr:nn,bl:li,br:qr,tex:ln,writingMode:At.writingMode,glyphOffset:ti,sectionIndex:ve.sectionIndex,isSDF:Wn,pixelOffsetTL:Gs,pixelOffsetBR:Fo,minFontScaleX:0,minFontScaleY:0})}}return Ue}(0,u,S,y,v,b,d,i.allowVerticalPlacement),ft=i.textSizeData,ut=null;ft.kind==="source"?(ut=[128*y.layout.get("text-size").evaluate(b,{})])[0]>32640&&ae(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ft.kind==="composite"&&((ut=[128*W.compositeTextSizes[0].evaluate(b,{},nt),128*W.compositeTextSizes[1].evaluate(b,{},nt)])[0]>32640||ut[1]>32640)&&ae(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),i.addSymbols(i.text,rt,ut,S,v,b,k,a,I.lineStartIndex,I.lineLength,j,nt);for(var vt=0,wt=R;vt<wt.length;vt+=1)z[wt[vt]]=i.text.placedSymbolArray.length-1;return 4*rt.length}function LT(i){for(var a in i)return i[a];return null}function f3(i,a,u,d){var y=i.compareText;if(a in y){for(var v=y[a],b=v.length-1;b>=0;b--)if(d.dist(v[b])<u)return!0}else y[a]=[];return y[a].push(d),!1}var p3=Yc.VectorTileFeature.types,d3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wm(i,a,u,d,y,v,b,S,I,k,R,z,j){var W=S?Math.min(32640,Math.round(S[0])):0,nt=S?Math.min(32640,Math.round(S[1])):0;i.emplaceBack(a,u,Math.round(32*d),Math.round(32*y),v,b,(W<<1)+(I?1:0),nt,16*k,16*R,256*z,256*j)}function R_(i,a,u){i.emplaceBack(a.x,a.y,u),i.emplaceBack(a.x,a.y,u),i.emplaceBack(a.x,a.y,u),i.emplaceBack(a.x,a.y,u)}function m3(i){for(var a=0,u=i.sections;a<u.length;a+=1)if(Bc(u[a].text))return!0;return!1}var rh=function(i){this.layoutVertexArray=new Gc,this.indexArray=new zs,this.programConfigurations=i,this.segments=new Y,this.dynamicLayoutVertexArray=new El,this.opacityVertexArray=new Iu,this.placedSymbolArray=new m};rh.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},rh.prototype.upload=function(i,a,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,VO.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,jO.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,d3,!0),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(i))},rh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},se("SymbolBuffers",rh);var rp=function(i,a,u){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new u,this.segments=new Y,this.collisionVertexArray=new Hf};rp.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,GO.members,!0)},rp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},se("CollisionBuffers",rp);var vn=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(v){return v.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vi([]),this.placementViewportMatrix=Vi([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=L_(this.zoom,a["text-size"]),this.iconSizeData=L_(this.zoom,a["icon-size"]);var u=this.layers[0].layout,d=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(v){return io[v]})),this.stateDependentLayerIds=this.layers.filter(function(v){return v.isStateDependent()}).map(function(v){return v.id}),this.sourceID=i.sourceID};vn.prototype.createArrays=function(){this.text=new rh(new Ee(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new rh(new Ee(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new E,this.lineVertexArray=new C,this.symbolInstances=new T},vn.prototype.calculateGlyphDependencies=function(i,a,u,d,y){for(var v=0;v<i.length;v++)if(a[i.charCodeAt(v)]=!0,(u||d)&&y){var b=tp[i.charAt(v)];b&&(a[b.charCodeAt(0)]=!0)}},vn.prototype.populate=function(i,a,u){var d=this.layers[0],y=d.layout,v=y.get("text-font"),b=y.get("text-field"),S=y.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Vn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),k=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,R=y.get("symbol-sort-key");if(this.features=[],I||k){for(var z=a.iconDependencies,j=a.glyphDependencies,W=a.availableImages,nt=new qe(this.zoom),rt=0,ft=i;rt<ft.length;rt+=1){var ut=ft[rt],vt=ut.feature,wt=ut.id,St=ut.index,At=ut.sourceLayerIndex,zt=d._featureFilter.needGeometry,Vt=$n(vt,zt);if(d._featureFilter.filter(nt,Vt,u)){zt||(Vt.geometry=Fn(vt));var Xt=void 0;if(I){var fe=d.getValueAndResolveTokens("text-field",Vt,u,W),te=Vn.factory(fe);m3(te)&&(this.hasRTLText=!0),(!this.hasRTLText||Vf()==="unavailable"||this.hasRTLText&&Ui.isParsed())&&(Xt=HO(te,d,Vt))}var ye=void 0;if(k){var ne=d.getValueAndResolveTokens("icon-image",Vt,u,W);ye=ne instanceof Cn?ne:Cn.fromString(ne)}if(Xt||ye){var Ue=this.sortFeaturesByKey?R.evaluate(Vt,{},u):void 0;if(this.features.push({id:wt,text:Xt,icon:ye,index:St,sourceLayerIndex:At,geometry:Vt.geometry,properties:vt.properties,type:p3[vt.type],sortKey:Ue}),ye&&(z[ye.name]=!0),Xt){var Pe=v.evaluate(Vt,{},u).join(","),ce=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(io.vertical)>=0;for(var He=0,Fe=Xt.sections;He<Fe.length;He+=1){var Qe=Fe[He];if(Qe.image)z[Qe.image.name]=!0;else{var ve=Nf(Xt.toString()),ln=Qe.fontStack||Pe,kn=j[ln]=j[ln]||{};this.calculateGlyphDependencies(Qe.text,kn,ce,this.allowVerticalPlacement,ve)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Wn){var Nn={},On={},Hn=[],br=0;function wr(An){Hn.push(Wn[An]),br++}function ti(An,or,Zr){var un=On[An];return delete On[An],On[or]=un,Hn[un].geometry[0].pop(),Hn[un].geometry[0]=Hn[un].geometry[0].concat(Zr[0]),un}function Mr(An,or,Zr){var un=Nn[or];return delete Nn[or],Nn[An]=un,Hn[un].geometry[0].shift(),Hn[un].geometry[0]=Zr[0].concat(Hn[un].geometry[0]),un}function ei(An,or,Zr){var un=Zr?or[0][or[0].length-1]:or[0][0];return An+":"+un.x+":"+un.y}for(var Yn=0;Yn<Wn.length;Yn++){var Lr=Wn[Yn],Xe=Lr.geometry,xn=Lr.text?Lr.text.toString():null;if(xn){var yn=ei(xn,Xe),nn=ei(xn,Xe,!0);if(yn in On&&nn in Nn&&On[yn]!==Nn[nn]){var li=Mr(yn,nn,Xe),qr=ti(yn,nn,Hn[li].geometry);delete Nn[yn],delete On[nn],On[ei(xn,Hn[qr].geometry,!0)]=qr,Hn[li].geometry=null}else yn in On?ti(yn,nn,Xe):nn in Nn?Mr(yn,nn,Xe):(wr(Yn),Nn[yn]=br-1,On[nn]=br-1)}else wr(Yn)}return Hn.filter(function(An){return An.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wn,Nn){return Wn.sortKey-Nn.sortKey})}},vn.prototype.update=function(i,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,u),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,u))},vn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},vn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},vn.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},vn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},vn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},vn.prototype.addToLineVertexArray=function(i,a){var u=this.lineVertexArray.length;if(i.segment!==void 0){for(var d=i.dist(a[i.segment+1]),y=i.dist(a[i.segment]),v={},b=i.segment+1;b<a.length;b++)v[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:d},b<a.length-1&&(d+=a[b+1].dist(a[b]));for(var S=i.segment||0;S>=0;S--)v[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:y},S>0&&(y+=a[S-1].dist(a[S]));for(var I=0;I<a.length;I++){var k=v[I];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},vn.prototype.addSymbols=function(i,a,u,d,y,v,b,S,I,k,R,z){for(var j=i.indexArray,W=i.layoutVertexArray,nt=i.segments.prepareSegment(4*a.length,W,j,this.canOverlap?v.sortKey:void 0),rt=this.glyphOffsetArray.length,ft=nt.vertexLength,ut=this.allowVerticalPlacement&&b===io.vertical?Math.PI/2:0,vt=v.text&&v.text.sections,wt=0;wt<a.length;wt++){var St=a[wt],At=St.tl,zt=St.tr,Vt=St.bl,Xt=St.br,fe=St.tex,te=St.pixelOffsetTL,ye=St.pixelOffsetBR,ne=St.minFontScaleX,Ue=St.minFontScaleY,Pe=St.glyphOffset,ce=St.isSDF,He=St.sectionIndex,Fe=nt.vertexLength,Qe=Pe[1];Wm(W,S.x,S.y,At.x,Qe+At.y,fe.x,fe.y,u,ce,te.x,te.y,ne,Ue),Wm(W,S.x,S.y,zt.x,Qe+zt.y,fe.x+fe.w,fe.y,u,ce,ye.x,te.y,ne,Ue),Wm(W,S.x,S.y,Vt.x,Qe+Vt.y,fe.x,fe.y+fe.h,u,ce,te.x,ye.y,ne,Ue),Wm(W,S.x,S.y,Xt.x,Qe+Xt.y,fe.x+fe.w,fe.y+fe.h,u,ce,ye.x,ye.y,ne,Ue),R_(i.dynamicLayoutVertexArray,S,ut),j.emplaceBack(Fe,Fe+1,Fe+2),j.emplaceBack(Fe+1,Fe+2,Fe+3),nt.vertexLength+=4,nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),wt!==a.length-1&&He===a[wt+1].sectionIndex||i.programConfigurations.populatePaintArrays(W.length,v,v.index,{},z,vt&&vt[He])}i.placedSymbolArray.emplaceBack(S.x,S.y,rt,this.glyphOffsetArray.length-rt,ft,I,k,S.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],b,0,!1,0,R)},vn.prototype._addCollisionDebugVertex=function(i,a,u,d,y,v){return a.emplaceBack(0,0),i.emplaceBack(u.x,u.y,d,y,Math.round(v.x),Math.round(v.y))},vn.prototype.addCollisionDebugVertices=function(i,a,u,d,y,v,b){var S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=S.vertexLength,k=y.layoutVertexArray,R=y.collisionVertexArray,z=b.anchorX,j=b.anchorY;this._addCollisionDebugVertex(k,R,v,z,j,new w(i,a)),this._addCollisionDebugVertex(k,R,v,z,j,new w(u,a)),this._addCollisionDebugVertex(k,R,v,z,j,new w(u,d)),this._addCollisionDebugVertex(k,R,v,z,j,new w(i,d)),S.vertexLength+=4;var W=y.indexArray;W.emplaceBack(I,I+1),W.emplaceBack(I+1,I+2),W.emplaceBack(I+2,I+3),W.emplaceBack(I+3,I),S.primitiveLength+=4},vn.prototype.addDebugCollisionBoxes=function(i,a,u,d){for(var y=i;y<a;y++){var v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,d?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,u)}},vn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rp(Sl,uT.members,Mu),this.iconCollisionBox=new rp(Sl,uT.members,Mu);for(var i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},vn.prototype._deserializeCollisionBoxesForSymbol=function(i,a,u,d,y,v,b,S,I){for(var k={},R=a;R<u;R++){var z=i.get(R);k.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},k.textFeatureIndex=z.featureIndex;break}for(var j=d;j<y;j++){var W=i.get(j);k.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},k.verticalTextFeatureIndex=W.featureIndex;break}for(var nt=v;nt<b;nt++){var rt=i.get(nt);k.iconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},k.iconFeatureIndex=rt.featureIndex;break}for(var ft=S;ft<I;ft++){var ut=i.get(ft);k.verticalIconBox={x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,anchorPointX:ut.anchorPointX,anchorPointY:ut.anchorPointY},k.verticalIconFeatureIndex=ut.featureIndex;break}return k},vn.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},vn.prototype.hasTextData=function(){return this.text.segments.get().length>0},vn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},vn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},vn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},vn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},vn.prototype.addIndicesForPlacedSymbol=function(i,a){for(var u=i.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<d;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)},vn.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(i),u=Math.cos(i),d=[],y=[],v=[],b=0;b<this.symbolInstances.length;++b){v.push(b);var S=this.symbolInstances.get(b);d.push(0|Math.round(a*S.anchorX+u*S.anchorY)),y.push(S.featureIndex)}return v.sort(function(I,k){return d[I]-d[k]||y[k]-y[I]}),v},vn.prototype.addToSortKeyRanges=function(i,a){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})},vn.prototype.sortFeatures=function(i){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,d=this.symbolInstanceIndexes;u<d.length;u+=1){var y=this.symbolInstances.get(d[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(v,b,S){v>=0&&S.indexOf(v)===b&&a.addIndicesForPlacedSymbol(a.text,v)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},se("SymbolBucket",vn,{omit:["layers","collisionBoxArray","features","compareText"]}),vn.MAX_GLYPHS=65535,vn.addDynamicAttributes=R_;var g3=new Nr({"symbol-placement":new me($.layout_symbol["symbol-placement"]),"symbol-spacing":new me($.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me($.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ue($.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me($.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new me($.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new me($.layout_symbol["icon-ignore-placement"]),"icon-optional":new me($.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me($.layout_symbol["icon-rotation-alignment"]),"icon-size":new ue($.layout_symbol["icon-size"]),"icon-text-fit":new me($.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me($.layout_symbol["icon-text-fit-padding"]),"icon-image":new ue($.layout_symbol["icon-image"]),"icon-rotate":new ue($.layout_symbol["icon-rotate"]),"icon-padding":new me($.layout_symbol["icon-padding"]),"icon-keep-upright":new me($.layout_symbol["icon-keep-upright"]),"icon-offset":new ue($.layout_symbol["icon-offset"]),"icon-anchor":new ue($.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me($.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me($.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me($.layout_symbol["text-rotation-alignment"]),"text-field":new ue($.layout_symbol["text-field"]),"text-font":new ue($.layout_symbol["text-font"]),"text-size":new ue($.layout_symbol["text-size"]),"text-max-width":new ue($.layout_symbol["text-max-width"]),"text-line-height":new me($.layout_symbol["text-line-height"]),"text-letter-spacing":new ue($.layout_symbol["text-letter-spacing"]),"text-justify":new ue($.layout_symbol["text-justify"]),"text-radial-offset":new ue($.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me($.layout_symbol["text-variable-anchor"]),"text-anchor":new ue($.layout_symbol["text-anchor"]),"text-max-angle":new me($.layout_symbol["text-max-angle"]),"text-writing-mode":new me($.layout_symbol["text-writing-mode"]),"text-rotate":new ue($.layout_symbol["text-rotate"]),"text-padding":new me($.layout_symbol["text-padding"]),"text-keep-upright":new me($.layout_symbol["text-keep-upright"]),"text-transform":new ue($.layout_symbol["text-transform"]),"text-offset":new ue($.layout_symbol["text-offset"]),"text-allow-overlap":new me($.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new me($.layout_symbol["text-ignore-placement"]),"text-optional":new me($.layout_symbol["text-optional"])}),z_={paint:new Nr({"icon-opacity":new ue($.paint_symbol["icon-opacity"]),"icon-color":new ue($.paint_symbol["icon-color"]),"icon-halo-color":new ue($.paint_symbol["icon-halo-color"]),"icon-halo-width":new ue($.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ue($.paint_symbol["icon-halo-blur"]),"icon-translate":new me($.paint_symbol["icon-translate"]),"icon-translate-anchor":new me($.paint_symbol["icon-translate-anchor"]),"text-opacity":new ue($.paint_symbol["text-opacity"]),"text-color":new ue($.paint_symbol["text-color"],{runtimeType:Zt,getOverride:function(i){return i.textColor},hasOverride:function(i){return!!i.textColor}}),"text-halo-color":new ue($.paint_symbol["text-halo-color"]),"text-halo-width":new ue($.paint_symbol["text-halo-width"]),"text-halo-blur":new ue($.paint_symbol["text-halo-blur"]),"text-translate":new me($.paint_symbol["text-translate"]),"text-translate-anchor":new me($.paint_symbol["text-translate-anchor"])}),layout:g3},ih=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:ie,this.defaultValue=i};ih.prototype.evaluate=function(i){if(i.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},ih.prototype.eachChild=function(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)},ih.prototype.outputDefined=function(){return!1},ih.prototype.serialize=function(){return null},se("FormatSectionOverride",ih,{omit:["defaultValue"]});var y3=function(i){function a(u){i.call(this,u,z_)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.recalculate=function(u,d){if(i.prototype.recalculate.call(this,u,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var v=[],b=0,S=y;b<S.length;b+=1){var I=S[b];v.indexOf(I)<0&&v.push(I)}this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(u,d,y,v){var b=this.layout.get(u).evaluate(d,{},y,v),S=this._unevaluatedLayout._values[u];return S.isDataDriven()||vu(S.value)||!b?b:function(I,k){return k.replace(/{([^{}]+)}/g,function(R,z){return z in I?String(I[z]):""})}(d.properties,b)},a.prototype.createBucket=function(u){return new vn(u)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var u=0,d=z_.paint.overridableProperties;u<d.length;u+=1){var y=d[u];if(a.hasPaintOverride(this.layout,y)){var v,b=this.paint.get(y),S=new ih(b),I=new vl(S,b.property.specification);v=b.value.kind==="constant"||b.value.kind==="source"?new _u("source",I):new _l("composite",I,b.value.zoomStops,b.value._interpolationType),this.paint._values[y]=new Yr(b.property,v,b.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(u,d,y){return!(!this.layout||d.isDataDriven()||y.isDataDriven())&&a.hasPaintOverride(this.layout,u)},a.hasPaintOverride=function(u,d){var y=u.get("text-field"),v=z_.paint.properties[d],b=!1,S=function(R){for(var z=0,j=R;z<j.length;z+=1)if(v.overrides&&v.overrides.hasOverride(j[z]))return void(b=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Vn)S(y.value.value.sections);else if(y.value.kind==="source"){var I=function(R){b||(R instanceof vr&&In(R.value)===mn?S(R.value.sections):R instanceof bi?S(R.sections):R.eachChild(I))},k=y.value;k._styleExpression&&I(k._styleExpression.expression)}return b},a}(Oo),v3={paint:new Nr({"background-color":new me($.paint_background["background-color"]),"background-pattern":new Kr($.paint_background["background-pattern"]),"background-opacity":new me($.paint_background["background-opacity"])})},_3=function(i){function a(u){i.call(this,u,v3)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a}(Oo),x3={paint:new Nr({"raster-opacity":new me($.paint_raster["raster-opacity"]),"raster-hue-rotate":new me($.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me($.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me($.paint_raster["raster-brightness-max"]),"raster-saturation":new me($.paint_raster["raster-saturation"]),"raster-contrast":new me($.paint_raster["raster-contrast"]),"raster-resampling":new me($.paint_raster["raster-resampling"]),"raster-fade-duration":new me($.paint_raster["raster-fade-duration"])})},b3=function(i){function a(u){i.call(this,u,x3)}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a}(Oo),w3=function(i){function a(u){i.call(this,u,{}),this.implementation=u}return i&&(a.__proto__=i),(a.prototype=Object.create(i&&i.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},a.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},a}(Oo),T3={circle:__,heatmap:sO,hillshade:lO,fill:SO,"fill-extrusion":RO,line:UO,symbol:y3,background:_3,raster:b3},kT=A.HTMLImageElement,OT=A.HTMLCanvasElement,RT=A.HTMLVideoElement,zT=A.ImageData,Hm=A.ImageBitmap,Du=function(i,a,u,d){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(a,d)};Du.prototype.update=function(i,a,u){var d=i.width,y=i.height,v=!(this.size&&this.size[0]===d&&this.size[1]===y||u),b=this.context,S=b.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!a||a.premultiply!==!1)),v)this.size=[d,y],i instanceof kT||i instanceof OT||i instanceof RT||i instanceof zT||Hm&&i instanceof Hm?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,i):S.texImage2D(S.TEXTURE_2D,0,this.format,d,y,0,this.format,S.UNSIGNED_BYTE,i.data);else{var I=u||{x:0,y:0},k=I.x,R=I.y;i instanceof kT||i instanceof OT||i instanceof RT||i instanceof zT||Hm&&i instanceof Hm?S.texSubImage2D(S.TEXTURE_2D,0,k,R,S.RGBA,S.UNSIGNED_BYTE,i):S.texSubImage2D(S.TEXTURE_2D,0,k,R,d,y,S.RGBA,S.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)},Du.prototype.bind=function(i,a,u){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),u!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=d.LINEAR),i!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,u||i),this.filter=i),a!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrap=a)},Du.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Du.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var D_=function(i){var a=this;this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};D_.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},D_.prototype.remove=function(){delete this._channel,this._callback=function(){}};var oh=function(i,a,u){this.target=i,this.parent=a,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ot(["receive","process"],this),this.invoker=new D_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ar()?i:A};function DT(i,a,u){var d=2*Math.PI*6378137/256/Math.pow(2,u);return[i*d-2*Math.PI*6378137/2,a*d-2*Math.PI*6378137/2]}oh.prototype.send=function(i,a,u,d,y){var v=this;y===void 0&&(y=!1);var b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[b]=u);var S=$i(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:i,hasCallback:!!u,targetMapId:d,mustQueue:y,sourceMapId:this.mapId,data:go(a,S)},S),{cancel:function(){u&&delete v.callbacks[b],v.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:v.mapId})}}},oh.prototype.receive=function(i){var a=i.data,u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[u];var d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d()}else ar()||a.mustQueue?(this.tasks[u]=a,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,a)},oh.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),a=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(i,a)}},oh.prototype.processTask=function(i,a){var u=this;if(a.type==="<response>"){var d=this.callbacks[i];delete this.callbacks[i],d&&(a.error?d(Si(a.error)):d(null,Si(a.data)))}else{var y=!1,v=$i(this.globalScope)?void 0:[],b=a.hasCallback?function(R,z){y=!0,delete u.cancelCallbacks[i],u.target.postMessage({id:i,type:"<response>",sourceMapId:u.mapId,error:R?go(R):null,data:go(z,v)},v)}:function(R){y=!0},S=null,I=Si(a.data);if(this.parent[a.type])S=this.parent[a.type](a.sourceMapId,I,b);else if(this.parent.getWorkerSource){var k=a.type.split(".");S=this.parent.getWorkerSource(a.sourceMapId,k[0],I.source)[k[1]](I,b)}else b(new Error("Could not find function "+a.type));!y&&S&&S.cancel&&(this.cancelCallbacks[i]=S.cancel)}},oh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var hr=function(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};hr.prototype.setNorthEast=function(i){return this._ne=i instanceof Ln?new Ln(i.lng,i.lat):Ln.convert(i),this},hr.prototype.setSouthWest=function(i){return this._sw=i instanceof Ln?new Ln(i.lng,i.lat):Ln.convert(i),this},hr.prototype.extend=function(i){var a,u,d=this._sw,y=this._ne;if(i instanceof Ln)a=i,u=i;else{if(!(i instanceof hr))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(hr.convert(i)):this.extend(Ln.convert(i)):this;if(u=i._ne,!(a=i._sw)||!u)return this}return d||y?(d.lng=Math.min(a.lng,d.lng),d.lat=Math.min(a.lat,d.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new Ln(a.lng,a.lat),this._ne=new Ln(u.lng,u.lat)),this},hr.prototype.getCenter=function(){return new Ln((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},hr.prototype.getSouthWest=function(){return this._sw},hr.prototype.getNorthEast=function(){return this._ne},hr.prototype.getNorthWest=function(){return new Ln(this.getWest(),this.getNorth())},hr.prototype.getSouthEast=function(){return new Ln(this.getEast(),this.getSouth())},hr.prototype.getWest=function(){return this._sw.lng},hr.prototype.getSouth=function(){return this._sw.lat},hr.prototype.getEast=function(){return this._ne.lng},hr.prototype.getNorth=function(){return this._ne.lat},hr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},hr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},hr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},hr.prototype.contains=function(i){var a=Ln.convert(i),u=a.lng,d=a.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&y},hr.convert=function(i){return!i||i instanceof hr?i:new hr(i)};var Ln=function(i,a){if(isNaN(i)||isNaN(a))throw new Error("Invalid LngLat object: ("+i+", "+a+")");if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ln.prototype.wrap=function(){return new Ln(U(this.lng,-180,180),this.lat)},Ln.prototype.toArray=function(){return[this.lng,this.lat]},Ln.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ln.prototype.distanceTo=function(i){var a=Math.PI/180,u=this.lat*a,d=i.lat*a,y=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((i.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(y,1))},Ln.prototype.toBounds=function(i){i===void 0&&(i=0);var a=360*i/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new hr(new Ln(this.lng-u,this.lat-a),new Ln(this.lng+u,this.lat+a))},Ln.convert=function(i){if(i instanceof Ln)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Ln(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Ln(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var FT=2*Math.PI*63710088e-1;function NT(i){return FT*Math.cos(i*Math.PI/180)}function BT(i){return(180+i)/360}function UT(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function VT(i,a){return i/NT(a)}function F_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}var Fu=function(i,a,u){u===void 0&&(u=0),this.x=+i,this.y=+a,this.z=+u};Fu.fromLngLat=function(i,a){a===void 0&&(a=0);var u=Ln.convert(i);return new Fu(BT(u.lng),UT(u.lat),VT(a,u.lat))},Fu.prototype.toLngLat=function(){return new Ln(360*this.x-180,F_(this.y))},Fu.prototype.toAltitude=function(){return this.z*NT(F_(this.y))},Fu.prototype.meterInMercatorCoordinateUnits=function(){return 1/FT*(i=F_(this.y),1/Math.cos(i*Math.PI/180));var i};var Nu=function(i,a,u){this.z=i,this.x=a,this.y=u,this.key=ip(0,i,i,a,u)};Nu.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},Nu.prototype.url=function(i,a){var u,d,y,v,b,S=(d=this.y,y=this.z,v=DT(256*(u=this.x),256*(d=Math.pow(2,y)-d-1),y),b=DT(256*(u+1),256*(d+1),y),v[0]+","+v[1]+","+b[0]+","+b[1]),I=function(k,R,z){for(var j,W="",nt=k;nt>0;nt--)W+=(R&(j=1<<nt-1)?1:0)+(z&j?2:0);return W}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",S)},Nu.prototype.getTilePoint=function(i){var a=Math.pow(2,this.z);return new w(8192*(i.x*a-this.x),8192*(i.y*a-this.y))},Nu.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var jT=function(i,a){this.wrap=i,this.canonical=a,this.key=ip(i,a.z,a.z,a.x,a.y)},fr=function(i,a,u,d,y){this.overscaledZ=i,this.wrap=a,this.canonical=new Nu(u,+d,+y),this.key=ip(a,i,u,d,y)};function ip(i,a,u,d,y){(i*=2)<0&&(i=-1*i-1);var v=1<<u;return(v*v*i+v*y+d).toString(36)+u.toString(36)+a.toString(36)}fr.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},fr.prototype.scaledTo=function(i){var a=this.canonical.z-i;return i>this.canonical.z?new fr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fr(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)},fr.prototype.calculateScaledKey=function(i,a){var u=this.canonical.z-i;return i>this.canonical.z?ip(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y):ip(this.wrap*+a,i,i,this.canonical.x>>u,this.canonical.y>>u)},fr.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a},fr.prototype.children=function(i){if(this.overscaledZ>=i)return[new fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new fr(a,this.wrap,a,u,d),new fr(a,this.wrap,a,u+1,d),new fr(a,this.wrap,a,u,d+1),new fr(a,this.wrap,a,u+1,d+1)]},fr.prototype.isLessThan=function(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))},fr.prototype.wrapped=function(){return new fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},fr.prototype.unwrapTo=function(i){return new fr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},fr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},fr.prototype.toUnwrapped=function(){return new jT(this.wrap,this.canonical)},fr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},fr.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new Fu(i.x-this.wrap,i.y))},se("CanonicalTileID",Nu),se("OverscaledTileID",fr,{omit:["posMatrix"]});var za=function(i,a,u){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return ae('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var d=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<d;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(d,y)]=this.data[this._idx(d-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,d)]=this.data[this._idx(y,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};za.prototype.get=function(i,a){var u=new Uint8Array(this.data.buffer),d=4*this._idx(i,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[d],u[d+1],u[d+2])},za.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},za.prototype._idx=function(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)},za.prototype._unpackMapbox=function(i,a,u){return(256*i*256+256*a+u)/10-1e4},za.prototype._unpackTerrarium=function(i,a,u){return 256*i+a+u/256-32768},za.prototype.getPixels=function(){return new Mi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},za.prototype.backfillBorder=function(i,a,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var d=a*this.dim,y=a*this.dim+this.dim,v=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:d=y-1;break;case 1:y=d+1}switch(u){case-1:v=b-1;break;case 1:b=v+1}for(var S=-a*this.dim,I=-u*this.dim,k=v;k<b;k++)for(var R=d;R<y;R++)this.data[this._idx(R,k)]=i.data[this._idx(R+S,k+I)]},se("DEMData",za);var qm=function(i){this._stringToNumber={},this._numberToString=[];for(var a=0;a<i.length;a++){var u=i[a];this._stringToNumber[u]=a,this._numberToString[a]=u}};qm.prototype.encode=function(i){return this._stringToNumber[i]},qm.prototype.decode=function(i){return this._numberToString[i]};var Zm=function(i,a,u,d,y){this.type="Feature",this._vectorTileFeature=i,i._z=a,i._x=u,i._y=d,this.properties=i.properties,this.id=y},N_={geometry:{configurable:!0}};N_.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},N_.geometry.set=function(i){this._geometry=i},Zm.prototype.toJSON=function(){var i={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(i[a]=this[a]);return i},Object.defineProperties(Zm.prototype,N_);var sh=function(){this.state={},this.stateChanges={},this.deletedStates={}};sh.prototype.updateState=function(i,a,u){var d=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},H(this.stateChanges[i][d],u),this.deletedStates[i]===null)for(var y in this.deletedStates[i]={},this.state[i])y!==d&&(this.deletedStates[i][y]=null);else if(this.deletedStates[i]&&this.deletedStates[i][d]===null)for(var v in this.deletedStates[i][d]={},this.state[i][d])u[v]||(this.deletedStates[i][d][v]=null);else for(var b in u)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][b]===null&&delete this.deletedStates[i][d][b]},sh.prototype.removeFeatureState=function(i,a,u){if(this.deletedStates[i]!==null){var d=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&a!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}},sh.prototype.getState=function(i,a){var u=String(a),d=H({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var y=this.deletedStates[i][a];if(y===null)return{};for(var v in y)delete d[v]}return d},sh.prototype.initializeTileState=function(i,a){i.setFeatureState(this.state,a)},sh.prototype.coalesceChanges=function(i,a){var u={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var y={};for(var v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),H(this.state[d][v],this.stateChanges[d][v]),y[v]=this.state[d][v];u[d]=y}for(var b in this.deletedStates){this.state[b]=this.state[b]||{};var S={};if(this.deletedStates[b]===null)for(var I in this.state[b])S[I]={},this.state[b][I]={};else for(var k in this.deletedStates[b]){if(this.deletedStates[b][k]===null)this.state[b][k]={};else for(var R=0,z=Object.keys(this.deletedStates[b][k]);R<z.length;R+=1)delete this.state[b][k][z[R]];S[k]=this.state[b][k]}u[b]=u[b]||{},H(u[b],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var j in i)i[j].setFeatureState(u,a)};var Da=function(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ko(8192,16,0),this.grid3D=new Ko(8192,16,0),this.featureIndexArray=new N,this.promoteId=a};function GT(i,a,u,d,y){return kt(i,function(v,b){var S=a instanceof Cu?a.get(b):null;return S&&S.evaluate?S.evaluate(u,d,y):S})}function WT(i){for(var a=1/0,u=1/0,d=-1/0,y=-1/0,v=0,b=i;v<b.length;v+=1){var S=b[v];a=Math.min(a,S.x),u=Math.min(u,S.y),d=Math.max(d,S.x),y=Math.max(y,S.y)}return{minX:a,minY:u,maxX:d,maxY:y}}function E3(i,a){return a-i}Da.prototype.insert=function(i,a,u,d,y,v){var b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,y);for(var S=v?this.grid3D:this.grid,I=0;I<a.length;I++){for(var k=a[I],R=[1/0,1/0,-1/0,-1/0],z=0;z<k.length;z++){var j=k[z];R[0]=Math.min(R[0],j.x),R[1]=Math.min(R[1],j.y),R[2]=Math.max(R[2],j.x),R[3]=Math.max(R[3],j.y)}R[0]<8192&&R[1]<8192&&R[2]>=0&&R[3]>=0&&S.insert(b,R[0],R[1],R[2],R[3])}},Da.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Yc.VectorTile(new zm(this.rawTileData)).layers,this.sourceLayerCoder=new qm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Da.prototype.query=function(i,a,u,d){var y=this;this.loadVTLayers();for(var v=i.params||{},b=8192/i.tileSize/i.scale,S=Oc(v.filter),I=i.queryGeometry,k=i.queryPadding*b,R=WT(I),z=this.grid.query(R.minX-k,R.minY-k,R.maxX+k,R.maxY+k),j=WT(i.cameraQueryGeometry),W=this.grid3D.query(j.minX-k,j.minY-k,j.maxX+k,j.maxY+k,function(St,At,zt,Vt){return function(Xt,fe,te,ye,ne){for(var Ue=0,Pe=Xt;Ue<Pe.length;Ue+=1){var ce=Pe[Ue];if(fe<=ce.x&&te<=ce.y&&ye>=ce.x&&ne>=ce.y)return!0}var He=[new w(fe,te),new w(fe,ne),new w(ye,ne),new w(ye,te)];if(Xt.length>2){for(var Fe=0,Qe=He;Fe<Qe.length;Fe+=1)if(zo(Xt,Qe[Fe]))return!0}for(var ve=0;ve<Xt.length-1;ve++)if(Ou(Xt[ve],Xt[ve+1],He))return!0;return!1}(i.cameraQueryGeometry,St-k,At-k,zt+k,Vt+k)}),nt=0,rt=W;nt<rt.length;nt+=1)z.push(rt[nt]);z.sort(E3);for(var ft,ut={},vt=function(St){var At=z[St];if(At!==ft){ft=At;var zt=y.featureIndexArray.get(At),Vt=null;y.loadMatchingFeature(ut,zt.bucketIndex,zt.sourceLayerIndex,zt.featureIndex,S,v.layers,v.availableImages,a,u,d,function(Xt,fe,te){return Vt||(Vt=Fn(Xt)),fe.queryIntersectsFeature(I,Xt,te,Vt,y.z,i.transform,b,i.pixelPosMatrix)})}},wt=0;wt<z.length;wt++)vt(wt);return ut},Da.prototype.loadMatchingFeature=function(i,a,u,d,y,v,b,S,I,k,R){var z=this.bucketLayerIDs[a];if(!v||function(Xt,fe){for(var te=0;te<Xt.length;te++)if(fe.indexOf(Xt[te])>=0)return!0;return!1}(v,z)){var j=this.sourceLayerCoder.decode(u),W=this.vtLayers[j].feature(d);if(y.needGeometry){var nt=$n(W,!0);if(!y.filter(new qe(this.tileID.overscaledZ),nt,this.tileID.canonical))return}else if(!y.filter(new qe(this.tileID.overscaledZ),W))return;for(var rt=this.getId(W,j),ft=0;ft<z.length;ft++){var ut=z[ft];if(!(v&&v.indexOf(ut)<0)){var vt=S[ut];if(vt){var wt={};rt!==void 0&&k&&(wt=k.getState(vt.sourceLayer||"_geojsonTileLayer",rt));var St=H({},I[ut]);St.paint=GT(St.paint,vt.paint,W,wt,b),St.layout=GT(St.layout,vt.layout,W,wt,b);var At=!R||R(W,vt,wt);if(At){var zt=new Zm(W,this.z,this.x,this.y,rt);zt.layer=St;var Vt=i[ut];Vt===void 0&&(Vt=i[ut]=[]),Vt.push({featureIndex:d,feature:zt,intersectionZ:At})}}}}}},Da.prototype.lookupSymbolFeatures=function(i,a,u,d,y,v,b,S){var I={};this.loadVTLayers();for(var k=Oc(y),R=0,z=i;R<z.length;R+=1)this.loadMatchingFeature(I,u,d,z[R],k,v,b,S,a);return I},Da.prototype.hasLayer=function(i){for(var a=0,u=this.bucketLayerIDs;a<u.length;a+=1)for(var d=0,y=u[a];d<y.length;d+=1)if(i===y[d])return!0;return!1},Da.prototype.getId=function(i,a){var u=i.id;return this.promoteId&&typeof(u=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(u=Number(u)),u},se("FeatureIndex",Da,{omit:["rawTileData","sourceLayerCoder"]});var Ir=function(i,a){this.tileID=i,this.uid=st(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ir.prototype.registerFadeDuration=function(i){var a=i+this.timeAdded;a<an.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},Ir.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ir.prototype.loadVectorData=function(i,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(var d in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(k,R){var z={};if(!R)return z;for(var j=function(){var rt=nt[W],ft=rt.layerIds.map(function(wt){return R.getLayer(wt)}).filter(Boolean);if(ft.length!==0){rt.layers=ft,rt.stateDependentLayerIds&&(rt.stateDependentLayers=rt.stateDependentLayerIds.map(function(wt){return ft.filter(function(St){return St.id===wt})[0]}));for(var ut=0,vt=ft;ut<vt.length;ut+=1)z[vt[ut].id]=rt}},W=0,nt=k;W<nt.length;W+=1)j();return z}(i.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[d];if(y instanceof vn){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var v in this.buckets){var b=this.buckets[v];if(b instanceof vn&&b.hasRTLText){this.hasRTLText=!0,Ui.isLoading()||Ui.isLoaded()||Vf()!=="deferred"||yo();break}}for(var S in this.queryPadding=0,this.buckets){var I=this.buckets[S];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(S).queryRadius(I))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new f},Ir.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ir.prototype.getBucket=function(i){return this.buckets[i.id]},Ir.prototype.upload=function(i){for(var a in this.buckets){var u=this.buckets[a];u.uploadPending()&&u.upload(i)}var d=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Du(i,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Du(i,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},Ir.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},Ir.prototype.queryRenderedFeatures=function(i,a,u,d,y,v,b,S,I,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:y,scale:v,tileSize:this.tileSize,pixelPosMatrix:k,transform:S,params:b,queryPadding:this.queryPadding*I},i,a,u):{}},Ir.prototype.querySourceFeatures=function(i,a){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var d=u.loadVTLayers(),y=a?a.sourceLayer:"",v=d._geojsonTileLayer||d[y];if(v)for(var b=Oc(a&&a.filter),S=this.tileID.canonical,I=S.z,k=S.x,R=S.y,z={z:I,x:k,y:R},j=0;j<v.length;j++){var W=v.feature(j);if(b.needGeometry){var nt=$n(W,!0);if(!b.filter(new qe(this.tileID.overscaledZ),nt,this.tileID.canonical))continue}else if(!b.filter(new qe(this.tileID.overscaledZ),W))continue;var rt=u.getId(W,y),ft=new Zm(W,I,k,R,rt);ft.tile=z,i.push(ft)}}},Ir.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ir.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ir.prototype.setExpiryData=function(i){var a=this.expirationTime;if(i.cacheControl){var u=gr(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var d=Date.now(),y=!1;if(this.expirationTime>d)y=!1;else if(a)if(this.expirationTime<a)y=!0;else{var v=this.expirationTime-a;v?this.expirationTime=d+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ir.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ir.prototype.setFeatureState=function(i,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(a.style.hasLayer(d)){var y=this.buckets[d],v=y.layers[0].sourceLayer||"_geojsonTileLayer",b=u[v],S=i[v];if(b&&S&&Object.keys(S).length!==0){y.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});var I=a&&a.style&&a.style.getLayer(d);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}}},Ir.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ir.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<an.now()},Ir.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ir.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=an.now()+i},Ir.prototype.setDependencies=function(i,a){for(var u={},d=0,y=a;d<y.length;d+=1)u[y[d]]=!0;this.dependencies[i]=u},Ir.prototype.hasDependency=function(i,a){for(var u=0,d=i;u<d.length;u+=1){var y=this.dependencies[d[u]];if(y){for(var v=0,b=a;v<b.length;v+=1)if(y[b[v]])return!0}}return!1};var Ml=A.performance,HT=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},Ml.mark(this._marks.start)};HT.prototype.finish=function(){Ml.mark(this._marks.end);var i=Ml.getEntriesByName(this._marks.measure);return i.length===0&&(Ml.measure(this._marks.measure,this._marks.start,this._marks.end),i=Ml.getEntriesByName(this._marks.measure),Ml.clearMarks(this._marks.start),Ml.clearMarks(this._marks.end),Ml.clearMeasures(this._marks.measure)),i},s.Actor=oh,s.AlphaImage=zu,s.CanonicalTileID=Nu,s.CollisionBoxArray=f,s.Color=Ge,s.DEMData=za,s.DataConstantProperty=me,s.DictionaryCoder=qm,s.EXTENT=8192,s.ErrorEvent=mt,s.EvaluationParameters=qe,s.Event=ot,s.Evented=gt,s.FeatureIndex=Da,s.FillBucket=es,s.FillExtrusionBucket=ns,s.ImageAtlas=np,s.ImagePosition=Fm,s.LineBucket=ai,s.LngLat=Ln,s.LngLatBounds=hr,s.MercatorCoordinate=Fu,s.ONE_EM=24,s.OverscaledTileID=fr,s.Point=w,s.Point$1=w,s.Properties=Nr,s.Protobuf=zm,s.RGBAImage=Mi,s.RequestManager=lr,s.RequestPerformance=HT,s.ResourceType=Zo,s.SegmentVector=Y,s.SourceFeatureState=sh,s.StructArrayLayout1ui2=Zf,s.StructArrayLayout2f1f2i16=La,s.StructArrayLayout2i4=Ma,s.StructArrayLayout3ui6=zs,s.StructArrayLayout4i8=Gf,s.SymbolBucket=vn,s.Texture=Du,s.Tile=Ir,s.Transitionable=Fr,s.Uniform1f=Wt,s.Uniform1i=Ft,s.Uniform2f=Gt,s.Uniform3f=re,s.Uniform4f=ge,s.UniformColor=we,s.UniformMatrix4f=en,s.UnwrappedTileID=jT,s.ValidationError=lt,s.WritingMode=io,s.ZoomHistory=Ff,s.add=function(i,a,u){return i[0]=a[0]+u[0],i[1]=a[1]+u[1],i[2]=a[2]+u[2],i},s.addDynamicAttributes=R_,s.asyncAll=function(i,a,u){if(!i.length)return u(null,[]);var d=i.length,y=new Array(i.length),v=null;i.forEach(function(b,S){a(b,function(I,k){I&&(v=I),y[S]=k,--d==0&&u(v,y)})})},s.bezier=F,s.bindAll=Ot,s.browser=an,s.cacheEntryPossiblyAdded=function(i){++pa>xs&&(i.getActor().send("enforceCacheSizeLimit",po),pa=0)},s.clamp=B,s.clearTileCache=function(i){var a=A.caches.delete("mapbox-tiles");i&&a.catch(i).then(function(){return i()})},s.clipLine=PT,s.clone=function(i){var a=new hn(16);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a},s.clone$1=ee,s.clone$2=function(i){var a=new hn(3);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a},s.collisionCircleLayout=WO,s.config=Se,s.create=function(){var i=new hn(16);return hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=function(){var i=new hn(9);return hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},s.create$2=function(){var i=new hn(4);return hn!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},s.createCommonjsModule=p,s.createExpression=Lc,s.createLayout=Ar,s.createStyleLayer=function(i){return i.type==="custom"?new w3(i):new T3[i.type](i)},s.cross=function(i,a,u){var d=a[0],y=a[1],v=a[2],b=u[0],S=u[1],I=u[2];return i[0]=y*I-v*S,i[1]=v*b-d*I,i[2]=d*S-y*b,i},s.deepEqual=function i(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(var d=0;d<a.length;d++)if(!i(a[d],u[d]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(var y in a)if(!i(a[y],u[y]))return!1;return!0}return a===u},s.dot=function(i,a){return i[0]*a[0]+i[1]*a[1]+i[2]*a[2]},s.dot$1=function(i,a){return i[0]*a[0]+i[1]*a[1]+i[2]*a[2]+i[3]*a[3]},s.ease=X,s.emitValidationErrors=Su,s.endsWith=Dt,s.enforceCacheSizeLimit=function(i){bs(),xi&&xi.then(function(a){a.keys().then(function(u){for(var d=0;d<u.length-i;d++)a.delete(u[d])})})},s.evaluateSizeForFeature=xT,s.evaluateSizeForZoom=bT,s.evaluateVariableOffset=IT,s.evented=Uf,s.extend=H,s.featureFilter=Oc,s.filterObject=qt,s.fromRotation=function(i,a){var u=Math.sin(a),d=Math.cos(a);return i[0]=d,i[1]=u,i[2]=0,i[3]=-u,i[4]=d,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.getAnchorAlignment=M_,s.getAnchorJustification=O_,s.getArrayBuffer=ma,s.getImage=V,s.getJSON=function(i,a){return Lo(H(i,{type:"json"}),a)},s.getRTLTextPluginStatus=Vf,s.getReferrer=Xo,s.getVideo=function(i,a){var u,d,y=A.document.createElement("video");y.muted=!0,y.onloadstart=function(){a(null,y)};for(var v=0;v<i.length;v++){var b=A.document.createElement("source");u=i[v],d=void 0,(d=A.document.createElement("a")).href=u,(d.protocol!==A.document.location.protocol||d.host!==A.document.location.host)&&(y.crossOrigin="Anonymous"),b.src=i[v],y.appendChild(b)}return{cancel:function(){}}},s.identity=Vi,s.invert=function(i,a){var u=a[0],d=a[1],y=a[2],v=a[3],b=a[4],S=a[5],I=a[6],k=a[7],R=a[8],z=a[9],j=a[10],W=a[11],nt=a[12],rt=a[13],ft=a[14],ut=a[15],vt=u*S-d*b,wt=u*I-y*b,St=u*k-v*b,At=d*I-y*S,zt=d*k-v*S,Vt=y*k-v*I,Xt=R*rt-z*nt,fe=R*ft-j*nt,te=R*ut-W*nt,ye=z*ft-j*rt,ne=z*ut-W*rt,Ue=j*ut-W*ft,Pe=vt*Ue-wt*ne+St*ye+At*te-zt*fe+Vt*Xt;return Pe?(i[0]=(S*Ue-I*ne+k*ye)*(Pe=1/Pe),i[1]=(y*ne-d*Ue-v*ye)*Pe,i[2]=(rt*Vt-ft*zt+ut*At)*Pe,i[3]=(j*zt-z*Vt-W*At)*Pe,i[4]=(I*te-b*Ue-k*fe)*Pe,i[5]=(u*Ue-y*te+v*fe)*Pe,i[6]=(ft*St-nt*Vt-ut*wt)*Pe,i[7]=(R*Vt-j*St+W*wt)*Pe,i[8]=(b*ne-S*te+k*Xt)*Pe,i[9]=(d*te-u*ne-v*Xt)*Pe,i[10]=(nt*zt-rt*St+ut*vt)*Pe,i[11]=(z*St-R*zt-W*vt)*Pe,i[12]=(S*fe-b*ye-I*Xt)*Pe,i[13]=(u*ye-d*fe+y*Xt)*Pe,i[14]=(rt*wt-nt*At-ft*vt)*Pe,i[15]=(R*At-z*wt+j*vt)*Pe,i):null},s.isChar=$t,s.isMapboxURL=Zn,s.keysDifference=function(i,a){var u=[];for(var d in i)d in a||u.push(d);return u},s.makeRequest=Lo,s.mapObject=kt,s.mercatorXfromLng=BT,s.mercatorYfromLat=UT,s.mercatorZfromAltitude=VT,s.mul=v_,s.multiply=si,s.mvt=Yc,s.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.normalize=function(i,a){var u=a[0],d=a[1],y=a[2],v=u*u+d*d+y*y;return v>0&&(v=1/Math.sqrt(v)),i[0]=a[0]*v,i[1]=a[1]*v,i[2]=a[2]*v,i},s.number=rr,s.offscreenCanvasSupported=da,s.ortho=function(i,a,u,d,y,v,b){var S=1/(a-u),I=1/(d-y),k=1/(v-b);return i[0]=-2*S,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*I,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*k,i[11]=0,i[12]=(a+u)*S,i[13]=(y+d)*I,i[14]=(b+v)*k,i[15]=1,i},s.parseGlyphPBF=function(i){return new zm(i).readFields(e3,[])},s.pbf=zm,s.performSymbolLayout=function(i,a,u,d,y,v,b){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;var S=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,k={};if(i.textSizeData.kind==="composite"){var R=i.textSizeData,z=R.maxZoom;k.compositeTextSizes=[I["text-size"].possiblyEvaluate(new qe(R.minZoom),b),I["text-size"].possiblyEvaluate(new qe(z),b)]}if(i.iconSizeData.kind==="composite"){var j=i.iconSizeData,W=j.maxZoom;k.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new qe(j.minZoom),b),I["icon-size"].possiblyEvaluate(new qe(W),b)]}k.layoutTextSize=I["text-size"].possiblyEvaluate(new qe(i.zoom+1),b),k.layoutIconSize=I["icon-size"].possiblyEvaluate(new qe(i.zoom+1),b),k.textMaxSize=I["text-size"].possiblyEvaluate(new qe(18));for(var nt=24*S.get("text-line-height"),rt=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",ft=S.get("text-keep-upright"),ut=S.get("text-size"),vt=function(){var At=St[wt],zt=S.get("text-font").evaluate(At,{},b).join(","),Vt=ut.evaluate(At,{},b),Xt=k.layoutTextSize.evaluate(At,{},b),fe=k.layoutIconSize.evaluate(At,{},b),te={horizontal:{},vertical:void 0},ye=At.text,ne=[0,0];if(ye){var Ue=ye.toString(),Pe=24*S.get("text-letter-spacing").evaluate(At,{},b),ce=function(Xe){for(var xn=0,yn=Xe;xn<yn.length;xn+=1)if(nn=yn[xn].charCodeAt(0),$t.Arabic(nn)||$t["Arabic Supplement"](nn)||$t["Arabic Extended-A"](nn)||$t["Arabic Presentation Forms-A"](nn)||$t["Arabic Presentation Forms-B"](nn))return!1;var nn;return!0}(Ue)?Pe:0,He=S.get("text-anchor").evaluate(At,{},b),Fe=S.get("text-variable-anchor");if(!Fe){var Qe=S.get("text-radial-offset").evaluate(At,{},b);ne=Qe?IT(He,[24*Qe,k_]):S.get("text-offset").evaluate(At,{},b).map(function(Xe){return 24*Xe})}var ve=rt?"center":S.get("text-justify").evaluate(At,{},b),ln=S.get("symbol-placement"),kn=ln==="point"?24*S.get("text-max-width").evaluate(At,{},b):0,Wn=function(){i.allowVerticalPlacement&&Nf(Ue)&&(te.vertical=Nm(ye,a,u,y,zt,kn,nt,He,"left",ce,ne,io.vertical,!0,ln,Xt,Vt))};if(!rt&&Fe){for(var Nn=ve==="auto"?Fe.map(function(Xe){return O_(Xe)}):[ve],On=!1,Hn=0;Hn<Nn.length;Hn++){var br=Nn[Hn];if(!te.horizontal[br])if(On)te.horizontal[br]=te.horizontal[0];else{var wr=Nm(ye,a,u,y,zt,kn,nt,"center",br,ce,ne,io.horizontal,!1,ln,Xt,Vt);wr&&(te.horizontal[br]=wr,On=wr.positionedLines.length===1)}}Wn()}else{ve==="auto"&&(ve=O_(He));var ti=Nm(ye,a,u,y,zt,kn,nt,He,ve,ce,ne,io.horizontal,!1,ln,Xt,Vt);ti&&(te.horizontal[ve]=ti),Wn(),Nf(Ue)&&rt&&ft&&(te.vertical=Nm(ye,a,u,y,zt,kn,nt,He,ve,ce,ne,io.vertical,!1,ln,Xt,Vt))}}var Mr=void 0,ei=!1;if(At.icon&&At.icon.name){var Yn=d[At.icon.name];Yn&&(Mr=function(Xe,xn,yn){var nn=M_(yn),li=xn[0]-Xe.displaySize[0]*nn.horizontalAlign,qr=xn[1]-Xe.displaySize[1]*nn.verticalAlign;return{image:Xe,top:qr,bottom:qr+Xe.displaySize[1],left:li,right:li+Xe.displaySize[0]}}(y[At.icon.name],S.get("icon-offset").evaluate(At,{},b),S.get("icon-anchor").evaluate(At,{},b)),ei=Yn.sdf,i.sdfIcons===void 0?i.sdfIcons=Yn.sdf:i.sdfIcons!==Yn.sdf&&ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yn.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}var Lr=LT(te.horizontal)||te.vertical;i.iconsInText=!!Lr&&Lr.iconsInText,(Lr||Mr)&&function(Xe,xn,yn,nn,li,qr,An,or,Zr,un,Vs){var oo=qr.textMaxSize.evaluate(xn,{});oo===void 0&&(oo=An);var js,Kn=Xe.layers[0].layout,Gs=Kn.get("icon-offset").evaluate(xn,{},Vs),Fo=LT(yn.horizontal),ah=An/24,Bu=Xe.tilePixelRatio*ah,lh=Xe.tilePixelRatio*oo/24,Fa=Xe.tilePixelRatio*or,uh=Xe.tilePixelRatio*Kn.get("symbol-spacing"),Xm=Kn.get("text-padding")*Xe.tilePixelRatio,ch=Kn.get("icon-padding")*Xe.tilePixelRatio,op=Kn.get("text-max-angle")/180*Math.PI,$m=Kn.get("text-rotation-alignment")==="map"&&Kn.get("symbol-placement")!=="point",Ym=Kn.get("icon-rotation-alignment")==="map"&&Kn.get("symbol-placement")!=="point",Na=Kn.get("symbol-placement"),sp=uh/2,hh=Kn.get("icon-text-fit");nn&&hh!=="none"&&(Xe.allowVerticalPlacement&&yn.vertical&&(js=_T(nn,yn.vertical,hh,Kn.get("icon-text-fit-padding"),Gs,ah)),Fo&&(nn=_T(nn,Fo,hh,Kn.get("icon-text-fit-padding"),Gs,ah)));var Ll=function(S3,dp){dp.x<0||dp.x>=8192||dp.y<0||dp.y>=8192||function(Jn,rs,P3,kl,j_,XT,ng,Ws,rg,mp,ig,og,G_,$T,gp,YT,KT,JT,QT,tE,so,sg,eE,Hs,A3){var nE,Vu,gh,yh,vh,_h=Jn.addToLineVertexArray(rs,P3),rE=0,iE=0,oE=0,sE=0,W_=-1,H_=-1,Ba={},aE=et(""),q_=0,Z_=0;if(Ws._unevaluatedLayout.getValue("text-radial-offset")===void 0?(q_=(nE=Ws.layout.get("text-offset").evaluate(so,{},Hs).map(function(vp){return 24*vp}))[0],Z_=nE[1]):(q_=24*Ws.layout.get("text-radial-offset").evaluate(so,{},Hs),Z_=k_),Jn.allowVerticalPlacement&&kl.vertical){var lE=Ws.layout.get("text-rotate").evaluate(so,{},Hs)+90;yh=new Gm(rg,rs,mp,ig,og,kl.vertical,G_,$T,gp,lE),ng&&(vh=new Gm(rg,rs,mp,ig,og,ng,KT,JT,gp,lE))}if(j_){var X_=Ws.layout.get("icon-rotate").evaluate(so,{}),uE=Ws.layout.get("icon-text-fit")!=="none",cE=AT(j_,X_,eE,uE),$_=ng?AT(ng,X_,eE,uE):void 0;gh=new Gm(rg,rs,mp,ig,og,j_,KT,JT,!1,X_),rE=4*cE.length;var hE=Jn.iconSizeData,yp=null;hE.kind==="source"?(yp=[128*Ws.layout.get("icon-size").evaluate(so,{})])[0]>32640&&ae(Jn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):hE.kind==="composite"&&((yp=[128*sg.compositeIconSizes[0].evaluate(so,{},Hs),128*sg.compositeIconSizes[1].evaluate(so,{},Hs)])[0]>32640||yp[1]>32640)&&ae(Jn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Jn.addSymbols(Jn.icon,cE,yp,tE,QT,so,!1,rs,_h.lineStartIndex,_h.lineLength,-1,Hs),W_=Jn.icon.placedSymbolArray.length-1,$_&&(iE=4*$_.length,Jn.addSymbols(Jn.icon,$_,yp,tE,QT,so,io.vertical,rs,_h.lineStartIndex,_h.lineLength,-1,Hs),H_=Jn.icon.placedSymbolArray.length-1)}for(var fE in kl.horizontal){var ag=kl.horizontal[fE];if(!Vu){aE=et(ag.text);var C3=Ws.layout.get("text-rotate").evaluate(so,{},Hs);Vu=new Gm(rg,rs,mp,ig,og,ag,G_,$T,gp,C3)}var pE=ag.positionedLines.length===1;if(oE+=MT(Jn,rs,ag,XT,Ws,gp,so,YT,_h,kl.vertical?io.horizontal:io.horizontalOnly,pE?Object.keys(kl.horizontal):[fE],Ba,W_,sg,Hs),pE)break}kl.vertical&&(sE+=MT(Jn,rs,kl.vertical,XT,Ws,gp,so,YT,_h,io.vertical,["vertical"],Ba,H_,sg,Hs));var I3=Vu?Vu.boxStartIndex:Jn.collisionBoxArray.length,M3=Vu?Vu.boxEndIndex:Jn.collisionBoxArray.length,L3=yh?yh.boxStartIndex:Jn.collisionBoxArray.length,k3=yh?yh.boxEndIndex:Jn.collisionBoxArray.length,O3=gh?gh.boxStartIndex:Jn.collisionBoxArray.length,R3=gh?gh.boxEndIndex:Jn.collisionBoxArray.length,z3=vh?vh.boxStartIndex:Jn.collisionBoxArray.length,D3=vh?vh.boxEndIndex:Jn.collisionBoxArray.length,qs=-1,lg=function(vp,mE){return vp&&vp.circleDiameter?Math.max(vp.circleDiameter,mE):mE};qs=lg(Vu,qs),qs=lg(yh,qs),qs=lg(gh,qs);var dE=(qs=lg(vh,qs))>-1?1:0;dE&&(qs*=A3/24),Jn.glyphOffsetArray.length>=vn.MAX_GLYPHS&&ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),so.sortKey!==void 0&&Jn.addToSortKeyRanges(Jn.symbolInstances.length,so.sortKey),Jn.symbolInstances.emplaceBack(rs.x,rs.y,Ba.right>=0?Ba.right:-1,Ba.center>=0?Ba.center:-1,Ba.left>=0?Ba.left:-1,Ba.vertical||-1,W_,H_,aE,I3,M3,L3,k3,O3,R3,z3,D3,mp,oE,sE,rE,iE,dE,0,G_,q_,Z_,qs)}(Xe,dp,S3,yn,nn,li,js,Xe.layers[0],Xe.collisionBoxArray,xn.index,xn.sourceLayerIndex,Xe.index,Bu,Xm,$m,Zr,Fa,ch,Ym,Gs,xn,qr,un,Vs,An)};if(Na==="line")for(var fh=0,Km=PT(xn.geometry,0,0,8192,8192);fh<Km.length;fh+=1)for(var Jm=Km[fh],ap=0,lp=l3(Jm,uh,op,yn.vertical||Fo,nn,24,lh,Xe.overscaling,8192);ap<lp.length;ap+=1){var Qm=lp[ap];Fo&&f3(Xe,Fo.text,sp,Qm)||Ll(Jm,Qm)}else if(Na==="line-center")for(var up=0,cp=xn.geometry;up<cp.length;up+=1){var hp=cp[up];if(hp.length>1){var tg=a3(hp,op,yn.vertical||Fo,nn,24,lh);tg&&Ll(hp,tg)}}else if(xn.type==="Polygon")for(var ph=0,eg=S_(xn.geometry,0);ph<eg.length;ph+=1){var dh=eg[ph],fp=c3(dh,16);Ll(dh[0],new th(fp.x,fp.y,0))}else if(xn.type==="LineString")for(var Uu=0,pp=xn.geometry;Uu<pp.length;Uu+=1){var mh=pp[Uu];Ll(mh,new th(mh[0].x,mh[0].y,0))}else if(xn.type==="Point")for(var B_=0,qT=xn.geometry;B_<qT.length;B_+=1)for(var U_=0,ZT=qT[B_];U_<ZT.length;U_+=1){var V_=ZT[U_];Ll([V_],new th(V_.x,V_.y,0))}}(i,At,te,Mr,d,k,Xt,fe,ne,ei,b)},wt=0,St=i.features;wt<St.length;wt+=1)vt();v&&i.generateCollisionDebugBuffers()},s.perspective=function(i,a,u,d,y){var v,b=1/Math.tan(a/2);return i[0]=b/u,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,y!=null&&y!==1/0?(i[10]=(y+d)*(v=1/(d-y)),i[14]=2*y*d*v):(i[10]=-1,i[14]=-2*d),i},s.pick=function(i,a){for(var u={},d=0;d<a.length;d++){var y=a[d];y in i&&(u[y]=i[y])}return u},s.plugin=Ui,s.polygonIntersectsPolygon=Ns,s.postMapLoadEvent=_s,s.postTurnstileEvent=ha,s.potpack=mT,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=se,s.registerForPluginStateChange=function(i){return i({pluginStatus:Ai,pluginURL:Jo}),Uf.on("pluginStateChange",i),i},s.renderColorRamp=Yw,s.rotate=function(i,a,u){var d=a[0],y=a[1],v=a[2],b=a[3],S=Math.sin(u),I=Math.cos(u);return i[0]=d*I+v*S,i[1]=y*I+b*S,i[2]=d*-S+v*I,i[3]=y*-S+b*I,i},s.rotateX=function(i,a,u){var d=Math.sin(u),y=Math.cos(u),v=a[4],b=a[5],S=a[6],I=a[7],k=a[8],R=a[9],z=a[10],j=a[11];return a!==i&&(i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15]),i[4]=v*y+k*d,i[5]=b*y+R*d,i[6]=S*y+z*d,i[7]=I*y+j*d,i[8]=k*y-v*d,i[9]=R*y-b*d,i[10]=z*y-S*d,i[11]=j*y-I*d,i},s.rotateZ=function(i,a,u){var d=Math.sin(u),y=Math.cos(u),v=a[0],b=a[1],S=a[2],I=a[3],k=a[4],R=a[5],z=a[6],j=a[7];return a!==i&&(i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15]),i[0]=v*y+k*d,i[1]=b*y+R*d,i[2]=S*y+z*d,i[3]=I*y+j*d,i[4]=k*y-v*d,i[5]=R*y-b*d,i[6]=z*y-S*d,i[7]=j*y-I*d,i},s.scale=function(i,a,u){var d=u[0],y=u[1],v=u[2];return i[0]=a[0]*d,i[1]=a[1]*d,i[2]=a[2]*d,i[3]=a[3]*d,i[4]=a[4]*y,i[5]=a[5]*y,i[6]=a[6]*y,i[7]=a[7]*y,i[8]=a[8]*v,i[9]=a[9]*v,i[10]=a[10]*v,i[11]=a[11]*v,i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},s.scale$1=function(i,a,u){return i[0]=a[0]*u,i[1]=a[1]*u,i[2]=a[2]*u,i[3]=a[3]*u,i},s.scale$2=function(i,a,u){return i[0]=a[0]*u,i[1]=a[1]*u,i[2]=a[2]*u,i},s.setCacheLimits=function(i,a){po=i,xs=a},s.setRTLTextPlugin=function(i,a,u){if(u===void 0&&(u=!1),Ai==="deferred"||Ai==="loading"||Ai==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Jo=an.resolveURL(i),Ai="deferred",Uc=a,Au(),u||yo()},s.sphericalToCartesian=function(i){var a=i[0],u=i[1],d=i[2];return u+=90,u*=Math.PI/180,d*=Math.PI/180,{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d)}},s.sqrLen=function(i){var a=i[0],u=i[1];return a*a+u*u},s.styleSpec=$,s.sub=function(i,a,u){return i[0]=a[0]-u[0],i[1]=a[1]-u[1],i[2]=a[2]-u[2],i},s.symbolSize=s3,s.transformMat3=function(i,a,u){var d=a[0],y=a[1],v=a[2];return i[0]=d*u[0]+y*u[3]+v*u[6],i[1]=d*u[1]+y*u[4]+v*u[7],i[2]=d*u[2]+y*u[5]+v*u[8],i},s.transformMat4=qc,s.translate=function(i,a,u){var d,y,v,b,S,I,k,R,z,j,W,nt,rt=u[0],ft=u[1],ut=u[2];return a===i?(i[12]=a[0]*rt+a[4]*ft+a[8]*ut+a[12],i[13]=a[1]*rt+a[5]*ft+a[9]*ut+a[13],i[14]=a[2]*rt+a[6]*ft+a[10]*ut+a[14],i[15]=a[3]*rt+a[7]*ft+a[11]*ut+a[15]):(y=a[1],v=a[2],b=a[3],S=a[4],I=a[5],k=a[6],R=a[7],z=a[8],j=a[9],W=a[10],nt=a[11],i[0]=d=a[0],i[1]=y,i[2]=v,i[3]=b,i[4]=S,i[5]=I,i[6]=k,i[7]=R,i[8]=z,i[9]=j,i[10]=W,i[11]=nt,i[12]=d*rt+S*ft+z*ut+a[12],i[13]=y*rt+I*ft+j*ut+a[13],i[14]=v*rt+k*ft+W*ut+a[14],i[15]=b*rt+R*ft+nt*ut+a[15]),i},s.triggerPluginCompletionEvent=Cm,s.uniqueId=st,s.validateCustomStyleLayer=function(i){var a=[],u=i.id;return u===void 0&&a.push({message:"layers."+u+': missing required property "id"'}),i.render===void 0&&a.push({message:"layers."+u+': missing required method "render"'}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&a.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),a},s.validateLight=g_,s.validateStyle=Tu,s.values=function(i){var a=[];for(var u in i)a.push(i[u]);return a},s.vectorTile=Yc,s.version="1.13.3",s.warnOnce=ae,s.webpSupported=dn,s.window=A,s.wrap=U}),l(["./shared"],function(s){function p(D){var V=typeof D;if(V==="number"||V==="boolean"||V==="string"||D==null)return JSON.stringify(D);if(Array.isArray(D)){for(var G="[",J=0,ot=D;J<ot.length;J+=1)G+=p(ot[J])+",";return G+"]"}for(var mt=Object.keys(D).sort(),gt="{",$=0;$<mt.length;$++)gt+=JSON.stringify(mt[$])+":"+p(D[mt[$]])+",";return gt+"}"}function g(D){for(var V="",G=0,J=s.refProperties;G<J.length;G+=1)V+="/"+p(D[J[G]]);return V}var _=function(D){this.keyCache={},D&&this.replace(D)};_.prototype.replace=function(D){this._layerConfigs={},this._layers={},this.update(D,[])},_.prototype.update=function(D,V){for(var G=this,J=0,ot=D;J<ot.length;J+=1){var mt=ot[J];this._layerConfigs[mt.id]=mt;var gt=this._layers[mt.id]=s.createStyleLayer(mt);gt._featureFilter=s.featureFilter(gt.filter),this.keyCache[mt.id]&&delete this.keyCache[mt.id]}for(var $=0,lt=V;$<lt.length;$+=1){var xt=lt[$];delete this.keyCache[xt],delete this._layerConfigs[xt],delete this._layers[xt]}this.familiesBySource={};for(var Nt=0,Ut=function(Ht,Zt){for(var Re={},Yt=0;Yt<Ht.length;Yt++){var We=Zt&&Zt[Ht[Yt].id]||g(Ht[Yt]);Zt&&(Zt[Ht[Yt].id]=We);var mn=Re[We];mn||(mn=Re[We]=[]),mn.push(Ht[Yt])}var je=[];for(var Ye in Re)je.push(Re[Ye]);return je}(s.values(this._layerConfigs),this.keyCache);Nt<Ut.length;Nt+=1){var It=Ut[Nt].map(function(Ht){return G._layers[Ht.id]}),Bt=It[0];if(Bt.visibility!=="none"){var le=Bt.source||"",ie=this.familiesBySource[le];ie||(ie=this.familiesBySource[le]={});var Lt=Bt.sourceLayer||"_geojsonTileLayer",Qt=ie[Lt];Qt||(Qt=ie[Lt]=[]),Qt.push(It)}}};var w=function(D){var V={},G=[];for(var J in D){var ot=D[J],mt=V[J]={};for(var gt in ot){var $=ot[+gt];if($&&$.bitmap.width!==0&&$.bitmap.height!==0){var lt={x:0,y:0,w:$.bitmap.width+2,h:$.bitmap.height+2};G.push(lt),mt[gt]={rect:lt,metrics:$.metrics}}}}var xt=s.potpack(G),Nt=new s.AlphaImage({width:xt.w||1,height:xt.h||1});for(var Ut in D){var It=D[Ut];for(var Bt in It){var le=It[+Bt];if(le&&le.bitmap.width!==0&&le.bitmap.height!==0){var ie=V[Ut][Bt].rect;s.AlphaImage.copy(le.bitmap,Nt,{x:0,y:0},{x:ie.x+1,y:ie.y+1},le.bitmap)}}}this.image=Nt,this.positions=V};s.register("GlyphAtlas",w);var P=function(D){this.tileID=new s.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId};function A(D,V,G){for(var J=new s.EvaluationParameters(V),ot=0,mt=D;ot<mt.length;ot+=1)mt[ot].recalculate(J,G)}function M(D,V){var G=s.getArrayBuffer(D.request,function(J,ot,mt,gt){J?V(J):ot&&V(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(ot)),rawData:ot,cacheControl:mt,expires:gt})});return function(){G.cancel(),V()}}P.prototype.parse=function(D,V,G,J,ot){var mt=this;this.status="parsing",this.data=D,this.collisionBoxArray=new s.CollisionBoxArray;var gt=new s.DictionaryCoder(Object.keys(D.layers).sort()),$=new s.FeatureIndex(this.tileID,this.promoteId);$.bucketLayerIDs=[];var lt,xt,Nt,Ut,It={},Bt={featureIndex:$,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},le=V.familiesBySource[this.source];for(var ie in le){var Lt=D.layers[ie];if(Lt){Lt.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+ie+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Qt=gt.encode(ie),Ht=[],Zt=0;Zt<Lt.length;Zt++){var Re=Lt.feature(Zt),Yt=$.getId(Re,ie);Ht.push({feature:Re,id:Yt,index:Zt,sourceLayerIndex:Qt})}for(var We=0,mn=le[ie];We<mn.length;We+=1){var je=mn[We],Ye=je[0];Ye.minzoom&&this.zoom<Math.floor(Ye.minzoom)||Ye.maxzoom&&this.zoom>=Ye.maxzoom||Ye.visibility!=="none"&&(A(je,this.zoom,G),(It[Ye.id]=Ye.createBucket({index:$.bucketLayerIDs.length,layers:je,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qt,sourceID:this.source})).populate(Ht,Bt,this.tileID.canonical),$.bucketLayerIDs.push(je.map(function(on){return on.id})))}}}var ze=s.mapObject(Bt.glyphDependencies,function(on){return Object.keys(on).map(Number)});Object.keys(ze).length?J.send("getGlyphs",{uid:this.uid,stacks:ze},function(on,De){lt||(lt=on,xt=De,gn.call(mt))}):xt={};var Xn=Object.keys(Bt.iconDependencies);Xn.length?J.send("getImages",{icons:Xn,source:this.source,tileID:this.tileID,type:"icons"},function(on,De){lt||(lt=on,Nt=De,gn.call(mt))}):Nt={};var Ze=Object.keys(Bt.patternDependencies);function gn(){if(lt)return ot(lt);if(xt&&Nt&&Ut){var on=new w(xt),De=new s.ImageAtlas(Nt,Ut);for(var Ge in It){var Rr=It[Ge];Rr instanceof s.SymbolBucket?(A(Rr.layers,this.zoom,G),s.performSymbolLayout(Rr,xt,on.positions,Nt,De.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Rr.hasPattern&&(Rr instanceof s.LineBucket||Rr instanceof s.FillBucket||Rr instanceof s.FillExtrusionBucket)&&(A(Rr.layers,this.zoom,G),Rr.addFeatures(Bt,this.tileID.canonical,De.patternPositions))}this.status="done",ot(null,{buckets:s.values(It).filter(function(ws){return!ws.isEmpty()}),featureIndex:$,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,imageAtlas:De,glyphMap:this.returnDependencies?xt:null,iconMap:this.returnDependencies?Nt:null,glyphPositions:this.returnDependencies?on.positions:null})}}Ze.length?J.send("getImages",{icons:Ze,source:this.source,tileID:this.tileID,type:"patterns"},function(on,De){lt||(lt=on,Ut=De,gn.call(mt))}):Ut={},gn.call(this)};var F=function(D,V,G,J){this.actor=D,this.layerIndex=V,this.availableImages=G,this.loadVectorData=J||M,this.loading={},this.loaded={}};F.prototype.loadTile=function(D,V){var G=this,J=D.uid;this.loading||(this.loading={});var ot=!!(D&&D.request&&D.request.collectResourceTiming)&&new s.RequestPerformance(D.request),mt=this.loading[J]=new P(D);mt.abort=this.loadVectorData(D,function(gt,$){if(delete G.loading[J],gt||!$)return mt.status="done",G.loaded[J]=mt,V(gt);var lt=$.rawData,xt={};$.expires&&(xt.expires=$.expires),$.cacheControl&&(xt.cacheControl=$.cacheControl);var Nt={};if(ot){var Ut=ot.finish();Ut&&(Nt.resourceTiming=JSON.parse(JSON.stringify(Ut)))}mt.vectorTile=$.vectorTile,mt.parse($.vectorTile,G.layerIndex,G.availableImages,G.actor,function(It,Bt){if(It||!Bt)return V(It);V(null,s.extend({rawTileData:lt.slice(0)},Bt,xt,Nt))}),G.loaded=G.loaded||{},G.loaded[J]=mt})},F.prototype.reloadTile=function(D,V){var G=this,J=this.loaded,ot=D.uid,mt=this;if(J&&J[ot]){var gt=J[ot];gt.showCollisionBoxes=D.showCollisionBoxes;var $=function(lt,xt){var Nt=gt.reloadCallback;Nt&&(delete gt.reloadCallback,gt.parse(gt.vectorTile,mt.layerIndex,G.availableImages,mt.actor,Nt)),V(lt,xt)};gt.status==="parsing"?gt.reloadCallback=$:gt.status==="done"&&(gt.vectorTile?gt.parse(gt.vectorTile,this.layerIndex,this.availableImages,this.actor,$):$())}},F.prototype.abortTile=function(D,V){var G=this.loading,J=D.uid;G&&G[J]&&G[J].abort&&(G[J].abort(),delete G[J]),V()},F.prototype.removeTile=function(D,V){var G=this.loaded,J=D.uid;G&&G[J]&&delete G[J],V()};var X=s.window.ImageBitmap,B=function(){this.loaded={}};function U(D,V){if(D.length!==0){H(D[0],V);for(var G=1;G<D.length;G++)H(D[G],!V)}}function H(D,V){for(var G=0,J=0,ot=0,mt=D.length,gt=mt-1;ot<mt;gt=ot++){var $=(D[ot][0]-D[gt][0])*(D[gt][1]+D[ot][1]),lt=G+$;J+=Math.abs(G)>=Math.abs($)?G-lt+$:$-lt+G,G=lt}G+J>=0!=!!V&&D.reverse()}B.prototype.loadTile=function(D,V){var G=D.uid,J=D.encoding,ot=D.rawImageData,mt=X&&ot instanceof X?this.getImageData(ot):ot,gt=new s.DEMData(G,mt,J);this.loaded=this.loaded||{},this.loaded[G]=gt,V(null,gt)},B.prototype.getImageData=function(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);var V=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:V.width,height:V.height},V.data)},B.prototype.removeTile=function(D){var V=this.loaded,G=D.uid;V&&V[G]&&delete V[G]};var tt=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,st=function(D){this._feature=D,this.extent=s.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))};st.prototype.loadGeometry=function(){if(this._feature.type===1){for(var D=[],V=0,G=this._feature.geometry;V<G.length;V+=1){var J=G[V];D.push([new s.Point$1(J[0],J[1])])}return D}for(var ot=[],mt=0,gt=this._feature.geometry;mt<gt.length;mt+=1){for(var $=[],lt=0,xt=gt[mt];lt<xt.length;lt+=1){var Nt=xt[lt];$.push(new s.Point$1(Nt[0],Nt[1]))}ot.push($)}return ot},st.prototype.toGeoJSON=function(D,V,G){return tt.call(this,D,V,G)};var pt=function(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=D.length,this._features=D};pt.prototype.feature=function(D){return new st(this._features[D])};var _t=s.vectorTile.VectorTileFeature,Ot=Dt;function Dt(D,V){this.options=V||{},this.features=D,this.length=D.length}function kt(D,V){this.id=typeof D.id=="number"?D.id:void 0,this.type=D.type,this.rawGeometry=D.type===1?[D.geometry]:D.geometry,this.properties=D.tags,this.extent=V||4096}Dt.prototype.feature=function(D){return new kt(this.features[D],this.options.extent)},kt.prototype.loadGeometry=function(){var D=this.rawGeometry;this.geometry=[];for(var V=0;V<D.length;V++){for(var G=D[V],J=[],ot=0;ot<G.length;ot++)J.push(new s.Point$1(G[ot][0],G[ot][1]));this.geometry.push(J)}return this.geometry},kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var D=this.geometry,V=1/0,G=-1/0,J=1/0,ot=-1/0,mt=0;mt<D.length;mt++)for(var gt=D[mt],$=0;$<gt.length;$++){var lt=gt[$];V=Math.min(V,lt.x),G=Math.max(G,lt.x),J=Math.min(J,lt.y),ot=Math.max(ot,lt.y)}return[V,J,G,ot]},kt.prototype.toGeoJSON=_t.prototype.toGeoJSON;var qt=_e,ee=Ot;function _e(D){var V=new s.pbf;return function(G,J){for(var ot in G.layers)J.writeMessage(3,ae,G.layers[ot])}(D,V),V.finish()}function ae(D,V){var G;V.writeVarintField(15,D.version||1),V.writeStringField(1,D.name||""),V.writeVarintField(5,D.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<D.length;G++)J.feature=D.feature(G),V.writeMessage(2,he,J);var ot=J.keys;for(G=0;G<ot.length;G++)V.writeStringField(3,ot[G]);var mt=J.values;for(G=0;G<mt.length;G++)V.writeMessage(4,$i,mt[G])}function he(D,V){var G=D.feature;G.id!==void 0&&V.writeVarintField(1,G.id),V.writeMessage(2,sn,D),V.writeVarintField(3,G.type),V.writeMessage(4,mi,G)}function sn(D,V){var G=D.feature,J=D.keys,ot=D.values,mt=D.keycache,gt=D.valuecache;for(var $ in G.properties){var lt=mt[$];lt===void 0&&(J.push($),mt[$]=lt=J.length-1),V.writeVarint(lt);var xt=G.properties[$],Nt=typeof xt;Nt!=="string"&&Nt!=="boolean"&&Nt!=="number"&&(xt=JSON.stringify(xt));var Ut=Nt+":"+xt,It=gt[Ut];It===void 0&&(ot.push(xt),gt[Ut]=It=ot.length-1),V.writeVarint(It)}}function ar(D,V){return(V<<3)+(7&D)}function gr(D){return D<<1^D>>31}function mi(D,V){for(var G=D.loadGeometry(),J=D.type,ot=0,mt=0,gt=G.length,$=0;$<gt;$++){var lt=G[$],xt=1;J===1&&(xt=lt.length),V.writeVarint(ar(1,xt));for(var Nt=J===3?lt.length-1:lt.length,Ut=0;Ut<Nt;Ut++){Ut===1&&J!==1&&V.writeVarint(ar(2,Nt-1));var It=lt[Ut].x-ot,Bt=lt[Ut].y-mt;V.writeVarint(gr(It)),V.writeVarint(gr(Bt)),ot+=It,mt+=Bt}J===3&&V.writeVarint(ar(7,1))}}function $i(D,V){var G=typeof D;G==="string"?V.writeStringField(1,D):G==="boolean"?V.writeBooleanField(7,D):G==="number"&&(D%1!=0?V.writeDoubleField(3,D):D<0?V.writeSVarintField(6,D):V.writeVarintField(5,D))}function gi(D,V,G,J){Vr(D,G,J),Vr(V,2*G,2*J),Vr(V,2*G+1,2*J+1)}function Vr(D,V,G){var J=D[V];D[V]=D[G],D[G]=J}function Sr(D,V,G,J){var ot=D-G,mt=V-J;return ot*ot+mt*mt}qt.fromVectorTileJs=_e,qt.fromGeojsonVt=function(D,V){V=V||{};var G={};for(var J in D)G[J]=new Ot(D[J].features,V),G[J].name=J,G[J].version=V.version,G[J].extent=V.extent;return _e({layers:G})},qt.GeoJSONWrapper=ee;var ho=function(D){return D[0]},Jt=function(D){return D[1]},Te=function(D,V,G,J,ot){V===void 0&&(V=ho),G===void 0&&(G=Jt),J===void 0&&(J=64),ot===void 0&&(ot=Float64Array),this.nodeSize=J,this.points=D;for(var mt=D.length<65536?Uint16Array:Uint32Array,gt=this.ids=new mt(D.length),$=this.coords=new ot(2*D.length),lt=0;lt<D.length;lt++)gt[lt]=lt,$[2*lt]=V(D[lt]),$[2*lt+1]=G(D[lt]);(function xt(Nt,Ut,It,Bt,le,ie){if(!(le-Bt<=It)){var Lt=Bt+le>>1;(function Qt(Ht,Zt,Re,Yt,We,mn){for(;We>Yt;){if(We-Yt>600){var je=We-Yt+1,Ye=Re-Yt+1,ze=Math.log(je),Xn=.5*Math.exp(2*ze/3),Ze=.5*Math.sqrt(ze*Xn*(je-Xn)/je)*(Ye-je/2<0?-1:1);Qt(Ht,Zt,Re,Math.max(Yt,Math.floor(Re-Ye*Xn/je+Ze)),Math.min(We,Math.floor(Re+(je-Ye)*Xn/je+Ze)),mn)}var gn=Zt[2*Re+mn],on=Yt,De=We;for(gi(Ht,Zt,Yt,Re),Zt[2*We+mn]>gn&&gi(Ht,Zt,Yt,We);on<De;){for(gi(Ht,Zt,on,De),on++,De--;Zt[2*on+mn]<gn;)on++;for(;Zt[2*De+mn]>gn;)De--}Zt[2*Yt+mn]===gn?gi(Ht,Zt,Yt,De):gi(Ht,Zt,++De,We),De<=Re&&(Yt=De+1),Re<=De&&(We=De-1)}})(Nt,Ut,Lt,Bt,le,ie%2),xt(Nt,Ut,It,Bt,Lt-1,ie+1),xt(Nt,Ut,It,Lt+1,le,ie+1)}})(gt,$,J,0,gt.length-1,0)};Te.prototype.range=function(D,V,G,J){return function(ot,mt,gt,$,lt,xt,Nt){for(var Ut,It,Bt=[0,ot.length-1,0],le=[];Bt.length;){var ie=Bt.pop(),Lt=Bt.pop(),Qt=Bt.pop();if(Lt-Qt<=Nt)for(var Ht=Qt;Ht<=Lt;Ht++)It=mt[2*Ht+1],(Ut=mt[2*Ht])>=gt&&Ut<=lt&&It>=$&&It<=xt&&le.push(ot[Ht]);else{var Zt=Math.floor((Qt+Lt)/2);It=mt[2*Zt+1],(Ut=mt[2*Zt])>=gt&&Ut<=lt&&It>=$&&It<=xt&&le.push(ot[Zt]);var Re=(ie+1)%2;(ie===0?gt<=Ut:$<=It)&&(Bt.push(Qt),Bt.push(Zt-1),Bt.push(Re)),(ie===0?lt>=Ut:xt>=It)&&(Bt.push(Zt+1),Bt.push(Lt),Bt.push(Re))}}return le}(this.ids,this.coords,D,V,G,J,this.nodeSize)},Te.prototype.within=function(D,V,G){return function(J,ot,mt,gt,$,lt){for(var xt=[0,J.length-1,0],Nt=[],Ut=$*$;xt.length;){var It=xt.pop(),Bt=xt.pop(),le=xt.pop();if(Bt-le<=lt)for(var ie=le;ie<=Bt;ie++)Sr(ot[2*ie],ot[2*ie+1],mt,gt)<=Ut&&Nt.push(J[ie]);else{var Lt=Math.floor((le+Bt)/2),Qt=ot[2*Lt],Ht=ot[2*Lt+1];Sr(Qt,Ht,mt,gt)<=Ut&&Nt.push(J[Lt]);var Zt=(It+1)%2;(It===0?mt-$<=Qt:gt-$<=Ht)&&(xt.push(le),xt.push(Lt-1),xt.push(Zt)),(It===0?mt+$>=Qt:gt+$>=Ht)&&(xt.push(Lt+1),xt.push(Bt),xt.push(Zt))}}return Nt}(this.ids,this.coords,D,V,G,this.nodeSize)};var Je={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(D){return D}},Oe=function(D){this.options=yi(Object.create(Je),D),this.trees=new Array(this.options.maxZoom+1)};function an(D,V,G,J,ot){return{x:D,y:V,zoom:1/0,id:G,parentId:-1,numPoints:J,properties:ot}}function Se(D,V){var G=D.geometry.coordinates,J=G[1];return{x:Un(G[0]),y:Ve(J),zoom:1/0,index:V,parentId:-1}}function dn(D){return{type:"Feature",id:D.id,properties:jr(D),geometry:{type:"Point",coordinates:[(J=D.x,360*(J-.5)),(V=D.y,G=(180-360*V)*Math.PI/180,360*Math.atan(Math.exp(G))/Math.PI-90)]}};var V,G,J}function jr(D){var V=D.numPoints,G=V>=1e4?Math.round(V/1e3)+"k":V>=1e3?Math.round(V/100)/10+"k":V;return yi(yi({},D.properties),{cluster:!0,cluster_id:D.id,point_count:V,point_count_abbreviated:G})}function Un(D){return D/360+.5}function Ve(D){var V=Math.sin(D*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function yi(D,V){for(var G in V)D[G]=V[G];return D}function lr(D){return D.x}function Zn(D){return D.y}function fo(D,V,G,J,ot,mt){var gt=ot-G,$=mt-J;if(gt!==0||$!==0){var lt=((D-G)*gt+(V-J)*$)/(gt*gt+$*$);lt>1?(G=ot,J=mt):lt>0&&(G+=gt*lt,J+=$*lt)}return(gt=D-G)*gt+($=V-J)*$}function vi(D,V,G,J){var ot={id:D===void 0?null:D,type:V,geometry:G,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(mt){var gt=mt.geometry,$=mt.type;if($==="Point"||$==="MultiPoint"||$==="LineString")gs(mt,gt);else if($==="Polygon"||$==="MultiLineString")for(var lt=0;lt<gt.length;lt++)gs(mt,gt[lt]);else if($==="MultiPolygon")for(lt=0;lt<gt.length;lt++)for(var xt=0;xt<gt[lt].length;xt++)gs(mt,gt[lt][xt])}(ot),ot}function gs(D,V){for(var G=0;G<V.length;G+=3)D.minX=Math.min(D.minX,V[G]),D.minY=Math.min(D.minY,V[G+1]),D.maxX=Math.max(D.maxX,V[G]),D.maxY=Math.max(D.maxY,V[G+1])}function Gr(D,V,G,J){if(V.geometry){var ot=V.geometry.coordinates,mt=V.geometry.type,gt=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),$=[],lt=V.id;if(G.promoteId?lt=V.properties[G.promoteId]:G.generateId&&(lt=J||0),mt==="Point")yr(ot,$);else if(mt==="MultiPoint")for(var xt=0;xt<ot.length;xt++)yr(ot[xt],$);else if(mt==="LineString")ys(ot,$,gt,!1);else if(mt==="MultiLineString"){if(G.lineMetrics){for(xt=0;xt<ot.length;xt++)ys(ot[xt],$=[],gt,!1),D.push(vi(lt,"LineString",$,V.properties));return}_i(ot,$,gt,!1)}else if(mt==="Polygon")_i(ot,$,gt,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(xt=0;xt<V.geometry.geometries.length;xt++)Gr(D,{id:lt,geometry:V.geometry.geometries[xt],properties:V.properties},G,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xt=0;xt<ot.length;xt++){var Nt=[];_i(ot[xt],Nt,gt,!0),$.push(Nt)}}D.push(vi(lt,mt,$,V.properties))}}function yr(D,V){V.push(xi(D[0])),V.push(Ho(D[1])),V.push(0)}function ys(D,V,G,J){for(var ot,mt,gt=0,$=0;$<D.length;$++){var lt=xi(D[$][0]),xt=Ho(D[$][1]);V.push(lt),V.push(xt),V.push(0),$>0&&(gt+=J?(ot*xt-lt*mt)/2:Math.sqrt(Math.pow(lt-ot,2)+Math.pow(xt-mt,2))),ot=lt,mt=xt}var Nt=V.length-3;V[2]=1,function Ut(It,Bt,le,ie){for(var Lt,Qt=ie,Ht=le-Bt>>1,Zt=le-Bt,Re=It[Bt],Yt=It[Bt+1],We=It[le],mn=It[le+1],je=Bt+3;je<le;je+=3){var Ye=fo(It[je],It[je+1],Re,Yt,We,mn);if(Ye>Qt)Lt=je,Qt=Ye;else if(Ye===Qt){var ze=Math.abs(je-Ht);ze<Zt&&(Lt=je,Zt=ze)}}Qt>ie&&(Lt-Bt>3&&Ut(It,Bt,Lt,ie),It[Lt+2]=Qt,le-Lt>3&&Ut(It,Lt,le,ie))}(V,0,Nt,G),V[Nt+2]=1,V.size=Math.abs(gt),V.start=0,V.end=V.size}function _i(D,V,G,J){for(var ot=0;ot<D.length;ot++){var mt=[];ys(D[ot],mt,G,J),V.push(mt)}}function xi(D){return D/360+.5}function Ho(D){var V=Math.sin(D*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Ni(D,V,G,J,ot,mt,gt,$){if(J/=V,mt>=(G/=V)&&gt<J)return D;if(gt<G||mt>=J)return null;for(var lt=[],xt=0;xt<D.length;xt++){var Nt=D[xt],Ut=Nt.geometry,It=Nt.type,Bt=ot===0?Nt.minX:Nt.minY,le=ot===0?Nt.maxX:Nt.maxY;if(Bt>=G&&le<J)lt.push(Nt);else if(!(le<G||Bt>=J)){var ie=[];if(It==="Point"||It==="MultiPoint")ca(Ut,ie,G,J,ot);else if(It==="LineString")ha(Ut,ie,G,J,ot,!1,$.lineMetrics);else if(It==="MultiLineString")_s(Ut,ie,G,J,ot,!1);else if(It==="Polygon")_s(Ut,ie,G,J,ot,!0);else if(It==="MultiPolygon")for(var Lt=0;Lt<Ut.length;Lt++){var Qt=[];_s(Ut[Lt],Qt,G,J,ot,!0),Qt.length&&ie.push(Qt)}if(ie.length){if($.lineMetrics&&It==="LineString"){for(Lt=0;Lt<ie.length;Lt++)lt.push(vi(Nt.id,It,ie[Lt],Nt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(ie.length===1?(It="LineString",ie=ie[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=ie.length===3?"Point":"MultiPoint"),lt.push(vi(Nt.id,It,ie,Nt.tags))}}}return lt.length?lt:null}function ca(D,V,G,J,ot){for(var mt=0;mt<D.length;mt+=3){var gt=D[mt+ot];gt>=G&&gt<=J&&(V.push(D[mt]),V.push(D[mt+1]),V.push(D[mt+2]))}}function ha(D,V,G,J,ot,mt,gt){for(var $,lt,xt=vs(D),Nt=ot===0?xs:bs,Ut=D.start,It=0;It<D.length-3;It+=3){var Bt=D[It],le=D[It+1],ie=D[It+2],Lt=D[It+3],Qt=D[It+4],Ht=ot===0?Bt:le,Zt=ot===0?Lt:Qt,Re=!1;gt&&($=Math.sqrt(Math.pow(Bt-Lt,2)+Math.pow(le-Qt,2))),Ht<G?Zt>G&&(lt=Nt(xt,Bt,le,Lt,Qt,G),gt&&(xt.start=Ut+$*lt)):Ht>J?Zt<J&&(lt=Nt(xt,Bt,le,Lt,Qt,J),gt&&(xt.start=Ut+$*lt)):po(xt,Bt,le,ie),Zt<G&&Ht>=G&&(lt=Nt(xt,Bt,le,Lt,Qt,G),Re=!0),Zt>J&&Ht<=J&&(lt=Nt(xt,Bt,le,Lt,Qt,J),Re=!0),!mt&&Re&&(gt&&(xt.end=Ut+$*lt),V.push(xt),xt=vs(D)),gt&&(Ut+=$)}var Yt=D.length-3;Bt=D[Yt],le=D[Yt+1],ie=D[Yt+2],(Ht=ot===0?Bt:le)>=G&&Ht<=J&&po(xt,Bt,le,ie),Yt=xt.length-3,mt&&Yt>=3&&(xt[Yt]!==xt[0]||xt[Yt+1]!==xt[1])&&po(xt,xt[0],xt[1],xt[2]),xt.length&&V.push(xt)}function vs(D){var V=[];return V.size=D.size,V.start=D.start,V.end=D.end,V}function _s(D,V,G,J,ot,mt){for(var gt=0;gt<D.length;gt++)ha(D[gt],V,G,J,ot,mt,!1)}function po(D,V,G,J){D.push(V),D.push(G),D.push(J)}function xs(D,V,G,J,ot,mt){var gt=(mt-V)/(J-V);return D.push(mt),D.push(G+(ot-G)*gt),D.push(1),gt}function bs(D,V,G,J,ot,mt){var gt=(mt-G)/(ot-G);return D.push(V+(J-V)*gt),D.push(mt),D.push(1),gt}function fa(D,V){for(var G=[],J=0;J<D.length;J++){var ot,mt=D[J],gt=mt.type;if(gt==="Point"||gt==="MultiPoint"||gt==="LineString")ot=qo(mt.geometry,V);else if(gt==="MultiLineString"||gt==="Polygon"){ot=[];for(var $=0;$<mt.geometry.length;$++)ot.push(qo(mt.geometry[$],V))}else if(gt==="MultiPolygon")for(ot=[],$=0;$<mt.geometry.length;$++){for(var lt=[],xt=0;xt<mt.geometry[$].length;xt++)lt.push(qo(mt.geometry[$][xt],V));ot.push(lt)}G.push(vi(mt.id,gt,ot,mt.tags))}return G}function qo(D,V){var G=[];G.size=D.size,D.start!==void 0&&(G.start=D.start,G.end=D.end);for(var J=0;J<D.length;J+=3)G.push(D[J]+V,D[J+1],D[J+2]);return G}function pa(D,V){if(D.transformed)return D;var G,J,ot,mt=1<<D.z,gt=D.x,$=D.y;for(G=0;G<D.features.length;G++){var lt=D.features[G],xt=lt.geometry,Nt=lt.type;if(lt.geometry=[],Nt===1)for(J=0;J<xt.length;J+=2)lt.geometry.push(da(xt[J],xt[J+1],V,mt,gt,$));else for(J=0;J<xt.length;J++){var Ut=[];for(ot=0;ot<xt[J].length;ot+=2)Ut.push(da(xt[J][ot],xt[J][ot+1],V,mt,gt,$));lt.geometry.push(Ut)}}return D.transformed=!0,D}function da(D,V,G,J,ot,mt){return[Math.round(G*(D*J-ot)),Math.round(G*(V*J-mt))]}function Zo(D,V,G,J,ot){for(var mt=V===ot.maxZoom?0:ot.tolerance/((1<<V)*ot.extent),gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:J,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},$=0;$<D.length;$++){gt.numFeatures++,dl(gt,D[$],mt,ot);var lt=D[$].minX,xt=D[$].minY,Nt=D[$].maxX,Ut=D[$].maxY;lt<gt.minX&&(gt.minX=lt),xt<gt.minY&&(gt.minY=xt),Nt>gt.maxX&&(gt.maxX=Nt),Ut>gt.maxY&&(gt.maxY=Ut)}return gt}function dl(D,V,G,J){var ot=V.geometry,mt=V.type,gt=[];if(mt==="Point"||mt==="MultiPoint")for(var $=0;$<ot.length;$+=3)gt.push(ot[$]),gt.push(ot[$+1]),D.numPoints++,D.numSimplified++;else if(mt==="LineString")Xo(gt,ot,D,G,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for($=0;$<ot.length;$++)Xo(gt,ot[$],D,G,mt==="Polygon",$===0);else if(mt==="MultiPolygon")for(var lt=0;lt<ot.length;lt++){var xt=ot[lt];for($=0;$<xt.length;$++)Xo(gt,xt[$],D,G,!0,$===0)}if(gt.length){var Nt=V.tags||null;if(mt==="LineString"&&J.lineMetrics){for(var Ut in Nt={},V.tags)Nt[Ut]=V.tags[Ut];Nt.mapbox_clip_start=ot.start/ot.size,Nt.mapbox_clip_end=ot.end/ot.size}var It={geometry:gt,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:Nt};V.id!==null&&(It.id=V.id),D.features.push(It)}}function Xo(D,V,G,J,ot,mt){var gt=J*J;if(J>0&&V.size<(ot?gt:J))G.numPoints+=V.length/3;else{for(var $=[],lt=0;lt<V.length;lt+=3)(J===0||V[lt+2]>gt)&&(G.numSimplified++,$.push(V[lt]),$.push(V[lt+1])),G.numPoints++;ot&&function(xt,Nt){for(var Ut=0,It=0,Bt=xt.length,le=Bt-2;It<Bt;le=It,It+=2)Ut+=(xt[It]-xt[le])*(xt[It+1]+xt[le+1]);if(Ut>0===Nt)for(It=0,Bt=xt.length;It<Bt/2;It+=2){var ie=xt[It],Lt=xt[It+1];xt[It]=xt[Bt-2-It],xt[It+1]=xt[Bt-1-It],xt[Bt-2-It]=ie,xt[Bt-1-It]=Lt}}($,mt),D.push($)}}function Yi(D,V){var G=(V=this.options=function(ot,mt){for(var gt in mt)ot[gt]=mt[gt];return ot}(Object.create(this.options),V)).debug;if(G&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ot,mt){var gt=[];if(ot.type==="FeatureCollection")for(var $=0;$<ot.features.length;$++)Gr(gt,ot.features[$],mt,$);else Gr(gt,ot.type==="Feature"?ot:{geometry:ot},mt);return gt}(D,V);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(ot,mt){var gt=mt.buffer/mt.extent,$=ot,lt=Ni(ot,1,-1-gt,gt,0,-1,2,mt),xt=Ni(ot,1,1-gt,2+gt,0,-1,2,mt);return(lt||xt)&&($=Ni(ot,1,-gt,1+gt,0,-1,2,mt)||[],lt&&($=fa(lt,1).concat($)),xt&&($=$.concat(fa(xt,-1)))),$}(J,V)).length&&this.splitTile(J,0,0,0),G&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ki(D,V,G){return 32*((1<<D)*G+V)+D}function Lo(D,V){var G=D.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);var J=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!J)return V(null,null);var ot=new pt(J.features),mt=qt(ot);mt.byteOffset===0&&mt.byteLength===mt.buffer.byteLength||(mt=new Uint8Array(mt)),V(null,{vectorTile:ot,rawData:mt.buffer})}Oe.prototype.load=function(D){var V=this.options,G=V.log,J=V.minZoom,ot=V.maxZoom,mt=V.nodeSize;G&&console.time("total time");var gt="prepare "+D.length+" points";G&&console.time(gt),this.points=D;for(var $=[],lt=0;lt<D.length;lt++)D[lt].geometry&&$.push(Se(D[lt],lt));this.trees[ot+1]=new Te($,lr,Zn,mt,Float32Array),G&&console.timeEnd(gt);for(var xt=ot;xt>=J;xt--){var Nt=+Date.now();$=this._cluster($,xt),this.trees[xt]=new Te($,lr,Zn,mt,Float32Array),G&&console.log("z%d: %d clusters in %dms",xt,$.length,+Date.now()-Nt)}return G&&console.timeEnd("total time"),this},Oe.prototype.getClusters=function(D,V){var G=((D[0]+180)%360+360)%360-180,J=Math.max(-90,Math.min(90,D[1])),ot=D[2]===180?180:((D[2]+180)%360+360)%360-180,mt=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)G=-180,ot=180;else if(G>ot){var gt=this.getClusters([G,J,180,mt],V),$=this.getClusters([-180,J,ot,mt],V);return gt.concat($)}for(var lt=this.trees[this._limitZoom(V)],xt=[],Nt=0,Ut=lt.range(Un(G),Ve(mt),Un(ot),Ve(J));Nt<Ut.length;Nt+=1){var It=lt.points[Ut[Nt]];xt.push(It.numPoints?dn(It):this.points[It.index])}return xt},Oe.prototype.getChildren=function(D){var V=this._getOriginId(D),G=this._getOriginZoom(D),J="No cluster with the specified id.",ot=this.trees[G];if(!ot)throw new Error(J);var mt=ot.points[V];if(!mt)throw new Error(J);for(var gt=this.options.radius/(this.options.extent*Math.pow(2,G-1)),$=[],lt=0,xt=ot.within(mt.x,mt.y,gt);lt<xt.length;lt+=1){var Nt=ot.points[xt[lt]];Nt.parentId===D&&$.push(Nt.numPoints?dn(Nt):this.points[Nt.index])}if($.length===0)throw new Error(J);return $},Oe.prototype.getLeaves=function(D,V,G){var J=[];return this._appendLeaves(J,D,V=V||10,G=G||0,0),J},Oe.prototype.getTile=function(D,V,G){var J=this.trees[this._limitZoom(D)],ot=Math.pow(2,D),mt=this.options,gt=mt.radius/mt.extent,$=(G-gt)/ot,lt=(G+1+gt)/ot,xt={features:[]};return this._addTileFeatures(J.range((V-gt)/ot,$,(V+1+gt)/ot,lt),J.points,V,G,ot,xt),V===0&&this._addTileFeatures(J.range(1-gt/ot,$,1,lt),J.points,ot,G,ot,xt),V===ot-1&&this._addTileFeatures(J.range(0,$,gt/ot,lt),J.points,-1,G,ot,xt),xt.features.length?xt:null},Oe.prototype.getClusterExpansionZoom=function(D){for(var V=this._getOriginZoom(D)-1;V<=this.options.maxZoom;){var G=this.getChildren(D);if(V++,G.length!==1)break;D=G[0].properties.cluster_id}return V},Oe.prototype._appendLeaves=function(D,V,G,J,ot){for(var mt=0,gt=this.getChildren(V);mt<gt.length;mt+=1){var $=gt[mt],lt=$.properties;if(lt&&lt.cluster?ot+lt.point_count<=J?ot+=lt.point_count:ot=this._appendLeaves(D,lt.cluster_id,G,J,ot):ot<J?ot++:D.push($),D.length===G)break}return ot},Oe.prototype._addTileFeatures=function(D,V,G,J,ot,mt){for(var gt=0,$=D;gt<$.length;gt+=1){var lt=V[$[gt]],xt=lt.numPoints,Nt={type:1,geometry:[[Math.round(this.options.extent*(lt.x*ot-G)),Math.round(this.options.extent*(lt.y*ot-J))]],tags:xt?jr(lt):this.points[lt.index].properties},Ut=void 0;xt?Ut=lt.id:this.options.generateId?Ut=lt.index:this.points[lt.index].id&&(Ut=this.points[lt.index].id),Ut!==void 0&&(Nt.id=Ut),mt.features.push(Nt)}},Oe.prototype._limitZoom=function(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))},Oe.prototype._cluster=function(D,V){for(var G=[],J=this.options,ot=J.reduce,mt=J.minPoints,gt=J.radius/(J.extent*Math.pow(2,V)),$=0;$<D.length;$++){var lt=D[$];if(!(lt.zoom<=V)){lt.zoom=V;for(var xt=this.trees[V+1],Nt=xt.within(lt.x,lt.y,gt),Ut=lt.numPoints||1,It=Ut,Bt=0,le=Nt;Bt<le.length;Bt+=1){var ie=xt.points[le[Bt]];ie.zoom>V&&(It+=ie.numPoints||1)}if(It>=mt){for(var Lt=lt.x*Ut,Qt=lt.y*Ut,Ht=ot&&Ut>1?this._map(lt,!0):null,Zt=($<<5)+(V+1)+this.points.length,Re=0,Yt=Nt;Re<Yt.length;Re+=1){var We=xt.points[Yt[Re]];if(!(We.zoom<=V)){We.zoom=V;var mn=We.numPoints||1;Lt+=We.x*mn,Qt+=We.y*mn,We.parentId=Zt,ot&&(Ht||(Ht=this._map(lt,!0)),ot(Ht,this._map(We)))}}lt.parentId=Zt,G.push(an(Lt/It,Qt/It,Zt,It,Ht))}else if(G.push(lt),It>1)for(var je=0,Ye=Nt;je<Ye.length;je+=1){var ze=xt.points[Ye[je]];ze.zoom<=V||(ze.zoom=V,G.push(ze))}}}return G},Oe.prototype._getOriginId=function(D){return D-this.points.length>>5},Oe.prototype._getOriginZoom=function(D){return(D-this.points.length)%32},Oe.prototype._map=function(D,V){if(D.numPoints)return V?yi({},D.properties):D.properties;var G=this.points[D.index].properties,J=this.options.map(G);return V&&J===G?yi({},J):J},Yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yi.prototype.splitTile=function(D,V,G,J,ot,mt,gt){for(var $=[D,V,G,J],lt=this.options,xt=lt.debug;$.length;){J=$.pop(),G=$.pop(),V=$.pop(),D=$.pop();var Nt=1<<V,Ut=Ki(V,G,J),It=this.tiles[Ut];if(!It&&(xt>1&&console.time("creation"),It=this.tiles[Ut]=Zo(D,V,G,J,lt),this.tileCoords.push({z:V,x:G,y:J}),xt)){xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,G,J,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));var Bt="z"+V;this.stats[Bt]=(this.stats[Bt]||0)+1,this.total++}if(It.source=D,ot){if(V===lt.maxZoom||V===ot)continue;var le=1<<ot-V;if(G!==Math.floor(mt/le)||J!==Math.floor(gt/le))continue}else if(V===lt.indexMaxZoom||It.numPoints<=lt.indexMaxPoints)continue;if(It.source=null,D.length!==0){xt>1&&console.time("clipping");var ie,Lt,Qt,Ht,Zt,Re,Yt=.5*lt.buffer/lt.extent,We=.5-Yt,mn=.5+Yt,je=1+Yt;ie=Lt=Qt=Ht=null,Zt=Ni(D,Nt,G-Yt,G+mn,0,It.minX,It.maxX,lt),Re=Ni(D,Nt,G+We,G+je,0,It.minX,It.maxX,lt),D=null,Zt&&(ie=Ni(Zt,Nt,J-Yt,J+mn,1,It.minY,It.maxY,lt),Lt=Ni(Zt,Nt,J+We,J+je,1,It.minY,It.maxY,lt),Zt=null),Re&&(Qt=Ni(Re,Nt,J-Yt,J+mn,1,It.minY,It.maxY,lt),Ht=Ni(Re,Nt,J+We,J+je,1,It.minY,It.maxY,lt),Re=null),xt>1&&console.timeEnd("clipping"),$.push(ie||[],V+1,2*G,2*J),$.push(Lt||[],V+1,2*G,2*J+1),$.push(Qt||[],V+1,2*G+1,2*J),$.push(Ht||[],V+1,2*G+1,2*J+1)}}},Yi.prototype.getTile=function(D,V,G){var J=this.options,ot=J.extent,mt=J.debug;if(D<0||D>24)return null;var gt=1<<D,$=Ki(D,V=(V%gt+gt)%gt,G);if(this.tiles[$])return pa(this.tiles[$],ot);mt>1&&console.log("drilling down to z%d-%d-%d",D,V,G);for(var lt,xt=D,Nt=V,Ut=G;!lt&&xt>0;)xt--,Nt=Math.floor(Nt/2),Ut=Math.floor(Ut/2),lt=this.tiles[Ki(xt,Nt,Ut)];return lt&&lt.source?(mt>1&&console.log("found parent tile z%d-%d-%d",xt,Nt,Ut),mt>1&&console.time("drilling down"),this.splitTile(lt.source,xt,Nt,Ut,D,V,G),mt>1&&console.timeEnd("drilling down"),this.tiles[$]?pa(this.tiles[$],ot):null):null};var ma=function(D){function V(G,J,ot,mt){D.call(this,G,J,ot,Lo),mt&&(this.loadGeoJSON=mt)}return D&&(V.__proto__=D),(V.prototype=Object.create(D&&D.prototype)).constructor=V,V.prototype.loadData=function(G,J){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=J,this._pendingLoadDataParams=G,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},V.prototype._loadData=function(){var G=this;if(this._pendingCallback&&this._pendingLoadDataParams){var J=this._pendingCallback,ot=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var mt=!!(ot&&ot.request&&ot.request.collectResourceTiming)&&new s.RequestPerformance(ot.request);this.loadGeoJSON(ot,function(gt,$){if(gt||!$)return J(gt);if(typeof $!="object")return J(new Error("Input data given to '"+ot.source+"' is not a valid GeoJSON object."));(function It(Bt,le){var ie,Lt=Bt&&Bt.type;if(Lt==="FeatureCollection")for(ie=0;ie<Bt.features.length;ie++)It(Bt.features[ie],le);else if(Lt==="GeometryCollection")for(ie=0;ie<Bt.geometries.length;ie++)It(Bt.geometries[ie],le);else if(Lt==="Feature")It(Bt.geometry,le);else if(Lt==="Polygon")U(Bt.coordinates,le);else if(Lt==="MultiPolygon")for(ie=0;ie<Bt.coordinates.length;ie++)U(Bt.coordinates[ie],le);return Bt})($,!0);try{if(ot.filter){var lt=s.createExpression(ot.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map(function(It){return It.key+": "+It.message}).join(", "));var xt=$.features.filter(function(It){return lt.value.evaluate({zoom:0},It)});$={type:"FeatureCollection",features:xt}}G._geoJSONIndex=ot.cluster?new Oe(function(It){var Bt=It.superclusterOptions,le=It.clusterProperties;if(!le||!Bt)return Bt;for(var ie={},Lt={},Qt={accumulated:null,zoom:0},Ht={properties:null},Zt=Object.keys(le),Re=0,Yt=Zt;Re<Yt.length;Re+=1){var We=Yt[Re],mn=le[We],je=mn[0],Ye=s.createExpression(mn[1]),ze=s.createExpression(typeof je=="string"?[je,["accumulated"],["get",We]]:je);ie[We]=Ye.value,Lt[We]=ze.value}return Bt.map=function(Xn){Ht.properties=Xn;for(var Ze={},gn=0,on=Zt;gn<on.length;gn+=1){var De=on[gn];Ze[De]=ie[De].evaluate(Qt,Ht)}return Ze},Bt.reduce=function(Xn,Ze){Ht.properties=Ze;for(var gn=0,on=Zt;gn<on.length;gn+=1){var De=on[gn];Qt.accumulated=Xn[De],Xn[De]=Lt[De].evaluate(Qt,Ht)}},Bt}(ot)).load($.features):function(It,Bt){return new Yi(It,Bt)}($,ot.geojsonVtOptions)}catch(It){return J(It)}G.loaded={};var Nt={};if(mt){var Ut=mt.finish();Ut&&(Nt.resourceTiming={},Nt.resourceTiming[ot.source]=JSON.parse(JSON.stringify(Ut)))}J(null,Nt)})}},V.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},V.prototype.reloadTile=function(G,J){var ot=this.loaded;return ot&&ot[G.uid]?D.prototype.reloadTile.call(this,G,J):this.loadTile(G,J)},V.prototype.loadGeoJSON=function(G,J){if(G.request)s.getJSON(G.request,J);else{if(typeof G.data!="string")return J(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."));try{return J(null,JSON.parse(G.data))}catch{return J(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."))}}},V.prototype.removeSource=function(G,J){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),J()},V.prototype.getClusterExpansionZoom=function(G,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ot){J(ot)}},V.prototype.getClusterChildren=function(G,J){try{J(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ot){J(ot)}},V.prototype.getClusterLeaves=function(G,J){try{J(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ot){J(ot)}},V}(F),Dn=function(D){var V=this;this.self=D,this.actor=new s.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:F,geojson:ma},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(G,J){if(V.workerSourceTypes[G])throw new Error('Worker source with name "'+G+'" already registered.');V.workerSourceTypes[G]=J},this.self.registerRTLTextPlugin=function(G){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=G.applyArabicShaping,s.plugin.processBidirectionalText=G.processBidirectionalText,s.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}};return Dn.prototype.setReferrer=function(D,V){this.referrer=V},Dn.prototype.setImages=function(D,V,G){for(var J in this.availableImages[D]=V,this.workerSources[D]){var ot=this.workerSources[D][J];for(var mt in ot)ot[mt].availableImages=V}G()},Dn.prototype.setLayers=function(D,V,G){this.getLayerIndex(D).replace(V),G()},Dn.prototype.updateLayers=function(D,V,G){this.getLayerIndex(D).update(V.layers,V.removedIds),G()},Dn.prototype.loadTile=function(D,V,G){this.getWorkerSource(D,V.type,V.source).loadTile(V,G)},Dn.prototype.loadDEMTile=function(D,V,G){this.getDEMWorkerSource(D,V.source).loadTile(V,G)},Dn.prototype.reloadTile=function(D,V,G){this.getWorkerSource(D,V.type,V.source).reloadTile(V,G)},Dn.prototype.abortTile=function(D,V,G){this.getWorkerSource(D,V.type,V.source).abortTile(V,G)},Dn.prototype.removeTile=function(D,V,G){this.getWorkerSource(D,V.type,V.source).removeTile(V,G)},Dn.prototype.removeDEMTile=function(D,V){this.getDEMWorkerSource(D,V.source).removeTile(V)},Dn.prototype.removeSource=function(D,V,G){if(this.workerSources[D]&&this.workerSources[D][V.type]&&this.workerSources[D][V.type][V.source]){var J=this.workerSources[D][V.type][V.source];delete this.workerSources[D][V.type][V.source],J.removeSource!==void 0?J.removeSource(V,G):G()}},Dn.prototype.loadWorkerSource=function(D,V,G){try{this.self.importScripts(V.url),G()}catch(J){G(J.toString())}},Dn.prototype.syncRTLPluginState=function(D,V,G){try{s.plugin.setState(V);var J=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&J!=null){this.self.importScripts(J);var ot=s.plugin.isParsed();G(ot?void 0:new Error("RTL Text Plugin failed to import scripts from "+J),ot)}}catch(mt){G(mt.toString())}},Dn.prototype.getAvailableImages=function(D){var V=this.availableImages[D];return V||(V=[]),V},Dn.prototype.getLayerIndex=function(D){var V=this.layerIndexes[D];return V||(V=this.layerIndexes[D]=new _),V},Dn.prototype.getWorkerSource=function(D,V,G){var J=this;return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][V]||(this.workerSources[D][V]={}),this.workerSources[D][V][G]||(this.workerSources[D][V][G]=new this.workerSourceTypes[V]({send:function(ot,mt,gt){J.actor.send(ot,mt,gt,D)}},this.getLayerIndex(D),this.getAvailableImages(D))),this.workerSources[D][V][G]},Dn.prototype.getDEMWorkerSource=function(D,V){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][V]||(this.demWorkerSources[D][V]=new B),this.demWorkerSources[D][V]},Dn.prototype.enforceCacheSizeLimit=function(D,V){s.enforceCacheSizeLimit(V)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Dn(self)),Dn}),l(["./shared"],function(s){var p=s.createCommonjsModule(function(c){function f(x){return!h(x)}function h(x){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,C,O=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(O);try{C=new Worker(N),E=!0}catch{E=!1}return C&&C.terminate(),URL.revokeObjectURL(N),E}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var E=document.createElement("canvas");E.width=E.height=1;var C=E.getContext("2d");if(!C)return!1;var O=C.getImageData(0,0,1,1);return O&&O.width===E.width}()?(m[T=x&&x.failIfMajorPerformanceCaveat]===void 0&&(m[T]=function(E){var C=function(N){var Z=document.createElement("canvas"),Y=Object.create(f.webGLContextAttributes);return Y.failIfMajorPerformanceCaveat=N,Z.probablySupportsContext?Z.probablySupportsContext("webgl",Y)||Z.probablySupportsContext("experimental-webgl",Y):Z.supportsContext?Z.supportsContext("webgl",Y)||Z.supportsContext("experimental-webgl",Y):Z.getContext("webgl",Y)||Z.getContext("experimental-webgl",Y)}(E);if(!C)return!1;var O=C.createShader(C.VERTEX_SHADER);return!(!O||C.isContextLost())&&(C.shaderSource(O,"void main() {}"),C.compileShader(O),C.getShaderParameter(O,C.COMPILE_STATUS)===!0)}(T)),m[T]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}c.exports?c.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=h);var m={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),g={create:function(c,f,h){var m=s.window.document.createElement(c);return f!==void 0&&(m.className=f),h&&h.appendChild(m),m},createNS:function(c,f){return s.window.document.createElementNS(c,f)}},_=s.window.document&&s.window.document.documentElement.style;function w(c){if(!_)return c[0];for(var f=0;f<c.length;f++)if(c[f]in _)return c[f];return c[0]}var P,A=w(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);g.disableDrag=function(){_&&A&&(P=_[A],_[A]="none")},g.enableDrag=function(){_&&A&&(_[A]=P)};var M=w(["transform","WebkitTransform"]);g.setTransform=function(c,f){c.style[M]=f};var F=!1;try{var X=Object.defineProperty({},"passive",{get:function(){F=!0}});s.window.addEventListener("test",X,X),s.window.removeEventListener("test",X,X)}catch{F=!1}g.addEventListener=function(c,f,h,m){m===void 0&&(m={}),c.addEventListener(f,h,"passive"in m&&F?m:m.capture)},g.removeEventListener=function(c,f,h,m){m===void 0&&(m={}),c.removeEventListener(f,h,"passive"in m&&F?m:m.capture)};var B=function(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",B,!0)};function U(c){var f=c.userImage;return!!(f&&f.render&&f.render())&&(c.data.replace(new Uint8Array(f.data.buffer)),!0)}g.suppressClick=function(){s.window.addEventListener("click",B,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",B,!0)},0)},g.mousePos=function(c,f){var h=c.getBoundingClientRect();return new s.Point(f.clientX-h.left-c.clientLeft,f.clientY-h.top-c.clientTop)},g.touchPos=function(c,f){for(var h=c.getBoundingClientRect(),m=[],x=0;x<f.length;x++)m.push(new s.Point(f[x].clientX-h.left-c.clientLeft,f[x].clientY-h.top-c.clientTop));return m},g.mouseButton=function(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},g.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var H=function(c){function f(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var m=0,x=this.requestors;m<x.length;m+=1){var T=x[m];this._notify(T.ids,T.callback)}this.requestors=[]}},f.prototype.getImage=function(h){return this.images[h]},f.prototype.addImage=function(h,m){this._validate(h,m)&&(this.images[h]=m)},f.prototype._validate=function(h,m){var x=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),x=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),x=!1),this._validateContent(m.content,m)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),x=!1),x},f.prototype._validateStretch=function(h,m){if(!h)return!0;for(var x=0,T=0,E=h;T<E.length;T+=1){var C=E[T];if(C[0]<x||C[1]<C[0]||m<C[1])return!1;x=C[1]}return!0},f.prototype._validateContent=function(h,m){return!(h&&(h.length!==4||h[0]<0||m.data.width<h[0]||h[1]<0||m.data.height<h[1]||h[2]<0||m.data.width<h[2]||h[3]<0||m.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},f.prototype.updateImage=function(h,m){m.version=this.images[h].version+1,this.images[h]=m,this.updatedImages[h]=!0},f.prototype.removeImage=function(h){var m=this.images[h];delete this.images[h],delete this.patterns[h],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(h,m){var x=!0;if(!this.isLoaded())for(var T=0,E=h;T<E.length;T+=1)this.images[E[T]]||(x=!1);this.isLoaded()||x?this._notify(h,m):this.requestors.push({ids:h,callback:m})},f.prototype._notify=function(h,m){for(var x={},T=0,E=h;T<E.length;T+=1){var C=E[T];this.images[C]||this.fire(new s.Event("styleimagemissing",{id:C}));var O=this.images[C];O?x[C]={data:O.data.clone(),pixelRatio:O.pixelRatio,sdf:O.sdf,version:O.version,stretchX:O.stretchX,stretchY:O.stretchY,content:O.content,hasRenderCallback:Boolean(O.userImage&&O.userImage.render)}:s.warnOnce('Image "'+C+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,x)},f.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},f.prototype.getPattern=function(h){var m=this.patterns[h],x=this.getImage(h);if(!x)return null;if(m&&m.position.version===x.version)return m.position;if(m)m.position.version=x.version;else{var T={w:x.data.width+2,h:x.data.height+2,x:0,y:0},E=new s.ImagePosition(T,x);this.patterns[h]={bin:T,position:E}}return this._updatePatternAtlas(),this.patterns[h].position},f.prototype.bind=function(h){var m=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(h,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var h=[];for(var m in this.patterns)h.push(this.patterns[m].bin);var x=s.potpack(h),T=x.w,E=x.h,C=this.atlasImage;for(var O in C.resize({width:T||1,height:E||1}),this.patterns){var N=this.patterns[O].bin,Z=N.x+1,Y=N.y+1,K=this.images[O].data,at=K.width,it=K.height;s.RGBAImage.copy(K,C,{x:0,y:0},{x:Z,y:Y},{width:at,height:it}),s.RGBAImage.copy(K,C,{x:0,y:it-1},{x:Z,y:Y-1},{width:at,height:1}),s.RGBAImage.copy(K,C,{x:0,y:0},{x:Z,y:Y+it},{width:at,height:1}),s.RGBAImage.copy(K,C,{x:at-1,y:0},{x:Z-1,y:Y},{width:1,height:it}),s.RGBAImage.copy(K,C,{x:0,y:0},{x:Z+at,y:Y},{width:1,height:it})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(h){for(var m=0,x=h;m<x.length;m+=1){var T=x[m];if(!this.callbackDispatchedThisFrame[T]){this.callbackDispatchedThisFrame[T]=!0;var E=this.images[T];U(E)&&this.updateImage(T,E)}}},f}(s.Evented),tt=_t,st=_t,pt=1e20;function _t(c,f,h,m,x,T){this.fontSize=c||24,this.buffer=f===void 0?3:f,this.cutoff=m||.25,this.fontFamily=x||"sans-serif",this.fontWeight=T||"normal",this.radius=h||8;var E=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=E,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.d=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Int16Array(E),this.middle=Math.round(E/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ot(c,f,h,m,x,T,E){for(var C=0;C<f;C++){for(var O=0;O<h;O++)m[O]=c[O*f+C];for(Dt(m,x,T,E,h),O=0;O<h;O++)c[O*f+C]=x[O]}for(O=0;O<h;O++){for(C=0;C<f;C++)m[C]=c[O*f+C];for(Dt(m,x,T,E,f),C=0;C<f;C++)c[O*f+C]=Math.sqrt(x[C])}}function Dt(c,f,h,m,x){h[0]=0,m[0]=-pt,m[1]=+pt;for(var T=1,E=0;T<x;T++){for(var C=(c[T]+T*T-(c[h[E]]+h[E]*h[E]))/(2*T-2*h[E]);C<=m[E];)E--,C=(c[T]+T*T-(c[h[E]]+h[E]*h[E]))/(2*T-2*h[E]);h[++E]=T,m[E]=C,m[E+1]=+pt}for(T=0,E=0;T<x;T++){for(;m[E+1]<T;)E++;f[T]=(T-h[E])*(T-h[E])+c[h[E]]}}_t.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var x=f.data[4*m+3]/255;this.gridOuter[m]=x===1?0:x===0?pt:Math.pow(Math.max(0,.5-x),2),this.gridInner[m]=x===1?pt:x===0?0:Math.pow(Math.max(0,x-.5),2)}for(Ot(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ot(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)h[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return h},tt.default=st;var kt=function(c,f){this.requestManager=c,this.localIdeographFontFamily=f,this.entries={}};kt.prototype.setURL=function(c){this.url=c},kt.prototype.getGlyphs=function(c,f){var h=this,m=[];for(var x in c)for(var T=0,E=c[x];T<E.length;T+=1)m.push({stack:x,id:E[T]});s.asyncAll(m,function(C,O){var N=C.stack,Z=C.id,Y=h.entries[N];Y||(Y=h.entries[N]={glyphs:{},requests:{},ranges:{}});var K=Y.glyphs[Z];if(K===void 0){if(K=h._tinySDF(Y,N,Z))return Y.glyphs[Z]=K,void O(null,{stack:N,id:Z,glyph:K});var at=Math.floor(Z/256);if(256*at>65535)O(new Error("glyphs > 65535 not supported"));else if(Y.ranges[at])O(null,{stack:N,id:Z,glyph:K});else{var it=Y.requests[at];it||(it=Y.requests[at]=[],kt.loadGlyphRange(N,at,h.url,h.requestManager,function(ht,et){if(et){for(var ct in et)h._doesCharSupportLocalGlyph(+ct)||(Y.glyphs[+ct]=et[+ct]);Y.ranges[at]=!0}for(var yt=0,bt=it;yt<bt.length;yt+=1)(0,bt[yt])(ht,et);delete Y.requests[at]})),it.push(function(ht,et){ht?O(ht):et&&O(null,{stack:N,id:Z,glyph:et[Z]||null})})}}else O(null,{stack:N,id:Z,glyph:K})},function(C,O){if(C)f(C);else if(O){for(var N={},Z=0,Y=O;Z<Y.length;Z+=1){var K=Y[Z],at=K.stack,it=K.id,ht=K.glyph;(N[at]||(N[at]={}))[it]=ht&&{id:ht.id,bitmap:ht.bitmap.clone(),metrics:ht.metrics}}f(null,N)}})},kt.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](c)||s.isChar["Hangul Syllables"](c)||s.isChar.Hiragana(c)||s.isChar.Katakana(c))},kt.prototype._tinySDF=function(c,f,h){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(h)){var x=c.tinySDF;if(!x){var T="400";/bold/i.test(f)?T="900":/medium/i.test(f)?T="500":/light/i.test(f)&&(T="200"),x=c.tinySDF=new kt.TinySDF(24,3,8,.25,m,T)}return{id:h,bitmap:new s.AlphaImage({width:30,height:30},x.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},kt.loadGlyphRange=function(c,f,h,m,x){var T=256*f,E=T+255,C=m.transformRequest(m.normalizeGlyphsURL(h).replace("{fontstack}",c).replace("{range}",T+"-"+E),s.ResourceType.Glyphs);s.getArrayBuffer(C,function(O,N){if(O)x(O);else if(N){for(var Z={},Y=0,K=s.parseGlyphPBF(N);Y<K.length;Y+=1){var at=K[Y];Z[at.id]=at}x(null,Z)}})},kt.TinySDF=tt;var qt=function(){this.specification=s.styleSpec.light.position};qt.prototype.possiblyEvaluate=function(c,f){return s.sphericalToCartesian(c.expression.evaluate(f))},qt.prototype.interpolate=function(c,f,h){return{x:s.number(c.x,f.x,h),y:s.number(c.y,f.y,h),z:s.number(c.z,f.z,h)}};var ee=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new qt,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),_e=function(c){function f(h){c.call(this),this._transitionable=new s.Transitionable(ee),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(h,m){if(m===void 0&&(m={}),!this._validate(s.validateLight,h,m))for(var x in h){var T=h[x];s.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-11),T):this._transitionable.setValue(x,T)}},f.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},f.prototype._validate=function(h,m,x){return(!x||x.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},f}(s.Evented),ae=function(c,f){this.width=c,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ae.prototype.getDash=function(c,f){var h=c.join(",")+String(f);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(c,f)),this.dashEntry[h]},ae.prototype.getDashRanges=function(c,f,h){var m=[],x=c.length%2==1?-c[c.length-1]*h:0,T=c[0]*h,E=!0;m.push({left:x,right:T,isDash:E,zeroLength:c[0]===0});for(var C=c[0],O=1;O<c.length;O++){var N=c[O];m.push({left:x=C*h,right:T=(C+=N)*h,isDash:E=!E,zeroLength:N===0})}return m},ae.prototype.addRoundDash=function(c,f,h){for(var m=f/2,x=-h;x<=h;x++)for(var T=this.width*(this.nextRow+h+x),E=0,C=c[E],O=0;O<this.width;O++){O/C.right>1&&(C=c[++E]);var N=Math.abs(O-C.left),Z=Math.abs(O-C.right),Y=Math.min(N,Z),K=void 0,at=x/h*(m+1);if(C.isDash){var it=m-Math.abs(at);K=Math.sqrt(Y*Y+it*it)}else K=m-Math.sqrt(Y*Y+at*at);this.data[T+O]=Math.max(0,Math.min(255,K+128))}},ae.prototype.addRegularDash=function(c){for(var f=c.length-1;f>=0;--f){var h=c[f],m=c[f+1];h.zeroLength?c.splice(f,1):m&&m.isDash===h.isDash&&(m.left=h.left,c.splice(f,1))}var x=c[0],T=c[c.length-1];x.isDash===T.isDash&&(x.left=T.left-this.width,T.right=x.right+this.width);for(var E=this.width*this.nextRow,C=0,O=c[C],N=0;N<this.width;N++){N/O.right>1&&(O=c[++C]);var Z=Math.abs(N-O.left),Y=Math.abs(N-O.right),K=Math.min(Z,Y);this.data[E+N]=Math.max(0,Math.min(255,(O.isDash?K:-K)+128))}},ae.prototype.addDash=function(c,f){var h=f?7:0,m=2*h+1;if(this.nextRow+m>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var x=0,T=0;T<c.length;T++)x+=c[T];if(x!==0){var E=this.width/x,C=this.getDashRanges(c,this.width,E);f?this.addRoundDash(C,E,h):this.addRegularDash(C)}var O={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:x};return this.nextRow+=m,this.dirty=!0,O},ae.prototype.bind=function(c){var f=c.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var he=function c(f,h){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var m=this.workerPool.acquire(this.id),x=0;x<m.length;x++){var T=new c.Actor(m[x],h,this.id);T.name="Worker "+x,this.actors.push(T)}};function sn(c,f,h){var m=function(x,T){if(x)return h(x);if(T){var E=s.pick(s.extend(T,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(E.vectorLayers=T.vector_layers,E.vectorLayerIds=E.vectorLayers.map(function(C){return C.id})),E.tiles=f.canonicalizeTileset(E,c.url),h(null,E)}};return c.url?s.getJSON(f.transformRequest(f.normalizeSourceURL(c.url),s.ResourceType.Source),m):s.browser.frame(function(){return m(null,c)})}he.prototype.broadcast=function(c,f,h){s.asyncAll(this.actors,function(m,x){m.send(c,f,x)},h=h||function(){})},he.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},he.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},he.Actor=s.Actor;var ar=function(c,f,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=h||24};ar.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},ar.prototype.contains=function(c){var f=Math.pow(2,c.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*f),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*f),x=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*f),T=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*f);return c.x>=h&&c.x<x&&c.y>=m&&c.y<T};var gr=function(c){function f(h,m,x,T){if(c.call(this),this.id=h,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(m,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sn(this._options,this.map._requestManager,function(m,x){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new s.ErrorEvent(m)):x&&(s.extend(h,x),x.bounds&&(h.tileBounds=new ar(x.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(x.tiles,h.map._requestManager._customAccessToken),s.postMapLoadEvent(x.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(h){var m=this;return this.setSourceProperty(function(){m._options.tiles=h}),this},f.prototype.setUrl=function(h){var m=this;return this.setSourceProperty(function(){m.url=h,m._options.url=h}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return s.extend({},this._options)},f.prototype.loadTile=function(h,m){var x=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(x,s.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function E(C,O){return delete h.request,h.aborted?m(null):C&&C.status!==404?m(C):(O&&O.resourceTiming&&(h.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&h.setExpiryData(O),h.loadVectorData(O,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=m:h.request=h.actor.send("reloadTile",T,E.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",T,E.bind(this)))},f.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(s.Evented),mi=function(c){function f(h,m,x,T){c.call(this),this.id=h,this.dispatcher=x,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},m),s.extend(this,s.pick(m,["url","scheme","tileSize"]))}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sn(this._options,this.map._requestManager,function(m,x){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new s.ErrorEvent(m)):x&&(s.extend(h,x),x.bounds&&(h.tileBounds=new ar(x.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(x.tiles),s.postMapLoadEvent(x.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return s.extend({},this._options)},f.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},f.prototype.loadTile=function(h,m){var x=this,T=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=s.getImage(this.map._requestManager.transformRequest(T,s.ResourceType.Tile),function(E,C){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(E)h.state="errored",m(E);else if(C){x.map._refreshExpiredTiles&&h.setExpiryData(C),delete C.cacheControl,delete C.expires;var O=x.map.painter.context,N=O.gl;h.texture=x.map.painter.getTileTexture(C.width),h.texture?h.texture.update(C,{useMipmap:!0}):(h.texture=new s.Texture(O,C,N.RGBA,{useMipmap:!0}),h.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),O.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),h.state="loaded",s.cacheEntryPossiblyAdded(x.dispatcher),m(null)}})},f.prototype.abortTile=function(h,m){h.request&&(h.request.cancel(),delete h.request),m()},f.prototype.unloadTile=function(h,m){h.texture&&this.map.painter.saveTileTexture(h.texture),m()},f.prototype.hasTransition=function(){return!1},f}(s.Evented),$i=function(c){function f(h,m,x,T){c.call(this,h,m,x,T),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(h,m){var x=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function T(E,C){E&&(h.state="errored",m(E)),C&&(h.dem=C,h.needsHillshadePrepare=!0,h.state="loaded",m(null))}h.request=s.getImage(this.map._requestManager.transformRequest(x,s.ResourceType.Tile),function(E,C){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(E)h.state="errored",m(E);else if(C){this.map._refreshExpiredTiles&&h.setExpiryData(C),delete C.cacheControl,delete C.expires;var O=s.window.ImageBitmap&&C instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?C:s.browser.getImageData(C,1),N={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:O,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",N,T.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},f.prototype._getNeighboringTiles=function(h){var m=h.canonical,x=Math.pow(2,m.z),T=(m.x-1+x)%x,E=m.x===0?h.wrap-1:h.wrap,C=(m.x+1+x)%x,O=m.x+1===x?h.wrap+1:h.wrap,N={};return N[new s.OverscaledTileID(h.overscaledZ,E,m.z,T,m.y).key]={backfilled:!1},N[new s.OverscaledTileID(h.overscaledZ,O,m.z,C,m.y).key]={backfilled:!1},m.y>0&&(N[new s.OverscaledTileID(h.overscaledZ,E,m.z,T,m.y-1).key]={backfilled:!1},N[new s.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},N[new s.OverscaledTileID(h.overscaledZ,O,m.z,C,m.y-1).key]={backfilled:!1}),m.y+1<x&&(N[new s.OverscaledTileID(h.overscaledZ,E,m.z,T,m.y+1).key]={backfilled:!1},N[new s.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},N[new s.OverscaledTileID(h.overscaledZ,O,m.z,C,m.y+1).key]={backfilled:!1}),N},f.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},f}(mi),gi=function(c){function f(h,m,x,T){c.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=x.getActor(),this.setEventedParent(T),this._data=m.data,this._options=s.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var E=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*E,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*E,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:s.EXTENT,radius:(m.clusterRadius||50)*E,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)h.fire(new s.ErrorEvent(m));else{var x={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(x.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new s.Event("data",x))}})},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.setData=function(h){var m=this;return this._data=h,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)m.fire(new s.ErrorEvent(x));else{var T={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(T.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new s.Event("data",T))}}),this},f.prototype.getClusterExpansionZoom=function(h,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},m),this},f.prototype.getClusterChildren=function(h,m){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},m),this},f.prototype.getClusterLeaves=function(h,m,x,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:m,offset:x},T),this},f.prototype._updateWorkerData=function(h){var m=this;this._loaded=!1;var x=s.extend({},this.workerOptions),T=this._data;typeof T=="string"?(x.request=this.map._requestManager.transformRequest(s.browser.resolveURL(T),s.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(T),this.actor.send(this.type+".loadData",x,function(E,C){m._removed||C&&C.abandoned||(m._loaded=!0,C&&C.resourceTiming&&C.resourceTiming[m.id]&&(m._resourceTiming=C.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:x.source},null),h(E))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(h,m){var x=this,T=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(T,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(E,C){return delete h.request,h.unloadVectorData(),h.aborted?m(null):E?m(E):(h.loadVectorData(C,x.map.painter,T==="reloadTile"),m(null))})},f.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},f.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(s.Evented),Vr=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Sr=function(c){function f(h,m,x,T){c.call(this),this.id=h,this.dispatcher=x,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(h,m){var x=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(T,E){x._loaded=!0,T?x.fire(new s.ErrorEvent(T)):E&&(x.image=E,h&&(x.coordinates=h),m&&m(),x._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(h){var m=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){m.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.setCoordinates=function(h){var m=this;this.coordinates=h;var x=h.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(E){for(var C=1/0,O=1/0,N=-1/0,Z=-1/0,Y=0,K=E;Y<K.length;Y+=1){var at=K[Y];C=Math.min(C,at.x),O=Math.min(O,at.y),N=Math.max(N,at.x),Z=Math.max(Z,at.y)}var it=Math.max(N-C,Z-O),ht=Math.max(0,Math.floor(-Math.log(it)/Math.LN2)),et=Math.pow(2,ht);return new s.CanonicalTileID(ht,Math.floor((C+N)/2*et),Math.floor((O+Z)/2*et))}(x),this.minzoom=this.maxzoom=this.tileID.z;var T=x.map(function(E){return m.tileID.getTilePoint(E)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,m=h.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(h,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.loadTile=function(h,m){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},m(null)):(h.state="errored",m(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(s.Evented),ho=function(c){function f(h,m,x,T){c.call(this,h,m,x,T),this.roundZoom=!0,this.type="video",this.options=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1;var m=this.options;this.urls=[];for(var x=0,T=m.urls;x<T.length;x+=1)this.urls.push(this.map._requestManager.transformRequest(T[x],s.ResourceType.Source).url);s.getVideo(this.urls,function(E,C){h._loaded=!0,E?h.fire(new s.ErrorEvent(E)):C&&(h.video=C,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(h){if(this.video){var m=this.video.seekable;h<m.start(0)||h>m.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=h}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,m=h.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(h,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(Sr),Jt=function(c){function f(h,m,x,T){c.call(this,h,m,x,T),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(E){return!Array.isArray(E)||E.length!==2||E.some(function(C){return typeof C!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,x=m.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(m,this.canvas,x.RGBA,{premultiply:!0}),this.tiles){var E=this.tiles[T];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var h=0,m=[this.canvas.width,this.canvas.height];h<m.length;h+=1){var x=m[h];if(isNaN(x)||x<=0)return!0}return!1},f}(Sr),Te={vector:gr,raster:mi,"raster-dem":$i,geojson:gi,video:ho,image:Sr,canvas:Jt};function Je(c,f){var h=s.identity([]);return s.translate(h,h,[1,1,0]),s.scale(h,h,[.5*c.width,.5*c.height,1]),s.multiply(h,h,c.calculatePosMatrix(f.toUnwrapped()))}function Oe(c,f,h,m,x,T){var E=function(ht,et,ct){if(ht)for(var yt=0,bt=ht;yt<bt.length;yt+=1){var Ct=et[bt[yt]];if(Ct&&Ct.source===ct&&Ct.type==="fill-extrusion")return!0}else for(var Pt in et){var Mt=et[Pt];if(Mt.source===ct&&Mt.type==="fill-extrusion")return!0}return!1}(x&&x.layers,f,c.id),C=T.maxPitchScaleFactor(),O=c.tilesIn(m,C,E);O.sort(an);for(var N=[],Z=0,Y=O;Z<Y.length;Z+=1){var K=Y[Z];N.push({wrappedTileID:K.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(f,h,c._state,K.queryGeometry,K.cameraQueryGeometry,K.scale,x,T,C,Je(c.transform,K.tileID))})}var at=function(ht){for(var et={},ct={},yt=0,bt=ht;yt<bt.length;yt+=1){var Ct=bt[yt],Pt=Ct.queryResults,Mt=Ct.wrappedTileID,Ft=ct[Mt]=ct[Mt]||{};for(var Wt in Pt)for(var Gt=Pt[Wt],re=Ft[Wt]=Ft[Wt]||{},ge=et[Wt]=et[Wt]||[],we=0,xe=Gt;we<xe.length;we+=1){var en=xe[we];re[en.featureIndex]||(re[en.featureIndex]=!0,ge.push(en))}}return et}(N);for(var it in at)at[it].forEach(function(ht){var et=ht.feature,ct=c.getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=ct});return at}function an(c,f){var h=c.tileID,m=f.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}var Se=function(c,f){this.max=c,this.onRemove=f,this.reset()};Se.prototype.reset=function(){for(var c in this.data)for(var f=0,h=this.data[c];f<h.length;f+=1){var m=h[f];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},Se.prototype.add=function(c,f,h){var m=this,x=c.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);var T={value:f,timeout:void 0};if(h!==void 0&&(T.timeout=setTimeout(function(){m.remove(c,T)},h)),this.data[x].push(T),this.order.push(x),this.order.length>this.max){var E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this},Se.prototype.has=function(c){return c.wrapped().key in this.data},Se.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},Se.prototype._getAndRemoveByKey=function(c){var f=this.data[c].shift();return f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),f.value},Se.prototype.getByKey=function(c){var f=this.data[c];return f?f[0].value:null},Se.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},Se.prototype.remove=function(c,f){if(!this.has(c))return this;var h=c.wrapped().key,m=f===void 0?0:this.data[h].indexOf(f),x=this.data[h][m];return this.data[h].splice(m,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this},Se.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Se.prototype.filter=function(c){var f=[];for(var h in this.data)for(var m=0,x=this.data[h];m<x.length;m+=1){var T=x[m];c(T.value)||f.push(T)}for(var E=0,C=f;E<C.length;E+=1){var O=C[E];this.remove(O.value.tileID,O)}};var dn=function(c,f,h){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};dn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},dn.prototype.updateData=function(c){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},dn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var jr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Un=function(c,f,h,m){this.length=f.length,this.attributes=h,this.itemSize=f.bytesPerElement,this.dynamicDraw=m,this.context=c;var x=c.gl;this.buffer=x.createBuffer(),c.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Un.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Un.prototype.updateData=function(c){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)},Un.prototype.enableAttributes=function(c,f){for(var h=0;h<this.attributes.length;h++){var m=f.attributes[this.attributes[h].name];m!==void 0&&c.enableVertexAttribArray(m)}},Un.prototype.setVertexAttribPointers=function(c,f,h){for(var m=0;m<this.attributes.length;m++){var x=this.attributes[m],T=f.attributes[x.name];T!==void 0&&c.vertexAttribPointer(T,x.components,c[jr[x.type]],!1,this.itemSize,x.offset+this.itemSize*(h||0))}},Un.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ve=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ve.prototype.get=function(){return this.current},Ve.prototype.set=function(c){},Ve.prototype.getDefault=function(){return this.default},Ve.prototype.setDefault=function(){this.set(this.default)};var yi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return s.Color.transparent},f.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},f}(Ve),lr=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},f}(Ve),Zn=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},f}(Ve),fo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},f}(Ve),vi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},f}(Ve),gs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},f}(Ve),Gr=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(h){var m=this.current;(h.func!==m.func||h.ref!==m.ref||h.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},f}(Ve),yr=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},f}(Ve),ys=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=h,this.dirty=!1}},f}(Ve),_i=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},f}(Ve),xi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=h,this.dirty=!1}},f}(Ve),Ho=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},f}(Ve),Ni=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.BLEND):m.disable(m.BLEND),this.current=h,this.dirty=!1}},f}(Ve),ca=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},f}(Ve),ha=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return s.Color.transparent},f.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},f}(Ve),vs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},f}(Ve),_s=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=h,this.dirty=!1}},f}(Ve),po=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},f}(Ve),xs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},f}(Ve),bs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},f}(Ve),fa=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},f}(Ve),qo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},f}(Ve),pa=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},f}(Ve),da=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},f}(Ve),Zo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,h),this.current=h,this.dirty=!1}},f}(Ve),dl=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},f}(Ve),Xo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},f}(Ve),Yi=function(c){function f(h){c.call(this,h),this.vao=h.extVertexArrayObject}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},f}(Ve),Ki=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},f}(Ve),Lo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},f}(Ve),ma=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},f}(Ve),Dn=function(c){function f(h,m){c.call(this,h),this.context=h,this.parent=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(Ve),D=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},f}(Dn),V=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},f}(Dn),G=function(c,f,h,m){this.context=c,this.width=f,this.height=h;var x=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new D(c,x),m&&(this.depthAttachment=new V(c,x))};G.prototype.destroy=function(){var c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){var h=this.depthAttachment.get();h&&c.deleteRenderbuffer(h)}c.deleteFramebuffer(this.framebuffer)};var J=function(c,f,h){this.func=c,this.mask=f,this.range=h};J.ReadOnly=!1,J.ReadWrite=!0,J.disabled=new J(519,J.ReadOnly,[0,1]);var ot=function(c,f,h,m,x,T){this.test=c,this.ref=f,this.mask=h,this.fail=m,this.depthFail=x,this.pass=T};ot.disabled=new ot({func:519,mask:0},0,0,7680,7680,7680);var mt=function(c,f,h){this.blendFunction=c,this.blendColor=f,this.mask=h};mt.disabled=new mt(mt.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),mt.unblended=new mt(mt.Replace,s.Color.transparent,[!0,!0,!0,!0]),mt.alphaBlended=new mt([1,771],s.Color.transparent,[!0,!0,!0,!0]);var gt=function(c,f,h){this.enable=c,this.mode=f,this.frontFace=h};gt.disabled=new gt(!1,1029,2305),gt.backCCW=new gt(!0,1029,2305);var $=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new yi(this),this.clearDepth=new lr(this),this.clearStencil=new Zn(this),this.colorMask=new fo(this),this.depthMask=new vi(this),this.stencilMask=new gs(this),this.stencilFunc=new Gr(this),this.stencilOp=new yr(this),this.stencilTest=new ys(this),this.depthRange=new _i(this),this.depthTest=new xi(this),this.depthFunc=new Ho(this),this.blend=new Ni(this),this.blendFunc=new ca(this),this.blendColor=new ha(this),this.blendEquation=new vs(this),this.cullFace=new _s(this),this.cullFaceSide=new po(this),this.frontFace=new xs(this),this.program=new bs(this),this.activeTexture=new fa(this),this.viewport=new qo(this),this.bindFramebuffer=new pa(this),this.bindRenderbuffer=new da(this),this.bindTexture=new Zo(this),this.bindVertexBuffer=new dl(this),this.bindElementBuffer=new Xo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Yi(this),this.pixelStoreUnpack=new Ki(this),this.pixelStoreUnpackPremultiplyAlpha=new Lo(this),this.pixelStoreUnpackFlipY=new ma(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};$.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},$.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},$.prototype.createIndexBuffer=function(c,f){return new dn(this,c,f)},$.prototype.createVertexBuffer=function(c,f,h){return new Un(this,c,f,h)},$.prototype.createRenderbuffer=function(c,f,h){var m=this.gl,x=m.createRenderbuffer();return this.bindRenderbuffer.set(x),m.renderbufferStorage(m.RENDERBUFFER,c,f,h),this.bindRenderbuffer.set(null),x},$.prototype.createFramebuffer=function(c,f,h){return new G(this,c,f,h)},$.prototype.clear=function(c){var f=c.color,h=c.depth,m=this.gl,x=0;f&&(x|=m.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(x|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m.clear(x)},$.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},$.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},$.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},$.prototype.setColorMode=function(c){s.deepEqual(c.blendFunction,mt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},$.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var lt=function(c){function f(h,m,x){var T=this;c.call(this),this.id=h,this.dispatcher=x,this.on("data",function(E){E.dataType==="source"&&E.sourceDataType==="metadata"&&(T._sourceLoaded=!0),T._sourceLoaded&&!T._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(T.reload(),T.transform&&T.update(T.transform))}),this.on("error",function(){T._sourceErrored=!0}),this._source=function(E,C,O,N){var Z=new Te[C.type](E,C,O,N);if(Z.id!==E)throw new Error("Expected Source id to be "+E+" instead of "+Z.id);return s.bindAll(["load","abort","unload","serialize","prepare"],Z),Z}(h,m,x,this),this._tiles={},this._cache=new Se(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},f.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var m=this._tiles[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(h,m){return this._source.loadTile(h,m)},f.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},f.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(h){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var x=this._tiles[m];x.upload(h),x.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return s.values(this._tiles).map(function(h){return h.tileID}).sort(xt).map(function(h){return h.key})},f.prototype.getRenderableIds=function(h){var m=this,x=[];for(var T in this._tiles)this._isIdRenderable(T,h)&&x.push(this._tiles[T]);return h?x.sort(function(E,C){var O=E.tileID,N=C.tileID,Z=new s.Point(O.canonical.x,O.canonical.y)._rotate(m.transform.angle),Y=new s.Point(N.canonical.x,N.canonical.y)._rotate(m.transform.angle);return O.overscaledZ-N.overscaledZ||Y.y-Z.y||Y.x-Z.x}).map(function(E){return E.tileID.key}):x.map(function(E){return E.tileID}).sort(xt).map(function(E){return E.key})},f.prototype.hasRenderableParent=function(h){var m=this.findLoadedParent(h,0);return!!m&&this._isIdRenderable(m.tileID.key)},f.prototype._isIdRenderable=function(h,m){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(m||!this._tiles[h].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},f.prototype._reloadTile=function(h,m){var x=this._tiles[h];x&&(x.state!=="loading"&&(x.state=m),this._loadTile(x,this._tileLoaded.bind(this,x,h,m)))},f.prototype._tileLoaded=function(h,m,x,T){if(T)return h.state="errored",void(T.status!==404?this._source.fire(new s.ErrorEvent(T,{tile:h})):this.update(this.transform));h.timeAdded=s.browser.now(),x==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(m,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},f.prototype._backfillDEM=function(h){for(var m=this.getRenderableIds(),x=0;x<m.length;x++){var T=m[x];if(h.neighboringTiles&&h.neighboringTiles[T]){var E=this.getTileByID(T);C(h,E),C(E,h)}}function C(O,N){O.needsHillshadePrepare=!0;var Z=N.tileID.canonical.x-O.tileID.canonical.x,Y=N.tileID.canonical.y-O.tileID.canonical.y,K=Math.pow(2,O.tileID.canonical.z),at=N.tileID.key;Z===0&&Y===0||Math.abs(Y)>1||(Math.abs(Z)>1&&(Math.abs(Z+K)===1?Z+=K:Math.abs(Z-K)===1&&(Z-=K)),N.dem&&O.dem&&(O.dem.backfillBorder(N.dem,Z,Y),O.neighboringTiles&&O.neighboringTiles[at]&&(O.neighboringTiles[at].backfilled=!0)))}},f.prototype.getTile=function(h){return this.getTileByID(h.key)},f.prototype.getTileByID=function(h){return this._tiles[h]},f.prototype._retainLoadedChildren=function(h,m,x,T){for(var E in this._tiles){var C=this._tiles[E];if(!(T[E]||!C.hasData()||C.tileID.overscaledZ<=m||C.tileID.overscaledZ>x)){for(var O=C.tileID;C&&C.tileID.overscaledZ>m+1;){var N=C.tileID.scaledTo(C.tileID.overscaledZ-1);(C=this._tiles[N.key])&&C.hasData()&&(O=N)}for(var Z=O;Z.overscaledZ>m;)if(h[(Z=Z.scaledTo(Z.overscaledZ-1)).key]){T[O.key]=O;break}}}},f.prototype.findLoadedParent=function(h,m){if(h.key in this._loadedParentTiles){var x=this._loadedParentTiles[h.key];return x&&x.tileID.overscaledZ>=m?x:null}for(var T=h.overscaledZ-1;T>=m;T--){var E=h.scaledTo(T),C=this._getLoadedTile(E);if(C)return C}},f.prototype._getLoadedTile=function(h){var m=this._tiles[h.key];return m&&m.hasData()?m:this._cache.getByKey(h.wrapped().key)},f.prototype.updateCacheSize=function(h){var m=Math.ceil(h.width/this._source.tileSize)+1,x=Math.ceil(h.height/this._source.tileSize)+1,T=Math.floor(m*x*5),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(E)},f.prototype.handleWrapJump=function(h){var m=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,m){var x={};for(var T in this._tiles){var E=this._tiles[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+m),x[E.tileID.key]=E}for(var C in this._tiles=x,this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(var O in this._tiles)this._setTileReloadTimer(O,this._tiles[O])}},f.prototype.update=function(h){var m=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var x;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?x=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ft){return new s.OverscaledTileID(Ft.canonical.z,Ft.wrap,Ft.canonical.z,Ft.canonical.x,Ft.canonical.y)}):(x=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(x=x.filter(function(Ft){return m._source.hasTile(Ft)}))):x=[];var T=h.coveringZoomLevel(this._source),E=Math.max(T-f.maxOverzooming,this._source.minzoom),C=Math.max(T+f.maxUnderzooming,this._source.minzoom),O=this._updateRetainedTiles(x,T);if(Nt(this._source.type)){for(var N={},Z={},Y=0,K=Object.keys(O);Y<K.length;Y+=1){var at=K[Y],it=O[at],ht=this._tiles[at];if(ht&&!(ht.fadeEndTime&&ht.fadeEndTime<=s.browser.now())){var et=this.findLoadedParent(it,E);et&&(this._addTile(et.tileID),N[et.tileID.key]=et.tileID),Z[at]=it}}for(var ct in this._retainLoadedChildren(Z,T,C,O),N)O[ct]||(this._coveredTiles[ct]=!0,O[ct]=N[ct])}for(var yt in O)this._tiles[yt].clearFadeHold();for(var bt=0,Ct=s.keysDifference(this._tiles,O);bt<Ct.length;bt+=1){var Pt=Ct[bt],Mt=this._tiles[Pt];Mt.hasSymbolBuckets&&!Mt.holdingForFade()?Mt.setHoldDuration(this.map._fadeDuration):Mt.hasSymbolBuckets&&!Mt.symbolFadeFinished()||this._removeTile(Pt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},f.prototype._updateRetainedTiles=function(h,m){for(var x={},T={},E=Math.max(m-f.maxOverzooming,this._source.minzoom),C=Math.max(m+f.maxUnderzooming,this._source.minzoom),O={},N=0,Z=h;N<Z.length;N+=1){var Y=Z[N],K=this._addTile(Y);x[Y.key]=Y,K.hasData()||m<this._source.maxzoom&&(O[Y.key]=Y)}this._retainLoadedChildren(O,m,C,x);for(var at=0,it=h;at<it.length;at+=1){var ht=it[at],et=this._tiles[ht.key];if(!et.hasData()){if(m+1>this._source.maxzoom){var ct=ht.children(this._source.maxzoom)[0],yt=this.getTile(ct);if(yt&&yt.hasData()){x[ct.key]=ct;continue}}else{var bt=ht.children(this._source.maxzoom);if(x[bt[0].key]&&x[bt[1].key]&&x[bt[2].key]&&x[bt[3].key])continue}for(var Ct=et.wasRequested(),Pt=ht.overscaledZ-1;Pt>=E;--Pt){var Mt=ht.scaledTo(Pt);if(T[Mt.key]||(T[Mt.key]=!0,!(et=this.getTile(Mt))&&Ct&&(et=this._addTile(Mt)),et&&(x[Mt.key]=Mt,Ct=et.wasRequested(),et.hasData())))break}}}return x},f.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var m=[],x=void 0,T=this._tiles[h].tileID;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){x=this._loadedParentTiles[T.key];break}m.push(T.key);var E=T.scaledTo(T.overscaledZ-1);if(x=this._getLoadedTile(E))break;T=E}for(var C=0,O=m;C<O.length;C+=1)this._loadedParentTiles[O[C]]=x}},f.prototype._addTile=function(h){var m=this._tiles[h.key];if(m)return m;(m=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,m),m.tileID=h,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,m)));var x=Boolean(m);return x||(m=new s.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,h.key,m.state))),m?(m.uses++,this._tiles[h.key]=m,x||this._source.fire(new s.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},f.prototype._setTileReloadTimer=function(h,m){var x=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var T=m.getExpiryTimeout();T&&(this._timers[h]=setTimeout(function(){x._reloadTile(h,"expired"),delete x._timers[h]},T))},f.prototype._removeTile=function(h){var m=this._tiles[h];m&&(m.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},f.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},f.prototype.tilesIn=function(h,m,x){var T=this,E=[],C=this.transform;if(!C)return E;for(var O=x?C.getCameraQueryGeometry(h):h,N=h.map(function(Pt){return C.pointCoordinate(Pt)}),Z=O.map(function(Pt){return C.pointCoordinate(Pt)}),Y=this.getIds(),K=1/0,at=1/0,it=-1/0,ht=-1/0,et=0,ct=Z;et<ct.length;et+=1){var yt=ct[et];K=Math.min(K,yt.x),at=Math.min(at,yt.y),it=Math.max(it,yt.x),ht=Math.max(ht,yt.y)}for(var bt=function(Pt){var Mt=T._tiles[Y[Pt]];if(!Mt.holdingForFade()){var Ft=Mt.tileID,Wt=Math.pow(2,C.zoom-Mt.tileID.overscaledZ),Gt=m*Mt.queryPadding*s.EXTENT/Mt.tileSize/Wt,re=[Ft.getTilePoint(new s.MercatorCoordinate(K,at)),Ft.getTilePoint(new s.MercatorCoordinate(it,ht))];if(re[0].x-Gt<s.EXTENT&&re[0].y-Gt<s.EXTENT&&re[1].x+Gt>=0&&re[1].y+Gt>=0){var ge=N.map(function(xe){return Ft.getTilePoint(xe)}),we=Z.map(function(xe){return Ft.getTilePoint(xe)});E.push({tile:Mt,tileID:Ft,queryGeometry:ge,cameraQueryGeometry:we,scale:Wt})}}},Ct=0;Ct<Y.length;Ct++)bt(Ct);return E},f.prototype.getVisibleCoordinates=function(h){for(var m=this,x=this.getRenderableIds(h).map(function(O){return m._tiles[O].tileID}),T=0,E=x;T<E.length;T+=1){var C=E[T];C.posMatrix=this.transform.calculatePosMatrix(C.toUnwrapped())}return x},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Nt(this._source.type))for(var h in this._tiles){var m=this._tiles[h];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=s.browser.now())return!0}return!1},f.prototype.setFeatureState=function(h,m,x){this._state.updateState(h=h||"_geojsonTileLayer",m,x)},f.prototype.removeFeatureState=function(h,m,x){this._state.removeFeatureState(h=h||"_geojsonTileLayer",m,x)},f.prototype.getFeatureState=function(h,m){return this._state.getState(h=h||"_geojsonTileLayer",m)},f.prototype.setDependencies=function(h,m,x){var T=this._tiles[h];T&&T.setDependencies(m,x)},f.prototype.reloadTilesForDependencies=function(h,m){for(var x in this._tiles)this._tiles[x].hasDependency(h,m)&&this._reloadTile(x,"reloading");this._cache.filter(function(T){return!T.hasDependency(h,m)})},f}(s.Evented);function xt(c,f){var h=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*f.wrap)-+(f.wrap<0);return c.overscaledZ-f.overscaledZ||m-h||f.canonical.y-c.canonical.y||f.canonical.x-c.canonical.x}function Nt(c){return c==="raster"||c==="image"||c==="video"}function Ut(){return new s.window.Worker(Hc.workerUrl)}lt.maxOverzooming=10,lt.maxUnderzooming=3;var It="mapboxgl_preloaded_worker_pool",Bt=function(){this.active={}};Bt.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Ut);return this.active[c]=!0,this.workers.slice()},Bt.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},Bt.prototype.isPreloaded=function(){return!!this.active[It]},Bt.prototype.numActive=function(){return Object.keys(this.active).length};var le,ie=Math.floor(s.browser.hardwareConcurrency/2);function Lt(){return le||(le=new Bt),le}function Qt(c,f){var h={};for(var m in c)m!=="ref"&&(h[m]=c[m]);return s.refProperties.forEach(function(x){x in f&&(h[x]=f[x])}),h}function Ht(c){c=c.slice();for(var f=Object.create(null),h=0;h<c.length;h++)f[c[h].id]=c[h];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=Qt(c[m],f[c[m].ref]));return c}Bt.workerCount=Math.max(Math.min(ie,6),1);var Zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Re(c,f,h){h.push({command:Zt.addSource,args:[c,f[c]]})}function Yt(c,f,h){f.push({command:Zt.removeSource,args:[c]}),h[c]=!0}function We(c,f,h,m){Yt(c,h,m),Re(c,f,h)}function mn(c,f,h){var m;for(m in c[h])if(c[h].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(c[h][m],f[h][m]))return!1;for(m in f[h])if(f[h].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(c[h][m],f[h][m]))return!1;return!0}function je(c,f,h,m,x,T){var E;for(E in f=f||{},c=c||{})c.hasOwnProperty(E)&&(s.deepEqual(c[E],f[E])||h.push({command:T,args:[m,E,f[E],x]}));for(E in f)f.hasOwnProperty(E)&&!c.hasOwnProperty(E)&&(s.deepEqual(c[E],f[E])||h.push({command:T,args:[m,E,f[E],x]}))}function Ye(c){return c.id}function ze(c,f){return c[f.id]=f,c}var Xn=function(c,f){this.reset(c,f)};Xn.prototype.reset=function(c,f){this.points=c||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Xn.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=s.clamp(c,0,1);for(var f=1,h=this._distances[f],m=c*this.paddedLength+this.padding;h<m&&f<this._distances.length;)h=this._distances[++f];var x=f-1,T=this._distances[x],E=h-T,C=E>0?(m-T)/E:0;return this.points[x].mult(1-C).add(this.points[f].mult(C))};var Ze=function(c,f,h){var m=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(c/h),this.yCellCount=Math.ceil(f/h);for(var T=0;T<this.xCellCount*this.yCellCount;T++)m.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function gn(c,f,h,m,x){var T=s.create();return f?(s.scale(T,T,[1/x,1/x,1]),h||s.rotateZ(T,T,m.angle)):s.multiply(T,m.labelPlaneMatrix,c),T}function on(c,f,h,m,x){if(f){var T=s.clone(c);return s.scale(T,T,[x,x,1]),h||s.rotateZ(T,T,-m.angle),T}return m.glCoordMatrix}function De(c,f){var h=[c.x,c.y,0,1];jn(h,h,f);var m=h[3];return{point:new s.Point(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function Ge(c,f){return .5+c/f*.5}function Rr(c,f){var h=c[0]/c[3],m=c[1]/c[3];return h>=-f[0]&&h<=f[0]&&m>=-f[1]&&m<=f[1]}function ws(c,f,h,m,x,T,E,C){var O=m?c.textSizeData:c.iconSizeData,N=s.evaluateSizeForZoom(O,h.transform.zoom),Z=[256/h.width*2+1,256/h.height*2+1],Y=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Y.clear();for(var K=c.lineVertexArray,at=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,it=h.transform.width/h.transform.height,ht=!1,et=0;et<at.length;et++){var ct=at.get(et);if(ct.hidden||ct.writingMode===s.WritingMode.vertical&&!ht)vr(ct.numGlyphs,Y);else{ht=!1;var yt=[ct.anchorX,ct.anchorY,0,1];if(s.transformMat4(yt,yt,f),Rr(yt,Z)){var bt=Ge(h.transform.cameraToCenterDistance,yt[3]),Ct=s.evaluateSizeForFeature(O,N,ct),Pt=E?Ct/bt:Ct*bt,Mt=new s.Point(ct.anchorX,ct.anchorY),Ft=De(Mt,x).point,Wt={},Gt=Ts(ct,Pt,!1,C,f,x,T,c.glyphOffsetArray,K,Y,Ft,Mt,Wt,it);ht=Gt.useVertical,(Gt.notEnoughRoom||ht||Gt.needsFlipping&&Ts(ct,Pt,!0,C,f,x,T,c.glyphOffsetArray,K,Y,Ft,Mt,Wt,it).notEnoughRoom)&&vr(ct.numGlyphs,Y)}else vr(ct.numGlyphs,Y)}}m?c.text.dynamicLayoutVertexBuffer.updateData(Y):c.icon.dynamicLayoutVertexBuffer.updateData(Y)}function Vn(c,f,h,m,x,T,E,C,O,N,Z){var Y=C.glyphStartIndex+C.numGlyphs,K=C.lineStartIndex,at=C.lineStartIndex+C.lineLength,it=f.getoffsetX(C.glyphStartIndex),ht=f.getoffsetX(Y-1),et=In(c*it,h,m,x,T,E,C.segment,K,at,O,N,Z);if(!et)return null;var ct=In(c*ht,h,m,x,T,E,C.segment,K,at,O,N,Z);return ct?{first:et,last:ct}:null}function Cn(c,f,h,m){return c===s.WritingMode.horizontal&&Math.abs(h.y-f.y)>Math.abs(h.x-f.x)*m?{useVertical:!0}:(c===s.WritingMode.vertical?f.y<h.y:f.x>h.x)?{needsFlipping:!0}:null}function Ts(c,f,h,m,x,T,E,C,O,N,Z,Y,K,at){var it,ht=f/24,et=c.lineOffsetX*ht,ct=c.lineOffsetY*ht;if(c.numGlyphs>1){var yt=c.glyphStartIndex+c.numGlyphs,bt=c.lineStartIndex,Ct=c.lineStartIndex+c.lineLength,Pt=Vn(ht,C,et,ct,h,Z,Y,c,O,T,K);if(!Pt)return{notEnoughRoom:!0};var Mt=De(Pt.first.point,E).point,Ft=De(Pt.last.point,E).point;if(m&&!h){var Wt=Cn(c.writingMode,Mt,Ft,at);if(Wt)return Wt}it=[Pt.first];for(var Gt=c.glyphStartIndex+1;Gt<yt-1;Gt++)it.push(In(ht*C.getoffsetX(Gt),et,ct,h,Z,Y,c.segment,bt,Ct,O,T,K));it.push(Pt.last)}else{if(m&&!h){var re=De(Y,x).point,ge=c.lineStartIndex+c.segment+1,we=new s.Point(O.getx(ge),O.gety(ge)),xe=De(we,x),en=xe.signedDistanceFromCamera>0?xe.point:$o(Y,we,re,1,x),oe=Cn(c.writingMode,re,en,at);if(oe)return oe}var Me=In(ht*C.getoffsetX(c.glyphStartIndex),et,ct,h,Z,Y,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,O,T,K);if(!Me)return{notEnoughRoom:!0};it=[Me]}for(var Be=0,Ie=it;Be<Ie.length;Be+=1){var Ce=Ie[Be];s.addDynamicAttributes(N,Ce.point,Ce.angle)}return{}}function $o(c,f,h,m,x){var T=De(c.add(c.sub(f)._unit()),x).point,E=h.sub(T);return h.add(E._mult(m/E.mag()))}function In(c,f,h,m,x,T,E,C,O,N,Z,Y){var K=m?c-f:c+f,at=K>0?1:-1,it=0;m&&(at*=-1,it=Math.PI),at<0&&(it+=Math.PI);for(var ht=at>0?C+E:C+E+1,et=x,ct=x,yt=0,bt=0,Ct=Math.abs(K),Pt=[];yt+bt<=Ct;){if((ht+=at)<C||ht>=O)return null;if(ct=et,Pt.push(et),(et=Y[ht])===void 0){var Mt=new s.Point(N.getx(ht),N.gety(ht)),Ft=De(Mt,Z);if(Ft.signedDistanceFromCamera>0)et=Y[ht]=Ft.point;else{var Wt=ht-at;et=$o(yt===0?T:new s.Point(N.getx(Wt),N.gety(Wt)),Mt,ct,Ct-yt+1,Z)}}yt+=bt,bt=ct.dist(et)}var Gt=(Ct-yt)/bt,re=et.sub(ct),ge=re.mult(Gt)._add(ct);ge._add(re._unit()._perp()._mult(h*at));var we=it+Math.atan2(et.y-ct.y,et.x-ct.x);return Pt.push(ge),{point:ge,angle:we,path:Pt}}Ze.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ze.prototype.insert=function(c,f,h,m,x){this._forEachCell(f,h,m,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(x)},Ze.prototype.insertCircle=function(c,f,h,m){this._forEachCell(f-m,h-m,f+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(h),this.circles.push(m)},Ze.prototype._insertBoxCell=function(c,f,h,m,x,T){this.boxCells[x].push(T)},Ze.prototype._insertCircleCell=function(c,f,h,m,x,T){this.circleCells[x].push(T)},Ze.prototype._query=function(c,f,h,m,x,T){if(h<0||c>this.width||m<0||f>this.height)return!x&&[];var E=[];if(c<=0&&f<=0&&this.width<=h&&this.height<=m){if(x)return!0;for(var C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(var O=0;O<this.circleKeys.length;O++){var N=this.circles[3*O],Z=this.circles[3*O+1],Y=this.circles[3*O+2];E.push({key:this.circleKeys[O],x1:N-Y,y1:Z-Y,x2:N+Y,y2:Z+Y})}return T?E.filter(T):E}return this._forEachCell(c,f,h,m,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?E.length>0:E},Ze.prototype._queryCircle=function(c,f,h,m,x){var T=c-h,E=c+h,C=f-h,O=f+h;if(E<0||T>this.width||O<0||C>this.height)return!m&&[];var N=[];return this._forEachCell(T,C,E,O,this._queryCellCircle,N,{hitTest:m,circle:{x:c,y:f,radius:h},seenUids:{box:{},circle:{}}},x),m?N.length>0:N},Ze.prototype.query=function(c,f,h,m,x){return this._query(c,f,h,m,!1,x)},Ze.prototype.hitTest=function(c,f,h,m,x){return this._query(c,f,h,m,!0,x)},Ze.prototype.hitTestCircle=function(c,f,h,m){return this._queryCircle(c,f,h,!0,m)},Ze.prototype._queryCell=function(c,f,h,m,x,T,E,C){var O=E.seenUids,N=this.boxCells[x];if(N!==null)for(var Z=this.bboxes,Y=0,K=N;Y<K.length;Y+=1){var at=K[Y];if(!O.box[at]){O.box[at]=!0;var it=4*at;if(c<=Z[it+2]&&f<=Z[it+3]&&h>=Z[it+0]&&m>=Z[it+1]&&(!C||C(this.boxKeys[at]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[at],x1:Z[it],y1:Z[it+1],x2:Z[it+2],y2:Z[it+3]})}}}var ht=this.circleCells[x];if(ht!==null)for(var et=this.circles,ct=0,yt=ht;ct<yt.length;ct+=1){var bt=yt[ct];if(!O.circle[bt]){O.circle[bt]=!0;var Ct=3*bt;if(this._circleAndRectCollide(et[Ct],et[Ct+1],et[Ct+2],c,f,h,m)&&(!C||C(this.circleKeys[bt]))){if(E.hitTest)return T.push(!0),!0;var Pt=et[Ct],Mt=et[Ct+1],Ft=et[Ct+2];T.push({key:this.circleKeys[bt],x1:Pt-Ft,y1:Mt-Ft,x2:Pt+Ft,y2:Mt+Ft})}}}},Ze.prototype._queryCellCircle=function(c,f,h,m,x,T,E,C){var O=E.circle,N=E.seenUids,Z=this.boxCells[x];if(Z!==null)for(var Y=this.bboxes,K=0,at=Z;K<at.length;K+=1){var it=at[K];if(!N.box[it]){N.box[it]=!0;var ht=4*it;if(this._circleAndRectCollide(O.x,O.y,O.radius,Y[ht+0],Y[ht+1],Y[ht+2],Y[ht+3])&&(!C||C(this.boxKeys[it])))return T.push(!0),!0}}var et=this.circleCells[x];if(et!==null)for(var ct=this.circles,yt=0,bt=et;yt<bt.length;yt+=1){var Ct=bt[yt];if(!N.circle[Ct]){N.circle[Ct]=!0;var Pt=3*Ct;if(this._circlesCollide(ct[Pt],ct[Pt+1],ct[Pt+2],O.x,O.y,O.radius)&&(!C||C(this.circleKeys[Ct])))return T.push(!0),!0}}},Ze.prototype._forEachCell=function(c,f,h,m,x,T,E,C){for(var O=this._convertToXCellCoord(c),N=this._convertToYCellCoord(f),Z=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(m),K=O;K<=Z;K++)for(var at=N;at<=Y;at++)if(x.call(this,c,f,h,m,this.xCellCount*at+K,T,E,C))return},Ze.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Ze.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Ze.prototype._circlesCollide=function(c,f,h,m,x,T){var E=m-c,C=x-f,O=h+T;return O*O>E*E+C*C},Ze.prototype._circleAndRectCollide=function(c,f,h,m,x,T,E){var C=(T-m)/2,O=Math.abs(c-(m+C));if(O>C+h)return!1;var N=(E-x)/2,Z=Math.abs(f-(x+N));if(Z>N+h)return!1;if(O<=C||Z<=N)return!0;var Y=O-C,K=Z-N;return Y*Y+K*K<=h*h};var Yo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vr(c,f){for(var h=0;h<c;h++){var m=f.length;f.resize(m+4),f.float32.set(Yo,3*m)}}function jn(c,f,h){var m=f[0],x=f[1];return c[0]=h[0]*m+h[4]*x+h[12],c[1]=h[1]*m+h[5]*x+h[13],c[3]=h[3]*m+h[7]*x+h[15],c}var er=function(c,f,h){f===void 0&&(f=new Ze(c.width+200,c.height+200,25)),h===void 0&&(h=new Ze(c.width+200,c.height+200,25)),this.transform=c,this.grid=f,this.ignoredGrid=h,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function wn(c,f,h){return f*(s.EXTENT/(c.tileSize*Math.pow(2,h-c.tileID.overscaledZ)))}er.prototype.placeCollisionBox=function(c,f,h,m,x){var T=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),E=h*T.perspectiveRatio,C=c.x1*E+T.point.x,O=c.y1*E+T.point.y,N=c.x2*E+T.point.x,Z=c.y2*E+T.point.y;return!this.isInsideGrid(C,O,N,Z)||!f&&this.grid.hitTest(C,O,N,Z,x)?{box:[],offscreen:!1}:{box:[C,O,N,Z],offscreen:this.isOffscreen(C,O,N,Z)}},er.prototype.placeCollisionCircles=function(c,f,h,m,x,T,E,C,O,N,Z,Y,K){var at=[],it=new s.Point(f.anchorX,f.anchorY),ht=De(it,T),et=Ge(this.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),ct=(N?x/et:x*et)/s.ONE_EM,yt=De(it,E).point,bt=Vn(ct,m,f.lineOffsetX*ct,f.lineOffsetY*ct,!1,yt,it,f,h,E,{}),Ct=!1,Pt=!1,Mt=!0;if(bt){for(var Ft=.5*Y*et+K,Wt=new s.Point(-100,-100),Gt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),re=new Xn,ge=bt.first,we=bt.last,xe=[],en=ge.path.length-1;en>=1;en--)xe.push(ge.path[en]);for(var oe=1;oe<we.path.length;oe++)xe.push(we.path[oe]);var Me=2.5*Ft;if(C){var Be=xe.map(function(ro){return De(ro,C)});xe=Be.some(function(ro){return ro.signedDistanceFromCamera<=0})?[]:Be.map(function(ro){return ro.point})}var Ie=[];if(xe.length>0){for(var Ce=xe[0].clone(),Ne=xe[0].clone(),Ae=1;Ae<xe.length;Ae++)Ce.x=Math.min(Ce.x,xe[Ae].x),Ce.y=Math.min(Ce.y,xe[Ae].y),Ne.x=Math.max(Ne.x,xe[Ae].x),Ne.y=Math.max(Ne.y,xe[Ae].y);Ie=Ce.x>=Wt.x&&Ne.x<=Gt.x&&Ce.y>=Wt.y&&Ne.y<=Gt.y?[xe]:Ne.x<Wt.x||Ce.x>Gt.x||Ne.y<Wt.y||Ce.y>Gt.y?[]:s.clipLine([xe],Wt.x,Wt.y,Gt.x,Gt.y)}for(var Ee=0,_r=Ie;Ee<_r.length;Ee+=1){var Gn;re.reset(_r[Ee],.25*Ft),Gn=re.length<=.5*Ft?1:Math.ceil(re.paddedLength/Me)+1;for(var Hr=0;Hr<Gn;Hr++){var Cr=Hr/Math.max(Gn-1,1),Fn=re.lerp(Cr),$n=Fn.x+100,Ii=Fn.y+100;at.push($n,Ii,Ft,0);var Jr=$n-Ft,Ns=Ii-Ft,oi=$n+Ft,xo=Ii+Ft;if(Mt=Mt&&this.isOffscreen(Jr,Ns,oi,xo),Pt=Pt||this.isInsideGrid(Jr,Ns,oi,xo),!c&&this.grid.hitTestCircle($n,Ii,Ft,Z)&&(Ct=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Ct}}}}return{circles:!O&&Ct||!Pt?[]:at,offscreen:Mt,collisionDetected:Ct}},er.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],h=1/0,m=1/0,x=-1/0,T=-1/0,E=0,C=c;E<C.length;E+=1){var O=C[E],N=new s.Point(O.x+100,O.y+100);h=Math.min(h,N.x),m=Math.min(m,N.y),x=Math.max(x,N.x),T=Math.max(T,N.y),f.push(N)}for(var Z={},Y={},K=0,at=this.grid.query(h,m,x,T).concat(this.ignoredGrid.query(h,m,x,T));K<at.length;K+=1){var it=at[K],ht=it.key;if(Z[ht.bucketInstanceId]===void 0&&(Z[ht.bucketInstanceId]={}),!Z[ht.bucketInstanceId][ht.featureIndex]){var et=[new s.Point(it.x1,it.y1),new s.Point(it.x2,it.y1),new s.Point(it.x2,it.y2),new s.Point(it.x1,it.y2)];s.polygonIntersectsPolygon(f,et)&&(Z[ht.bucketInstanceId][ht.featureIndex]=!0,Y[ht.bucketInstanceId]===void 0&&(Y[ht.bucketInstanceId]=[]),Y[ht.bucketInstanceId].push(ht.featureIndex))}}return Y},er.prototype.insertCollisionBox=function(c,f,h,m,x){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:x},c[0],c[1],c[2],c[3])},er.prototype.insertCollisionCircles=function(c,f,h,m,x){for(var T=f?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:x},C=0;C<c.length;C+=4)T.insertCircle(E,c[C],c[C+1],c[C+2])},er.prototype.projectAndGetPerspectiveRatio=function(c,f,h){var m=[f,h,0,1];return jn(m,m,c),{point:new s.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},er.prototype.isOffscreen=function(c,f,h,m){return h<100||c>=this.screenRightBoundary||m<100||f>this.screenBottomBoundary},er.prototype.isInsideGrid=function(c,f,h,m){return h>=0&&c<this.gridRightBoundary&&m>=0&&f<this.gridBottomBoundary},er.prototype.getViewportMatrix=function(){var c=s.identity([]);return s.translate(c,c,[-100,-100,0]),c};var bi=function(c,f,h,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):m&&h?1:0,this.placed=h};bi.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wr=function(c,f,h,m,x){this.text=new bi(c?c.text:null,f,h,x),this.icon=new bi(c?c.icon:null,f,m,x)};Wr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var pu=function(c,f,h){this.text=c,this.icon=f,this.skipFade=h},wi=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},Ef=function(c,f,h,m,x){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=x},q=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Q(c,f,h,m,x){var T=s.getAnchorAlignment(c),E=-(T.horizontalAlign-.5)*f,C=-(T.verticalAlign-.5)*h,O=s.evaluateVariableOffset(c,m);return new s.Point(E+O[0]*x,C+O[1]*x)}function dt(c,f,h,m,x,T){var E=c.x1,C=c.x2,O=c.y1,N=c.y2,Z=c.anchorPointX,Y=c.anchorPointY,K=new s.Point(f,h);return m&&K._rotate(x?T:-T),{x1:E+K.x,y1:O+K.y,x2:C+K.x,y2:N+K.y,anchorPointX:Z,anchorPointY:Y}}q.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:function(h){return h.collisionGroupID===f}}}return this.collisionGroups[c]};var Et=function(c,f,h,m){this.transform=c.clone(),this.collisionIndex=new er(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new q(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function jt(c,f,h,m,x){c.emplaceBack(f?1:0,h?1:0,m||0,x||0),c.emplaceBack(f?1:0,h?1:0,m||0,x||0),c.emplaceBack(f?1:0,h?1:0,m||0,x||0),c.emplaceBack(f?1:0,h?1:0,m||0,x||0)}Et.prototype.getBucketParts=function(c,f,h,m){var x=h.getBucket(f),T=h.latestFeatureIndex;if(x&&T&&f.id===x.layerIds[0]){var E=h.collisionBoxArray,C=x.layers[0].layout,O=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),N=h.tileSize/s.EXTENT,Z=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Y=C.get("text-pitch-alignment")==="map",K=C.get("text-rotation-alignment")==="map",at=wn(h,1,this.transform.zoom),it=gn(Z,Y,K,this.transform,at),ht=null;if(Y){var et=on(Z,Y,K,this.transform,at);ht=s.multiply([],this.transform.labelPlaneMatrix,et)}this.retainedQueryData[x.bucketInstanceId]=new Ef(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,h.tileID);var ct={bucket:x,layout:C,posMatrix:Z,textLabelPlaneMatrix:it,labelToScreenMatrix:ht,scale:O,textPixelRatio:N,holdingForFade:h.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(m)for(var yt=0,bt=x.sortKeyRanges;yt<bt.length;yt+=1){var Ct=bt[yt];c.push({sortKey:Ct.sortKey,symbolInstanceStart:Ct.symbolInstanceStart,symbolInstanceEnd:Ct.symbolInstanceEnd,parameters:ct})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ct})}},Et.prototype.attemptAnchorPlacement=function(c,f,h,m,x,T,E,C,O,N,Z,Y,K,at,it){var ht,et=[Y.textOffset0,Y.textOffset1],ct=Q(c,h,m,et,x),yt=this.collisionIndex.placeCollisionBox(dt(f,ct.x,ct.y,T,E,this.transform.angle),Z,C,O,N.predicate);if(!it||this.collisionIndex.placeCollisionBox(dt(it,ct.x,ct.y,T,E,this.transform.angle),Z,C,O,N.predicate).box.length!==0)return yt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(ht=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),this.variableOffsets[Y.crossTileID]={textOffset:et,width:h,height:m,anchor:c,textBoxScale:x,prevAnchor:ht},this.markUsedJustification(K,c,Y,at),K.allowVerticalPlacement&&(this.markUsedOrientation(K,at,Y),this.placedOrientations[Y.crossTileID]=at),{shift:ct,placedGlyphBoxes:yt}):void 0},Et.prototype.placeLayerBucketPart=function(c,f,h){var m=this,x=c.parameters,T=x.bucket,E=x.layout,C=x.posMatrix,O=x.textLabelPlaneMatrix,N=x.labelToScreenMatrix,Z=x.textPixelRatio,Y=x.holdingForFade,K=x.collisionBoxArray,at=x.partiallyEvaluatedTextSize,it=x.collisionGroup,ht=E.get("text-optional"),et=E.get("icon-optional"),ct=E.get("text-allow-overlap"),yt=E.get("icon-allow-overlap"),bt=E.get("text-rotation-alignment")==="map",Ct=E.get("text-pitch-alignment")==="map",Pt=E.get("icon-text-fit")!=="none",Mt=E.get("symbol-z-order")==="viewport-y",Ft=ct&&(yt||!T.hasIconData()||et),Wt=yt&&(ct||!T.hasTextData()||ht);!T.collisionArrays&&K&&T.deserializeCollisionBoxes(K);var Gt=function(oe,Me){if(!f[oe.crossTileID])if(Y)m.placements[oe.crossTileID]=new pu(!1,!1,!1);else{var Be,Ie=!1,Ce=!1,Ne=!0,Ae=null,Ee={box:null,offscreen:null},_r={box:null,offscreen:null},Gn=null,Hr=null,Cr=0,Fn=0,$n=0;Me.textFeatureIndex?Cr=Me.textFeatureIndex:oe.useRuntimeCollisionCircles&&(Cr=oe.featureIndex),Me.verticalTextFeatureIndex&&(Fn=Me.verticalTextFeatureIndex);var Ii=Me.textBox;if(Ii){var Jr=function(hn){var Vi=s.WritingMode.horizontal;if(T.allowVerticalPlacement&&!hn&&m.prevPlacement){var si=m.prevPlacement.placedOrientations[oe.crossTileID];si&&(m.placedOrientations[oe.crossTileID]=si,m.markUsedOrientation(T,Vi=si,oe))}return Vi},Ns=function(hn,Vi){if(T.allowVerticalPlacement&&oe.numVerticalGlyphVertices>0&&Me.verticalTextBox)for(var si=0,Oa=T.writingModes;si<Oa.length&&(Oa[si]===s.WritingMode.vertical?(Ee=Vi(),_r=Ee):Ee=hn(),!(Ee&&Ee.box&&Ee.box.length));si+=1);else Ee=hn()};if(E.get("text-variable-anchor")){var oi=E.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[oe.crossTileID]){var xo=m.prevPlacement.variableOffsets[oe.crossTileID];oi.indexOf(xo.anchor)>0&&(oi=oi.filter(function(hn){return hn!==xo.anchor})).unshift(xo.anchor)}var ro=function(hn,Vi,si){for(var Oa=hn.x2-hn.x1,v_=hn.y2-hn.y1,qc=oe.textBoxScale,__=Pt&&!yt?Vi:null,Ru={box:[],offscreen:!1},Mm=ct?2*oi.length:oi.length,Cl=0;Cl<Mm;++Cl){var Zc=m.attemptAnchorPlacement(oi[Cl%oi.length],hn,Oa,v_,qc,bt,Ct,Z,C,it,Cl>=oi.length,oe,T,si,__);if(Zc&&(Ru=Zc.placedGlyphBoxes)&&Ru.box&&Ru.box.length){Ie=!0,Ae=Zc.shift;break}}return Ru};Ns(function(){return ro(Ii,Me.iconBox,s.WritingMode.horizontal)},function(){var hn=Me.verticalTextBox;return T.allowVerticalPlacement&&!(Ee&&Ee.box&&Ee.box.length)&&oe.numVerticalGlyphVertices>0&&hn?ro(hn,Me.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Ee&&(Ie=Ee.box,Ne=Ee.offscreen);var Lu=Jr(Ee&&Ee.box);if(!Ie&&m.prevPlacement){var Pl=m.prevPlacement.variableOffsets[oe.crossTileID];Pl&&(m.variableOffsets[oe.crossTileID]=Pl,m.markUsedJustification(T,Pl.anchor,oe,Lu))}}else{var Bs=function(hn,Vi){var si=m.collisionIndex.placeCollisionBox(hn,ct,Z,C,it.predicate);return si&&si.box&&si.box.length&&(m.markUsedOrientation(T,Vi,oe),m.placedOrientations[oe.crossTileID]=Vi),si};Ns(function(){return Bs(Ii,s.WritingMode.horizontal)},function(){var hn=Me.verticalTextBox;return T.allowVerticalPlacement&&oe.numVerticalGlyphVertices>0&&hn?Bs(hn,s.WritingMode.vertical):{box:null,offscreen:null}}),Jr(Ee&&Ee.box&&Ee.box.length)}}if(Ie=(Be=Ee)&&Be.box&&Be.box.length>0,Ne=Be&&Be.offscreen,oe.useRuntimeCollisionCircles){var Al=T.text.placedSymbolArray.get(oe.centerJustifiedTextSymbolIndex),ku=s.evaluateSizeForFeature(T.textSizeData,at,Al),zo=E.get("text-padding");Gn=m.collisionIndex.placeCollisionCircles(ct,Al,T.lineVertexArray,T.glyphOffsetArray,ku,C,O,N,h,Ct,it.predicate,oe.collisionCircleDiameter,zo),Ie=ct||Gn.circles.length>0&&!Gn.collisionDetected,Ne=Ne&&Gn.offscreen}if(Me.iconFeatureIndex&&($n=Me.iconFeatureIndex),Me.iconBox){var Ou=function(hn){var Vi=Pt&&Ae?dt(hn,Ae.x,Ae.y,bt,Ct,m.transform.angle):hn;return m.collisionIndex.placeCollisionBox(Vi,yt,Z,C,it.predicate)};Ce=_r&&_r.box&&_r.box.length&&Me.verticalIconBox?(Hr=Ou(Me.verticalIconBox)).box.length>0:(Hr=Ou(Me.iconBox)).box.length>0,Ne=Ne&&Hr.offscreen}var Do=ht||oe.numHorizontalGlyphVertices===0&&oe.numVerticalGlyphVertices===0,xr=et||oe.numIconVertices===0;if(Do||xr?xr?Do||(Ce=Ce&&Ie):Ie=Ce&&Ie:Ce=Ie=Ce&&Ie,Ie&&Be&&Be.box&&m.collisionIndex.insertCollisionBox(Be.box,E.get("text-ignore-placement"),T.bucketInstanceId,_r&&_r.box&&Fn?Fn:Cr,it.ID),Ce&&Hr&&m.collisionIndex.insertCollisionBox(Hr.box,E.get("icon-ignore-placement"),T.bucketInstanceId,$n,it.ID),Gn&&(Ie&&m.collisionIndex.insertCollisionCircles(Gn.circles,E.get("text-ignore-placement"),T.bucketInstanceId,Cr,it.ID),h)){var ts=T.bucketInstanceId,Us=m.collisionCircleArrays[ts];Us===void 0&&(Us=m.collisionCircleArrays[ts]=new wi);for(var ka=0;ka<Gn.circles.length;ka+=4)Us.circles.push(Gn.circles[ka+0]),Us.circles.push(Gn.circles[ka+1]),Us.circles.push(Gn.circles[ka+2]),Us.circles.push(Gn.collisionDetected?1:0)}m.placements[oe.crossTileID]=new pu(Ie||Ft,Ce||Wt,Ne||T.justReloaded),f[oe.crossTileID]=!0}};if(Mt)for(var re=T.getSortedSymbolIndexes(this.transform.angle),ge=re.length-1;ge>=0;--ge){var we=re[ge];Gt(T.symbolInstances.get(we),T.collisionArrays[we])}else for(var xe=c.symbolInstanceStart;xe<c.symbolInstanceEnd;xe++)Gt(T.symbolInstances.get(xe),T.collisionArrays[xe]);if(h&&T.bucketInstanceId in this.collisionCircleArrays){var en=this.collisionCircleArrays[T.bucketInstanceId];s.invert(en.invProjMatrix,C),en.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1},Et.prototype.markUsedJustification=function(c,f,h,m){var x;x=m===s.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(f)];for(var T=0,E=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];T<E.length;T+=1){var C=E[T];C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:h.crossTileID)}},Et.prototype.markUsedOrientation=function(c,f,h){for(var m=f===s.WritingMode.horizontal||f===s.WritingMode.horizontalOnly?f:0,x=f===s.WritingMode.vertical?f:0,T=0,E=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];T<E.length;T+=1)c.text.placedSymbolArray.get(E[T]).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=x)},Et.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,h=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var m=f?f.symbolFadeChange(c):1,x=f?f.opacities:{},T=f?f.variableOffsets:{},E=f?f.placedOrientations:{};for(var C in this.placements){var O=this.placements[C],N=x[C];N?(this.opacities[C]=new Wr(N,m,O.text,O.icon),h=h||O.text!==N.text.placed||O.icon!==N.icon.placed):(this.opacities[C]=new Wr(null,m,O.text,O.icon,O.skipFade),h=h||O.text||O.icon)}for(var Z in x){var Y=x[Z];if(!this.opacities[Z]){var K=new Wr(Y,m,!1,!1);K.isHidden()||(this.opacities[Z]=K,h=h||Y.text.placed||Y.icon.placed)}}for(var at in T)this.variableOffsets[at]||!this.opacities[at]||this.opacities[at].isHidden()||(this.variableOffsets[at]=T[at]);for(var it in E)this.placedOrientations[it]||!this.opacities[it]||this.opacities[it].isHidden()||(this.placedOrientations[it]=E[it]);h?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)},Et.prototype.updateLayerOpacities=function(c,f){for(var h={},m=0,x=f;m<x.length;m+=1){var T=x[m],E=T.getBucket(c);E&&T.latestFeatureIndex&&c.id===E.layerIds[0]&&this.updateBucketOpacities(E,h,T.collisionBoxArray)}},Et.prototype.updateBucketOpacities=function(c,f,h){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var x=c.layers[0].layout,T=new Wr(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),O=x.get("text-variable-anchor"),N=x.get("text-rotation-alignment")==="map",Z=x.get("text-pitch-alignment")==="map",Y=x.get("icon-text-fit")!=="none",K=new Wr(null,0,E&&(C||!c.hasIconData()||x.get("icon-optional")),C&&(E||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&h&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(h);for(var at=function(ct,yt,bt){for(var Ct=0;Ct<yt/4;Ct++)ct.opacityVertexArray.emplaceBack(bt)},it=function(ct){var yt=c.symbolInstances.get(ct),bt=yt.numHorizontalGlyphVertices,Ct=yt.numVerticalGlyphVertices,Pt=yt.crossTileID,Mt=m.opacities[Pt];f[Pt]?Mt=T:Mt||(m.opacities[Pt]=Mt=K),f[Pt]=!0;var Ft=yt.numIconVertices>0,Wt=m.placedOrientations[yt.crossTileID],Gt=Wt===s.WritingMode.vertical,re=Wt===s.WritingMode.horizontal||Wt===s.WritingMode.horizontalOnly;if(bt>0||Ct>0){var ge=nm(Mt.text);at(c.text,bt,Gt?ml:ge),at(c.text,Ct,re?ml:ge);var we=Mt.text.isHidden();[yt.rightJustifiedTextSymbolIndex,yt.centerJustifiedTextSymbolIndex,yt.leftJustifiedTextSymbolIndex].forEach(function(Ee){Ee>=0&&(c.text.placedSymbolArray.get(Ee).hidden=we||Gt?1:0)}),yt.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(yt.verticalPlacedTextSymbolIndex).hidden=we||re?1:0);var xe=m.variableOffsets[yt.crossTileID];xe&&m.markUsedJustification(c,xe.anchor,yt,Wt);var en=m.placedOrientations[yt.crossTileID];en&&(m.markUsedJustification(c,"left",yt,en),m.markUsedOrientation(c,en,yt))}if(Ft){var oe=nm(Mt.icon),Me=!(Y&&yt.verticalPlacedIconSymbolIndex&&Gt);yt.placedIconSymbolIndex>=0&&(at(c.icon,yt.numIconVertices,Me?oe:ml),c.icon.placedSymbolArray.get(yt.placedIconSymbolIndex).hidden=Mt.icon.isHidden()),yt.verticalPlacedIconSymbolIndex>=0&&(at(c.icon,yt.numVerticalIconVertices,Me?ml:oe),c.icon.placedSymbolArray.get(yt.verticalPlacedIconSymbolIndex).hidden=Mt.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Be=c.collisionArrays[ct];if(Be){var Ie=new s.Point(0,0);if(Be.textBox||Be.verticalTextBox){var Ce=!0;if(O){var Ne=m.variableOffsets[Pt];Ne?(Ie=Q(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),N&&Ie._rotate(Z?m.transform.angle:-m.transform.angle)):Ce=!1}Be.textBox&&jt(c.textCollisionBox.collisionVertexArray,Mt.text.placed,!Ce||Gt,Ie.x,Ie.y),Be.verticalTextBox&&jt(c.textCollisionBox.collisionVertexArray,Mt.text.placed,!Ce||re,Ie.x,Ie.y)}var Ae=Boolean(!re&&Be.verticalIconBox);Be.iconBox&&jt(c.iconCollisionBox.collisionVertexArray,Mt.icon.placed,Ae,Y?Ie.x:0,Y?Ie.y:0),Be.verticalIconBox&&jt(c.iconCollisionBox.collisionVertexArray,Mt.icon.placed,!Ae,Y?Ie.x:0,Y?Ie.y:0)}}},ht=0;ht<c.symbolInstances.length;ht++)it(ht);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var et=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=et.invProjMatrix,c.placementViewportMatrix=et.viewportMatrix,c.collisionCircleArray=et.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},Et.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Et.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},Et.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},Et.prototype.stillRecent=function(c,f){var h=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*h>c},Et.prototype.setStale=function(){this.stale=!0};var pe=Math.pow(2,25),tn=Math.pow(2,24),nr=Math.pow(2,17),Pr=Math.pow(2,16),zr=Math.pow(2,9),Ji=Math.pow(2,8),em=Math.pow(2,1);function nm(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var f=c.placed?1:0,h=Math.floor(127*c.opacity);return h*pe+f*tn+h*nr+f*Pr+h*zr+f*Ji+h*em+f}var ml=0,Sf=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Sf.prototype.continuePlacement=function(c,f,h,m,x){for(var T=this._bucketParts;this._currentTileIndex<c.length;)if(f.getBucketParts(T,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(function(E,C){return E.sortKey-C.sortKey}));this._currentPartIndex<T.length;)if(f.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,x())return!0;return!1};var du=function(c,f,h,m,x,T,E){this.placement=new Et(c,x,T,E),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1};du.prototype.isDone=function(){return this._done},du.prototype.continuePlacement=function(c,f,h){for(var m=this,x=s.browser.now(),T=function(){var O=s.browser.now()-x;return!m._forceFullPlacement&&O>2};this._currentPlacementIndex>=0;){var E=f[c[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Sf(E)),this._inProgressLayer.continuePlacement(h[E.source],this.placement,this._showCollisionBoxes,E,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},du.prototype.commit=function(c){return this.placement.commit(c),this.placement};var rm=512/s.EXTENT/2,Pc=function(c,f,h){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var m=0;m<f.length;m++){var x=f.get(m),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,c)})}};Pc.prototype.getScaledCoordinates=function(c,f){var h=rm/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*s.EXTENT+c.anchorX)*h),y:Math.floor((f.canonical.y*s.EXTENT+c.anchorY)*h)}},Pc.prototype.findMatches=function(c,f,h){for(var m=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),x=0;x<c.length;x++){var T=c.get(x);if(!T.crossTileID){var E=this.indexedSymbolInstances[T.key];if(E)for(var C=this.getScaledCoordinates(T,f),O=0,N=E;O<N.length;O+=1){var Z=N[O];if(Math.abs(Z.coord.x-C.x)<=m&&Math.abs(Z.coord.y-C.y)<=m&&!h[Z.crossTileID]){h[Z.crossTileID]=!0,T.crossTileID=Z.crossTileID;break}}}}};var Qi=function(){this.maxCrossTileID=0};Qi.prototype.generate=function(){return++this.maxCrossTileID};var Es=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Es.prototype.handleWrapJump=function(c){var f=Math.round((c-this.lng)/360);if(f!==0)for(var h in this.indexes){var m=this.indexes[h],x={};for(var T in m){var E=m[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),x[E.tileID.key]=E}this.indexes[h]=x}this.lng=c},Es.prototype.addBucket=function(c,f,h){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<f.symbolInstances.length;m++)f.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var x=this.usedCrossTileIDs[c.overscaledZ];for(var T in this.indexes){var E=this.indexes[T];if(Number(T)>c.overscaledZ)for(var C in E){var O=E[C];O.tileID.isChildOf(c)&&O.findMatches(f.symbolInstances,c,x)}else{var N=E[c.scaledTo(Number(T)).key];N&&N.findMatches(f.symbolInstances,c,x)}}for(var Z=0;Z<f.symbolInstances.length;Z++){var Y=f.symbolInstances.get(Z);Y.crossTileID||(Y.crossTileID=h.generate(),x[Y.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Pc(c,f.symbolInstances,f.bucketInstanceId),!0},Es.prototype.removeBucketCrossTileIDs=function(c,f){for(var h in f.indexedSymbolInstances)for(var m=0,x=f.indexedSymbolInstances[h];m<x.length;m+=1)delete this.usedCrossTileIDs[c][x[m].crossTileID]},Es.prototype.removeStaleBuckets=function(c){var f=!1;for(var h in this.indexes){var m=this.indexes[h];for(var x in m)c[m[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[x]),delete m[x],f=!0)}return f};var Ss=function(){this.layerIndexes={},this.crossTileIDs=new Qi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ss.prototype.addLayer=function(c,f,h){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Es);var x=!1,T={};m.handleWrapJump(h);for(var E=0,C=f;E<C.length;E+=1){var O=C[E],N=O.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(O.tileID,N,this.crossTileIDs)&&(x=!0),T[N.bucketInstanceId]=!0)}return m.removeStaleBuckets(T)&&(x=!0),x},Ss.prototype.pruneUnusedLayers=function(c){var f={};for(var h in c.forEach(function(m){f[m]=!0}),this.layerIndexes)f[h]||delete this.layerIndexes[h]};var ga=function(c,f){return s.emitValidationErrors(c,f&&f.filter(function(h){return h.identifier!=="source.canvas"}))},Ps=s.pick(Zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),As=s.pick(Zt,["setCenter","setZoom","setBearing","setPitch"]),Ac=function(){var c={},f=s.styleSpec.$version;for(var h in s.styleSpec.$root){var m,x=s.styleSpec.$root[h];x.required&&(m=h==="version"?f:x.type==="array"?[]:{})!=null&&(c[h]=m)}return c}(),Ti=function(c){function f(h,m){var x=this;m===void 0&&(m={}),c.call(this),this.map=h,this.dispatcher=new he(Lt(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new kt(h._requestManager,m.localIdeographFontFamily),this.lineAtlas=new ae(256,512),this.crossTileSymbolIndex=new Ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var T=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(E){T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},function(C,O){if(s.triggerPluginCompletionEvent(C),O&&O.every(function(Z){return Z}))for(var N in T.sourceCaches)T.sourceCaches[N].reload()})}),this.on("data",function(E){if(E.dataType==="source"&&E.sourceDataType==="metadata"){var C=x.sourceCaches[E.sourceId];if(C){var O=C.getSource();if(O&&O.vectorLayerIds)for(var N in x._layers){var Z=x._layers[N];Z.source===O.id&&x._validateLayer(Z)}}}})}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.loadURL=function(h,m){var x=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var T=typeof m.validate=="boolean"?m.validate:!s.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,m.accessToken);var E=this.map._requestManager.transformRequest(h,s.ResourceType.Style);this._request=s.getJSON(E,function(C,O){x._request=null,C?x.fire(new s.ErrorEvent(C)):O&&x._load(O,T)})},f.prototype.loadJSON=function(h,m){var x=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){x._request=null,x._load(h,m.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Ac,!1)},f.prototype._load=function(h,m){if(!m||!ga(this,s.validateStyle(h))){for(var x in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(x,h.sources[x],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var T=Ht(this.stylesheet.layers);this._order=T.map(function(N){return N.id}),this._layers={},this._serializedLayers={};for(var E=0,C=T;E<C.length;E+=1){var O=C[E];(O=s.createStyleLayer(O)).setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O,this._serializedLayers[O.id]=O.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _e(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},f.prototype._loadSprite=function(h){var m=this;this._spriteRequest=function(x,T,E){var C,O,N,Z=s.browser.devicePixelRatio>1?"@2x":"",Y=s.getJSON(T.transformRequest(T.normalizeSpriteURL(x,Z,".json"),s.ResourceType.SpriteJSON),function(it,ht){Y=null,N||(N=it,C=ht,at())}),K=s.getImage(T.transformRequest(T.normalizeSpriteURL(x,Z,".png"),s.ResourceType.SpriteImage),function(it,ht){K=null,N||(N=it,O=ht,at())});function at(){if(N)E(N);else if(C&&O){var it=s.browser.getImageData(O),ht={};for(var et in C){var ct=C[et],yt=ct.width,bt=ct.height,Ct=ct.x,Pt=ct.y,Mt=ct.sdf,Ft=ct.pixelRatio,Wt=ct.stretchX,Gt=ct.stretchY,re=ct.content,ge=new s.RGBAImage({width:yt,height:bt});s.RGBAImage.copy(it,ge,{x:Ct,y:Pt},{x:0,y:0},{width:yt,height:bt}),ht[et]={data:ge,pixelRatio:Ft,sdf:Mt,stretchX:Wt,stretchY:Gt,content:re}}E(null,ht)}}return{cancel:function(){Y&&(Y.cancel(),Y=null),K&&(K.cancel(),K=null)}}}(h,this.map._requestManager,function(x,T){if(m._spriteRequest=null,x)m.fire(new s.ErrorEvent(x));else if(T)for(var E in T)m.imageManager.addImage(E,T[E]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new s.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(h){var m=this.sourceCaches[h.source];if(m){var x=h.sourceLayer;if(x){var T=m.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(x)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+x+'" does not exist on source "'+T.id+'" as specified by style layer "'+h.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(h){for(var m=[],x=0,T=h;x<T.length;x+=1){var E=this._layers[T[x]];E.type!=="custom"&&m.push(E.serialize())}return m},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(h){if(this._loaded){var m=this._changed;if(this._changed){var x=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);for(var E in(x.length||T.length)&&this._updateWorkerLayers(x,T),this._updatedSources){var C=this._updatedSources[E];C==="reload"?this._reloadSource(E):C==="clear"&&this._clearSource(E)}for(var O in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[O].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var N={};for(var Z in this.sourceCaches){var Y=this.sourceCaches[Z];N[Z]=Y.used,Y.used=!1}for(var K=0,at=this._order;K<at.length;K+=1){var it=this._layers[at[K]];it.recalculate(h,this._availableImages),!it.isHidden(h.zoom)&&it.source&&(this.sourceCaches[it.source].used=!0)}for(var ht in N){var et=this.sourceCaches[ht];N[ht]!==et.used&&et.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ht}))}this.light.recalculate(h),this.z=h.zoom,m&&this.fire(new s.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},f.prototype._updateWorkerLayers=function(h,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:m})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(h){var m=this;if(this._checkLoaded(),ga(this,s.validateStyle(h)))return!1;(h=s.clone$1(h)).layers=Ht(h.layers);var x=function(E,C){if(!E)return[{command:Zt.setStyle,args:[C]}];var O=[];try{if(!s.deepEqual(E.version,C.version))return[{command:Zt.setStyle,args:[C]}];s.deepEqual(E.center,C.center)||O.push({command:Zt.setCenter,args:[C.center]}),s.deepEqual(E.zoom,C.zoom)||O.push({command:Zt.setZoom,args:[C.zoom]}),s.deepEqual(E.bearing,C.bearing)||O.push({command:Zt.setBearing,args:[C.bearing]}),s.deepEqual(E.pitch,C.pitch)||O.push({command:Zt.setPitch,args:[C.pitch]}),s.deepEqual(E.sprite,C.sprite)||O.push({command:Zt.setSprite,args:[C.sprite]}),s.deepEqual(E.glyphs,C.glyphs)||O.push({command:Zt.setGlyphs,args:[C.glyphs]}),s.deepEqual(E.transition,C.transition)||O.push({command:Zt.setTransition,args:[C.transition]}),s.deepEqual(E.light,C.light)||O.push({command:Zt.setLight,args:[C.light]});var N={},Z=[];(function(K,at,it,ht){var et;for(et in at=at||{},K=K||{})K.hasOwnProperty(et)&&(at.hasOwnProperty(et)||Yt(et,it,ht));for(et in at)at.hasOwnProperty(et)&&(K.hasOwnProperty(et)?s.deepEqual(K[et],at[et])||(K[et].type==="geojson"&&at[et].type==="geojson"&&mn(K,at,et)?it.push({command:Zt.setGeoJSONSourceData,args:[et,at[et].data]}):We(et,at,it,ht)):Re(et,at,it))})(E.sources,C.sources,Z,N);var Y=[];E.layers&&E.layers.forEach(function(K){N[K.source]?O.push({command:Zt.removeLayer,args:[K.id]}):Y.push(K)}),O=O.concat(Z),function(K,at,it){at=at||[];var ht,et,ct,yt,bt,Ct,Pt,Mt=(K=K||[]).map(Ye),Ft=at.map(Ye),Wt=K.reduce(ze,{}),Gt=at.reduce(ze,{}),re=Mt.slice(),ge=Object.create(null);for(ht=0,et=0;ht<Mt.length;ht++)Gt.hasOwnProperty(ct=Mt[ht])?et++:(it.push({command:Zt.removeLayer,args:[ct]}),re.splice(re.indexOf(ct,et),1));for(ht=0,et=0;ht<Ft.length;ht++)re[re.length-1-ht]!==(ct=Ft[Ft.length-1-ht])&&(Wt.hasOwnProperty(ct)?(it.push({command:Zt.removeLayer,args:[ct]}),re.splice(re.lastIndexOf(ct,re.length-et),1)):et++,it.push({command:Zt.addLayer,args:[Gt[ct],Ct=re[re.length-ht]]}),re.splice(re.length-ht,0,ct),ge[ct]=!0);for(ht=0;ht<Ft.length;ht++)if(yt=Wt[ct=Ft[ht]],bt=Gt[ct],!ge[ct]&&!s.deepEqual(yt,bt))if(s.deepEqual(yt.source,bt.source)&&s.deepEqual(yt["source-layer"],bt["source-layer"])&&s.deepEqual(yt.type,bt.type)){for(Pt in je(yt.layout,bt.layout,it,ct,null,Zt.setLayoutProperty),je(yt.paint,bt.paint,it,ct,null,Zt.setPaintProperty),s.deepEqual(yt.filter,bt.filter)||it.push({command:Zt.setFilter,args:[ct,bt.filter]}),s.deepEqual(yt.minzoom,bt.minzoom)&&s.deepEqual(yt.maxzoom,bt.maxzoom)||it.push({command:Zt.setLayerZoomRange,args:[ct,bt.minzoom,bt.maxzoom]}),yt)yt.hasOwnProperty(Pt)&&Pt!=="layout"&&Pt!=="paint"&&Pt!=="filter"&&Pt!=="metadata"&&Pt!=="minzoom"&&Pt!=="maxzoom"&&(Pt.indexOf("paint.")===0?je(yt[Pt],bt[Pt],it,ct,Pt.slice(6),Zt.setPaintProperty):s.deepEqual(yt[Pt],bt[Pt])||it.push({command:Zt.setLayerProperty,args:[ct,Pt,bt[Pt]]}));for(Pt in bt)bt.hasOwnProperty(Pt)&&!yt.hasOwnProperty(Pt)&&Pt!=="layout"&&Pt!=="paint"&&Pt!=="filter"&&Pt!=="metadata"&&Pt!=="minzoom"&&Pt!=="maxzoom"&&(Pt.indexOf("paint.")===0?je(yt[Pt],bt[Pt],it,ct,Pt.slice(6),Zt.setPaintProperty):s.deepEqual(yt[Pt],bt[Pt])||it.push({command:Zt.setLayerProperty,args:[ct,Pt,bt[Pt]]}))}else it.push({command:Zt.removeLayer,args:[ct]}),Ct=re[re.lastIndexOf(ct)+1],it.push({command:Zt.addLayer,args:[bt,Ct]})}(Y,C.layers,O)}catch(K){console.warn("Unable to compute style diff:",K),O=[{command:Zt.setStyle,args:[C]}]}return O}(this.serialize(),h).filter(function(E){return!(E.command in As)});if(x.length===0)return!1;var T=x.filter(function(E){return!(E.command in Ps)});if(T.length>0)throw new Error("Unimplemented: "+T.map(function(E){return E.command}).join(", ")+".");return x.forEach(function(E){E.command!=="setTransition"&&m[E.command].apply(m,E.args)}),this.stylesheet=h,!0},f.prototype.addImage=function(h,m){if(this.getImage(h))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,m),this._afterImageUpdated(h)},f.prototype.updateImage=function(h,m){this.imageManager.updateImage(h,m)},f.prototype.getImage=function(h){return this.imageManager.getImage(h)},f.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},f.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(h,m,x){var T=this;if(x===void 0&&(x={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(s.validateStyle.source,"sources."+h,m,null,x))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var E=this.sourceCaches[h]=new lt(h,m,this.dispatcher);E.style=this,E.setEventedParent(this,function(){return{isSourceLoaded:T.loaded(),source:E.serialize(),sourceId:h}}),E.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===h)return this.fire(new s.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+m+'" is using it.')));var x=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],x.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),x.setEventedParent(null),x.clearTiles(),x.onRemove&&x.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(h,m){this._checkLoaded(),this.sourceCaches[h].getSource().setData(m),this._changed=!0},f.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},f.prototype.addLayer=function(h,m,x){x===void 0&&(x={}),this._checkLoaded();var T=h.id;if(this.getLayer(T))this.fire(new s.ErrorEvent(new Error('Layer with id "'+T+'" already exists on this map')));else{var E;if(h.type==="custom"){if(ga(this,s.validateCustomStyleLayer(h)))return;E=s.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(T,h.source),h=s.clone$1(h),h=s.extend(h,{source:T})),this._validate(s.validateStyle.layer,"layers."+T,h,{arrayIndex:-1},x))return;E=s.createStyleLayer(h),this._validateLayer(E),E.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[E.id]=E.serialize()}var C=m?this._order.indexOf(m):this._order.length;if(m&&C===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(C,0,T),this._layerOrderChanged=!0,this._layers[T]=E,this._removedLayers[T]&&E.source&&E.type!=="custom"){var O=this._removedLayers[T];delete this._removedLayers[T],O.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}},f.prototype.moveLayer=function(h,m){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==m){var x=this._order.indexOf(h);this._order.splice(x,1);var T=m?this._order.indexOf(m):this._order.length;m&&T===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(T,0,h),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(h){this._checkLoaded();var m=this._layers[h];if(m){m.setEventedParent(null);var x=this._order.indexOf(h);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=m,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],m.onRemove&&m.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(h){return this._layers[h]},f.prototype.hasLayer=function(h){return h in this._layers},f.prototype.setLayerZoomRange=function(h,m,x){this._checkLoaded();var T=this.getLayer(h);T?T.minzoom===m&&T.maxzoom===x||(m!=null&&(T.minzoom=m),x!=null&&(T.maxzoom=x),this._updateLayer(T)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(h,m,x){x===void 0&&(x={}),this._checkLoaded();var T=this.getLayer(h);if(T){if(!s.deepEqual(T.filter,m))return m==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(s.validateStyle.filter,"layers."+T.id+".filter",m,null,x)||(T.filter=s.clone$1(m),this._updateLayer(T)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(h){return s.clone$1(this.getLayer(h).filter)},f.prototype.setLayoutProperty=function(h,m,x,T){T===void 0&&(T={}),this._checkLoaded();var E=this.getLayer(h);E?s.deepEqual(E.getLayoutProperty(m),x)||(E.setLayoutProperty(m,x,T),this._updateLayer(E)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(h,m){var x=this.getLayer(h);if(x)return x.getLayoutProperty(m);this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(h,m,x,T){T===void 0&&(T={}),this._checkLoaded();var E=this.getLayer(h);E?s.deepEqual(E.getPaintProperty(m),x)||(E.setPaintProperty(m,x,T)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(h,m){return this.getLayer(h).getPaintProperty(m)},f.prototype.setFeatureState=function(h,m){this._checkLoaded();var x=h.source,T=h.sourceLayer,E=this.sourceCaches[x];if(E!==void 0){var C=E.getSource().type;C==="geojson"&&T?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||T?(h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),E.setFeatureState(T,h.id,m)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(h,m){this._checkLoaded();var x=h.source,T=this.sourceCaches[x];if(T!==void 0){var E=T.getSource().type,C=E==="vector"?h.sourceLayer:void 0;E!=="vector"||C?m&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(C,h.id,m):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(h){this._checkLoaded();var m=h.source,x=h.sourceLayer,T=this.sourceCaches[m];if(T!==void 0){if(T.getSource().type!=="vector"||x)return h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(x,h.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},f.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(h){for(var m=this,x=function(Wt){return m._layers[Wt].type==="fill-extrusion"},T={},E=[],C=this._order.length-1;C>=0;C--){var O=this._order[C];if(x(O)){T[O]=C;for(var N=0,Z=h;N<Z.length;N+=1){var Y=Z[N][O];if(Y)for(var K=0,at=Y;K<at.length;K+=1)E.push(at[K])}}}E.sort(function(Wt,Gt){return Gt.intersectionZ-Wt.intersectionZ});for(var it=[],ht=this._order.length-1;ht>=0;ht--){var et=this._order[ht];if(x(et))for(var ct=E.length-1;ct>=0;ct--){var yt=E[ct].feature;if(T[yt.layer.id]<ht)break;it.push(yt),E.pop()}else for(var bt=0,Ct=h;bt<Ct.length;bt+=1){var Pt=Ct[bt][et];if(Pt)for(var Mt=0,Ft=Pt;Mt<Ft.length;Mt+=1)it.push(Ft[Mt].feature)}}return it},f.prototype.queryRenderedFeatures=function(h,m,x){m&&m.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var T={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var E=0,C=m.layers;E<C.length;E+=1){var O=C[E],N=this._layers[O];if(!N)return this.fire(new s.ErrorEvent(new Error("The layer '"+O+"' does not exist in the map's style and cannot be queried for features."))),[];T[N.source]=!0}}var Z=[];for(var Y in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!T[Y]||Z.push(Oe(this.sourceCaches[Y],this._layers,this._serializedLayers,h,m,x));return this.placement&&Z.push(function(K,at,it,ht,et,ct,yt){for(var bt={},Ct=ct.queryRenderedSymbols(ht),Pt=[],Mt=0,Ft=Object.keys(Ct).map(Number);Mt<Ft.length;Mt+=1)Pt.push(yt[Ft[Mt]]);Pt.sort(an);for(var Wt=function(){var xe=re[Gt],en=xe.featureIndex.lookupSymbolFeatures(Ct[xe.bucketInstanceId],at,xe.bucketIndex,xe.sourceLayerIndex,et.filter,et.layers,et.availableImages,K);for(var oe in en){var Me=bt[oe]=bt[oe]||[],Be=en[oe];Be.sort(function(Ne,Ae){var Ee=xe.featureSortOrder;if(Ee){var _r=Ee.indexOf(Ne.featureIndex);return Ee.indexOf(Ae.featureIndex)-_r}return Ae.featureIndex-Ne.featureIndex});for(var Ie=0,Ce=Be;Ie<Ce.length;Ie+=1)Me.push(Ce[Ie])}},Gt=0,re=Pt;Gt<re.length;Gt+=1)Wt();var ge=function(xe){bt[xe].forEach(function(en){var oe=en.feature,Me=it[K[xe].source].getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=Me})};for(var we in bt)ge(we);return bt}(this._layers,this._serializedLayers,this.sourceCaches,h,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Z)},f.prototype.querySourceFeatures=function(h,m){m&&m.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var x=this.sourceCaches[h];return x?function(T,E){for(var C=T.getRenderableIds().map(function(at){return T.getTileByID(at)}),O=[],N={},Z=0;Z<C.length;Z++){var Y=C[Z],K=Y.tileID.canonical.key;N[K]||(N[K]=!0,Y.querySourceFeatures(O,E))}return O}(x,m):[]},f.prototype.addSourceType=function(h,m,x){return f.getSourceType(h)?x(new Error('A source type called "'+h+'" already exists.')):(f.setSourceType(h,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:m.workerSourceURL},x):x(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(h,m){m===void 0&&(m={}),this._checkLoaded();var x=this.light.getLight(),T=!1;for(var E in h)if(!s.deepEqual(h[E],x[E])){T=!0;break}if(T){var C={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,m),this.light.updateTransitions(C)}},f.prototype._validate=function(h,m,x,T,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&ga(this,h.call(s.validateStyle,s.extend({key:m,style:this.serialize(),value:x,styleSpec:s.styleSpec},T)))},f.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},f.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},f.prototype._updateSources=function(h){for(var m in this.sourceCaches)this.sourceCaches[m].update(h)},f.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},f.prototype._updatePlacement=function(h,m,x,T,E){E===void 0&&(E=!1);for(var C=!1,O=!1,N={},Z=0,Y=this._order;Z<Y.length;Z+=1){var K=this._layers[Y[Z]];if(K.type==="symbol"){if(!N[K.source]){var at=this.sourceCaches[K.source];N[K.source]=at.getRenderableIds(!0).map(function(yt){return at.getTileByID(yt)}).sort(function(yt,bt){return bt.tileID.overscaledZ-yt.tileID.overscaledZ||(yt.tileID.isLessThan(bt.tileID)?-1:1)})}var it=this.crossTileSymbolIndex.addLayer(K,N[K.source],h.center.lng);C=C||it}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),h.zoom))&&(this.pauseablePlacement=new du(h,this._order,E,m,x,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),O=!0),C&&this.pauseablePlacement.placement.setStale()),O||C)for(var ht=0,et=this._order;ht<et.length;ht+=1){var ct=this._layers[et[ht]];ct.type==="symbol"&&this.placement.updateLayerOpacities(ct,N[ct.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},f.prototype.getImages=function(h,m,x){this.imageManager.getImages(m.icons,x),this._updateTilesForChangedImages();var T=this.sourceCaches[m.source];T&&T.setDependencies(m.tileID.key,m.type,m.icons)},f.prototype.getGlyphs=function(h,m,x){this.glyphManager.getGlyphs(m.stacks,x)},f.prototype.getResource=function(h,m,x){return s.makeRequest(m,x)},f}(s.Evented);Ti.getSourceType=function(c){return Te[c]},Ti.setSourceType=function(c,f){Te[c]=f},Ti.registerForPluginStateChange=s.registerForPluginStateChange;var rr=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),gl=_n(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),im=_n(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),u_=_n(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),c_=_n(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Pf=_n("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Af=_n(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Cf=_n(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),If=_n("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),om=_n("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),sm=_n("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),h_=_n(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),mu=_n(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),gu=_n(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),am=_n(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Dr=_n(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Mf=_n(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Cs=_n(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Is=_n(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ya=_n(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),va=_n(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ms=_n(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),_a=_n(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),xa=_n(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ls=_n(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),lm=_n(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),um=_n(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function _n(c,f){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=f.match(/attribute ([\w]+) ([\w]+)/g),x=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=T?T.concat(x):x,C={};return{fragmentSource:c=c.replace(h,function(O,N,Z,Y,K){return C[K]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_`+K+`
varying `+Z+" "+Y+" "+K+`;
#else
uniform `+Z+" "+Y+" u_"+K+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+K+`
    `+Z+" "+Y+" "+K+" = u_"+K+`;
#endif
`}),vertexSource:f=f.replace(h,function(O,N,Z,Y,K){var at=Y==="float"?"vec2":"vec4",it=K.match(/color/)?"color":at;return C[K]?N==="define"?`
#ifndef HAS_UNIFORM_u_`+K+`
uniform lowp float u_`+K+`_t;
attribute `+Z+" "+at+" a_"+K+`;
varying `+Z+" "+Y+" "+K+`;
#else
uniform `+Z+" "+Y+" u_"+K+`;
#endif
`:it==="vec4"?`
#ifndef HAS_UNIFORM_u_`+K+`
    `+K+" = a_"+K+`;
#else
    `+Z+" "+Y+" "+K+" = u_"+K+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+K+`
    `+K+" = unpack_mix_"+it+"(a_"+K+", u_"+K+`_t);
#else
    `+Z+" "+Y+" "+K+" = u_"+K+`;
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_`+K+`
uniform lowp float u_`+K+`_t;
attribute `+Z+" "+at+" a_"+K+`;
#else
uniform `+Z+" "+Y+" u_"+K+`;
#endif
`:it==="vec4"?`
#ifndef HAS_UNIFORM_u_`+K+`
    `+Z+" "+Y+" "+K+" = a_"+K+`;
#else
    `+Z+" "+Y+" "+K+" = u_"+K+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+K+`
    `+Z+" "+Y+" "+K+" = unpack_mix_"+it+"(a_"+K+", u_"+K+`_t);
#else
    `+Z+" "+Y+" "+K+" = u_"+K+`;
#endif
`}),staticAttributes:m,staticUniforms:E}}var f_=Object.freeze({__proto__:null,prelude:gl,background:im,backgroundPattern:u_,circle:c_,clippingMask:Pf,heatmap:Af,heatmapTexture:Cf,collisionBox:If,collisionCircle:om,debug:sm,fill:h_,fillOutline:mu,fillOutlinePattern:gu,fillPattern:am,fillExtrusion:Dr,fillExtrusionPattern:Mf,hillshadePrepare:Cs,hillshade:Is,line:ya,lineGradient:va,linePattern:Ms,lineSDF:_a,raster:xa,symbolIcon:Ls,symbolSDF:lm,symbolTextAndIcon:um}),Cc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function cm(c){for(var f=[],h=0;h<c.length;h++)if(c[h]!==null){var m=c[h].split(" ");f.push(m.pop())}return f}Cc.prototype.bind=function(c,f,h,m,x,T,E,C){this.context=c;for(var O=this.boundPaintVertexBuffers.length!==m.length,N=0;!O&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(O=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===h&&!O&&this.boundIndexBuffer===x&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===C?(c.bindVertexArrayOES.set(this.vao),E&&E.bind(),x&&x.dynamicDraw&&x.bind(),C&&C.bind()):this.freshBind(f,h,m,x,T,E,C)},Cc.prototype.freshBind=function(c,f,h,m,x,T,E){var C,O=c.numAttributes,N=this.context,Z=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=E;else{C=N.currentNumAttributes||0;for(var Y=O;Y<C;Y++)Z.disableVertexAttribArray(Y)}f.enableAttributes(Z,c);for(var K=0,at=h;K<at.length;K+=1)at[K].enableAttributes(Z,c);T&&T.enableAttributes(Z,c),E&&E.enableAttributes(Z,c),f.bind(),f.setVertexAttribPointers(Z,c,x);for(var it=0,ht=h;it<ht.length;it+=1){var et=ht[it];et.bind(),et.setVertexAttribPointers(Z,c,x)}T&&(T.bind(),T.setVertexAttribPointers(Z,c,x)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(Z,c,x)),N.currentNumAttributes=O},Cc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hm=function(c,f,h,m,x,T){var E=c.gl;this.program=E.createProgram();for(var C=cm(h.staticAttributes),O=m?m.getBinderAttributes():[],N=C.concat(O),Z=h.staticUniforms?cm(h.staticUniforms):[],Y=m?m.getBinderUniforms():[],K=[],at=0,it=Z.concat(Y);at<it.length;at+=1){var ht=it[at];K.indexOf(ht)<0&&K.push(ht)}var et=m?m.defines():[];T&&et.push("#define OVERDRAW_INSPECTOR;");var ct=et.concat(gl.fragmentSource,h.fragmentSource).join(`
`),yt=et.concat(gl.vertexSource,h.vertexSource).join(`
`),bt=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(bt,ct),E.compileShader(bt),E.attachShader(this.program,bt);var Ct=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Ct,yt),E.compileShader(Ct),E.attachShader(this.program,Ct),this.attributes={};var Pt={};this.numAttributes=N.length;for(var Mt=0;Mt<this.numAttributes;Mt++)N[Mt]&&(E.bindAttribLocation(this.program,Mt,N[Mt]),this.attributes[N[Mt]]=Mt);E.linkProgram(this.program),E.deleteShader(Ct),E.deleteShader(bt);for(var Ft=0;Ft<K.length;Ft++){var Wt=K[Ft];if(Wt&&!Pt[Wt]){var Gt=E.getUniformLocation(this.program,Wt);Gt&&(Pt[Wt]=Gt)}}this.fixedUniforms=x(c,Pt),this.binderUniforms=m?m.getUniforms(c,Pt):[]}}};function fm(c,f,h){var m=1/wn(h,1,f.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),T=h.tileSize*Math.pow(2,f.transform.tileZoom)/x,E=T*(h.tileID.canonical.x+h.tileID.wrap*x),C=T*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}hm.prototype.draw=function(c,f,h,m,x,T,E,C,O,N,Z,Y,K,at,it,ht){var et,ct=c.gl;if(!this.failedToCreate){for(var yt in c.program.set(this.program),c.setDepthMode(h),c.setStencilMode(m),c.setColorMode(x),c.setCullFace(T),this.fixedUniforms)this.fixedUniforms[yt].set(E[yt]);at&&at.setUniforms(c,this.binderUniforms,Y,{zoom:K});for(var bt=(et={},et[ct.LINES]=2,et[ct.TRIANGLES]=3,et[ct.LINE_STRIP]=1,et)[f],Ct=0,Pt=Z.get();Ct<Pt.length;Ct+=1){var Mt=Pt[Ct],Ft=Mt.vaos||(Mt.vaos={});(Ft[C]||(Ft[C]=new Cc)).bind(c,this,O,at?at.getPaintVertexBuffers():[],N,Mt.vertexOffset,it,ht),ct.drawElements(f,Mt.primitiveLength*bt,ct.UNSIGNED_SHORT,Mt.primitiveOffset*bt*2)}}};var pm=function(c,f,h,m){var x=f.style.light,T=x.properties.get("position"),E=[T.x,T.y,T.z],C=s.create$1();x.properties.get("anchor")==="viewport"&&s.fromRotation(C,-f.transform.angle),s.transformMat3(E,E,C);var O=x.properties.get("color");return{u_matrix:c,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+h,u_opacity:m}},ba=function(c,f,h,m,x,T,E){return s.extend(pm(c,f,h,m),fm(T,f,E),{u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8})},ks=function(c){return{u_matrix:c}},wa=function(c,f,h,m){return s.extend(ks(c),fm(h,f,m))},dm=function(c,f){return{u_matrix:c,u_world:f}},mm=function(c,f,h,m,x){return s.extend(wa(c,f,h,m),{u_world:x})},Lf=function(c,f,h,m){var x,T,E=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var C=wn(h,1,E.zoom);x=!0,T=[C,C]}else x=!1,T=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(f.posMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:T}},Ta=function(c,f,h){var m=wn(h,1,f.zoom),x=Math.pow(2,f.zoom-h.tileID.overscaledZ),T=h.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[f.pixelsToGLUnits[0]/(m*x),f.pixelsToGLUnits[1]/(m*x)],u_overscale_factor:T}},gm=function(c,f,h){return{u_matrix:c,u_inv_matrix:f,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Ea=function(c,f,h){return h===void 0&&(h=1),{u_matrix:c,u_color:f,u_overlay:0,u_overlay_scale:h}},Sa=function(c){return{u_matrix:c}},ym=function(c,f,h,m){return{u_matrix:c,u_extrude_scale:wn(f,1,h),u_intensity:m}},yu=function(c,f,h){var m=c.transform;return{u_matrix:vm(c,f,h),u_ratio:1/wn(f,1,m.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Tn=function(c,f,h,m){return s.extend(yu(c,f,h),{u_image:0,u_image_height:m})},Ic=function(c,f,h,m){var x=c.transform,T=yl(f,x);return{u_matrix:vm(c,f,h),u_texsize:f.imageAtlasTexture.size,u_ratio:1/wn(f,1,x.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},p_=function(c,f,h,m,x){var T=c.lineAtlas,E=yl(f,c.transform),C=h.layout.get("line-cap")==="round",O=T.getDash(m.from,C),N=T.getDash(m.to,C),Z=O.width*x.fromScale,Y=N.width*x.toScale;return s.extend(yu(c,f,h),{u_patternscale_a:[E/Z,-O.height/2],u_patternscale_b:[E/Y,-N.height/2],u_sdfgamma:T.width/(256*Math.min(Z,Y)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:N.y,u_mix:x.t})};function yl(c,f){return 1/wn(c,1,f.tileZoom)}function vm(c,f,h){return c.translatePosMatrix(f.tileID.posMatrix,f,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var d_=function(c,f,h,m,x){return{u_matrix:c,u_tl_parent:f,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(E=x.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(T=x.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:_m(x.paint.get("raster-hue-rotate"))};var T,E};function _m(c){c*=Math.PI/180;var f=Math.sin(c),h=Math.cos(c);return[(2*h+1)/3,(-Math.sqrt(3)*f-h+1)/3,(Math.sqrt(3)*f-h+1)/3]}var Mc,vl=function(c,f,h,m,x,T,E,C,O,N){var Z=x.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Z.width/Z.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+O,u_pitch_with_map:+m,u_texsize:N,u_texture:0}},vu=function(c,f,h,m,x,T,E,C,O,N,Z){var Y=x.transform;return s.extend(vl(c,f,h,m,x,T,E,C,O,N),{u_gamma_scale:m?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:+Z})},Lc=function(c,f,h,m,x,T,E,C,O,N){return s.extend(vu(c,f,h,m,x,T,E,C,!0,O,!0),{u_texsize_icon:N,u_texture_icon:1})},_u=function(c,f,h){return{u_matrix:c,u_opacity:f,u_color:h}},_l=function(c,f,h,m,x,T){return s.extend(function(E,C,O,N){var Z=O.imageManager.getPattern(E.from.toString()),Y=O.imageManager.getPattern(E.to.toString()),K=O.imageManager.getPixelSize(),at=K.width,it=K.height,ht=Math.pow(2,N.tileID.overscaledZ),et=N.tileSize*Math.pow(2,O.transform.tileZoom)/ht,ct=et*(N.tileID.canonical.x+N.tileID.wrap*ht),yt=et*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[at,it],u_mix:C.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/wn(N,1,O.transform.tileZoom),u_pixel_coord_upper:[ct>>16,yt>>16],u_pixel_coord_lower:[65535&ct,65535&yt]}}(m,T,h,x),{u_matrix:c,u_opacity:f})},xm={fillExtrusion:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_lightpos:new s.Uniform3f(c,f.u_lightpos),u_lightintensity:new s.Uniform1f(c,f.u_lightintensity),u_lightcolor:new s.Uniform3f(c,f.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,f.u_vertical_gradient),u_opacity:new s.Uniform1f(c,f.u_opacity)}},fillExtrusionPattern:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_lightpos:new s.Uniform3f(c,f.u_lightpos),u_lightintensity:new s.Uniform1f(c,f.u_lightintensity),u_lightcolor:new s.Uniform3f(c,f.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,f.u_vertical_gradient),u_height_factor:new s.Uniform1f(c,f.u_height_factor),u_image:new s.Uniform1i(c,f.u_image),u_texsize:new s.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,f.u_scale),u_fade:new s.Uniform1f(c,f.u_fade),u_opacity:new s.Uniform1f(c,f.u_opacity)}},fill:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix)}},fillPattern:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_image:new s.Uniform1i(c,f.u_image),u_texsize:new s.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,f.u_scale),u_fade:new s.Uniform1f(c,f.u_fade)}},fillOutline:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_world:new s.Uniform2f(c,f.u_world)}},fillOutlinePattern:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_world:new s.Uniform2f(c,f.u_world),u_image:new s.Uniform1i(c,f.u_image),u_texsize:new s.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,f.u_scale),u_fade:new s.Uniform1f(c,f.u_fade)}},circle:function(c,f){return{u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(c,f.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(c,f.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(c,f.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(c,f.u_matrix)}},collisionBox:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(c,f.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(c,f.u_extrude_scale),u_overscale_factor:new s.Uniform1f(c,f.u_overscale_factor)}},collisionCircle:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_inv_matrix:new s.UniformMatrix4f(c,f.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(c,f.u_viewport_size)}},debug:function(c,f){return{u_color:new s.UniformColor(c,f.u_color),u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_overlay:new s.Uniform1i(c,f.u_overlay),u_overlay_scale:new s.Uniform1f(c,f.u_overlay_scale)}},clippingMask:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix)}},heatmap:function(c,f){return{u_extrude_scale:new s.Uniform1f(c,f.u_extrude_scale),u_intensity:new s.Uniform1f(c,f.u_intensity),u_matrix:new s.UniformMatrix4f(c,f.u_matrix)}},heatmapTexture:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_world:new s.Uniform2f(c,f.u_world),u_image:new s.Uniform1i(c,f.u_image),u_color_ramp:new s.Uniform1i(c,f.u_color_ramp),u_opacity:new s.Uniform1f(c,f.u_opacity)}},hillshade:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_image:new s.Uniform1i(c,f.u_image),u_latrange:new s.Uniform2f(c,f.u_latrange),u_light:new s.Uniform2f(c,f.u_light),u_shadow:new s.UniformColor(c,f.u_shadow),u_highlight:new s.UniformColor(c,f.u_highlight),u_accent:new s.UniformColor(c,f.u_accent)}},hillshadePrepare:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_image:new s.Uniform1i(c,f.u_image),u_dimension:new s.Uniform2f(c,f.u_dimension),u_zoom:new s.Uniform1f(c,f.u_zoom),u_unpack:new s.Uniform4f(c,f.u_unpack)}},line:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_ratio:new s.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,f.u_units_to_pixels)}},lineGradient:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_ratio:new s.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,f.u_units_to_pixels),u_image:new s.Uniform1i(c,f.u_image),u_image_height:new s.Uniform1f(c,f.u_image_height)}},linePattern:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_texsize:new s.Uniform2f(c,f.u_texsize),u_ratio:new s.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_image:new s.Uniform1i(c,f.u_image),u_units_to_pixels:new s.Uniform2f(c,f.u_units_to_pixels),u_scale:new s.Uniform3f(c,f.u_scale),u_fade:new s.Uniform1f(c,f.u_fade)}},lineSDF:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_ratio:new s.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,f.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(c,f.u_patternscale_a),u_patternscale_b:new s.Uniform2f(c,f.u_patternscale_b),u_sdfgamma:new s.Uniform1f(c,f.u_sdfgamma),u_image:new s.Uniform1i(c,f.u_image),u_tex_y_a:new s.Uniform1f(c,f.u_tex_y_a),u_tex_y_b:new s.Uniform1f(c,f.u_tex_y_b),u_mix:new s.Uniform1f(c,f.u_mix)}},raster:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_tl_parent:new s.Uniform2f(c,f.u_tl_parent),u_scale_parent:new s.Uniform1f(c,f.u_scale_parent),u_buffer_scale:new s.Uniform1f(c,f.u_buffer_scale),u_fade_t:new s.Uniform1f(c,f.u_fade_t),u_opacity:new s.Uniform1f(c,f.u_opacity),u_image0:new s.Uniform1i(c,f.u_image0),u_image1:new s.Uniform1i(c,f.u_image1),u_brightness_low:new s.Uniform1f(c,f.u_brightness_low),u_brightness_high:new s.Uniform1f(c,f.u_brightness_high),u_saturation_factor:new s.Uniform1f(c,f.u_saturation_factor),u_contrast_factor:new s.Uniform1f(c,f.u_contrast_factor),u_spin_weights:new s.Uniform3f(c,f.u_spin_weights)}},symbolIcon:function(c,f){return{u_is_size_zoom_constant:new s.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,f.u_size_t),u_size:new s.Uniform1f(c,f.u_size),u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,f.u_pitch),u_rotate_symbol:new s.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,f.u_fade_change),u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new s.Uniform1i(c,f.u_is_text),u_pitch_with_map:new s.Uniform1i(c,f.u_pitch_with_map),u_texsize:new s.Uniform2f(c,f.u_texsize),u_texture:new s.Uniform1i(c,f.u_texture)}},symbolSDF:function(c,f){return{u_is_size_zoom_constant:new s.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,f.u_size_t),u_size:new s.Uniform1f(c,f.u_size),u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,f.u_pitch),u_rotate_symbol:new s.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,f.u_fade_change),u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new s.Uniform1i(c,f.u_is_text),u_pitch_with_map:new s.Uniform1i(c,f.u_pitch_with_map),u_texsize:new s.Uniform2f(c,f.u_texsize),u_texture:new s.Uniform1i(c,f.u_texture),u_gamma_scale:new s.Uniform1f(c,f.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,f.u_is_halo)}},symbolTextAndIcon:function(c,f){return{u_is_size_zoom_constant:new s.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,f.u_size_t),u_size:new s.Uniform1f(c,f.u_size),u_camera_to_center_distance:new s.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,f.u_pitch),u_rotate_symbol:new s.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,f.u_fade_change),u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new s.Uniform1i(c,f.u_is_text),u_pitch_with_map:new s.Uniform1i(c,f.u_pitch_with_map),u_texsize:new s.Uniform2f(c,f.u_texsize),u_texsize_icon:new s.Uniform2f(c,f.u_texsize_icon),u_texture:new s.Uniform1i(c,f.u_texture),u_texture_icon:new s.Uniform1i(c,f.u_texture_icon),u_gamma_scale:new s.Uniform1f(c,f.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,f.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,f.u_is_halo)}},background:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_opacity:new s.Uniform1f(c,f.u_opacity),u_color:new s.UniformColor(c,f.u_color)}},backgroundPattern:function(c,f){return{u_matrix:new s.UniformMatrix4f(c,f.u_matrix),u_opacity:new s.Uniform1f(c,f.u_opacity),u_image:new s.Uniform1i(c,f.u_image),u_pattern_tl_a:new s.Uniform2f(c,f.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(c,f.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(c,f.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(c,f.u_pattern_br_b),u_texsize:new s.Uniform2f(c,f.u_texsize),u_mix:new s.Uniform1f(c,f.u_mix),u_pattern_size_a:new s.Uniform2f(c,f.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(c,f.u_pattern_size_b),u_scale_a:new s.Uniform1f(c,f.u_scale_a),u_scale_b:new s.Uniform1f(c,f.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,f.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(c,f.u_tile_units_to_pixels)}}};function xl(c,f,h,m,x,T,E){for(var C=c.context,O=C.gl,N=c.useProgram("collisionBox"),Z=[],Y=0,K=0,at=0;at<m.length;at++){var it=m[at],ht=f.getTile(it),et=ht.getBucket(h);if(et){var ct=it.posMatrix;x[0]===0&&x[1]===0||(ct=c.translatePosMatrix(it.posMatrix,ht,x,T));var yt=E?et.textCollisionBox:et.iconCollisionBox,bt=et.collisionCircleArray;if(bt.length>0){var Ct=s.create(),Pt=ct;s.mul(Ct,et.placementInvProjMatrix,c.transform.glCoordMatrix),s.mul(Ct,Ct,et.placementViewportMatrix),Z.push({circleArray:bt,circleOffset:K,transform:Pt,invTransform:Ct}),K=Y+=bt.length/4}yt&&N.draw(C,O.LINES,J.disabled,ot.disabled,c.colorModeForRenderPass(),gt.disabled,Ta(ct,c.transform,ht),h.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,c.transform.zoom,null,null,yt.collisionVertexBuffer)}}if(E&&Z.length){var Mt=c.useProgram("collisionCircle"),Ft=new s.StructArrayLayout2f1f2i16;Ft.resize(4*Y),Ft._trim();for(var Wt=0,Gt=0,re=Z;Gt<re.length;Gt+=1)for(var ge=re[Gt],we=0;we<ge.circleArray.length/4;we++){var xe=4*we,en=ge.circleArray[xe+0],oe=ge.circleArray[xe+1],Me=ge.circleArray[xe+2],Be=ge.circleArray[xe+3];Ft.emplace(Wt++,en,oe,Me,Be,0),Ft.emplace(Wt++,en,oe,Me,Be,1),Ft.emplace(Wt++,en,oe,Me,Be,2),Ft.emplace(Wt++,en,oe,Me,Be,3)}(!Mc||Mc.length<2*Y)&&(Mc=function(Gn){var Hr=2*Gn,Cr=new s.StructArrayLayout3ui6;Cr.resize(Hr),Cr._trim();for(var Fn=0;Fn<Hr;Fn++){var $n=6*Fn;Cr.uint16[$n+0]=4*Fn+0,Cr.uint16[$n+1]=4*Fn+1,Cr.uint16[$n+2]=4*Fn+2,Cr.uint16[$n+3]=4*Fn+2,Cr.uint16[$n+4]=4*Fn+3,Cr.uint16[$n+5]=4*Fn+0}return Cr}(Y));for(var Ie=C.createIndexBuffer(Mc,!0),Ce=C.createVertexBuffer(Ft,s.collisionCircleLayout.members,!0),Ne=0,Ae=Z;Ne<Ae.length;Ne+=1){var Ee=Ae[Ne],_r=gm(Ee.transform,Ee.invTransform,c.transform);Mt.draw(C,O.TRIANGLES,J.disabled,ot.disabled,c.colorModeForRenderPass(),gt.disabled,_r,h.id,Ce,Ie,s.SegmentVector.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,c.transform.zoom,null,null,null)}Ce.destroy(),Ie.destroy()}}var mo=s.identity(new Float32Array(16));function bm(c,f,h,m,x,T){var E=s.getAnchorAlignment(c),C=-(E.horizontalAlign-.5)*f,O=-(E.verticalAlign-.5)*h,N=s.evaluateVariableOffset(c,m);return new s.Point((C/x+N[0])*T,(O/x+N[1])*T)}function wm(c,f,h,m,x,T,E,C,O,N,Z){var Y=c.text.placedSymbolArray,K=c.text.dynamicLayoutVertexArray,at=c.icon.dynamicLayoutVertexArray,it={};K.clear();for(var ht=0;ht<Y.length;ht++){var et=Y.get(ht),ct=et.hidden||!et.crossTileID||c.allowVerticalPlacement&&!et.placedOrientation?null:m[et.crossTileID];if(ct){var yt=new s.Point(et.anchorX,et.anchorY),bt=De(yt,h?C:E),Ct=Ge(T.cameraToCenterDistance,bt.signedDistanceFromCamera),Pt=x.evaluateSizeForFeature(c.textSizeData,N,et)*Ct/s.ONE_EM;h&&(Pt*=c.tilePixelRatio/O);for(var Mt=bm(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textBoxScale,Pt),Ft=h?De(yt.add(Mt),E).point:bt.point.add(f?Mt.rotate(-T.angle):Mt),Wt=c.allowVerticalPlacement&&et.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,Gt=0;Gt<et.numGlyphs;Gt++)s.addDynamicAttributes(K,Ft,Wt);Z&&et.associatedIconIndex>=0&&(it[et.associatedIconIndex]={shiftedAnchor:Ft,angle:Wt})}else vr(et.numGlyphs,K)}if(Z){at.clear();for(var re=c.icon.placedSymbolArray,ge=0;ge<re.length;ge++){var we=re.get(ge);if(we.hidden)vr(we.numGlyphs,at);else{var xe=it[ge];if(xe)for(var en=0;en<we.numGlyphs;en++)s.addDynamicAttributes(at,xe.shiftedAnchor,xe.angle);else vr(we.numGlyphs,at)}}c.icon.dynamicLayoutVertexBuffer.updateData(at)}c.text.dynamicLayoutVertexBuffer.updateData(K)}function Tm(c,f,h){return h.iconsInText&&f?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Pa(c,f,h,m,x,T,E,C,O,N,Z,Y){for(var K=c.context,at=K.gl,it=c.transform,ht=C==="map",et=O==="map",ct=ht&&h.layout.get("symbol-placement")!=="point",yt=ht&&!et&&!ct,bt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ct=!1,Pt=c.depthModeForSublayer(0,J.ReadOnly),Mt=h.layout.get("text-variable-anchor"),Ft=[],Wt=0,Gt=m;Wt<Gt.length;Wt+=1){var re=Gt[Wt],ge=f.getTile(re),we=ge.getBucket(h);if(we){var xe=x?we.text:we.icon;if(xe&&xe.segments.get().length){var en=xe.programConfigurations.get(h.id),oe=x||we.sdfIcons,Me=x?we.textSizeData:we.iconSizeData,Be=et||it.pitch!==0,Ie=c.useProgram(Tm(oe,x,we),en),Ce=s.evaluateSizeForZoom(Me,it.zoom),Ne=void 0,Ae=[0,0],Ee=void 0,_r=void 0,Gn=null,Hr=void 0;if(x)Ee=ge.glyphAtlasTexture,_r=at.LINEAR,Ne=ge.glyphAtlasTexture.size,we.iconsInText&&(Ae=ge.imageAtlasTexture.size,Gn=ge.imageAtlasTexture,Hr=Be||c.options.rotating||c.options.zooming||Me.kind==="composite"||Me.kind==="camera"?at.LINEAR:at.NEAREST);else{var Cr=h.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Ee=ge.imageAtlasTexture,_r=oe||c.options.rotating||c.options.zooming||Cr||Be?at.LINEAR:at.NEAREST,Ne=ge.imageAtlasTexture.size}var Fn=wn(ge,1,c.transform.zoom),$n=gn(re.posMatrix,et,ht,c.transform,Fn),Ii=on(re.posMatrix,et,ht,c.transform,Fn),Jr=Mt&&we.hasTextData(),Ns=h.layout.get("icon-text-fit")!=="none"&&Jr&&we.hasIconData();ct&&ws(we,re.posMatrix,c,x,$n,Ii,et,N);var oi=c.translatePosMatrix(re.posMatrix,ge,T,E),xo=ct||x&&Mt||Ns?mo:$n,ro=c.translatePosMatrix(Ii,ge,T,E,!0),Lu=oe&&h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Pl={program:Ie,buffers:xe,uniformValues:oe?we.iconsInText?Lc(Me.kind,Ce,yt,et,c,oi,xo,ro,Ne,Ae):vu(Me.kind,Ce,yt,et,c,oi,xo,ro,x,Ne,!0):vl(Me.kind,Ce,yt,et,c,oi,xo,ro,x,Ne),atlasTexture:Ee,atlasTextureIcon:Gn,atlasInterpolation:_r,atlasInterpolationIcon:Hr,isSDF:oe,hasHalo:Lu};if(bt&&we.canOverlap){Ct=!0;for(var Bs=0,Al=xe.segments.get();Bs<Al.length;Bs+=1){var ku=Al[Bs];Ft.push({segments:new s.SegmentVector([ku]),sortKey:ku.sortKey,state:Pl})}}else Ft.push({segments:xe.segments,sortKey:0,state:Pl})}}}Ct&&Ft.sort(function(Us,ka){return Us.sortKey-ka.sortKey});for(var zo=0,Ou=Ft;zo<Ou.length;zo+=1){var Do=Ou[zo],xr=Do.state;if(K.activeTexture.set(at.TEXTURE0),xr.atlasTexture.bind(xr.atlasInterpolation,at.CLAMP_TO_EDGE),xr.atlasTextureIcon&&(K.activeTexture.set(at.TEXTURE1),xr.atlasTextureIcon&&xr.atlasTextureIcon.bind(xr.atlasInterpolationIcon,at.CLAMP_TO_EDGE)),xr.isSDF){var ts=xr.uniformValues;xr.hasHalo&&(ts.u_is_halo=1,xu(xr.buffers,Do.segments,h,c,xr.program,Pt,Z,Y,ts)),ts.u_is_halo=0}xu(xr.buffers,Do.segments,h,c,xr.program,Pt,Z,Y,xr.uniformValues)}}function xu(c,f,h,m,x,T,E,C,O){var N=m.context;x.draw(N,N.gl.TRIANGLES,T,E,C,gt.disabled,O,h.id,c.layoutVertexBuffer,c.indexBuffer,f,h.paint,m.transform.zoom,c.programConfigurations.get(h.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function kc(c,f,h,m,x,T,E){var C,O,N,Z,Y,K=c.context.gl,at=h.paint.get("fill-pattern"),it=at&&at.constantOr(1),ht=h.getCrossfadeParameters();E?(O=it&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=K.LINES):(O=it?"fillPattern":"fill",C=K.TRIANGLES);for(var et=0,ct=m;et<ct.length;et+=1){var yt=ct[et],bt=f.getTile(yt);if(!it||bt.patternsLoaded()){var Ct=bt.getBucket(h);if(Ct){var Pt=Ct.programConfigurations.get(h.id),Mt=c.useProgram(O,Pt);it&&(c.context.activeTexture.set(K.TEXTURE0),bt.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Pt.updatePaintBuffers(ht));var Ft=at.constantOr(null);if(Ft&&bt.imageAtlas){var Wt=bt.imageAtlas,Gt=Wt.patternPositions[Ft.to.toString()],re=Wt.patternPositions[Ft.from.toString()];Gt&&re&&Pt.setConstantPatternPositions(Gt,re)}var ge=c.translatePosMatrix(yt.posMatrix,bt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){Z=Ct.indexBuffer2,Y=Ct.segments2;var we=[K.drawingBufferWidth,K.drawingBufferHeight];N=O==="fillOutlinePattern"&&it?mm(ge,c,ht,bt,we):dm(ge,we)}else Z=Ct.indexBuffer,Y=Ct.segments,N=it?wa(ge,c,ht,bt):ks(ge);Mt.draw(c.context,C,x,c.stencilModeForClipping(yt),T,gt.disabled,N,h.id,Ct.layoutVertexBuffer,Z,Y,h.paint,c.transform.zoom,Pt)}}}}function kf(c,f,h,m,x,T,E){for(var C=c.context,O=C.gl,N=h.paint.get("fill-extrusion-pattern"),Z=N.constantOr(1),Y=h.getCrossfadeParameters(),K=h.paint.get("fill-extrusion-opacity"),at=0,it=m;at<it.length;at+=1){var ht=it[at],et=f.getTile(ht),ct=et.getBucket(h);if(ct){var yt=ct.programConfigurations.get(h.id),bt=c.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",yt);Z&&(c.context.activeTexture.set(O.TEXTURE0),et.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),yt.updatePaintBuffers(Y));var Ct=N.constantOr(null);if(Ct&&et.imageAtlas){var Pt=et.imageAtlas,Mt=Pt.patternPositions[Ct.to.toString()],Ft=Pt.patternPositions[Ct.from.toString()];Mt&&Ft&&yt.setConstantPatternPositions(Mt,Ft)}var Wt=c.translatePosMatrix(ht.posMatrix,et,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Gt=h.paint.get("fill-extrusion-vertical-gradient"),re=Z?ba(Wt,c,Gt,K,ht,Y,et):pm(Wt,c,Gt,K);bt.draw(C,C.gl.TRIANGLES,x,T,E,gt.backCCW,re,h.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,h.paint,c.transform.zoom,yt)}}}function Oc(c,f,h,m,x,T){var E=c.context,C=E.gl,O=f.fbo;if(O){var N=c.useProgram("hillshade");E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,O.colorAttachment.get());var Z=function(Y,K,at){var it=at.paint.get("hillshade-shadow-color"),ht=at.paint.get("hillshade-highlight-color"),et=at.paint.get("hillshade-accent-color"),ct=at.paint.get("hillshade-illumination-direction")*(Math.PI/180);at.paint.get("hillshade-illumination-anchor")==="viewport"&&(ct-=Y.transform.angle);var yt,bt,Ct,Pt=!Y.options.moving;return{u_matrix:Y.transform.calculatePosMatrix(K.tileID.toUnwrapped(),Pt),u_image:0,u_latrange:(yt=K.tileID,bt=Math.pow(2,yt.canonical.z),Ct=yt.canonical.y,[new s.MercatorCoordinate(0,Ct/bt).toLngLat().lat,new s.MercatorCoordinate(0,(Ct+1)/bt).toLngLat().lat]),u_light:[at.paint.get("hillshade-exaggeration"),ct],u_shadow:it,u_highlight:ht,u_accent:et}}(c,f,h);N.draw(E,C.TRIANGLES,m,x,T,gt.disabled,Z,h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function m_(c,f,h,m,x,T){var E=c.context,C=E.gl,O=f.dem;if(O&&O.data){var N=O.dim,Z=O.stride,Y=O.getPixels();if(E.activeTexture.set(C.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||c.getTileTexture(Z),f.demTexture){var K=f.demTexture;K.update(Y,{premultiply:!1}),K.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else f.demTexture=new s.Texture(E,Y,C.RGBA,{premultiply:!1}),f.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);E.activeTexture.set(C.TEXTURE0);var at=f.fbo;if(!at){var it=new s.Texture(E,{width:N,height:N,data:null},C.RGBA);it.bind(C.LINEAR,C.CLAMP_TO_EDGE),(at=f.fbo=E.createFramebuffer(N,N,!0)).colorAttachment.set(it.texture)}E.bindFramebuffer.set(at.framebuffer),E.viewport.set([0,0,N,N]),c.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,m,x,T,gt.disabled,function(ht,et){var ct=et.stride,yt=s.create();return s.ortho(yt,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(yt,yt,[0,-s.EXTENT,0]),{u_matrix:yt,u_image:1,u_dimension:[ct,ct],u_zoom:ht.overscaledZ,u_unpack:et.getUnpackVector()}}(f.tileID,O),h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Rc(c,f,h,m,x){var T=m.paint.get("raster-fade-duration");if(T>0){var E=s.browser.now(),C=(E-c.timeAdded)/T,O=f?(E-f.timeAdded)/T:-1,N=h.getSource(),Z=x.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),Y=!f||Math.abs(f.tileID.overscaledZ-Z)>Math.abs(c.tileID.overscaledZ-Z),K=Y&&c.refreshedUponExpiration?1:s.clamp(Y?C:1-O,0,1);return c.refreshedUponExpiration&&C>=1&&(c.refreshedUponExpiration=!1),f?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}var Of=new s.Color(1,0,0,1),Em=new s.Color(0,1,0,1),Sm=new s.Color(0,0,1,1),zc=new s.Color(1,0,1,1),Rf=new s.Color(0,1,1,1);function zf(c,f,h,m){bu(c,0,f+h/2,c.transform.width,h,m)}function Df(c,f,h,m){bu(c,f-h/2,0,h,c.transform.height,m)}function bu(c,f,h,m,x,T){var E=c.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(f*s.browser.devicePixelRatio,h*s.browser.devicePixelRatio,m*s.browser.devicePixelRatio,x*s.browser.devicePixelRatio),E.clear({color:T}),C.disable(C.SCISSOR_TEST)}function Pm(c,f,h){var m=c.context,x=m.gl,T=h.posMatrix,E=c.useProgram("debug"),C=J.disabled,O=ot.disabled,N=c.colorModeForRenderPass();m.activeTexture.set(x.TEXTURE0),c.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),E.draw(m,x.LINE_STRIP,C,O,N,gt.disabled,Ea(T,s.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var Z=f.getTileByID(h.key).latestRawTileData,Y=Math.floor((Z&&Z.byteLength||0)/1024),K=f.getTile(h).tileSize,at=512/Math.min(K,512)*(h.overscaledZ/c.transform.zoom)*.5,it=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(it+=" => "+h.overscaledZ),function(ht,et){ht.initDebugOverlayCanvas();var ct=ht.debugOverlayCanvas,yt=ht.context.gl,bt=ht.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,ct.width,ct.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(et,5,5),bt.strokeText(et,5,5),ht.debugOverlayTexture.update(ct),ht.debugOverlayTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}(c,it+" "+Y+"kb"),E.draw(m,x.TRIANGLES,C,O,mt.alphaBlended,gt.disabled,Ea(T,s.Color.transparent,at),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Aa={symbol:function(c,f,h,m,x){if(c.renderPass==="translucent"){var T=ot.disabled,E=c.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,O,N,Z,Y,K,at){for(var it=O.transform,ht=Y==="map",et=K==="map",ct=0,yt=C;ct<yt.length;ct+=1){var bt=yt[ct],Ct=Z.getTile(bt),Pt=Ct.getBucket(N);if(Pt&&Pt.text&&Pt.text.segments.get().length){var Mt=s.evaluateSizeForZoom(Pt.textSizeData,it.zoom),Ft=wn(Ct,1,O.transform.zoom),Wt=gn(bt.posMatrix,et,ht,O.transform,Ft),Gt=N.layout.get("icon-text-fit")!=="none"&&Pt.hasIconData();if(Mt){var re=Math.pow(2,it.zoom-Ct.tileID.overscaledZ);wm(Pt,ht,et,at,s.symbolSize,it,Wt,bt.posMatrix,re,Mt,Gt)}}}}(m,c,h,f,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),h.paint.get("icon-opacity").constantOr(1)!==0&&Pa(c,f,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),T,E),h.paint.get("text-opacity").constantOr(1)!==0&&Pa(c,f,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),T,E),f.map.showCollisionBoxes&&(xl(c,f,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),xl(c,f,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(c,f,h,m){if(c.renderPass==="translucent"){var x=h.paint.get("circle-opacity"),T=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)!==0||T.constantOr(1)!==0&&E.constantOr(1)!==0){for(var O=c.context,N=O.gl,Z=c.depthModeForSublayer(0,J.ReadOnly),Y=ot.disabled,K=c.colorModeForRenderPass(),at=[],it=0;it<m.length;it++){var ht=m[it],et=f.getTile(ht),ct=et.getBucket(h);if(ct){var yt=ct.programConfigurations.get(h.id),bt={programConfiguration:yt,program:c.useProgram("circle",yt),layoutVertexBuffer:ct.layoutVertexBuffer,indexBuffer:ct.indexBuffer,uniformValues:Lf(c,ht,et,h)};if(C)for(var Ct=0,Pt=ct.segments.get();Ct<Pt.length;Ct+=1){var Mt=Pt[Ct];at.push({segments:new s.SegmentVector([Mt]),sortKey:Mt.sortKey,state:bt})}else at.push({segments:ct.segments,sortKey:0,state:bt})}}C&&at.sort(function(ge,we){return ge.sortKey-we.sortKey});for(var Ft=0,Wt=at;Ft<Wt.length;Ft+=1){var Gt=Wt[Ft],re=Gt.state;re.program.draw(O,N.TRIANGLES,Z,Y,K,gt.disabled,re.uniformValues,h.id,re.layoutVertexBuffer,re.indexBuffer,Gt.segments,h.paint,c.transform.zoom,re.programConfiguration)}}}},heatmap:function(c,f,h,m){if(h.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var x=c.context,T=x.gl,E=ot.disabled,C=new mt([T.ONE,T.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(at,it,ht){var et=at.gl;at.activeTexture.set(et.TEXTURE1),at.viewport.set([0,0,it.width/4,it.height/4]);var ct=ht.heatmapFbo;if(ct)et.bindTexture(et.TEXTURE_2D,ct.colorAttachment.get()),at.bindFramebuffer.set(ct.framebuffer);else{var yt=et.createTexture();et.bindTexture(et.TEXTURE_2D,yt),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_S,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_T,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MIN_FILTER,et.LINEAR),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MAG_FILTER,et.LINEAR),ct=ht.heatmapFbo=at.createFramebuffer(it.width/4,it.height/4,!1),function(bt,Ct,Pt,Mt){var Ft=bt.gl;Ft.texImage2D(Ft.TEXTURE_2D,0,Ft.RGBA,Ct.width/4,Ct.height/4,0,Ft.RGBA,bt.extRenderToTextureHalfFloat?bt.extTextureHalfFloat.HALF_FLOAT_OES:Ft.UNSIGNED_BYTE,null),Mt.colorAttachment.set(Pt)}(at,it,yt,ct)}})(x,c,h),x.clear({color:s.Color.transparent});for(var O=0;O<m.length;O++){var N=m[O];if(!f.hasRenderableParent(N)){var Z=f.getTile(N),Y=Z.getBucket(h);if(Y){var K=Y.programConfigurations.get(h.id);c.useProgram("heatmap",K).draw(x,T.TRIANGLES,J.disabled,E,C,gt.disabled,ym(N.posMatrix,Z,c.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,h.paint,c.transform.zoom,K)}}}x.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(at,it){var ht=at.context,et=ht.gl,ct=it.heatmapFbo;if(ct){ht.activeTexture.set(et.TEXTURE0),et.bindTexture(et.TEXTURE_2D,ct.colorAttachment.get()),ht.activeTexture.set(et.TEXTURE1);var yt=it.colorRampTexture;yt||(yt=it.colorRampTexture=new s.Texture(ht,it.colorRamp,et.RGBA)),yt.bind(et.LINEAR,et.CLAMP_TO_EDGE),at.useProgram("heatmapTexture").draw(ht,et.TRIANGLES,J.disabled,ot.disabled,at.colorModeForRenderPass(),gt.disabled,function(bt,Ct,Pt,Mt){var Ft=s.create();s.ortho(Ft,0,bt.width,bt.height,0,0,1);var Wt=bt.context.gl;return{u_matrix:Ft,u_world:[Wt.drawingBufferWidth,Wt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ct.paint.get("heatmap-opacity")}}(at,it),it.id,at.viewportBuffer,at.quadTriangleIndexBuffer,at.viewportSegments,it.paint,at.transform.zoom)}}(c,h))},line:function(c,f,h,m){if(c.renderPass==="translucent"){var x=h.paint.get("line-opacity"),T=h.paint.get("line-width");if(x.constantOr(1)!==0&&T.constantOr(1)!==0)for(var E=c.depthModeForSublayer(0,J.ReadOnly),C=c.colorModeForRenderPass(),O=h.paint.get("line-dasharray"),N=h.paint.get("line-pattern"),Z=N.constantOr(1),Y=h.paint.get("line-gradient"),K=h.getCrossfadeParameters(),at=Z?"linePattern":O?"lineSDF":Y?"lineGradient":"line",it=c.context,ht=it.gl,et=!0,ct=0,yt=m;ct<yt.length;ct+=1){var bt=yt[ct],Ct=f.getTile(bt);if(!Z||Ct.patternsLoaded()){var Pt=Ct.getBucket(h);if(Pt){var Mt=Pt.programConfigurations.get(h.id),Ft=c.context.program.get(),Wt=c.useProgram(at,Mt),Gt=et||Wt.program!==Ft,re=N.constantOr(null);if(re&&Ct.imageAtlas){var ge=Ct.imageAtlas,we=ge.patternPositions[re.to.toString()],xe=ge.patternPositions[re.from.toString()];we&&xe&&Mt.setConstantPatternPositions(we,xe)}var en=Z?Ic(c,Ct,h,K):O?p_(c,Ct,h,O,K):Y?Tn(c,Ct,h,Pt.lineClipsArray.length):yu(c,Ct,h);if(Z)it.activeTexture.set(ht.TEXTURE0),Ct.imageAtlasTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),Mt.updatePaintBuffers(K);else if(O&&(Gt||c.lineAtlas.dirty))it.activeTexture.set(ht.TEXTURE0),c.lineAtlas.bind(it);else if(Y){var oe=Pt.gradients[h.id],Me=oe.texture;if(h.gradientVersion!==oe.version){var Be=256;if(h.stepInterpolant){var Ie=f.getSource().maxzoom,Ce=bt.canonical.z===Ie?Math.ceil(1<<c.transform.maxZoom-bt.canonical.z):1;Be=s.clamp(s.nextPowerOfTwo(Pt.maxLineLength/s.EXTENT*1024*Ce),256,it.maxTextureSize)}oe.gradient=s.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Be,image:oe.gradient||void 0,clips:Pt.lineClipsArray}),oe.texture?oe.texture.update(oe.gradient):oe.texture=new s.Texture(it,oe.gradient,ht.RGBA),oe.version=h.gradientVersion,Me=oe.texture}it.activeTexture.set(ht.TEXTURE0),Me.bind(h.stepInterpolant?ht.NEAREST:ht.LINEAR,ht.CLAMP_TO_EDGE)}Wt.draw(it,ht.TRIANGLES,E,c.stencilModeForClipping(bt),C,gt.disabled,en,h.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,h.paint,c.transform.zoom,Mt,Pt.layoutVertexBuffer2),et=!1}}}}},fill:function(c,f,h,m){var x=h.paint.get("fill-color"),T=h.paint.get("fill-opacity");if(T.constantOr(1)!==0){var E=c.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),O=c.opaquePassEnabledForLayer()&&!C.constantOr(1)&&x.constantOr(s.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===O){var N=c.depthModeForSublayer(1,c.renderPass==="opaque"?J.ReadWrite:J.ReadOnly);kc(c,f,h,m,N,E,!1)}if(c.renderPass==="translucent"&&h.paint.get("fill-antialias")){var Z=c.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,J.ReadOnly);kc(c,f,h,m,Z,E,!0)}}},"fill-extrusion":function(c,f,h,m){var x=h.paint.get("fill-extrusion-opacity");if(x!==0&&c.renderPass==="translucent"){var T=new J(c.context.gl.LEQUAL,J.ReadWrite,c.depthRangeFor3D);if(x!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))kf(c,f,h,m,T,ot.disabled,mt.disabled),kf(c,f,h,m,T,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var E=c.colorModeForRenderPass();kf(c,f,h,m,T,ot.disabled,E)}}},hillshade:function(c,f,h,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var x=c.context,T=c.depthModeForSublayer(0,J.ReadOnly),E=c.colorModeForRenderPass(),C=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],O=C[0],N=0,Z=C[1];N<Z.length;N+=1){var Y=Z[N],K=f.getTile(Y);K.needsHillshadePrepare&&c.renderPass==="offscreen"?m_(c,K,h,T,ot.disabled,E):c.renderPass==="translucent"&&Oc(c,K,h,T,O[Y.overscaledZ],E)}x.viewport.set([0,0,c.width,c.height])}},raster:function(c,f,h,m){if(c.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&m.length)for(var x=c.context,T=x.gl,E=f.getSource(),C=c.useProgram("raster"),O=c.colorModeForRenderPass(),N=E instanceof Sr?[{},m]:c.stencilConfigForOverlap(m),Z=N[0],Y=N[1],K=Y[Y.length-1].overscaledZ,at=!c.options.moving,it=0,ht=Y;it<ht.length;it+=1){var et=ht[it],ct=c.depthModeForSublayer(et.overscaledZ-K,h.paint.get("raster-opacity")===1?J.ReadWrite:J.ReadOnly,T.LESS),yt=f.getTile(et),bt=c.transform.calculatePosMatrix(et.toUnwrapped(),at);yt.registerFadeDuration(h.paint.get("raster-fade-duration"));var Ct=f.findLoadedParent(et,0),Pt=Rc(yt,Ct,f,h,c.transform),Mt=void 0,Ft=void 0,Wt=h.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;x.activeTexture.set(T.TEXTURE0),yt.texture.bind(Wt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(T.TEXTURE1),Ct?(Ct.texture.bind(Wt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),Mt=Math.pow(2,Ct.tileID.overscaledZ-yt.tileID.overscaledZ),Ft=[yt.tileID.canonical.x*Mt%1,yt.tileID.canonical.y*Mt%1]):yt.texture.bind(Wt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);var Gt=d_(bt,Ft||[0,0],Mt||1,Pt,h);E instanceof Sr?C.draw(x,T.TRIANGLES,ct,ot.disabled,O,gt.disabled,Gt,h.id,E.boundsBuffer,c.quadTriangleIndexBuffer,E.boundsSegments):C.draw(x,T.TRIANGLES,ct,Z[et.overscaledZ],O,gt.disabled,Gt,h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,f,h){var m=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x!==0){var T=c.context,E=T.gl,C=c.transform,O=C.tileSize,N=h.paint.get("background-pattern");if(!c.isPatternMissing(N)){var Z=!N&&m.a===1&&x===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===Z){var Y=ot.disabled,K=c.depthModeForSublayer(0,Z==="opaque"?J.ReadWrite:J.ReadOnly),at=c.colorModeForRenderPass(),it=c.useProgram(N?"backgroundPattern":"background"),ht=C.coveringTiles({tileSize:O});N&&(T.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));for(var et=h.getCrossfadeParameters(),ct=0,yt=ht;ct<yt.length;ct+=1){var bt=yt[ct],Ct=c.transform.calculatePosMatrix(bt.toUnwrapped()),Pt=N?_l(Ct,x,c,N,{tileID:bt,tileSize:O},et):_u(Ct,x,m);it.draw(T,E.TRIANGLES,K,Y,at,gt.disabled,Pt,h.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,f,h){for(var m=0;m<h.length;m++)Pm(c,f,h[m])},custom:function(c,f,h){var m=c.context,x=h.implementation;if(c.renderPass==="offscreen"){var T=x.prerender;T&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),T.call(x,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(ot.disabled);var E=x.renderingMode==="3d"?new J(c.context.gl.LEQUAL,J.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,J.ReadOnly);m.setDepthMode(E),x.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Mn=function(c,f){this.context=new $(c),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=lt.maxUnderzooming+lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss,this.gpuTimers={}};Mn.prototype.resize=function(c,f){if(this.width=c*s.browser.devicePixelRatio,this.height=f*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,m=this.style._order;h<m.length;h+=1)this.style._layers[m[h]].resize()},Mn.prototype.setup=function(){var c=this.context,f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(f,rr.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=c.createVertexBuffer(h,rr.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var m=new s.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,Vr.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var x=new s.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,rr.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var T=new s.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(T);var E=new s.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(E),this.emptyTexture=new s.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var C=this.context.gl;this.stencilClearMode=new ot({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)},Mn.prototype.clearStencil=function(){var c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=s.create();s.ortho(h,0,this.width,this.height,0,0,1),s.scale(h,h,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,f.TRIANGLES,J.disabled,this.stencilClearMode,mt.disabled,gt.disabled,Sa(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Mn.prototype._renderTileClippingMasks=function(c,f){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&f&&f.length){this.currentStencilSource=c.source;var h=this.context,m=h.gl;this.nextStencilID+f.length>256&&this.clearStencil(),h.setColorMode(mt.disabled),h.setDepthMode(J.disabled);var x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var T=0,E=f;T<E.length;T+=1){var C=E[T],O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++;x.draw(h,m.TRIANGLES,J.disabled,new ot({func:m.ALWAYS,mask:0},O,255,m.KEEP,m.KEEP,m.REPLACE),mt.disabled,gt.disabled,Sa(C.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Mn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,f=this.context.gl;return new ot({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)},Mn.prototype.stencilModeForClipping=function(c){var f=this.context.gl;return new ot({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)},Mn.prototype.stencilConfigForOverlap=function(c){var f,h=this.context.gl,m=c.sort(function(O,N){return N.overscaledZ-O.overscaledZ}),x=m[m.length-1].overscaledZ,T=m[0].overscaledZ-x+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();for(var E={},C=0;C<T;C++)E[C+x]=new ot({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=T,[E,m]}return[(f={},f[x]=ot.disabled,f),m]},Mn.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new mt([c.CONSTANT_COLOR,c.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mt.unblended:mt.alphaBlended},Mn.prototype.depthModeForSublayer=function(c,f,h){if(!this.opaquePassEnabledForLayer())return J.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new J(h||this.context.gl.LEQUAL,f,[m,m])},Mn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Mn.prototype.render=function(c,f){var h=this;this.style=c,this.options=f,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var m=this.style._order,x=this.style.sourceCaches;for(var T in x){var E=x[T];E.used&&E.prepare(this.context)}var C,O,N={},Z={},Y={};for(var K in x){var at=x[K];N[K]=at.getVisibleCoordinates(),Z[K]=N[K].slice().reverse(),Y[K]=at.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var it=0;it<m.length;it++)if(this.style._layers[m[it]].is3D()){this.opaquePassCutoff=it;break}this.renderPass="offscreen";for(var ht=0,et=m;ht<et.length;ht+=1){var ct=this.style._layers[et[ht]];if(ct.hasOffscreenPass()&&!ct.isHidden(this.transform.zoom)){var yt=Z[ct.source];(ct.type==="custom"||yt.length)&&this.renderLayer(this,x[ct.source],ct,yt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var bt=this.style._layers[m[this.currentLayer]],Ct=x[bt.source],Pt=N[bt.source];this._renderTileClippingMasks(bt,Pt),this.renderLayer(this,Ct,bt,Pt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var Mt=this.style._layers[m[this.currentLayer]],Ft=x[Mt.source],Wt=(Mt.type==="symbol"?Y:Z)[Mt.source];this._renderTileClippingMasks(Mt,N[Mt.source]),this.renderLayer(this,Ft,Mt,Wt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(Gt){Gt.source&&!Gt.isHidden(h.transform.zoom)&&(Gt.source!==(O&&O.id)&&(O=h.style.sourceCaches[Gt.source]),(!C||C.getSource().maxzoom<O.getSource().maxzoom)&&(C=O))}),C&&Aa.debug(this,C,C.getVisibleCoordinates())),this.options.showPadding&&function(Gt){var re=Gt.transform.padding;zf(Gt,Gt.transform.height-(re.top||0),3,Of),zf(Gt,re.bottom||0,3,Em),Df(Gt,re.left||0,3,Sm),Df(Gt,Gt.transform.width-(re.right||0),3,zc);var ge=Gt.transform.centerPoint;(function(we,xe,en,oe){bu(we,xe-1,en-10,2,20,oe),bu(we,xe-10,en-1,20,2,oe)})(Gt,ge.x,Gt.transform.height-ge.y,Rf)}(this),this.context.setDefault()},Mn.prototype.renderLayer=function(c,f,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||m.length)&&(this.id=h.id,this.gpuTimingStart(h),Aa[h.type](c,f,h,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Mn.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var f=this.context.extTimerQuery,h=this.gpuTimers[c.id];h||(h=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),h.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,h.query)}},Mn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Mn.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Mn.prototype.queryGpuTimers=function(c){var f={};for(var h in c){var m=c[h],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(m.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(m.query),f[h]=T}return f},Mn.prototype.translatePosMatrix=function(c,f,h,m,x){if(!h[0]&&!h[1])return c;var T=x?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(T){var E=Math.sin(T),C=Math.cos(T);h=[h[0]*C-h[1]*E,h[0]*E+h[1]*C]}var O=[x?h[0]:wn(f,h[0],this.transform.zoom),x?h[1]:wn(f,h[1],this.transform.zoom),0],N=new Float32Array(16);return s.translate(N,c,O),N},Mn.prototype.saveTileTexture=function(c){var f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]},Mn.prototype.getTileTexture=function(c){var f=this._tileTextures[c];return f&&f.length>0?f.pop():null},Mn.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var f=this.imageManager.getPattern(c.from.toString()),h=this.imageManager.getPattern(c.to.toString());return!f||!h},Mn.prototype.useProgram=function(c,f){this.cache=this.cache||{};var h=""+c+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new hm(this.context,c,f_[c],f,xm[c],this._showOverdrawInspector)),this.cache[h]},Mn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Mn.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Mn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Mn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Dc=function(c,f){this.points=c,this.planes=f};Dc.fromInvProjectionMatrix=function(c,f,h){var m=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(E){return s.transformMat4([],E,c)}).map(function(E){return s.scale$1([],E,1/E[3]/f*m)}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(E){var C=s.sub([],x[E[0]],x[E[1]]),O=s.sub([],x[E[2]],x[E[1]]),N=s.normalize([],s.cross([],C,O)),Z=-s.dot(N,x[E[1]]);return N.concat(Z)});return new Dc(x,T)};var Ca=function(c,f){this.min=c,this.max=f,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};Ca.prototype.quadrant=function(c){for(var f=[c%2==0,c<2],h=s.clone$2(this.min),m=s.clone$2(this.max),x=0;x<f.length;x++)h[x]=f[x]?this.min[x]:this.center[x],m[x]=f[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new Ca(h,m)},Ca.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Ca.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Ca.prototype.intersects=function(c){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,m=0;m<c.planes.length;m++){for(var x=c.planes[m],T=0,E=0;E<f.length;E++)T+=s.dot$1(x,f[E])>=0;if(T===0)return 0;T!==f.length&&(h=!1)}if(h)return 2;for(var C=0;C<3;C++){for(var O=Number.MAX_VALUE,N=-Number.MAX_VALUE,Z=0;Z<c.points.length;Z++){var Y=c.points[Z][C]-this.min[C];O=Math.min(O,Y),N=Math.max(N,Y)}if(N<0||O>this.max[C]-this.min[C])return 0}return 1};var Os=function(c,f,h,m){if(c===void 0&&(c=0),f===void 0&&(f=0),h===void 0&&(h=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(f)||f<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=h,this.right=m};Os.prototype.interpolate=function(c,f,h){return f.top!=null&&c.top!=null&&(this.top=s.number(c.top,f.top,h)),f.bottom!=null&&c.bottom!=null&&(this.bottom=s.number(c.bottom,f.bottom,h)),f.left!=null&&c.left!=null&&(this.left=s.number(c.left,f.left,h)),f.right!=null&&c.right!=null&&(this.right=s.number(c.right,f.right,h)),this},Os.prototype.getCenter=function(c,f){var h=s.clamp((this.left+c-this.right)/2,0,c),m=s.clamp((this.top+f-this.bottom)/2,0,f);return new s.Point(h,m)},Os.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},Os.prototype.clone=function(){return new Os(this.top,this.bottom,this.left,this.right)},Os.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ke=function(c,f,h,m,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||x,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Os,this._posMatrixCache={},this._alignedPosMatrixCache={}},En={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ke.prototype.clone=function(){var c=new Ke(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},En.minZoom.get=function(){return this._minZoom},En.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},En.maxZoom.get=function(){return this._maxZoom},En.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},En.minPitch.get=function(){return this._minPitch},En.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},En.maxPitch.get=function(){return this._maxPitch},En.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},En.renderWorldCopies.get=function(){return this._renderWorldCopies},En.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},En.worldSize.get=function(){return this.tileSize*this.scale},En.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},En.size.get=function(){return new s.Point(this.width,this.height)},En.bearing.get=function(){return-this.angle/Math.PI*180},En.bearing.set=function(c){var f=-s.wrap(c,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},En.pitch.get=function(){return this._pitch/Math.PI*180},En.pitch.set=function(c){var f=s.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},En.fov.get=function(){return this._fov/Math.PI*180},En.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},En.zoom.get=function(){return this._zoom},En.zoom.set=function(c){var f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},En.center.get=function(){return this._center},En.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},En.padding.get=function(){return this._edgeInsets.toJSON()},En.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},En.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ke.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Ke.prototype.interpolatePadding=function(c,f,h){this._unmodified=!1,this._edgeInsets.interpolate(c,f,h),this._constrain(),this._calcMatrices()},Ke.prototype.coveringZoomLevel=function(c){var f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)},Ke.prototype.getVisibleUnwrappedCoordinates=function(c){var f=[new s.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new s.Point(0,0)),m=this.pointCoordinate(new s.Point(this.width,0)),x=this.pointCoordinate(new s.Point(this.width,this.height)),T=this.pointCoordinate(new s.Point(0,this.height)),E=Math.floor(Math.min(h.x,m.x,x.x,T.x)),C=Math.floor(Math.max(h.x,m.x,x.x,T.x)),O=E-1;O<=C+1;O++)O!==0&&f.push(new s.UnwrappedTileID(O,c));return f},Ke.prototype.coveringTiles=function(c){var f=this.coveringZoomLevel(c),h=f;if(c.minzoom!==void 0&&f<c.minzoom)return[];c.maxzoom!==void 0&&f>c.maxzoom&&(f=c.maxzoom);var m=s.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,f),T=[x*m.x,x*m.y,0],E=Dc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),C=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(C=f);var O=function(Gt){return{aabb:new Ca([Gt*x,0,0],[(Gt+1)*x,x,0]),zoom:0,x:0,y:0,wrap:Gt,fullyVisible:!1}},N=[],Z=[],Y=f,K=c.reparseOverscaled?h:f;if(this._renderWorldCopies)for(var at=1;at<=3;at++)N.push(O(-at)),N.push(O(at));for(N.push(O(0));N.length>0;){var it=N.pop(),ht=it.x,et=it.y,ct=it.fullyVisible;if(!ct){var yt=it.aabb.intersects(E);if(yt===0)continue;ct=yt===2}var bt=it.aabb.distanceX(T),Ct=it.aabb.distanceY(T),Pt=Math.max(Math.abs(bt),Math.abs(Ct));if(it.zoom===Y||Pt>3+(1<<Y-it.zoom)-2&&it.zoom>=C)Z.push({tileID:new s.OverscaledTileID(it.zoom===Y?K:it.zoom,it.wrap,it.zoom,ht,et),distanceSq:s.sqrLen([T[0]-.5-ht,T[1]-.5-et])});else for(var Mt=0;Mt<4;Mt++){var Ft=(ht<<1)+Mt%2,Wt=(et<<1)+(Mt>>1);N.push({aabb:it.aabb.quadrant(Mt),zoom:it.zoom+1,x:Ft,y:Wt,wrap:it.wrap,fullyVisible:ct})}}return Z.sort(function(Gt,re){return Gt.distanceSq-re.distanceSq}).map(function(Gt){return Gt.tileID})},Ke.prototype.resize=function(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()},En.unmodified.get=function(){return this._unmodified},Ke.prototype.zoomScale=function(c){return Math.pow(2,c)},Ke.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Ke.prototype.project=function(c){var f=s.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(c.lng)*this.worldSize,s.mercatorYfromLat(f)*this.worldSize)},Ke.prototype.unproject=function(c){return new s.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},En.point.get=function(){return this.project(this.center)},Ke.prototype.setLocationAtPoint=function(c,f){var h=this.pointCoordinate(f),m=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(c),T=new s.MercatorCoordinate(x.x-(h.x-m.x),x.y-(h.y-m.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())},Ke.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Ke.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Ke.prototype.locationCoordinate=function(c){return s.MercatorCoordinate.fromLngLat(c)},Ke.prototype.coordinateLocation=function(c){return c.toLngLat()},Ke.prototype.pointCoordinate=function(c){var f=[c.x,c.y,0,1],h=[c.x,c.y,1,1];s.transformMat4(f,f,this.pixelMatrixInverse),s.transformMat4(h,h,this.pixelMatrixInverse);var m=f[3],x=h[3],T=f[1]/m,E=h[1]/x,C=f[2]/m,O=h[2]/x,N=C===O?0:(0-C)/(O-C);return new s.MercatorCoordinate(s.number(f[0]/m,h[0]/x,N)/this.worldSize,s.number(T,E,N)/this.worldSize)},Ke.prototype.coordinatePoint=function(c){var f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(f,f,this.pixelMatrix),new s.Point(f[0]/f[3],f[1]/f[3])},Ke.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},Ke.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ke.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ke.prototype.calculatePosMatrix=function(c,f){f===void 0&&(f=!1);var h=c.key,m=f?this._alignedPosMatrixCache:this._posMatrixCache;if(m[h])return m[h];var x=c.canonical,T=this.worldSize/this.zoomScale(x.z),E=x.x+Math.pow(2,x.z)*c.wrap,C=s.identity(new Float64Array(16));return s.translate(C,C,[E*T,x.y*T,0]),s.scale(C,C,[T/s.EXTENT,T/s.EXTENT,1]),s.multiply(C,f?this.alignedProjMatrix:this.projMatrix,C),m[h]=new Float32Array(C),m[h]},Ke.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ke.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,f,h,m,x=-90,T=90,E=-180,C=180,O=this.size,N=this._unmodified;if(this.latRange){var Z=this.latRange;x=s.mercatorYfromLat(Z[1])*this.worldSize,c=(T=s.mercatorYfromLat(Z[0])*this.worldSize)-x<O.y?O.y/(T-x):0}if(this.lngRange){var Y=this.lngRange;E=s.mercatorXfromLng(Y[0])*this.worldSize,f=(C=s.mercatorXfromLng(Y[1])*this.worldSize)-E<O.x?O.x/(C-E):0}var K=this.point,at=Math.max(f||0,c||0);if(at)return this.center=this.unproject(new s.Point(f?(C+E)/2:K.x,c?(T+x)/2:K.y)),this.zoom+=this.scaleZoom(at),this._unmodified=N,void(this._constraining=!1);if(this.latRange){var it=K.y,ht=O.y/2;it-ht<x&&(m=x+ht),it+ht>T&&(m=T-ht)}if(this.lngRange){var et=K.x,ct=O.x/2;et-ct<E&&(h=E+ct),et+ct>C&&(h=C-ct)}h===void 0&&m===void 0||(this.center=this.unproject(new s.Point(h!==void 0?h:K.x,m!==void 0?m:K.y))),this._unmodified=N,this._constraining=!1}},Ke.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,h=this._fov*(.5+c.y/this.height),m=Math.sin(h)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-f-h,.01,Math.PI-.01)),x=this.point,T=x.x,E=x.y,C=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),O=this.height/50,N=new Float64Array(16);s.perspective(N,this._fov,this.width/this.height,O,C),N[8]=2*-c.x/this.width,N[9]=2*c.y/this.height,s.scale(N,N,[1,-1,1]),s.translate(N,N,[0,0,-this.cameraToCenterDistance]),s.rotateX(N,N,this._pitch),s.rotateZ(N,N,this.angle),s.translate(N,N,[-T,-E,0]),this.mercatorMatrix=s.scale([],N,[this.worldSize,this.worldSize,this.worldSize]),s.scale(N,N,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=N,this.invProjMatrix=s.invert([],this.projMatrix);var Z=this.width%2/2,Y=this.height%2/2,K=Math.cos(this.angle),at=Math.sin(this.angle),it=T-Math.round(T)+K*Z+at*Y,ht=E-Math.round(E)+K*Y+at*Z,et=new Float64Array(N);if(s.translate(et,et,[it>.5?it-1:it,ht>.5?ht-1:ht,0]),this.alignedProjMatrix=et,N=s.create(),s.scale(N,N,[this.width/2,-this.height/2,1]),s.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=s.create(),s.scale(N,N,[1,-1,1]),s.translate(N,N,[-1,-1,0]),s.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(N=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=N,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ke.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new s.Point(0,0)),f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ke.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,c))},Ke.prototype.getCameraQueryGeometry=function(c){var f=this.getCameraPoint();if(c.length===1)return[c[0],f];for(var h=f.x,m=f.y,x=f.x,T=f.y,E=0,C=c;E<C.length;E+=1){var O=C[E];h=Math.min(h,O.x),m=Math.min(m,O.y),x=Math.max(x,O.x),T=Math.max(T,O.y)}return[new s.Point(h,m),new s.Point(x,m),new s.Point(x,T),new s.Point(h,T),new s.Point(h,m)]},Object.defineProperties(Ke.prototype,En);var Bi=function(c){var f,h,m,x;this._hashName=c&&encodeURIComponent(c),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),h=!1,m=null,x=function(){m=null,h&&(f(),m=setTimeout(x,300),h=!1)},function(){return h=!0,m||x(),m})};Bi.prototype.addTo=function(c){return this._map=c,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Bi.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Bi.prototype.getHashString=function(c){var f=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,m),T=Math.round(f.lng*x)/x,E=Math.round(f.lat*x)/x,C=this._map.getBearing(),O=this._map.getPitch(),N="";if(N+=c?"/"+T+"/"+E+"/"+h:h+"/"+E+"/"+T,(C||O)&&(N+="/"+Math.round(10*C)/10),O&&(N+="/"+Math.round(O)),this._hashName){var Z=this._hashName,Y=!1,K=s.window.location.hash.slice(1).split("&").map(function(at){var it=at.split("=")[0];return it===Z?(Y=!0,it+"="+N):at}).filter(function(at){return at});return Y||K.push(Z+"="+N),"#"+K.join("&")}return"#"+N},Bi.prototype._getCurrentHash=function(){var c,f=this,h=s.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===f._hashName&&(c=m)}),(c&&c[1]||"").split("/")):h.split("/")},Bi.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(h){return isNaN(h)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1},Bi.prototype._updateHashUnthrottled=function(){var c=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,c)}catch{}};var wu={linearity:.3,easing:s.bezier(0,0,.3,1)},bl=s.extend({deceleration:2500,maxSpeed:1400},wu),Tu=s.extend({deceleration:20,maxSpeed:1400},wu),g_=s.extend({deceleration:1e3,maxSpeed:360},wu),y_=s.extend({deceleration:1e3,maxSpeed:90},wu),Eu=function(c){this._map=c,this.clear()};function Su(c,f){(!c.duration||c.duration<f.duration)&&(c.duration=f.duration,c.easing=f.easing)}function Ko(c,f,h){var m=h.maxSpeed,x=h.linearity,T=h.deceleration,E=s.clamp(c*x/(f/1e3),-m,m),C=Math.abs(E)/(T*x);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}Eu.prototype.clear=function(){this._inertiaBuffer=[]},Eu.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:c})},Eu.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,f=s.browser.now();c.length>0&&f-c[0].time>160;)c.shift()},Eu.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},h=0,m=this._inertiaBuffer;h<m.length;h+=1){var x=m[h].settings;f.zoom+=x.zoomDelta||0,f.bearing+=x.bearingDelta||0,f.pitch+=x.pitchDelta||0,x.panDelta&&f.pan._add(x.panDelta),x.around&&(f.around=x.around),x.pinchAround&&(f.pinchAround=x.pinchAround)}var T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(f.pan.mag()){var C=Ko(f.pan.mag(),T,s.extend({},bl,c||{}));E.offset=f.pan.mult(C.amount/f.pan.mag()),E.center=this._map.transform.center,Su(E,C)}if(f.zoom){var O=Ko(f.zoom,T,Tu);E.zoom=this._map.transform.zoom+O.amount,Su(E,O)}if(f.bearing){var N=Ko(f.bearing,T,g_);E.bearing=this._map.transform.bearing+s.clamp(N.amount,-179,179),Su(E,N)}if(f.pitch){var Z=Ko(f.pitch,T,y_);E.pitch=this._map.transform.pitch+Z.amount,Su(E,Z)}if(E.zoom||E.bearing){var Y=f.pinchAround===void 0?f.around:f.pinchAround;E.around=Y?this._map.unproject(Y):this._map.getCenter()}return this.clear(),s.extend(E,{noMoveStart:!0})}};var ur=function(c){function f(m,x,T,E){E===void 0&&(E={});var C=g.mousePos(x.getCanvasContainer(),T),O=x.unproject(C);c.call(this,m,s.extend({point:C,lngLat:O,originalEvent:T},E)),this._defaultPrevented=!1,this.target=x}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(s.Event),Pu=function(c){function f(m,x,T){var E=m==="touchend"?T.changedTouches:T.touches,C=g.touchPos(x.getCanvasContainer(),E),O=C.map(function(Y){return x.unproject(Y)}),N=C.reduce(function(Y,K,at,it){return Y.add(K.div(it.length))},new s.Point(0,0)),Z=x.unproject(N);c.call(this,m,{points:C,point:N,lngLats:O,lngLat:Z,originalEvent:T}),this._defaultPrevented=!1}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(s.Event),Am=function(c){function f(m,x,T){c.call(this,m,{originalEvent:T}),this._defaultPrevented=!1}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(s.Event),ir=function(c,f){this._map=c,this._clickTolerance=f.clickTolerance};ir.prototype.reset=function(){delete this._mousedownPos},ir.prototype.wheel=function(c){return this._firePreventable(new Am(c.type,this._map,c))},ir.prototype.mousedown=function(c,f){return this._mousedownPos=f,this._firePreventable(new ur(c.type,this._map,c))},ir.prototype.mouseup=function(c){this._map.fire(new ur(c.type,this._map,c))},ir.prototype.click=function(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ur(c.type,this._map,c))},ir.prototype.dblclick=function(c){return this._firePreventable(new ur(c.type,this._map,c))},ir.prototype.mouseover=function(c){this._map.fire(new ur(c.type,this._map,c))},ir.prototype.mouseout=function(c){this._map.fire(new ur(c.type,this._map,c))},ir.prototype.touchstart=function(c){return this._firePreventable(new Pu(c.type,this._map,c))},ir.prototype.touchmove=function(c){this._map.fire(new Pu(c.type,this._map,c))},ir.prototype.touchend=function(c){this._map.fire(new Pu(c.type,this._map,c))},ir.prototype.touchcancel=function(c){this._map.fire(new Pu(c.type,this._map,c))},ir.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},ir.prototype.isEnabled=function(){return!0},ir.prototype.isActive=function(){return!1},ir.prototype.enable=function(){},ir.prototype.disable=function(){};var se=function(c){this._map=c};se.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},se.prototype.mousemove=function(c){this._map.fire(new ur(c.type,this._map,c))},se.prototype.mousedown=function(){this._delayContextMenu=!0},se.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},se.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ur(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},se.prototype.isEnabled=function(){return!0},se.prototype.isActive=function(){return!1},se.prototype.enable=function(){},se.prototype.disable=function(){};var Ei=function(c,f){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1};function Fc(c,f){for(var h={},m=0;m<c.length;m++)h[c[m].identifier]=f[m];return h}Ei.prototype.isEnabled=function(){return!!this._enabled},Ei.prototype.isActive=function(){return!!this._active},Ei.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ei.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ei.prototype.mousedown=function(c,f){this.isEnabled()&&c.shiftKey&&c.button===0&&(g.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},Ei.prototype.mousemoveWindow=function(c,f){if(this._active){var h=f;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=h,this._box||(this._box=g.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var x=Math.min(m.x,h.x),T=Math.max(m.x,h.x),E=Math.min(m.y,h.y),C=Math.max(m.y,h.y);g.setTransform(this._box,"translate("+x+"px,"+E+"px)"),this._box.style.width=T-x+"px",this._box.style.height=C-E+"px"}}},Ei.prototype.mouseupWindow=function(c,f){var h=this;if(this._active&&c.button===0){var m=this._startPos,x=f;if(this.reset(),g.suppressClick(),m.x!==x.x||m.y!==x.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(T){return T.fitScreenCoordinates(m,x,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Ei.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Ei.prototype.blur=function(){this.reset()},Ei.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(g.remove(this._box),this._box=null),g.enableDrag(),delete this._startPos,delete this._lastPos},Ei.prototype._fireEvent=function(c,f){return this._map.fire(new s.Event(c,{originalEvent:f}))};var wl=function(c){this.reset(),this.numTouches=c.numTouches};wl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},wl.prototype.touchstart=function(c,f,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){for(var x=new s.Point(0,0),T=0,E=m;T<E.length;T+=1)x._add(E[T]);return x.div(m.length)}(f),this.touches=Fc(h,f)))},wl.prototype.touchmove=function(c,f,h){if(!this.aborted&&this.centroid){var m=Fc(h,f);for(var x in this.touches){var T=m[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}},wl.prototype.touchend=function(c,f,h){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var go=function(c){this.singleTap=new wl(c),this.numTaps=c.numTaps,this.reset()};go.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},go.prototype.touchstart=function(c,f,h){this.singleTap.touchstart(c,f,h)},go.prototype.touchmove=function(c,f,h){this.singleTap.touchmove(c,f,h)},go.prototype.touchend=function(c,f,h){var m=this.singleTap.touchend(c,f,h);if(m){var x=c.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(m)<30;if(x&&T||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var Si=function(){this._zoomIn=new go({numTouches:1,numTaps:2}),this._zoomOut=new go({numTouches:2,numTaps:1}),this.reset()};Si.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Si.prototype.touchstart=function(c,f,h){this._zoomIn.touchstart(c,f,h),this._zoomOut.touchstart(c,f,h)},Si.prototype.touchmove=function(c,f,h){this._zoomIn.touchmove(c,f,h),this._zoomOut.touchmove(c,f,h)},Si.prototype.touchend=function(c,f,h){var m=this,x=this._zoomIn.touchend(c,f,h),T=this._zoomOut.touchend(c,f,h);return x?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:c})}}):T?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(T)},{originalEvent:c})}}):void 0},Si.prototype.touchcancel=function(){this.reset()},Si.prototype.enable=function(){this._enabled=!0},Si.prototype.disable=function(){this._enabled=!1,this.reset()},Si.prototype.isEnabled=function(){return this._enabled},Si.prototype.isActive=function(){return this._active};var Ff={0:1,2:2},$t=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};$t.prototype.blur=function(){this.reset()},$t.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},$t.prototype._correctButton=function(c,f){return!1},$t.prototype._move=function(c,f){return{}},$t.prototype.mousedown=function(c,f){if(!this._lastPoint){var h=g.mouseButton(c);this._correctButton(c,h)&&(this._lastPoint=f,this._eventButton=h)}},$t.prototype.mousemoveWindow=function(c,f){var h=this._lastPoint;if(h){if(c.preventDefault(),function(m,x){var T=Ff[x];return m.buttons===void 0||(m.buttons&T)!==T}(c,this._eventButton))this.reset();else if(this._moved||!(f.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(h,f)}},$t.prototype.mouseupWindow=function(c){this._lastPoint&&g.mouseButton(c)===this._eventButton&&(this._moved&&g.suppressClick(),this.reset())},$t.prototype.enable=function(){this._enabled=!0},$t.prototype.disable=function(){this._enabled=!1,this.reset()},$t.prototype.isEnabled=function(){return this._enabled},$t.prototype.isActive=function(){return this._active};var Nf=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.mousedown=function(h,m){c.prototype.mousedown.call(this,h,m),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(h,m){return m===0&&!h.ctrlKey},f.prototype._move=function(h,m){return{around:m,panDelta:m.sub(h)}},f}($t),Nc=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},f.prototype._move=function(h,m){var x=.8*(m.x-h.x);if(x)return this._active=!0,{bearingDelta:x}},f.prototype.contextmenu=function(h){h.preventDefault()},f}($t),Bf=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},f.prototype._move=function(h,m){var x=-.5*(m.y-h.y);if(x)return this._active=!0,{pitchDelta:x}},f.prototype.contextmenu=function(h){h.preventDefault()},f}($t),to=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};to.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},to.prototype.touchstart=function(c,f,h){return this._calculateTransform(c,f,h)},to.prototype.touchmove=function(c,f,h){if(this._active&&!(h.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,f,h)},to.prototype.touchend=function(c,f,h){this._calculateTransform(c,f,h),this._active&&h.length<this._minTouches&&this.reset()},to.prototype.touchcancel=function(){this.reset()},to.prototype._calculateTransform=function(c,f,h){h.length>0&&(this._active=!0);var m=Fc(h,f),x=new s.Point(0,0),T=new s.Point(0,0),E=0;for(var C in m){var O=m[C],N=this._touches[C];N&&(x._add(O),T._add(O.sub(N)),E++,m[C]=O)}if(this._touches=m,!(E<this._minTouches)&&T.mag()){var Z=T.div(E);if(this._sum._add(Z),!(this._sum.mag()<this._clickTolerance))return{around:x.div(E),panDelta:Z}}},to.prototype.enable=function(){this._enabled=!0},to.prototype.disable=function(){this._enabled=!1,this.reset()},to.prototype.isEnabled=function(){return this._enabled},to.prototype.isActive=function(){return this._active};var Pi=function(){this.reset()};function Bc(c,f,h){for(var m=0;m<c.length;m++)if(c[m].identifier===h)return f[m]}function Uc(c,f){return Math.log(c/f)/Math.LN2}Pi.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Pi.prototype._start=function(c){},Pi.prototype._move=function(c,f,h){return{}},Pi.prototype.touchstart=function(c,f,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([f[0],f[1]]))},Pi.prototype.touchmove=function(c,f,h){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,x=m[1],T=Bc(h,f,m[0]),E=Bc(h,f,x);if(T&&E){var C=this._aroundCenter?null:T.add(E).div(2);return this._move([T,E],C,c)}}},Pi.prototype.touchend=function(c,f,h){if(this._firstTwoTouches){var m=this._firstTwoTouches,x=m[1],T=Bc(h,f,m[0]),E=Bc(h,f,x);T&&E||(this._active&&g.suppressClick(),this.reset())}},Pi.prototype.touchcancel=function(){this.reset()},Pi.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},Pi.prototype.disable=function(){this._enabled=!1,this.reset()},Pi.prototype.isEnabled=function(){return this._enabled},Pi.prototype.isActive=function(){return this._active};var Ai=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},f.prototype._move=function(h,m){var x=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Uc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uc(this._distance,x),pinchAround:m}},f}(Pi);function Jo(c,f){return 180*c.angleWith(f)/Math.PI}var Cm=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},f.prototype._move=function(h,m){var x=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jo(this._vector,x),pinchAround:m}},f.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var m=25/(Math.PI*this._minDiameter)*360,x=Jo(h,this._startVector);return Math.abs(x)<m},f}(Pi);function Au(c){return Math.abs(c.y)>Math.abs(c.x)}var Uf=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(h){this._lastPoints=h,Au(h[0].sub(h[1]))&&(this._valid=!1)},f.prototype._move=function(h,m,x){var T=h[0].sub(this._lastPoints[0]),E=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(T,E,x.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(T.y+E.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(h,m,x){if(this._valid!==void 0)return this._valid;var T=h.mag()>=2,E=m.mag()>=2;if(T||E){if(!T||!E)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;var C=h.y>0==m.y>0;return Au(h)&&Au(m)&&C}},f}(Pi),Vf={panStep:100,bearingStep:15,pitchStep:10},yo=function(){var c=Vf;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Ui(c){return c*(2-c)}yo.prototype.blur=function(){this.reset()},yo.prototype.reset=function(){this._active=!1},yo.prototype.keydown=function(c){var f=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var h=0,m=0,x=0,T=0,E=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),T=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),T=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),E=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:function(C){var O=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Ui,zoom:h?Math.round(O)+h*(c.shiftKey?2:1):O,bearing:C.getBearing()+m*f._bearingStep,pitch:C.getPitch()+x*f._pitchStep,offset:[-T*f._panStep,-E*f._panStep],center:C.getCenter()},{originalEvent:c})}}}},yo.prototype.enable=function(){this._enabled=!0},yo.prototype.disable=function(){this._enabled=!1,this.reset()},yo.prototype.isEnabled=function(){return this._enabled},yo.prototype.isActive=function(){return this._active},yo.prototype.disableRotation=function(){this._rotationDisabled=!0},yo.prototype.enableRotation=function(){this._rotationDisabled=!1};var qe=function(c,f){this._map=c,this._el=c.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};qe.prototype.setZoomRate=function(c){this._defaultZoomRate=c},qe.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},qe.prototype.isEnabled=function(){return!!this._enabled},qe.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},qe.prototype.isZooming=function(){return!!this._zooming},qe.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},qe.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qe.prototype.wheel=function(c){if(this.isEnabled()){var f=c.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,h=s.browser.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}},qe.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},qe.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=g.mousePos(this._el,c);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},qe.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&m!==0&&(m=1/m);var x=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(x*m))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var T,E=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,C=this._startZoom,O=this._easing,N=!1;if(this._type==="wheel"&&C&&O){var Z=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),Y=O(Z);T=s.number(C,E,Y),Z<1?this._frameId||(this._frameId=!0):N=!0}else T=E,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:T-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},qe.prototype._smoothOutEasing=function(c){var f=s.ease;if(this._prevEase){var h=this._prevEase,m=(s.browser.now()-h.start)/h.duration,x=h.easing(m+.01)-h.easing(m),T=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-T*T);f=s.bezier(T,E,.25,1)}return this._prevEase={start:s.browser.now(),duration:c,easing:f},f},qe.prototype.blur=function(){this.reset()},qe.prototype.reset=function(){this._active=!1};var ko=function(c,f){this._clickZoom=c,this._tapZoom=f};ko.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ko.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ko.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ko.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var eo=function(){this.reset()};eo.prototype.reset=function(){this._active=!1},eo.prototype.blur=function(){this.reset()},eo.prototype.dblclick=function(c,f){return c.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(c.shiftKey?-1:1),around:h.unproject(f)},{originalEvent:c})}}},eo.prototype.enable=function(){this._enabled=!0},eo.prototype.disable=function(){this._enabled=!1,this.reset()},eo.prototype.isEnabled=function(){return this._enabled},eo.prototype.isActive=function(){return this._active};var Fr=function(){this._tap=new go({numTouches:1,numTaps:1}),this.reset()};Fr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Fr.prototype.touchstart=function(c,f,h){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=f[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(c,f,h))},Fr.prototype.touchmove=function(c,f,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var m=f[0],x=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(c,f,h)},Fr.prototype.touchend=function(c,f,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(c,f,h)&&(this._tapTime=c.timeStamp)},Fr.prototype.touchcancel=function(){this.reset()},Fr.prototype.enable=function(){this._enabled=!0},Fr.prototype.disable=function(){this._enabled=!1,this.reset()},Fr.prototype.isEnabled=function(){return this._enabled},Fr.prototype.isActive=function(){return this._active};var Ia=function(c,f,h){this._el=c,this._mousePan=f,this._touchPan=h};Ia.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ia.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ia.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ia.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Rs=function(c,f,h){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=h};Rs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Rs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Rs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Rs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var vo=function(c,f,h,m){this._el=c,this._touchZoom=f,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};vo.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},vo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},vo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},vo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},vo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},vo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Yr=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Cu=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f}(s.Event);function me(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var ue=function(c,f){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Eu(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),s.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[s.window,"blur",void 0]];for(var m=0,x=this._listeners;m<x.length;m+=1){var T=x[m],E=T[0];g.addEventListener(E,T[1],E===s.window.document?this.handleWindowEvent:this.handleEvent,T[2])}};ue.prototype.destroy=function(){for(var c=0,f=this._listeners;c<f.length;c+=1){var h=f[c],m=h[0];g.removeEventListener(m,h[1],m===s.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},ue.prototype._addDefaultHandlers=function(c){var f=this._map,h=f.getCanvasContainer();this._add("mapEvent",new ir(f,c));var m=f.boxZoom=new Ei(f,c);this._add("boxZoom",m);var x=new Si,T=new eo;f.doubleClickZoom=new ko(T,x),this._add("tapZoom",x),this._add("clickZoom",T);var E=new Fr;this._add("tapDragZoom",E);var C=f.touchPitch=new Uf;this._add("touchPitch",C);var O=new Nc(c),N=new Bf(c);f.dragRotate=new Rs(c,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);var Z=new Nf(c),Y=new to(c);f.dragPan=new Ia(h,Z,Y),this._add("mousePan",Z),this._add("touchPan",Y,["touchZoom","touchRotate"]);var K=new Cm,at=new Ai;f.touchZoomRotate=new vo(h,at,K,E),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",at,["touchPan","touchRotate"]);var it=f.scrollZoom=new qe(f,this);this._add("scrollZoom",it,["mousePan"]);var ht=f.keyboard=new yo;this._add("keyboard",ht),this._add("blockableMapEvent",new se(f));for(var et=0,ct=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];et<ct.length;et+=1){var yt=ct[et];c.interactive&&c[yt]&&f[yt].enable(c[yt])}},ue.prototype._add=function(c,f,h){this._handlers.push({handlerName:c,handler:f,allowed:h}),this._handlersById[c]=f},ue.prototype.stop=function(c){if(!this._updatingCamera){for(var f=0,h=this._handlers;f<h.length;f+=1)h[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},ue.prototype.isActive=function(){for(var c=0,f=this._handlers;c<f.length;c+=1)if(f[c].handler.isActive())return!0;return!1},ue.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ue.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ue.prototype.isMoving=function(){return Boolean(Yr(this._eventsInProgress))||this.isZooming()},ue.prototype._blockedByActive=function(c,f,h){for(var m in c)if(m!==h&&(!f||f.indexOf(m)<0))return!0;return!1},ue.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},ue.prototype._getMapTouches=function(c){for(var f=[],h=0,m=c;h<m.length;h+=1){var x=m[h];this._el.contains(x.target)&&f.push(x)}return f},ue.prototype.handleEvent=function(c,f){this._updatingCamera=!0;for(var h=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},x={},T={},E=c.touches?this._getMapTouches(c.touches):void 0,C=E?g.touchPos(this._el,E):g.mousePos(this._el,c),O=0,N=this._handlers;O<N.length;O+=1){var Z=N[O],Y=Z.handlerName,K=Z.handler,at=Z.allowed;if(K.isEnabled()){var it=void 0;this._blockedByActive(T,at,Y)?K.reset():K[f||c.type]&&(it=K[f||c.type](c,C,E),this.mergeHandlerResult(m,x,it,Y,h),it&&it.needsRenderFrame&&this._triggerRenderFrame()),(it||K.isActive())&&(T[Y]=K)}}var ht={};for(var et in this._previousActiveHandlers)T[et]||(ht[et]=h);this._previousActiveHandlers=T,(Object.keys(ht).length||me(m))&&(this._changes.push([m,x,ht]),this._triggerRenderFrame()),(Object.keys(T).length||me(m))&&this._map._stop(!0),this._updatingCamera=!1;var ct=m.cameraAnimation;ct&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ct(this._map))},ue.prototype.mergeHandlerResult=function(c,f,h,m,x){if(h){s.extend(c,h);var T={handlerName:m,originalEvent:h.originalEvent||x};h.zoomDelta!==void 0&&(f.zoom=T),h.panDelta!==void 0&&(f.drag=T),h.pitchDelta!==void 0&&(f.pitch=T),h.bearingDelta!==void 0&&(f.rotate=T)}},ue.prototype._applyChanges=function(){for(var c={},f={},h={},m=0,x=this._changes;m<x.length;m+=1){var T=x[m],E=T[0],C=T[1],O=T[2];E.panDelta&&(c.panDelta=(c.panDelta||new s.Point(0,0))._add(E.panDelta)),E.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(c.around=E.around),E.pinchAround!==void 0&&(c.pinchAround=E.pinchAround),E.noInertia&&(c.noInertia=E.noInertia),s.extend(f,C),s.extend(h,O)}this._updateMapTransform(c,f,h),this._changes=[]},ue.prototype._updateMapTransform=function(c,f,h){var m=this._map,x=m.transform;if(!me(c))return this._fireEvents(f,h,!0);var T=c.panDelta,E=c.zoomDelta,C=c.bearingDelta,O=c.pitchDelta,N=c.around,Z=c.pinchAround;Z!==void 0&&(N=Z),m._stop(!0),N=N||m.transform.centerPoint;var Y=x.pointLocation(T?N.sub(T):N);C&&(x.bearing+=C),O&&(x.pitch+=O),E&&(x.zoom+=E),x.setLocationAtPoint(Y,N),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,h,!0)},ue.prototype._fireEvents=function(c,f,h){var m=this,x=Yr(this._eventsInProgress),T=Yr(c),E={};for(var C in c)this._eventsInProgress[C]||(E[C+"start"]=c[C].originalEvent),this._eventsInProgress[C]=c[C];for(var O in!x&&T&&this._fireEvent("movestart",T.originalEvent),E)this._fireEvent(O,E[O]);for(var N in T&&this._fireEvent("move",T.originalEvent),c)this._fireEvent(N,c[N].originalEvent);var Z,Y={};for(var K in this._eventsInProgress){var at=this._eventsInProgress[K],it=at.handlerName,ht=at.originalEvent;this._handlersById[it].isActive()||(delete this._eventsInProgress[K],Y[K+"end"]=Z=f[it]||ht)}for(var et in Y)this._fireEvent(et,Y[et]);var ct=Yr(this._eventsInProgress);if(h&&(x||T)&&!ct){this._updatingCamera=!0;var yt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),bt=function(Ct){return Ct!==0&&-m._bearingSnap<Ct&&Ct<m._bearingSnap};yt?(bt(yt.bearing||this._map.getBearing())&&(yt.bearing=0),this._map.easeTo(yt,{originalEvent:Z})):(this._map.fire(new s.Event("moveend",{originalEvent:Z})),bt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ue.prototype._fireEvent=function(c,f){this._map.fire(new s.Event(c,f?{originalEvent:f}:{}))},ue.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete c._frameId,c.handleEvent(new Cu("renderFrame",{timeStamp:f})),c._applyChanges()})},ue.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Vc=function(c){function f(h,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=m.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(h,m){return this.jumpTo({center:h},m)},f.prototype.panBy=function(h,m,x){return h=s.Point.convert(h).mult(-1),this.panTo(this.transform.center,s.extend({offset:h},m),x)},f.prototype.panTo=function(h,m,x){return this.easeTo(s.extend({center:h},m),x)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(h,m){return this.jumpTo({zoom:h},m),this},f.prototype.zoomTo=function(h,m,x){return this.easeTo(s.extend({zoom:h},m),x)},f.prototype.zoomIn=function(h,m){return this.zoomTo(this.getZoom()+1,h,m),this},f.prototype.zoomOut=function(h,m){return this.zoomTo(this.getZoom()-1,h,m),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(h,m){return this.jumpTo({bearing:h},m),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(h,m){return this.jumpTo({padding:h},m),this},f.prototype.rotateTo=function(h,m,x){return this.easeTo(s.extend({bearing:h},m),x)},f.prototype.resetNorth=function(h,m){return this.rotateTo(0,s.extend({duration:1e3},h),m),this},f.prototype.resetNorthPitch=function(h,m){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},h),m),this},f.prototype.snapToNorth=function(h,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,m):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(h,m){return this.jumpTo({pitch:h},m),this},f.prototype.cameraForBounds=function(h,m){h=s.LngLatBounds.convert(h);var x=m&&m.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),x,m)},f.prototype._cameraForBoxAndBearing=function(h,m,x,T){var E={top:0,bottom:0,right:0,left:0};if(typeof(T=s.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){var C=T.padding;T.padding={top:C,bottom:C,right:C,left:C}}T.padding=s.extend(E,T.padding);var O=this.transform,N=O.padding,Z=O.project(s.LngLat.convert(h)),Y=O.project(s.LngLat.convert(m)),K=Z.rotate(-x*Math.PI/180),at=Y.rotate(-x*Math.PI/180),it=new s.Point(Math.max(K.x,at.x),Math.max(K.y,at.y)),ht=new s.Point(Math.min(K.x,at.x),Math.min(K.y,at.y)),et=it.sub(ht),ct=(O.width-(N.left+N.right+T.padding.left+T.padding.right))/et.x,yt=(O.height-(N.top+N.bottom+T.padding.top+T.padding.bottom))/et.y;if(!(yt<0||ct<0)){var bt=Math.min(O.scaleZoom(O.scale*Math.min(ct,yt)),T.maxZoom),Ct=typeof T.offset.x=="number"?new s.Point(T.offset.x,T.offset.y):s.Point.convert(T.offset),Pt=new s.Point((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(x*Math.PI/180),Mt=Ct.add(Pt).mult(O.scale/O.zoomScale(bt));return{center:O.unproject(Z.add(Y).div(2).sub(Mt)),zoom:bt,bearing:x}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(h,m,x){return this._fitInternal(this.cameraForBounds(h,m),m,x)},f.prototype.fitScreenCoordinates=function(h,m,x,T,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(h)),this.transform.pointLocation(s.Point.convert(m)),x,T),T,E)},f.prototype._fitInternal=function(h,m,x){return h?(delete(m=s.extend(h,m)).padding,m.linear?this.easeTo(m,x):this.flyTo(m,x)):this},f.prototype.jumpTo=function(h,m){this.stop();var x=this.transform,T=!1,E=!1,C=!1;return"zoom"in h&&x.zoom!==+h.zoom&&(T=!0,x.zoom=+h.zoom),h.center!==void 0&&(x.center=s.LngLat.convert(h.center)),"bearing"in h&&x.bearing!==+h.bearing&&(E=!0,x.bearing=+h.bearing),"pitch"in h&&x.pitch!==+h.pitch&&(C=!0,x.pitch=+h.pitch),h.padding==null||x.isPaddingEqual(h.padding)||(x.padding=h.padding),this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),T&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),E&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),C&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m))},f.prototype.easeTo=function(h,m){var x=this;this._stop(!1,h.easeId),((h=s.extend({offset:[0,0],duration:500,easing:s.ease},h)).animate===!1||!h.essential&&s.browser.prefersReducedMotion)&&(h.duration=0);var T=this.transform,E=this.getZoom(),C=this.getBearing(),O=this.getPitch(),N=this.getPadding(),Z="zoom"in h?+h.zoom:E,Y="bearing"in h?this._normalizeBearing(h.bearing,C):C,K="pitch"in h?+h.pitch:O,at="padding"in h?h.padding:T.padding,it=s.Point.convert(h.offset),ht=T.centerPoint.add(it),et=T.pointLocation(ht),ct=s.LngLat.convert(h.center||et);this._normalizeCenter(ct);var yt,bt,Ct=T.project(et),Pt=T.project(ct).sub(Ct),Mt=T.zoomScale(Z-E);h.around&&(yt=s.LngLat.convert(h.around),bt=T.locationPoint(yt));var Ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==E,this._rotating=this._rotating||C!==Y,this._pitching=this._pitching||K!==O,this._padding=!T.isPaddingEqual(at),this._easeId=h.easeId,this._prepareEase(m,h.noMoveStart,Ft),this._ease(function(Wt){if(x._zooming&&(T.zoom=s.number(E,Z,Wt)),x._rotating&&(T.bearing=s.number(C,Y,Wt)),x._pitching&&(T.pitch=s.number(O,K,Wt)),x._padding&&(T.interpolatePadding(N,at,Wt),ht=T.centerPoint.add(it)),yt)T.setLocationAtPoint(yt,bt);else{var Gt=T.zoomScale(T.zoom-E),re=Z>E?Math.min(2,Mt):Math.max(.5,Mt),ge=Math.pow(re,1-Wt),we=T.unproject(Ct.add(Pt.mult(Wt*ge)).mult(Gt));T.setLocationAtPoint(T.renderWorldCopies?we.wrap():we,ht)}x._fireMoveEvents(m)},function(Wt){x._afterEase(m,Wt)},h),this},f.prototype._prepareEase=function(h,m,x){x===void 0&&(x={}),this._moving=!0,m||x.moving||this.fire(new s.Event("movestart",h)),this._zooming&&!x.zooming&&this.fire(new s.Event("zoomstart",h)),this._rotating&&!x.rotating&&this.fire(new s.Event("rotatestart",h)),this._pitching&&!x.pitching&&this.fire(new s.Event("pitchstart",h))},f.prototype._fireMoveEvents=function(h){this.fire(new s.Event("move",h)),this._zooming&&this.fire(new s.Event("zoom",h)),this._rotating&&this.fire(new s.Event("rotate",h)),this._pitching&&this.fire(new s.Event("pitch",h))},f.prototype._afterEase=function(h,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var x=this._zooming,T=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new s.Event("zoomend",h)),T&&this.fire(new s.Event("rotateend",h)),E&&this.fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h))}},f.prototype.flyTo=function(h,m){var x=this;if(!h.essential&&s.browser.prefersReducedMotion){var T=s.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(T,m)}this.stop(),h=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},h);var E=this.transform,C=this.getZoom(),O=this.getBearing(),N=this.getPitch(),Z=this.getPadding(),Y="zoom"in h?s.clamp(+h.zoom,E.minZoom,E.maxZoom):C,K="bearing"in h?this._normalizeBearing(h.bearing,O):O,at="pitch"in h?+h.pitch:N,it="padding"in h?h.padding:E.padding,ht=E.zoomScale(Y-C),et=s.Point.convert(h.offset),ct=E.centerPoint.add(et),yt=E.pointLocation(ct),bt=s.LngLat.convert(h.center||yt);this._normalizeCenter(bt);var Ct=E.project(yt),Pt=E.project(bt).sub(Ct),Mt=h.curve,Ft=Math.max(E.width,E.height),Wt=Ft/ht,Gt=Pt.mag();if("minZoom"in h){var re=s.clamp(Math.min(h.minZoom,C,Y),E.minZoom,E.maxZoom),ge=Ft/E.zoomScale(re-C);Mt=Math.sqrt(ge/Gt*2)}var we=Mt*Mt;function xe(Ae){var Ee=(Wt*Wt-Ft*Ft+(Ae?-1:1)*we*we*Gt*Gt)/(2*(Ae?Wt:Ft)*we*Gt);return Math.log(Math.sqrt(Ee*Ee+1)-Ee)}function en(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function oe(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}var Me=xe(0),Be=function(Ae){return oe(Me)/oe(Me+Mt*Ae)},Ie=function(Ae){return Ft*((oe(Me)*(en(Ee=Me+Mt*Ae)/oe(Ee))-en(Me))/we)/Gt;var Ee},Ce=(xe(1)-Me)/Mt;if(Math.abs(Gt)<1e-6||!isFinite(Ce)){if(Math.abs(Ft-Wt)<1e-6)return this.easeTo(h,m);var Ne=Wt<Ft?-1:1;Ce=Math.abs(Math.log(Wt/Ft))/Mt,Ie=function(){return 0},Be=function(Ae){return Math.exp(Ne*Mt*Ae)}}return h.duration="duration"in h?+h.duration:1e3*Ce/("screenSpeed"in h?+h.screenSpeed/Mt:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=O!==K,this._pitching=at!==N,this._padding=!E.isPaddingEqual(it),this._prepareEase(m,!1),this._ease(function(Ae){var Ee=Ae*Ce,_r=1/Be(Ee);E.zoom=Ae===1?Y:C+E.scaleZoom(_r),x._rotating&&(E.bearing=s.number(O,K,Ae)),x._pitching&&(E.pitch=s.number(N,at,Ae)),x._padding&&(E.interpolatePadding(Z,it,Ae),ct=E.centerPoint.add(et));var Gn=Ae===1?bt:E.unproject(Ct.add(Pt.mult(Ie(Ee))).mult(_r));E.setLocationAtPoint(E.renderWorldCopies?Gn.wrap():Gn,ct),x._fireMoveEvents(m)},function(){return x._afterEase(m)},h),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(h,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,m)}if(!h){var T=this.handlers;T&&T.stop(!1)}return this},f.prototype._ease=function(h,m,x){x.animate===!1||x.duration===0?(h(1),m()):(this._easeStart=s.browser.now(),this._easeOptions=x,this._onEaseFrame=h,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var h=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(h,m){h=s.wrap(h,-180,180);var x=Math.abs(h-m);return Math.abs(h-360-m)<x&&(h-=360),Math.abs(h+360-m)<x&&(h+=360),h},f.prototype._normalizeCenter=function(h){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var x=h.lng-m.center.lng;h.lng+=x>180?-360:x<-180?360:0}},f}(s.Evented),Kr=function(c){c===void 0&&(c={}),this.options=c,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Kr.prototype.getDefaultPosition=function(){return"bottom-right"},Kr.prototype.onAdd=function(c){var f=this.options&&this.options.compact;return this._map=c,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=g.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=g.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Kr.prototype.onRemove=function(){g.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Kr.prototype._setElementTitle=function(c,f){var h=this._map._getUIString("AttributionControl."+f);c.title=h,c.setAttribute("aria-label",h)},Kr.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Kr.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(c){var h=f.reduce(function(m,x,T){return x.value&&(m+=x.key+"="+x.value+(T<f.length-1?"&":"")),m},"?");c.href=s.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Kr.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Kr.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(C){return typeof C!="string"?"":C})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var h=this._map.style.sourceCaches;for(var m in h){var x=h[m];if(x.used){var T=x.getSource();T.attribution&&c.indexOf(T.attribution)<0&&c.push(T.attribution)}}c.sort(function(C,O){return C.length-O.length});var E=(c=c.filter(function(C,O){for(var N=O+1;N<c.length;N++)if(c[N].indexOf(C)>=0)return!1;return!0})).join(" | ");E!==this._attribHTML&&(this._attribHTML=E,c.length?(this._innerContainer.innerHTML=E,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Kr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var _o=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};_o.prototype.onAdd=function(c){this._map=c,this._container=g.create("div","mapboxgl-ctrl");var f=g.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},_o.prototype.onRemove=function(){g.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},_o.prototype.getDefaultPosition=function(){return"bottom-left"},_o.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},_o.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var f in c)if(c[f].getSource().mapbox_logo)return!0;return!1}},_o.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var f=c[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Nr=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Nr.prototype.add=function(c){var f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f},Nr.prototype.remove=function(c){for(var f=this._currentlyRunning,h=0,m=f?this._queue.concat(f):this._queue;h<m.length;h+=1){var x=m[h];if(x.id===c)return void(x.cancelled=!0)}},Nr.prototype.run=function(c){c===void 0&&(c=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,m=f;h<m.length;h+=1){var x=m[h];if(!x.cancelled&&(x.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Nr.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Oo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},jf=s.window.HTMLImageElement,jc=s.window.HTMLElement,fn=s.window.ImageBitmap,Ar={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Im=function(c){function f(m){var x=this;if((m=s.extend({},Ar,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var T=new Ke(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,T,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Nr,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Oo,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new s.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=s.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof jc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return x._update(!1)}),this.on("moveend",function(){return x._update(!1)}),this.on("zoom",function(){return x._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ue(this,m),this._hash=m.hash&&new Bi(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Kr({customAttribution:m.customAttribution})),this.addControl(new _o,m.logoPosition),this.on("style.load",function(){x.transform.unmodified&&x.jumpTo(x.style.stylesheet)}),this.on("data",function(E){x._update(E.dataType==="style"),x.fire(new s.Event(E.dataType+"data",E))}),this.on("dataloading",function(E){x.fire(new s.Event(E.dataType+"dataloading",E))})}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(m,x){if(x===void 0&&(x=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var T=m.onAdd(this);this._controls.push(m);var E=this._controlPositions[x];return x.indexOf("bottom")!==-1?E.insertBefore(T,E.firstChild):E.appendChild(T),this},f.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var x=this._controls.indexOf(m);return x>-1&&this._controls.splice(x,1),m.onRemove(this),this},f.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},f.prototype.resize=function(m){var x=this._containerDimensions(),T=x[0],E=x[1];if(T===this.transform.width&&E===this.transform.height)return this;this._resizeCanvas(T,E),this.transform.resize(T,E),this.painter.resize(T,E);var C=!this._moving;return C&&this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),this.fire(new s.Event("resize",m)),C&&this.fire(new s.Event("moveend",m)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(s.LngLatBounds.convert(m)),this._update()},f.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},f.prototype.project=function(m){return this.transform.locationPoint(s.LngLat.convert(m))},f.prototype.unproject=function(m){return this.transform.pointLocation(s.Point.convert(m))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(m,x,T){var E,C=this;if(m==="mouseenter"||m==="mouseover"){var O=!1;return{layer:x,listener:T,delegates:{mousemove:function(Z){var Y=C.getLayer(x)?C.queryRenderedFeatures(Z.point,{layers:[x]}):[];Y.length?O||(O=!0,T.call(C,new ur(m,C,Z.originalEvent,{features:Y}))):O=!1},mouseout:function(){O=!1}}}}if(m==="mouseleave"||m==="mouseout"){var N=!1;return{layer:x,listener:T,delegates:{mousemove:function(Z){(C.getLayer(x)?C.queryRenderedFeatures(Z.point,{layers:[x]}):[]).length?N=!0:N&&(N=!1,T.call(C,new ur(m,C,Z.originalEvent)))},mouseout:function(Z){N&&(N=!1,T.call(C,new ur(m,C,Z.originalEvent)))}}}}return{layer:x,listener:T,delegates:(E={},E[m]=function(Z){var Y=C.getLayer(x)?C.queryRenderedFeatures(Z.point,{layers:[x]}):[];Y.length&&(Z.features=Y,T.call(C,Z),delete Z.features)},E)}},f.prototype.on=function(m,x,T){if(T===void 0)return c.prototype.on.call(this,m,x);var E=this._createDelegatedListener(m,x,T);for(var C in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(E),E.delegates)this.on(C,E.delegates[C]);return this},f.prototype.once=function(m,x,T){if(T===void 0)return c.prototype.once.call(this,m,x);var E=this._createDelegatedListener(m,x,T);for(var C in E.delegates)this.once(C,E.delegates[C]);return this},f.prototype.off=function(m,x,T){var E=this;return T===void 0?c.prototype.off.call(this,m,x):(this._delegatedListeners&&this._delegatedListeners[m]&&function(C){for(var O=C[m],N=0;N<O.length;N++){var Z=O[N];if(Z.layer===x&&Z.listener===T){for(var Y in Z.delegates)E.off(Y,Z.delegates[Y]);return O.splice(N,1),E}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(m,x){if(!this.style)return[];var T;if(x!==void 0||m===void 0||m instanceof s.Point||Array.isArray(m)||(x=m,m=void 0),x=x||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof m[0]=="number")T=[s.Point.convert(m)];else{var E=s.Point.convert(m[0]),C=s.Point.convert(m[1]);T=[E,new s.Point(C.x,E.y),C,new s.Point(E.x,C.y),E]}return this.style.queryRenderedFeatures(T,x,this.transform)},f.prototype.querySourceFeatures=function(m,x){return this.style.querySourceFeatures(m,x)},f.prototype.setStyle=function(m,x){return(x=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},x)).diff!==!1&&x.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,x),this):(this._localIdeographFontFamily=x.localIdeographFontFamily,this._updateStyle(m,x))},f.prototype._getUIString=function(m){var x=this._locale[m];if(x==null)throw new Error("Missing UI string '"+m+"'");return x},f.prototype._updateStyle=function(m,x){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Ti(this,x||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(m,x){var T=this;if(typeof m=="string"){var E=this._requestManager.normalizeStyleURL(m),C=this._requestManager.transformRequest(E,s.ResourceType.Style);s.getJSON(C,function(O,N){O?T.fire(new s.ErrorEvent(O)):N&&T._updateDiff(N,x)})}else typeof m=="object"&&this._updateDiff(m,x)},f.prototype._updateDiff=function(m,x){try{this.style.setState(m)&&this._update(!0)}catch(T){s.warnOnce("Unable to perform style diff: "+(T.message||T.error||T)+".  Rebuilding the style from scratch."),this._updateStyle(m,x)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(m,x){return this._lazyInitEmptyStyle(),this.style.addSource(m,x),this._update(!0)},f.prototype.isSourceLoaded=function(m){var x=this.style&&this.style.sourceCaches[m];if(x!==void 0)return x.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},f.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var x in m){var T=m[x]._tiles;for(var E in T){var C=T[E];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(m,x,T){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,x,T)},f.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},f.prototype.getSource=function(m){return this.style.getSource(m)},f.prototype.addImage=function(m,x,T){T===void 0&&(T={});var E=T.pixelRatio;E===void 0&&(E=1);var C=T.sdf;C===void 0&&(C=!1);var O=T.stretchX,N=T.stretchY,Z=T.content;if(this._lazyInitEmptyStyle(),x instanceof jf||fn&&x instanceof fn){var Y=s.browser.getImageData(x);this.style.addImage(m,{data:new s.RGBAImage({width:Y.width,height:Y.height},Y.data),pixelRatio:E,stretchX:O,stretchY:N,content:Z,sdf:C,version:0})}else{if(x.width===void 0||x.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var K=x;this.style.addImage(m,{data:new s.RGBAImage({width:x.width,height:x.height},new Uint8Array(x.data)),pixelRatio:E,stretchX:O,stretchY:N,content:Z,sdf:C,version:0,userImage:K}),K.onAdd&&K.onAdd(this,m)}},f.prototype.updateImage=function(m,x){var T=this.style.getImage(m);if(!T)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var E=x instanceof jf||fn&&x instanceof fn?s.browser.getImageData(x):x,C=E.width,O=E.height,N=E.data;return C===void 0||O===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):C!==T.data.width||O!==T.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(T.data.replace(N,!(x instanceof jf||fn&&x instanceof fn)),void this.style.updateImage(m,T))},f.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(m){this.style.removeImage(m)},f.prototype.loadImage=function(m,x){s.getImage(this._requestManager.transformRequest(m,s.ResourceType.Image),x)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(m,x){return this._lazyInitEmptyStyle(),this.style.addLayer(m,x),this._update(!0)},f.prototype.moveLayer=function(m,x){return this.style.moveLayer(m,x),this._update(!0)},f.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},f.prototype.getLayer=function(m){return this.style.getLayer(m)},f.prototype.setLayerZoomRange=function(m,x,T){return this.style.setLayerZoomRange(m,x,T),this._update(!0)},f.prototype.setFilter=function(m,x,T){return T===void 0&&(T={}),this.style.setFilter(m,x,T),this._update(!0)},f.prototype.getFilter=function(m){return this.style.getFilter(m)},f.prototype.setPaintProperty=function(m,x,T,E){return E===void 0&&(E={}),this.style.setPaintProperty(m,x,T,E),this._update(!0)},f.prototype.getPaintProperty=function(m,x){return this.style.getPaintProperty(m,x)},f.prototype.setLayoutProperty=function(m,x,T,E){return E===void 0&&(E={}),this.style.setLayoutProperty(m,x,T,E),this._update(!0)},f.prototype.getLayoutProperty=function(m,x){return this.style.getLayoutProperty(m,x)},f.prototype.setLight=function(m,x){return x===void 0&&(x={}),this._lazyInitEmptyStyle(),this.style.setLight(m,x),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(m,x){return this.style.setFeatureState(m,x),this._update()},f.prototype.removeFeatureState=function(m,x){return this.style.removeFeatureState(m,x),this._update()},f.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var m=0,x=0;return this._container&&(m=this._container.clientWidth||400,x=this._container.clientHeight||300),[m,x]},f.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=g.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var x=this._canvasContainer=g.create("div","mapboxgl-canvas-container",m);this._interactive&&x.classList.add("mapboxgl-interactive"),this._canvas=g.create("canvas","mapboxgl-canvas",x),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var T=this._containerDimensions();this._resizeCanvas(T[0],T[1]);var E=this._controlContainer=g.create("div","mapboxgl-control-container",m),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(O){C[O]=g.create("div","mapboxgl-ctrl-"+O,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(m,x){var T=s.browser.devicePixelRatio||1;this._canvas.width=T*m,this._canvas.height=T*x,this._canvas.style.width=m+"px",this._canvas.style.height=x+"px"},f.prototype._setupPainter=function(){var m=s.extend({},p.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),x=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);x?(this.painter=new Mn(x,this.transform),s.webpSupported.testSupport(x)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:m}))},f.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:m}))},f.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},f.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},f.prototype._render=function(m){var x,T=this,E=0,C=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(x=C.createQueryEXT(),C.beginQueryEXT(C.TIME_ELAPSED_EXT,x),E=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var N=this.transform.zoom,Z=s.browser.now();this.style.zoomHistory.update(N,Z);var Y=new s.EvaluationParameters(N,{now:Z,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=Y.crossFadingFactor();K===1&&K===this._crossFadingFactor||(O=!0,this._crossFadingFactor=K),this.style.update(Y)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var at=s.browser.now()-E;C.endQueryEXT(C.TIME_ELAPSED_EXT,x),setTimeout(function(){var et=C.getQueryObjectEXT(x,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(x),T.fire(new s.Event("gpu-timing-frame",{cpuTime:at,gpuTime:et}))},50)}if(this.listens("gpu-timing-layer")){var it=this.painter.collectGpuTimers();setTimeout(function(){var et=T.painter.queryGpuTimers(it);T.fire(new s.Event("gpu-timing-layer",{layerTimes:et}))},50)}var ht=this._sourcesDirty||this._styleDirty||this._placementDirty;return ht||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||ht||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,x=this._controls;m<x.length;m+=1)x[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var T=this.painter.context.gl.getExtension("WEBGL_lose_context");T&&T.loseContext(),Ma(this._canvasContainer),Ma(this._controlContainer),Ma(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},f.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(x){m._frame=null,m._render(x)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(m){this._vertices=m,this._update()},f.prototype._setCacheLimits=function(m,x){s.setCacheLimits(m,x)},h.version.get=function(){return s.version},Object.defineProperties(f.prototype,h),f}(Vc);function Ma(c){c.parentNode&&c.parentNode.removeChild(c)}var Gf={showCompass:!0,showZoom:!0,visualizePitch:!1},Qo=function(c){var f=this;this.options=s.extend({},Gf,c),this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return f._map.zoomIn({},{originalEvent:h})}),g.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return f._map.zoomOut({},{originalEvent:h})}),g.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:h}):f._map.resetNorth({},{originalEvent:h})}),this._compassIcon=g.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Qo.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),f=c===this._map.getMaxZoom(),h=c===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},Qo.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Qo.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ci(this._map,this._compass,this.options.visualizePitch)),this._container},Qo.prototype.onRemove=function(){g.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Qo.prototype._createButton=function(c,f){var h=g.create("button",c,this._container);return h.type="button",h.addEventListener("click",f),h},Qo.prototype._setButtonTitle=function(c,f){var h=this._map._getUIString("NavigationControl."+f);c.title=h,c.setAttribute("aria-label",h)};var Ci=function(c,f,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Nc({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,h&&(this.mousePitch=new Bf({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener(f,"mousedown",this.mousedown),g.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),g.addEventListener(f,"touchmove",this.touchmove),g.addEventListener(f,"touchend",this.touchend),g.addEventListener(f,"touchcancel",this.reset)};function Tl(c,f,h){if(c=new s.LngLat(c.lng,c.lat),f){var m=new s.LngLat(c.lng-360,c.lat),x=new s.LngLat(c.lng+360,c.lat),T=h.locationPoint(c).distSqr(f);h.locationPoint(m).distSqr(f)<T?c=m:h.locationPoint(x).distSqr(f)<T&&(c=x)}for(;Math.abs(c.lng-h.center.lng)>180;){var E=h.locationPoint(c);if(E.x>=0&&E.y>=0&&E.x<=h.width&&E.y<=h.height)break;c.lng>h.center.lng?c.lng-=360:c.lng+=360}return c}Ci.prototype.down=function(c,f){this.mouseRotate.mousedown(c,f),this.mousePitch&&this.mousePitch.mousedown(c,f),g.disableDrag()},Ci.prototype.move=function(c,f){var h=this.map,m=this.mouseRotate.mousemoveWindow(c,f);if(m&&m.bearingDelta&&h.setBearing(h.getBearing()+m.bearingDelta),this.mousePitch){var x=this.mousePitch.mousemoveWindow(c,f);x&&x.pitchDelta&&h.setPitch(h.getPitch()+x.pitchDelta)}},Ci.prototype.off=function(){var c=this.element;g.removeEventListener(c,"mousedown",this.mousedown),g.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),g.removeEventListener(c,"touchmove",this.touchmove),g.removeEventListener(c,"touchend",this.touchend),g.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Ci.prototype.offTemp=function(){g.enableDrag(),g.removeEventListener(s.window,"mousemove",this.mousemove),g.removeEventListener(s.window,"mouseup",this.mouseup)},Ci.prototype.mousedown=function(c){this.down(s.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),g.mousePos(this.element,c)),g.addEventListener(s.window,"mousemove",this.mousemove),g.addEventListener(s.window,"mouseup",this.mouseup)},Ci.prototype.mousemove=function(c){this.move(c,g.mousePos(this.element,c))},Ci.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Ci.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=g.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Ci.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=g.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Ci.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ci.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gc(c,f,h){var m=c.classList;for(var x in Ro)m.remove("mapboxgl-"+h+"-anchor-"+x);m.add("mapboxgl-"+h+"-anchor-"+f)}var El,Iu=function(c){function f(h,m){if(c.call(this),(h instanceof s.window.HTMLElement||m)&&(h=s.extend({element:h},m)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=s.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=g.create("div"),this._element.setAttribute("aria-label","Map marker");var x=g.createNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","41px"),x.setAttributeNS(null,"width","27px"),x.setAttributeNS(null,"viewBox","0 0 27 41");var T=g.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");var E=g.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");var C=g.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");for(var O=0,N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];O<N.length;O+=1){var Z=N[O],Y=g.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",Z.rx),Y.setAttributeNS(null,"ry",Z.ry),C.appendChild(Y)}var K=g.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"fill",this._color);var at=g.createNS("http://www.w3.org/2000/svg","path");at.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),K.appendChild(at);var it=g.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"fill","#000000");var ht=g.createNS("http://www.w3.org/2000/svg","path");ht.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),it.appendChild(ht);var et=g.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(6.0, 7.0)"),et.setAttributeNS(null,"fill","#FFFFFF");var ct=g.createNS("http://www.w3.org/2000/svg","g");ct.setAttributeNS(null,"transform","translate(8.0, 8.0)");var yt=g.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#000000"),yt.setAttributeNS(null,"opacity","0.25"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962");var bt=g.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#FFFFFF"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962"),ct.appendChild(yt),ct.appendChild(bt),E.appendChild(C),E.appendChild(K),E.appendChild(it),E.appendChild(et),E.appendChild(ct),x.appendChild(E),x.setAttributeNS(null,"height",41*this._scale+"px"),x.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(x),this._offset=s.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ct){Ct.preventDefault()}),this._element.addEventListener("mousedown",function(Ct){Ct.preventDefault()}),Gc(this._element,this._anchor,"marker"),this._popup=null}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),g.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(h){var m=h.code,x=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&x!==32&&x!==13||this.togglePopup()},f.prototype._onMapClick=function(h){var m=h.originalEvent.target,x=this._element;this._popup&&(m===x||x.contains(m))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},f.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Tl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),g.setTransform(this._element,Ro[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+x+" "+m)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(h){return this._offset=s.Point.convert(h),this._update(),this},f.prototype._onMove=function(h){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(s.Evented),Wf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Sl=0,La=!1,Hf=function(c){function f(h){c.call(this),this.options=s.extend({},Wf,h),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.onAdd=function(h){var m;return this._map=h,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,El!==void 0?m(El):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(x){m(El=x.state!=="denied")}):m(El=!!s.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),g.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sl=0,La=!1},f.prototype._isOutOfMapMaxBounds=function(h){var m=this._map.getMaxBounds(),x=h.coords;return m&&(x.longitude<m.getWest()||x.longitude>m.getEast()||x.latitude<m.getSouth()||x.latitude>m.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",h)),this._finish()}},f.prototype._updateCamera=function(h){var m=new s.LngLat(h.coords.longitude,h.coords.latitude),x=h.coords.accuracy,T=this._map.getBearing(),E=s.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(x),E,{geolocateSource:!0})},f.prototype._updateMarker=function(h){if(h){var m=new s.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,m=this._map.unproject([0,h]),x=this._map.unproject([1,h]),T=m.distanceTo(x),E=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=E+"px",this._circleElement.style.height=E+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&La)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",h)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(h){var m=this;if(this._container.addEventListener("contextmenu",function(E){return E.preventDefault()}),this._geolocateButton=g.create("button","mapboxgl-ctrl-geolocate",this._container),g.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{var T=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=g.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Iu(this._dotElement),this._circleElement=g.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Iu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(E){E.geolocateSource||m._watchState!=="ACTIVE_LOCK"||E.originalEvent&&E.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new s.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sl--,La=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Sl>1?(h={maximumAge:6e5,timeout:0},La=!0):(h=this.options.positionOptions,La=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(s.Evented),zs={maxWidth:100,unit:"metric"},Ds=function(c){this.options=s.extend({},zs,c),s.bindAll(["_onMove","setUnit"],this)};function Wc(c,f,h){var m=h&&h.maxWidth||100,x=c._container.clientHeight/2,T=c.unproject([0,x]),E=c.unproject([m,x]),C=T.distanceTo(E);if(h&&h.unit==="imperial"){var O=3.2808*C;O>5280?Fs(f,m,O/5280,c._getUIString("ScaleControl.Miles")):Fs(f,m,O,c._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Fs(f,m,C/1852,c._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Fs(f,m,C/1e3,c._getUIString("ScaleControl.Kilometers")):Fs(f,m,C,c._getUIString("ScaleControl.Meters"))}function Fs(c,f,h,m){var x,T,E,C=(x=h,(T=Math.pow(10,(""+Math.floor(x)).length-1))*(E=(E=x/T)>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(O){var N=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*N)/N}(E)));c.style.width=f*(C/h)+"px",c.innerHTML=C+"&nbsp;"+m}Ds.prototype.getDefaultPosition=function(){return"bottom-left"},Ds.prototype._onMove=function(){Wc(this._map,this._container,this.options)},Ds.prototype.onAdd=function(c){return this._map=c,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ds.prototype.onRemove=function(){g.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ds.prototype.setUnit=function(c){this.options.unit=c,Wc(this._map,this._container,this.options)};var no=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};no.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},no.prototype.onRemove=function(){g.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},no.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},no.prototype._setupUI=function(){var c=this._fullscreenButton=g.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);g.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},no.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},no.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},no.prototype._isFullscreen=function(){return this._fullscreen},no.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},no.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var qf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zf=function(c){function f(h){c.call(this),this.options=s.extend(Object.create(qf),h),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&g.remove(this._content),this._container&&(g.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(h){return this.setDOMContent(s.window.document.createTextNode(h))},f.prototype.setHTML=function(h){var m,x=s.window.document.createDocumentFragment(),T=s.window.document.createElement("body");for(T.innerHTML=h;m=T.firstChild;)x.appendChild(m);return this.setDOMContent(x)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},f.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=g.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},f.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},f.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},f.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=g.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(h){this._update(h.point)},f.prototype._onMouseMove=function(h){this._update(h.point)},f.prototype._onDrag=function(h){this._update(h.point)},f.prototype._update=function(h){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=g.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=g.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Y){return m._container.classList.add(Y)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var x=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),T=this.options.anchor,E=function Y(K){if(K){if(typeof K=="number"){var at=Math.round(Math.sqrt(.5*Math.pow(K,2)));return{center:new s.Point(0,0),top:new s.Point(0,K),"top-left":new s.Point(at,at),"top-right":new s.Point(-at,at),bottom:new s.Point(0,-K),"bottom-left":new s.Point(at,-at),"bottom-right":new s.Point(-at,-at),left:new s.Point(K,0),right:new s.Point(-K,0)}}if(K instanceof s.Point||Array.isArray(K)){var it=s.Point.convert(K);return{center:it,top:it,"top-left":it,"top-right":it,bottom:it,"bottom-left":it,"bottom-right":it,left:it,right:it}}return{center:s.Point.convert(K.center||[0,0]),top:s.Point.convert(K.top||[0,0]),"top-left":s.Point.convert(K["top-left"]||[0,0]),"top-right":s.Point.convert(K["top-right"]||[0,0]),bottom:s.Point.convert(K.bottom||[0,0]),"bottom-left":s.Point.convert(K["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(K["bottom-right"]||[0,0]),left:s.Point.convert(K.left||[0,0]),right:s.Point.convert(K.right||[0,0])}}return Y(new s.Point(0,0))}(this.options.offset);if(!T){var C,O=this._container.offsetWidth,N=this._container.offsetHeight;C=x.y+E.bottom.y<N?["top"]:x.y>this._map.transform.height-N?["bottom"]:[],x.x<O/2?C.push("left"):x.x>this._map.transform.width-O/2&&C.push("right"),T=C.length===0?"bottom":C.join("-")}var Z=x.add(E[T]).round();g.setTransform(this._container,Ro[T]+" translate("+Z.x+"px,"+Z.y+"px)"),Gc(this._container,T,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(Mu);h&&h.focus()}},f.prototype._onClose=function(){this.remove()},f}(s.Evented),Hc={version:s.version,supported:p,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:Im,NavigationControl:Qo,GeolocateControl:Hf,AttributionControl:Kr,ScaleControl:Ds,FullscreenControl:no,Popup:Zf,Marker:Iu,Style:Ti,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){Lt().acquire(It)},clearPrewarmedResources:function(){var c=le;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(It),le=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Bt.workerCount},set workerCount(c){Bt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){s.clearTileCache(c)},workerUrl:""};return Hc}),o})})(AF);const aa=o1;var CF=1e-7;function s1(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function PM(e,t){if(e===t)return!0;if(s1(e)&&s1(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!PM(e[n],t[n]))return!1;return!0}return Math.abs(e-t)<=CF}function bg(e,t,n){return Math.max(t,Math.min(n,e))}function av(e,t,n){return s1(e)?e.map(function(r,o){return av(r,t[o],n)}):n*t+(1-n)*e}function ss(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function RS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function zS(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RS(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RS(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var ec={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},d0={pitch:0,bearing:0,altitude:1.5},DS=5,IF=1.2,Jh=function(){function e(t){var n=t.width,r=t.height,o=t.latitude,l=t.longitude,s=t.zoom,p=t.bearing,g=p===void 0?d0.bearing:p,_=t.pitch,w=_===void 0?d0.pitch:_,P=t.altitude,A=P===void 0?d0.altitude:P,M=t.maxZoom,F=M===void 0?ec.maxZoom:M,X=t.minZoom,B=X===void 0?ec.minZoom:X,U=t.maxPitch,H=U===void 0?ec.maxPitch:U,tt=t.minPitch,st=tt===void 0?ec.minPitch:tt,pt=t.transitionDuration,_t=t.transitionEasing,Ot=t.transitionInterpolator,Dt=t.transitionInterruption,kt=t.startPanLngLat,qt=t.startZoomLngLat,ee=t.startRotatePos,_e=t.startBearing,ae=t.startPitch,he=t.startZoom;lu(this,e),ss(Number.isFinite(n),"`width` must be supplied"),ss(Number.isFinite(r),"`height` must be supplied"),ss(Number.isFinite(l),"`longitude` must be supplied"),ss(Number.isFinite(o),"`latitude` must be supplied"),ss(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:r,latitude:o,longitude:l,zoom:s,bearing:g,pitch:w,altitude:A,maxZoom:F,minZoom:B,maxPitch:H,minPitch:st,transitionDuration:pt,transitionEasing:_t,transitionInterpolator:Ot,transitionInterruption:Dt}),this._state={startPanLngLat:kt,startZoomLngLat:qt,startRotatePos:ee,startBearing:_e,startPitch:ae,startZoom:he}}return uu(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(n){var r=n.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(r)})}},{key:"pan",value:function(n){var r=n.pos,o=n.startPos,l=this._state.startPanLngLat||this._unproject(o);if(!l)return this;var s=this._calculateNewLngLat({startPanLngLat:l,pos:r}),p=Br(s,2),g=p[0],_=p[1];return this._getUpdatedMapState({longitude:g,latitude:_})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(n){var r=n.pos;return this._getUpdatedMapState({startRotatePos:r,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(n){var r=n.pos,o=n.deltaAngleX,l=o===void 0?0:o,s=n.deltaAngleY,p=s===void 0?0:s,g=this._state,_=g.startRotatePos,w=g.startBearing,P=g.startPitch;if(!Number.isFinite(w)||!Number.isFinite(P))return this;var A;return r?A=this._calculateNewPitchAndBearing(zS(zS({},this._getRotationParams(r,_)),{},{startBearing:w,startPitch:P})):A={bearing:w+l,pitch:P+p},this._getUpdatedMapState(A)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(n){var r=n.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(r),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(n){var r=n.pos,o=n.startPos,l=n.scale;ss(l>0,"`scale` must be a positive number");var s=this._state,p=s.startZoom,g=s.startZoomLngLat;Number.isFinite(p)||(p=this._viewportProps.zoom,g=this._unproject(o)||this._unproject(r)),ss(g,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var _=this._calculateNewZoom({scale:l,startZoom:p||0}),w=new il(Object.assign({},this._viewportProps,{zoom:_})),P=w.getMapCenterByLngLatPosition({lngLat:g,pos:r}),A=Br(P,2),M=A[0],F=A[1];return this._getUpdatedMapState({zoom:_,longitude:M,latitude:F})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(n){return new e(Object.assign({},this._viewportProps,this._state,n))}},{key:"_applyConstraints",value:function(n){var r=n.maxZoom,o=n.minZoom,l=n.zoom;n.zoom=bg(l,o,r);var s=n.maxPitch,p=n.minPitch,g=n.pitch;return n.pitch=bg(g,p,s),Object.assign(n,gM(n)),n}},{key:"_unproject",value:function(n){var r=new il(this._viewportProps);return n&&r.unproject(n)}},{key:"_calculateNewLngLat",value:function(n){var r=n.startPanLngLat,o=n.pos,l=new il(this._viewportProps);return l.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"_calculateNewZoom",value:function(n){var r=n.scale,o=n.startZoom,l=this._viewportProps,s=l.maxZoom,p=l.minZoom,g=o+Math.log2(r);return bg(g,p,s)}},{key:"_calculateNewPitchAndBearing",value:function(n){var r=n.deltaScaleX,o=n.deltaScaleY,l=n.startBearing,s=n.startPitch;o=bg(o,-1,1);var p=this._viewportProps,g=p.minPitch,_=p.maxPitch,w=l+180*r,P=s;return o>0?P=s+o*(_-s):o<0&&(P=s-o*(g-s)),{pitch:P,bearing:w}}},{key:"_getRotationParams",value:function(n,r){var o=n[0]-r[0],l=n[1]-r[1],s=n[1],p=r[1],g=this._viewportProps,_=g.width,w=g.height,P=o/_,A=0;return l>0?Math.abs(w-p)>DS&&(A=l/(p-w)*IF):l<0&&p>DS&&(A=1-s/p),A=Math.min(1,Math.max(-1,A)),{deltaScaleX:P,deltaScaleY:A}}}]),e}();function MF(e){return e[0].toLowerCase()+e.slice(1)}function LF(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ec;for(var n in t){var r=n.slice(0,3),o=MF(n.slice(3));if(r==="min"&&e[o]<t[n]||r==="max"&&e[o]>t[n])return!1}return!0}function FS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function NS(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FS(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FS(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Tc=Rt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),$b=Tc.Provider;function kF(e){var t=e.value,n=e.children,r=Rt.useState(null),o=Br(r,2),l=o[0],s=o[1],p=Rt.useContext(Tc);return t=NS(NS({setMap:s},p),{},{map:p&&p.map||l},t),Rt.createElement($b,{value:t},n)}Tc.Provider=kF;var a1=typeof window<"u"?Rt.useLayoutEffect:Rt.useEffect;function BS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function os(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BS(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BS(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var OF="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",AM="A valid API access token is required to use Mapbox data";function RF(){}function CM(e){var t=e.props,n=e.width,r=e.height;return new il(os(os(os({},t),t.viewState),{},{width:n,height:r}))}var zF=401,US={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},DF=Object.assign({},wc.propTypes,{width:Tt.oneOfType([Tt.number,Tt.string]),height:Tt.oneOfType([Tt.number,Tt.string]),onResize:Tt.func,disableTokenWarning:Tt.bool,visible:Tt.bool,className:Tt.string,style:Tt.object,visibilityConstraints:Tt.object}),FF=Object.assign({},wc.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:RF,className:"",style:null,visibilityConstraints:ec});function NF(){var e={position:"absolute",left:0,top:0};return Rt.createElement("div",{key:"warning",id:"no-token-warning",style:e},Rt.createElement("h3",{key:"header"},AM),Rt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Rt.createElement("a",{key:"link",href:OF},"Note on Map Tokens"))}function BF(e){return{getMap:function(){return e.current&&e.current.getMap()},queryRenderedFeatures:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=e.current&&e.current.getMap();return o&&o.queryRenderedFeatures(n,r)}}}var cl=Rt.forwardRef(function(e,t){var n=Rt.useState(!0),r=Br(n,2),o=r[0],l=r[1],s=Rt.useState({width:0,height:0}),p=Br(s,2),g=p[0],_=p[1],w=Rt.useRef(null),P=Rt.useRef(null),A=Rt.useRef(null),M=Rt.useRef(null),F=Rt.useContext(Tc);a1(function(){if(cl.supported()){var qt=new wc(os(os(os({},e),g),{},{mapboxgl:aa,container:P.current,onError:function(ae){var he=ae.error&&ae.error.status||ae.status;he===zF&&o&&(console.error(AM),l(!1)),e.onError(ae)}}));w.current=qt,F&&F.setMap&&F.setMap(qt.getMap());var ee=new bF(function(_e){if(_e[0].contentRect){var ae=_e[0].contentRect,he=ae.width,sn=ae.height;_({width:he,height:sn}),e.onResize({width:he,height:sn})}});return ee.observe(A.current),function(){qt.finalize(),w.current=null,ee.disconnect()}}},[]),a1(function(){w.current&&w.current.setProps(os(os({},e),g))});var X=w.current&&w.current.getMap();Rt.useImperativeHandle(t,function(){return BF(w)},[]);var B=Rt.useCallback(function(qt){var ee=qt.target;ee===M.current&&ee.scrollTo(0,0)},[]),U=X&&Rt.createElement($b,{value:os(os({},F),{},{viewport:F.viewport||CM(os({map:X,props:e},g)),map:X,container:F.container||A.current})},Rt.createElement("div",{key:"map-overlays",className:"overlays",ref:M,style:US,onScroll:B},e.children)),H=e.className,tt=e.width,st=e.height,pt=e.style,_t=e.visibilityConstraints,Ot=Object.assign({position:"relative"},pt,{width:tt,height:st}),Dt=e.visible&&LF(e.viewState||e,_t),kt=Object.assign({},US,{visibility:Dt?"inherit":"hidden"});return Rt.createElement("div",{key:"map-container",ref:A,style:Ot},Rt.createElement("div",{key:"map-mapbox",ref:P,style:kt,className:H}),U,!o&&!e.disableTokenWarning&&Rt.createElement(NF,null))});cl.supported=function(){return aa&&aa.supported()};cl.propTypes=DF;cl.defaultProps=FF;function UF(e,t){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=VF(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,s=!1,p;return{s:function(){n=e[Symbol.iterator]()},n:function(){var _=n.next();return l=_.done,_},e:function(_){s=!0,p=_},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(s)throw p}}}}function VF(e,t){if(e){if(typeof e=="string")return VS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return VS(e,t)}}function VS(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var IM=function(){function e(){lu(this,e),L(this,"propNames",[])}return uu(e,[{key:"arePropsEqual",value:function(n,r){var o=UF(this.propNames||[]),l;try{for(o.s();!(l=o.n()).done;){var s=l.value;if(!PM(n[s],r[s]))return!1}}catch(p){o.e(p)}finally{o.f()}return!0}},{key:"initializeProps",value:function(n,r){return{start:n,end:r}}},{key:"interpolateProps",value:function(n,r,o){ss(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(n,r){return r.transitionDuration}}]),e}();function Za(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l1(e,t){return l1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},l1(e,t)}function Yb(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l1(e,t)}function Kb(e,t){if(t&&(lf(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Za(e)}function iu(e){return iu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},iu(e)}var jF={longitude:1,bearing:1};function lv(e){return Number.isFinite(e)||Array.isArray(e)}function GF(e){return e in jF}function u1(e,t,n){return GF(e)&&Math.abs(n-t)>180&&(n=n<0?n+360:n-360),n}function m0(e,t){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=WF(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,s=!1,p;return{s:function(){n=e[Symbol.iterator]()},n:function(){var _=n.next();return l=_.done,_},e:function(_){s=!0,p=_},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(s)throw p}}}}function WF(e,t){if(e){if(typeof e=="string")return jS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jS(e,t)}}function jS(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function HF(e){var t=qF();return function(){var r=iu(e),o;if(t){var l=iu(this).constructor;o=Reflect.construct(r,arguments,l)}else o=r.apply(this,arguments);return Kb(this,o)}}function qF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var ZF=["longitude","latitude","zoom","bearing","pitch"],XF=["latitude","longitude","zoom","width","height"],GS=["bearing","pitch"],$F={speed:1.2,curve:1.414};(function(e){Yb(n,e);var t=HF(n);function n(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lu(this,n),r=t.call(this),L(Za(r),"propNames",ZF),r.props=Object.assign({},$F,o),r}return uu(n,[{key:"initializeProps",value:function(o,l){var s={},p={},g=m0(XF),_;try{for(g.s();!(_=g.n()).done;){var w=_.value,P=o[w],A=l[w];ss(lv(P)&&lv(A),"".concat(w," must be supplied for transition")),s[w]=P,p[w]=u1(w,P,A)}}catch(H){g.e(H)}finally{g.f()}var M=m0(GS),F;try{for(M.s();!(F=M.n()).done;){var X=F.value,B=o[X]||0,U=l[X]||0;s[X]=B,p[X]=u1(X,B,U)}}catch(H){M.e(H)}finally{M.f()}return{start:s,end:p}}},{key:"interpolateProps",value:function(o,l,s){var p=nF(o,l,s,this.props),g=m0(GS),_;try{for(g.s();!(_=g.n()).done;){var w=_.value;p[w]=av(o[w],l[w],s)}}catch(P){g.e(P)}finally{g.f()}return p}},{key:"getDuration",value:function(o,l){var s=l.transitionDuration;return s==="auto"&&(s=rF(o,l,this.props)),s}}]),n})(IM);function WS(e,t){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=YF(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,s=!1,p;return{s:function(){n=e[Symbol.iterator]()},n:function(){var _=n.next();return l=_.done,_},e:function(_){s=!0,p=_},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(s)throw p}}}}function YF(e,t){if(e){if(typeof e=="string")return HS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return HS(e,t)}}function HS(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function KF(e){var t=JF();return function(){var r=iu(e),o;if(t){var l=iu(this).constructor;o=Reflect.construct(r,arguments,l)}else o=r.apply(this,arguments);return Kb(this,o)}}function JF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var QF=["longitude","latitude","zoom","bearing","pitch"],Yp=function(e){Yb(n,e);var t=KF(n);function n(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lu(this,n),r=t.call(this),Array.isArray(o)&&(o={transitionProps:o}),r.propNames=o.transitionProps||QF,o.around&&(r.around=o.around),r}return uu(n,[{key:"initializeProps",value:function(o,l){var s={},p={};if(this.around){s.around=this.around;var g=new il(o).unproject(this.around);Object.assign(p,l,{around:new il(l).project(g),aroundLngLat:g})}var _=WS(this.propNames),w;try{for(_.s();!(w=_.n()).done;){var P=w.value,A=o[P],M=l[P];ss(lv(A)&&lv(M),"".concat(P," must be supplied for transition")),s[P]=A,p[P]=u1(P,A,M)}}catch(F){_.e(F)}finally{_.f()}return{start:s,end:p}}},{key:"interpolateProps",value:function(o,l,s){var p={},g=WS(this.propNames),_;try{for(g.s();!(_=g.n()).done;){var w=_.value;p[w]=av(o[w],l[w],s)}}catch(X){g.e(X)}finally{g.f()}if(l.around){var P=new il(Object.assign({},l,p)).getMapCenterByLngLatPosition({lngLat:l.aroundLngLat,pos:av(o.around,l.around,s)}),A=Br(P,2),M=A[0],F=A[1];p.longitude=M,p.latitude=F}return p}}]),n}(IM),Kp=function(){};function tN(e,t){var n=e(t);return function(r){return 1/(1-n)*(e(r*(1-t)+t)-n)}}var Jp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},eN={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new Yp,transitionInterruption:Jp.BREAK,onTransitionStart:Kp,onTransitionInterrupt:Kp,onTransitionEnd:Kp},Jb=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lu(this,e),L(this,"_animationFrame",null),L(this,"_onTransitionFrame",function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()}),this.props=null,this.onViewportChange=n.onViewportChange||Kp,this.onStateChange=n.onStateChange||Kp,this.time=n.getTime||Date.now}return uu(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(n){var r=this.props;if(this.props=n,!r||this._shouldIgnoreViewportChange(r,n))return!1;if(this._isTransitionEnabled(n)){var o=Object.assign({},r),l=Object.assign({},n);if(this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this.state.interruption===Jp.SNAP_TO_END?Object.assign(o,this.state.endProps):Object.assign(o,this.state.propsInTransition),this.state.interruption===Jp.UPDATE)){var s=this.time(),p=(s-this.state.startTime)/this.state.duration;l.transitionDuration=this.state.duration-(s-this.state.startTime),l.transitionEasing=tN(this.state.easing,p),l.transitionInterpolator=o.transitionInterpolator}return l.onTransitionStart(),this._triggerTransition(o,l),!0}return this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(n){var r=n.transitionDuration,o=n.transitionInterpolator;return(r>0||r==="auto")&&Boolean(o)}},{key:"_isUpdateDueToCurrentTransition",value:function(n){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(n,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(n,r){return n?this._isTransitionInProgress()?this.state.interruption===Jp.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(n,r):!0:!0}},{key:"_triggerTransition",value:function(n,r){ss(this._isTransitionEnabled(r)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var o=r.transitionInterpolator,l=o.getDuration?o.getDuration(n,r):r.transitionDuration;if(l!==0){var s=r.transitionInterpolator.initializeProps(n,r),p={inTransition:!0,isZooming:n.zoom!==r.zoom,isPanning:n.longitude!==r.longitude||n.latitude!==r.latitude,isRotating:n.bearing!==r.bearing||n.pitch!==r.pitch};this.state={duration:l,easing:r.transitionEasing,interpolator:r.transitionInterpolator,interruption:r.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(p)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var n=this.time(),r=this.state,o=r.startTime,l=r.duration,s=r.easing,p=r.interpolator,g=r.startProps,_=r.endProps,w=!1,P=(n-o)/l;P>=1&&(P=1,w=!0),P=s(P);var A=p.interpolateProps(g,_,P),M=new Jh(Object.assign({},this.props,A));this.state.propsInTransition=M.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),w&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();L(Jb,"defaultProps",eN);var pc={},nN={get exports(){return pc},set exports(e){pc=e}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,n,r,o){var l=["","webkit","Moz","MS","ms","o"],s=n.createElement("div"),p="function",g=Math.round,_=Math.abs,w=Date.now;function P(q,Q,dt){return setTimeout(tt(q,dt),Q)}function A(q,Q,dt){return Array.isArray(q)?(M(q,dt[Q],dt),!0):!1}function M(q,Q,dt){var Et;if(q)if(q.forEach)q.forEach(Q,dt);else if(q.length!==o)for(Et=0;Et<q.length;)Q.call(dt,q[Et],Et,q),Et++;else for(Et in q)q.hasOwnProperty(Et)&&Q.call(dt,q[Et],Et,q)}function F(q,Q,dt){var Et="DEPRECATED METHOD: "+Q+`
`+dt+` AT 
`;return function(){var jt=new Error("get-stack-trace"),pe=jt&&jt.stack?jt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",tn=t.console&&(t.console.warn||t.console.log);return tn&&tn.call(t.console,Et,pe),q.apply(this,arguments)}}var X;typeof Object.assign!="function"?X=function(Q){if(Q===o||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Q),Et=1;Et<arguments.length;Et++){var jt=arguments[Et];if(jt!==o&&jt!==null)for(var pe in jt)jt.hasOwnProperty(pe)&&(dt[pe]=jt[pe])}return dt}:X=Object.assign;var B=F(function(Q,dt,Et){for(var jt=Object.keys(dt),pe=0;pe<jt.length;)(!Et||Et&&Q[jt[pe]]===o)&&(Q[jt[pe]]=dt[jt[pe]]),pe++;return Q},"extend","Use `assign`."),U=F(function(Q,dt){return B(Q,dt,!0)},"merge","Use `assign`.");function H(q,Q,dt){var Et=Q.prototype,jt;jt=q.prototype=Object.create(Et),jt.constructor=q,jt._super=Et,dt&&X(jt,dt)}function tt(q,Q){return function(){return q.apply(Q,arguments)}}function st(q,Q){return typeof q==p?q.apply(Q&&Q[0]||o,Q):q}function pt(q,Q){return q===o?Q:q}function _t(q,Q,dt){M(qt(Q),function(Et){q.addEventListener(Et,dt,!1)})}function Ot(q,Q,dt){M(qt(Q),function(Et){q.removeEventListener(Et,dt,!1)})}function Dt(q,Q){for(;q;){if(q==Q)return!0;q=q.parentNode}return!1}function kt(q,Q){return q.indexOf(Q)>-1}function qt(q){return q.trim().split(/\s+/g)}function ee(q,Q,dt){if(q.indexOf&&!dt)return q.indexOf(Q);for(var Et=0;Et<q.length;){if(dt&&q[Et][dt]==Q||!dt&&q[Et]===Q)return Et;Et++}return-1}function _e(q){return Array.prototype.slice.call(q,0)}function ae(q,Q,dt){for(var Et=[],jt=[],pe=0;pe<q.length;){var tn=Q?q[pe][Q]:q[pe];ee(jt,tn)<0&&Et.push(q[pe]),jt[pe]=tn,pe++}return dt&&(Q?Et=Et.sort(function(Pr,zr){return Pr[Q]>zr[Q]}):Et=Et.sort()),Et}function he(q,Q){for(var dt,Et,jt=Q[0].toUpperCase()+Q.slice(1),pe=0;pe<l.length;){if(dt=l[pe],Et=dt?dt+jt:Q,Et in q)return Et;pe++}return o}var sn=1;function ar(){return sn++}function gr(q){var Q=q.ownerDocument||q;return Q.defaultView||Q.parentWindow||t}var mi=/mobile|tablet|ip(ad|hone|od)|android/i,$i="ontouchstart"in t,gi=he(t,"PointerEvent")!==o,Vr=$i&&mi.test(navigator.userAgent),Sr="touch",ho="pen",Jt="mouse",Te="kinect",Je=25,Oe=1,an=2,Se=4,dn=8,jr=1,Un=2,Ve=4,yi=8,lr=16,Zn=Un|Ve,fo=yi|lr,vi=Zn|fo,gs=["x","y"],Gr=["clientX","clientY"];function yr(q,Q){var dt=this;this.manager=q,this.callback=Q,this.element=q.element,this.target=q.options.inputTarget,this.domHandler=function(Et){st(q.options.enable,[q])&&dt.handler(Et)},this.init()}yr.prototype={handler:function(){},init:function(){this.evEl&&_t(this.element,this.evEl,this.domHandler),this.evTarget&&_t(this.target,this.evTarget,this.domHandler),this.evWin&&_t(gr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ot(this.element,this.evEl,this.domHandler),this.evTarget&&Ot(this.target,this.evTarget,this.domHandler),this.evWin&&Ot(gr(this.element),this.evWin,this.domHandler)}};function ys(q){var Q,dt=q.options.inputClass;return dt?Q=dt:gi?Q=Lo:Vr?Q=mt:$i?Q=xt:Q=Zo,new Q(q,_i)}function _i(q,Q,dt){var Et=dt.pointers.length,jt=dt.changedPointers.length,pe=Q&Oe&&Et-jt===0,tn=Q&(Se|dn)&&Et-jt===0;dt.isFirst=!!pe,dt.isFinal=!!tn,pe&&(q.session={}),dt.eventType=Q,xi(q,dt),q.emit("hammer.input",dt),q.recognize(dt),q.session.prevInput=dt}function xi(q,Q){var dt=q.session,Et=Q.pointers,jt=Et.length;dt.firstInput||(dt.firstInput=ca(Q)),jt>1&&!dt.firstMultiple?dt.firstMultiple=ca(Q):jt===1&&(dt.firstMultiple=!1);var pe=dt.firstInput,tn=dt.firstMultiple,nr=tn?tn.center:pe.center,Pr=Q.center=ha(Et);Q.timeStamp=w(),Q.deltaTime=Q.timeStamp-pe.timeStamp,Q.angle=xs(nr,Pr),Q.distance=po(nr,Pr),Ho(dt,Q),Q.offsetDirection=_s(Q.deltaX,Q.deltaY);var zr=vs(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=zr.x,Q.overallVelocityY=zr.y,Q.overallVelocity=_(zr.x)>_(zr.y)?zr.x:zr.y,Q.scale=tn?fa(tn.pointers,Et):1,Q.rotation=tn?bs(tn.pointers,Et):0,Q.maxPointers=dt.prevInput?Q.pointers.length>dt.prevInput.maxPointers?Q.pointers.length:dt.prevInput.maxPointers:Q.pointers.length,Ni(dt,Q);var Ji=q.element;Dt(Q.srcEvent.target,Ji)&&(Ji=Q.srcEvent.target),Q.target=Ji}function Ho(q,Q){var dt=Q.center,Et=q.offsetDelta||{},jt=q.prevDelta||{},pe=q.prevInput||{};(Q.eventType===Oe||pe.eventType===Se)&&(jt=q.prevDelta={x:pe.deltaX||0,y:pe.deltaY||0},Et=q.offsetDelta={x:dt.x,y:dt.y}),Q.deltaX=jt.x+(dt.x-Et.x),Q.deltaY=jt.y+(dt.y-Et.y)}function Ni(q,Q){var dt=q.lastInterval||Q,Et=Q.timeStamp-dt.timeStamp,jt,pe,tn,nr;if(Q.eventType!=dn&&(Et>Je||dt.velocity===o)){var Pr=Q.deltaX-dt.deltaX,zr=Q.deltaY-dt.deltaY,Ji=vs(Et,Pr,zr);pe=Ji.x,tn=Ji.y,jt=_(Ji.x)>_(Ji.y)?Ji.x:Ji.y,nr=_s(Pr,zr),q.lastInterval=Q}else jt=dt.velocity,pe=dt.velocityX,tn=dt.velocityY,nr=dt.direction;Q.velocity=jt,Q.velocityX=pe,Q.velocityY=tn,Q.direction=nr}function ca(q){for(var Q=[],dt=0;dt<q.pointers.length;)Q[dt]={clientX:g(q.pointers[dt].clientX),clientY:g(q.pointers[dt].clientY)},dt++;return{timeStamp:w(),pointers:Q,center:ha(Q),deltaX:q.deltaX,deltaY:q.deltaY}}function ha(q){var Q=q.length;if(Q===1)return{x:g(q[0].clientX),y:g(q[0].clientY)};for(var dt=0,Et=0,jt=0;jt<Q;)dt+=q[jt].clientX,Et+=q[jt].clientY,jt++;return{x:g(dt/Q),y:g(Et/Q)}}function vs(q,Q,dt){return{x:Q/q||0,y:dt/q||0}}function _s(q,Q){return q===Q?jr:_(q)>=_(Q)?q<0?Un:Ve:Q<0?yi:lr}function po(q,Q,dt){dt||(dt=gs);var Et=Q[dt[0]]-q[dt[0]],jt=Q[dt[1]]-q[dt[1]];return Math.sqrt(Et*Et+jt*jt)}function xs(q,Q,dt){dt||(dt=gs);var Et=Q[dt[0]]-q[dt[0]],jt=Q[dt[1]]-q[dt[1]];return Math.atan2(jt,Et)*180/Math.PI}function bs(q,Q){return xs(Q[1],Q[0],Gr)+xs(q[1],q[0],Gr)}function fa(q,Q){return po(Q[0],Q[1],Gr)/po(q[0],q[1],Gr)}var qo={mousedown:Oe,mousemove:an,mouseup:Se},pa="mousedown",da="mousemove mouseup";function Zo(){this.evEl=pa,this.evWin=da,this.pressed=!1,yr.apply(this,arguments)}H(Zo,yr,{handler:function(Q){var dt=qo[Q.type];dt&Oe&&Q.button===0&&(this.pressed=!0),dt&an&&Q.which!==1&&(dt=Se),this.pressed&&(dt&Se&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Q],changedPointers:[Q],pointerType:Jt,srcEvent:Q}))}});var dl={pointerdown:Oe,pointermove:an,pointerup:Se,pointercancel:dn,pointerout:dn},Xo={2:Sr,3:ho,4:Jt,5:Te},Yi="pointerdown",Ki="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Yi="MSPointerDown",Ki="MSPointerMove MSPointerUp MSPointerCancel");function Lo(){this.evEl=Yi,this.evWin=Ki,yr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}H(Lo,yr,{handler:function(Q){var dt=this.store,Et=!1,jt=Q.type.toLowerCase().replace("ms",""),pe=dl[jt],tn=Xo[Q.pointerType]||Q.pointerType,nr=tn==Sr,Pr=ee(dt,Q.pointerId,"pointerId");pe&Oe&&(Q.button===0||nr)?Pr<0&&(dt.push(Q),Pr=dt.length-1):pe&(Se|dn)&&(Et=!0),!(Pr<0)&&(dt[Pr]=Q,this.callback(this.manager,pe,{pointers:dt,changedPointers:[Q],pointerType:tn,srcEvent:Q}),Et&&dt.splice(Pr,1))}});var ma={touchstart:Oe,touchmove:an,touchend:Se,touchcancel:dn},Dn="touchstart",D="touchstart touchmove touchend touchcancel";function V(){this.evTarget=Dn,this.evWin=D,this.started=!1,yr.apply(this,arguments)}H(V,yr,{handler:function(Q){var dt=ma[Q.type];if(dt===Oe&&(this.started=!0),!!this.started){var Et=G.call(this,Q,dt);dt&(Se|dn)&&Et[0].length-Et[1].length===0&&(this.started=!1),this.callback(this.manager,dt,{pointers:Et[0],changedPointers:Et[1],pointerType:Sr,srcEvent:Q})}}});function G(q,Q){var dt=_e(q.touches),Et=_e(q.changedTouches);return Q&(Se|dn)&&(dt=ae(dt.concat(Et),"identifier",!0)),[dt,Et]}var J={touchstart:Oe,touchmove:an,touchend:Se,touchcancel:dn},ot="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=ot,this.targetIds={},yr.apply(this,arguments)}H(mt,yr,{handler:function(Q){var dt=J[Q.type],Et=gt.call(this,Q,dt);Et&&this.callback(this.manager,dt,{pointers:Et[0],changedPointers:Et[1],pointerType:Sr,srcEvent:Q})}});function gt(q,Q){var dt=_e(q.touches),Et=this.targetIds;if(Q&(Oe|an)&&dt.length===1)return Et[dt[0].identifier]=!0,[dt,dt];var jt,pe,tn=_e(q.changedTouches),nr=[],Pr=this.target;if(pe=dt.filter(function(zr){return Dt(zr.target,Pr)}),Q===Oe)for(jt=0;jt<pe.length;)Et[pe[jt].identifier]=!0,jt++;for(jt=0;jt<tn.length;)Et[tn[jt].identifier]&&nr.push(tn[jt]),Q&(Se|dn)&&delete Et[tn[jt].identifier],jt++;if(nr.length)return[ae(pe.concat(nr),"identifier",!0),nr]}var $=2500,lt=25;function xt(){yr.apply(this,arguments);var q=tt(this.handler,this);this.touch=new mt(this.manager,q),this.mouse=new Zo(this.manager,q),this.primaryTouch=null,this.lastTouches=[]}H(xt,yr,{handler:function(Q,dt,Et){var jt=Et.pointerType==Sr,pe=Et.pointerType==Jt;if(!(pe&&Et.sourceCapabilities&&Et.sourceCapabilities.firesTouchEvents)){if(jt)Nt.call(this,dt,Et);else if(pe&&It.call(this,Et))return;this.callback(Q,dt,Et)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Nt(q,Q){q&Oe?(this.primaryTouch=Q.changedPointers[0].identifier,Ut.call(this,Q)):q&(Se|dn)&&Ut.call(this,Q)}function Ut(q){var Q=q.changedPointers[0];if(Q.identifier===this.primaryTouch){var dt={x:Q.clientX,y:Q.clientY};this.lastTouches.push(dt);var Et=this.lastTouches,jt=function(){var pe=Et.indexOf(dt);pe>-1&&Et.splice(pe,1)};setTimeout(jt,$)}}function It(q){for(var Q=q.srcEvent.clientX,dt=q.srcEvent.clientY,Et=0;Et<this.lastTouches.length;Et++){var jt=this.lastTouches[Et],pe=Math.abs(Q-jt.x),tn=Math.abs(dt-jt.y);if(pe<=lt&&tn<=lt)return!0}return!1}var Bt=he(s.style,"touchAction"),le=Bt!==o,ie="compute",Lt="auto",Qt="manipulation",Ht="none",Zt="pan-x",Re="pan-y",Yt=je();function We(q,Q){this.manager=q,this.set(Q)}We.prototype={set:function(q){q==ie&&(q=this.compute()),le&&this.manager.element.style&&Yt[q]&&(this.manager.element.style[Bt]=q),this.actions=q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var q=[];return M(this.manager.recognizers,function(Q){st(Q.options.enable,[Q])&&(q=q.concat(Q.getTouchAction()))}),mn(q.join(" "))},preventDefaults:function(q){var Q=q.srcEvent,dt=q.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Et=this.actions,jt=kt(Et,Ht)&&!Yt[Ht],pe=kt(Et,Re)&&!Yt[Re],tn=kt(Et,Zt)&&!Yt[Zt];if(jt){var nr=q.pointers.length===1,Pr=q.distance<2,zr=q.deltaTime<250;if(nr&&Pr&&zr)return}if(!(tn&&pe)&&(jt||pe&&dt&Zn||tn&&dt&fo))return this.preventSrc(Q)},preventSrc:function(q){this.manager.session.prevented=!0,q.preventDefault()}};function mn(q){if(kt(q,Ht))return Ht;var Q=kt(q,Zt),dt=kt(q,Re);return Q&&dt?Ht:Q||dt?Q?Zt:Re:kt(q,Qt)?Qt:Lt}function je(){if(!le)return!1;var q={},Q=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){q[dt]=Q?t.CSS.supports("touch-action",dt):!0}),q}var Ye=1,ze=2,Xn=4,Ze=8,gn=Ze,on=16,De=32;function Ge(q){this.options=X({},this.defaults,q||{}),this.id=ar(),this.manager=null,this.options.enable=pt(this.options.enable,!0),this.state=Ye,this.simultaneous={},this.requireFail=[]}Ge.prototype={defaults:{},set:function(q){return X(this.options,q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(q){if(A(q,"recognizeWith",this))return this;var Q=this.simultaneous;return q=Vn(q,this),Q[q.id]||(Q[q.id]=q,q.recognizeWith(this)),this},dropRecognizeWith:function(q){return A(q,"dropRecognizeWith",this)?this:(q=Vn(q,this),delete this.simultaneous[q.id],this)},requireFailure:function(q){if(A(q,"requireFailure",this))return this;var Q=this.requireFail;return q=Vn(q,this),ee(Q,q)===-1&&(Q.push(q),q.requireFailure(this)),this},dropRequireFailure:function(q){if(A(q,"dropRequireFailure",this))return this;q=Vn(q,this);var Q=ee(this.requireFail,q);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(q){return!!this.simultaneous[q.id]},emit:function(q){var Q=this,dt=this.state;function Et(jt){Q.manager.emit(jt,q)}dt<Ze&&Et(Q.options.event+Rr(dt)),Et(Q.options.event),q.additionalEvent&&Et(q.additionalEvent),dt>=Ze&&Et(Q.options.event+Rr(dt))},tryEmit:function(q){if(this.canEmit())return this.emit(q);this.state=De},canEmit:function(){for(var q=0;q<this.requireFail.length;){if(!(this.requireFail[q].state&(De|Ye)))return!1;q++}return!0},recognize:function(q){var Q=X({},q);if(!st(this.options.enable,[this,Q])){this.reset(),this.state=De;return}this.state&(gn|on|De)&&(this.state=Ye),this.state=this.process(Q),this.state&(ze|Xn|Ze|on)&&this.tryEmit(Q)},process:function(q){},getTouchAction:function(){},reset:function(){}};function Rr(q){return q&on?"cancel":q&Ze?"end":q&Xn?"move":q&ze?"start":""}function ws(q){return q==lr?"down":q==yi?"up":q==Un?"left":q==Ve?"right":""}function Vn(q,Q){var dt=Q.manager;return dt?dt.get(q):q}function Cn(){Ge.apply(this,arguments)}H(Cn,Ge,{defaults:{pointers:1},attrTest:function(q){var Q=this.options.pointers;return Q===0||q.pointers.length===Q},process:function(q){var Q=this.state,dt=q.eventType,Et=Q&(ze|Xn),jt=this.attrTest(q);return Et&&(dt&dn||!jt)?Q|on:Et||jt?dt&Se?Q|Ze:Q&ze?Q|Xn:ze:De}});function Ts(){Cn.apply(this,arguments),this.pX=null,this.pY=null}H(Ts,Cn,{defaults:{event:"pan",threshold:10,pointers:1,direction:vi},getTouchAction:function(){var q=this.options.direction,Q=[];return q&Zn&&Q.push(Re),q&fo&&Q.push(Zt),Q},directionTest:function(q){var Q=this.options,dt=!0,Et=q.distance,jt=q.direction,pe=q.deltaX,tn=q.deltaY;return jt&Q.direction||(Q.direction&Zn?(jt=pe===0?jr:pe<0?Un:Ve,dt=pe!=this.pX,Et=Math.abs(q.deltaX)):(jt=tn===0?jr:tn<0?yi:lr,dt=tn!=this.pY,Et=Math.abs(q.deltaY))),q.direction=jt,dt&&Et>Q.threshold&&jt&Q.direction},attrTest:function(q){return Cn.prototype.attrTest.call(this,q)&&(this.state&ze||!(this.state&ze)&&this.directionTest(q))},emit:function(q){this.pX=q.deltaX,this.pY=q.deltaY;var Q=ws(q.direction);Q&&(q.additionalEvent=this.options.event+Q),this._super.emit.call(this,q)}});function $o(){Cn.apply(this,arguments)}H($o,Cn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ht]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.scale-1)>this.options.threshold||this.state&ze)},emit:function(q){if(q.scale!==1){var Q=q.scale<1?"in":"out";q.additionalEvent=this.options.event+Q}this._super.emit.call(this,q)}});function In(){Ge.apply(this,arguments),this._timer=null,this._input=null}H(In,Ge,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Lt]},process:function(q){var Q=this.options,dt=q.pointers.length===Q.pointers,Et=q.distance<Q.threshold,jt=q.deltaTime>Q.time;if(this._input=q,!Et||!dt||q.eventType&(Se|dn)&&!jt)this.reset();else if(q.eventType&Oe)this.reset(),this._timer=P(function(){this.state=gn,this.tryEmit()},Q.time,this);else if(q.eventType&Se)return gn;return De},reset:function(){clearTimeout(this._timer)},emit:function(q){this.state===gn&&(q&&q.eventType&Se?this.manager.emit(this.options.event+"up",q):(this._input.timeStamp=w(),this.manager.emit(this.options.event,this._input)))}});function Yo(){Cn.apply(this,arguments)}H(Yo,Cn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ht]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.rotation)>this.options.threshold||this.state&ze)}});function vr(){Cn.apply(this,arguments)}H(vr,Cn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Zn|fo,pointers:1},getTouchAction:function(){return Ts.prototype.getTouchAction.call(this)},attrTest:function(q){var Q=this.options.direction,dt;return Q&(Zn|fo)?dt=q.overallVelocity:Q&Zn?dt=q.overallVelocityX:Q&fo&&(dt=q.overallVelocityY),this._super.attrTest.call(this,q)&&Q&q.offsetDirection&&q.distance>this.options.threshold&&q.maxPointers==this.options.pointers&&_(dt)>this.options.velocity&&q.eventType&Se},emit:function(q){var Q=ws(q.offsetDirection);Q&&this.manager.emit(this.options.event+Q,q),this.manager.emit(this.options.event,q)}});function jn(){Ge.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}H(jn,Ge,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Qt]},process:function(q){var Q=this.options,dt=q.pointers.length===Q.pointers,Et=q.distance<Q.threshold,jt=q.deltaTime<Q.time;if(this.reset(),q.eventType&Oe&&this.count===0)return this.failTimeout();if(Et&&jt&&dt){if(q.eventType!=Se)return this.failTimeout();var pe=this.pTime?q.timeStamp-this.pTime<Q.interval:!0,tn=!this.pCenter||po(this.pCenter,q.center)<Q.posThreshold;this.pTime=q.timeStamp,this.pCenter=q.center,!tn||!pe?this.count=1:this.count+=1,this._input=q;var nr=this.count%Q.taps;if(nr===0)return this.hasRequireFailures()?(this._timer=P(function(){this.state=gn,this.tryEmit()},Q.interval,this),ze):gn}return De},failTimeout:function(){return this._timer=P(function(){this.state=De},this.options.interval,this),De},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function er(q,Q){return Q=Q||{},Q.recognizers=pt(Q.recognizers,er.defaults.preset),new Wr(q,Q)}er.VERSION="2.0.7",er.defaults={domEvents:!1,touchAction:ie,enable:!0,inputTarget:null,inputClass:null,preset:[[Yo,{enable:!1}],[$o,{enable:!1},["rotate"]],[vr,{direction:Zn}],[Ts,{direction:Zn},["swipe"]],[jn],[jn,{event:"doubletap",taps:2},["tap"]],[In]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var wn=1,bi=2;function Wr(q,Q){this.options=X({},er.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=q,this.input=ys(this),this.touchAction=new We(this,this.options.touchAction),pu(this,!0),M(this.options.recognizers,function(dt){var Et=this.add(new dt[0](dt[1]));dt[2]&&Et.recognizeWith(dt[2]),dt[3]&&Et.requireFailure(dt[3])},this)}Wr.prototype={set:function(q){return X(this.options,q),q.touchAction&&this.touchAction.update(),q.inputTarget&&(this.input.destroy(),this.input.target=q.inputTarget,this.input.init()),this},stop:function(q){this.session.stopped=q?bi:wn},recognize:function(q){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults(q);var dt,Et=this.recognizers,jt=Q.curRecognizer;(!jt||jt&&jt.state&gn)&&(jt=Q.curRecognizer=null);for(var pe=0;pe<Et.length;)dt=Et[pe],Q.stopped!==bi&&(!jt||dt==jt||dt.canRecognizeWith(jt))?dt.recognize(q):dt.reset(),!jt&&dt.state&(ze|Xn|Ze)&&(jt=Q.curRecognizer=dt),pe++}},get:function(q){if(q instanceof Ge)return q;for(var Q=this.recognizers,dt=0;dt<Q.length;dt++)if(Q[dt].options.event==q)return Q[dt];return null},add:function(q){if(A(q,"add",this))return this;var Q=this.get(q.options.event);return Q&&this.remove(Q),this.recognizers.push(q),q.manager=this,this.touchAction.update(),q},remove:function(q){if(A(q,"remove",this))return this;if(q=this.get(q),q){var Q=this.recognizers,dt=ee(Q,q);dt!==-1&&(Q.splice(dt,1),this.touchAction.update())}return this},on:function(q,Q){if(q!==o&&Q!==o){var dt=this.handlers;return M(qt(q),function(Et){dt[Et]=dt[Et]||[],dt[Et].push(Q)}),this}},off:function(q,Q){if(q!==o){var dt=this.handlers;return M(qt(q),function(Et){Q?dt[Et]&&dt[Et].splice(ee(dt[Et],Q),1):delete dt[Et]}),this}},emit:function(q,Q){this.options.domEvents&&wi(q,Q);var dt=this.handlers[q]&&this.handlers[q].slice();if(!(!dt||!dt.length)){Q.type=q,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Et=0;Et<dt.length;)dt[Et](Q),Et++}},destroy:function(){this.element&&pu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function pu(q,Q){var dt=q.element;if(dt.style){var Et;M(q.options.cssProps,function(jt,pe){Et=he(dt.style,pe),Q?(q.oldCssProps[Et]=dt.style[Et],dt.style[Et]=jt):dt.style[Et]=q.oldCssProps[Et]||""}),Q||(q.oldCssProps={})}}function wi(q,Q){var dt=n.createEvent("Event");dt.initEvent(q,!0,!0),dt.gesture=Q,Q.target.dispatchEvent(dt)}X(er,{INPUT_START:Oe,INPUT_MOVE:an,INPUT_END:Se,INPUT_CANCEL:dn,STATE_POSSIBLE:Ye,STATE_BEGAN:ze,STATE_CHANGED:Xn,STATE_ENDED:Ze,STATE_RECOGNIZED:gn,STATE_CANCELLED:on,STATE_FAILED:De,DIRECTION_NONE:jr,DIRECTION_LEFT:Un,DIRECTION_RIGHT:Ve,DIRECTION_UP:yi,DIRECTION_DOWN:lr,DIRECTION_HORIZONTAL:Zn,DIRECTION_VERTICAL:fo,DIRECTION_ALL:vi,Manager:Wr,Input:yr,TouchAction:We,TouchInput:mt,MouseInput:Zo,PointerEventInput:Lo,TouchMouseInput:xt,SingleTouchInput:V,Recognizer:Ge,AttrRecognizer:Cn,Tap:jn,Pan:Ts,Swipe:vr,Pinch:$o,Rotate:Yo,Press:In,on:_t,off:Ot,each:M,merge:U,extend:B,assign:X,inherit:H,bindFn:tt,prefixed:he});var Ef=typeof t<"u"?t:typeof self<"u"?self:{};Ef.Hammer=er,typeof o=="function"&&o.amd?o(function(){return er}):e.exports?e.exports=er:t[r]=er})(window,document,"Hammer")})(nN);const rN=pc,Zs=F3({__proto__:null,default:rN},[pc]),MM=1,LM=2,c1=4,iN={mousedown:MM,mousemove:LM,mouseup:c1};function oN(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function sN(e){const t=e.prototype.handler;e.prototype.handler=function(r){const o=this.store;r.button>0&&r.type==="pointerdown"&&(oN(o,l=>l.pointerId===r.pointerId)||o.push(r)),t.call(this,r)}}function aN(e){e.prototype.handler=function(n){let r=iN[n.type];r&MM&&n.button>=0&&(this.pressed=!0),r&LM&&n.which===0&&(r=c1),this.pressed&&(r&c1&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}sN(pc.PointerEventInput);aN(pc.MouseInput);const lN=pc.Manager;class Hv{constructor(t,n,r){this.element=t,this.callback=n,this.options={enable:!0,...r}}}const uN=Zs?[[Zs.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Zs.Rotate,{enable:!1}],[Zs.Pinch,{enable:!1}],[Zs.Swipe,{enable:!1}],[Zs.Pan,{threshold:0,enable:!1}],[Zs.Press,{enable:!1}],[Zs.Tap,{event:"doubletap",taps:2,enable:!1}],[Zs.Tap,{event:"anytap",enable:!1}],[Zs.Tap,{enable:!1}]]:null,qS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},cN={doubletap:["tap"]},hN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Qb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},fN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ZS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},pN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Nh=typeof window<"u"?window:global;let h1=!1;try{const e={get passive(){return h1=!0,!0}};Nh.addEventListener("test",null,e),Nh.removeEventListener("test",null)}catch{h1=!1}const dN=pN.indexOf("firefox")!==-1,{WHEEL_EVENTS:mN}=Qb,XS="wheel",$S=4.000244140625,gN=40,yN=.25;class vN extends Hv{constructor(t,n,r){super(t,n,r),this.handleEvent=o=>{if(!this.options.enable)return;let l=o.deltaY;Nh.WheelEvent&&(dN&&o.deltaMode===Nh.WheelEvent.DOM_DELTA_PIXEL&&(l/=Nh.devicePixelRatio),o.deltaMode===Nh.WheelEvent.DOM_DELTA_LINE&&(l*=gN)),l!==0&&l%$S===0&&(l=Math.floor(l/$S)),o.shiftKey&&l&&(l=l*yN),this.callback({type:XS,center:{x:o.clientX,y:o.clientY},delta:-l,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(mN),this.events.forEach(o=>t.addEventListener(o,this.handleEvent,h1?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,n){t===XS&&(this.options.enable=n)}}const{MOUSE_EVENTS:_N}=Qb,YS="pointermove",KS="pointerover",JS="pointerout",QS="pointerenter",t2="pointerleave";class xN extends Hv{constructor(t,n,r){super(t,n,r),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(_N),this.events.forEach(l=>t.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,n){t===YS&&(this.enableMoveEvent=n),t===KS&&(this.enableOverEvent=n),t===JS&&(this.enableOutEvent=n),t===QS&&(this.enableEnterEvent=n),t===t2&&(this.enableLeaveEvent=n)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(KS,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(JS,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(QS,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(t2,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(YS,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,n){this.callback({type:t,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:bN}=Qb,e2="keydown",n2="keyup";class wN extends Hv{constructor(t,n,r){super(t,n,r),this.handleEvent=o=>{const l=o.target||o.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:e2,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:n2,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(bN),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,n){t===e2&&(this.enableDownEvent=n),t===n2&&(this.enableUpEvent=n)}}const r2="contextmenu";class TN extends Hv{constructor(t,n,r){super(t,n,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:r2,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,n){t===r2&&(this.options.enable=n)}}const f1=1,uv=2,p1=4,EN={pointerdown:f1,pointermove:uv,pointerup:p1,mousedown:f1,mousemove:uv,mouseup:p1},SN=1,PN=2,AN=3,CN=0,IN=1,MN=2,LN=1,kN=2,ON=4;function RN(e){const t=EN[e.srcEvent.type];if(!t)return null;const{buttons:n,button:r,which:o}=e.srcEvent;let l=!1,s=!1,p=!1;return t===p1||t===uv&&!Number.isFinite(n)?(l=o===SN,s=o===PN,p=o===AN):t===uv?(l=Boolean(n&LN),s=Boolean(n&ON),p=Boolean(n&kN)):t===f1&&(l=r===CN,s=r===IN,p=r===MN),{leftButton:l,middleButton:s,rightButton:p}}function zN(e,t){const n=e.center;if(!n)return null;const r=t.getBoundingClientRect(),o=r.width/t.offsetWidth||1,l=r.height/t.offsetHeight||1,s={x:(n.x-r.left-t.clientLeft)/o,y:(n.y-r.top-t.clientTop)/l};return{center:n,offsetCenter:s}}const g0={srcElement:"root",priority:0};class DN{constructor(t){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,n,r,o=!1,l=!1){const{handlers:s,handlersByElement:p}=this;let g=g0;typeof r=="string"||r&&r.addEventListener?g={...g0,srcElement:r}:r&&(g={...g0,...r});let _=p.get(g.srcElement);_||(_=[],p.set(g.srcElement,_));const w={type:t,handler:n,srcElement:g.srcElement,priority:g.priority};o&&(w.once=!0),l&&(w.passive=!0),s.push(w),this._active=this._active||!w.passive;let P=_.length-1;for(;P>=0&&!(_[P].priority>=w.priority);)P--;_.splice(P+1,0,w)}remove(t,n){const{handlers:r,handlersByElement:o}=this;for(let l=r.length-1;l>=0;l--){const s=r[l];if(s.type===t&&s.handler===n){r.splice(l,1);const p=o.get(s.srcElement);p.splice(p.indexOf(s),1),p.length===0&&o.delete(s.srcElement)}}this._active=r.some(l=>!l.passive)}_emit(t,n){const r=this.handlersByElement.get(n);if(r){let o=!1;const l=()=>{t.handled=!0},s=()=>{t.handled=!0,o=!0},p=[];for(let g=0;g<r.length;g++){const{type:_,handler:w,once:P}=r[g];if(w({...t,type:_,stopPropagation:l,stopImmediatePropagation:s}),P&&p.push(r[g]),o)break}for(let g=0;g<p.length;g++){const{type:_,handler:w}=p[g];this.remove(_,w)}}}_normalizeEvent(t){const n=this.eventManager.getElement();return{...t,...RN(t),...zN(t,n),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const FN={events:null,recognizers:null,recognizerOptions:{},Manager:lN,touchAction:"none",tabIndex:0};class kM{constructor(t=null,n){this._onBasicInput=o=>{const{srcEvent:l}=o,s=hN[l.type];s&&this.manager.emit(s,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...FN,...n},this.events=new Map,this.setElement(t);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:n}=this,r=n.Manager;this.manager=new r(t,{touchAction:n.touchAction,recognizers:n.recognizers||uN}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(qS).forEach(o=>{const l=this.manager.get(o);l&&qS[o].forEach(s=>{l.recognizeWith(s)})});for(const o in n.recognizerOptions){const l=this.manager.get(o);if(l){const s=n.recognizerOptions[o];delete s.enable,l.set(s)}}this.wheelInput=new vN(t,this._onOtherEvent,{enable:!1}),this.moveInput=new xN(t,this._onOtherEvent,{enable:!1}),this.keyInput=new wN(t,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new TN(t,this._onOtherEvent,{enable:!1});for(const[o,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(o,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,n,r){this._addEventHandler(t,n,r,!1)}once(t,n,r){this._addEventHandler(t,n,r,!0)}watch(t,n,r){this._addEventHandler(t,n,r,!1,!0)}off(t,n){this._removeEventHandler(t,n)}_toggleRecognizer(t,n){const{manager:r}=this;if(!r)return;const o=r.get(t);if(o&&o.options.enable!==n){o.set({enable:n});const l=cN[t];l&&!this.options.recognizers&&l.forEach(s=>{const p=r.get(s);n?(p.requireFailure(t),o.dropRequireFailure(s)):p.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,n),this.moveInput.enableEventType(t,n),this.keyInput.enableEventType(t,n),this.contextmenuInput.enableEventType(t,n)}_addEventHandler(t,n,r,o,l){if(typeof t!="string"){r=n;for(const w in t)this._addEventHandler(w,t[w],r,o,l);return}const{manager:s,events:p}=this,g=ZS[t]||t;let _=p.get(g);_||(_=new DN(this),p.set(g,_),_.recognizerName=fN[g]||g,s&&s.on(g,_.handleEvent)),_.add(t,n,r,o,l),_.isEmpty()||this._toggleRecognizer(_.recognizerName,!0)}_removeEventHandler(t,n){if(typeof t!="string"){for(const s in t)this._removeEventHandler(s,t[s]);return}const{events:r}=this,o=ZS[t]||t,l=r.get(o);if(l&&(l.remove(t,n),l.isEmpty())){const{recognizerName:s}=l;let p=!1;for(const g of r.values())if(g.recognizerName===s&&!g.isEmpty()){p=!0;break}p||this._toggleRecognizer(s,!1)}}}function i2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Gi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var ju={transitionDuration:0},Xa={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new Yp,transitionInterruption:Jp.BREAK},wg=300,Tg=function(t){return 1-(1-t)*(1-t)},xh={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},OM=function(){function e(){var t=this;lu(this,e),L(this,"events",[]),L(this,"scrollZoom",!0),L(this,"dragPan",!0),L(this,"dragRotate",!0),L(this,"doubleClickZoom",!0),L(this,"touchZoom",!0),L(this,"touchRotate",!1),L(this,"keyboard",!0),L(this,"_interactionState",{isDragging:!1}),L(this,"_events",{}),L(this,"_setInteractionState",function(n){Object.assign(t._interactionState,n),t.onStateChange&&t.onStateChange(t._interactionState)}),L(this,"_onTransition",function(n,r){t.onViewportChange(n,t._interactionState,r)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new Jb({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return uu(e,[{key:"handleEvent",value:function(n){this.mapState=this.getMapState();var r=this._eventStartBlocked;switch(n.type){case"panstart":return r?!1:this._onPanStart(n);case"panmove":return this._onPan(n);case"panend":return this._onPanEnd(n);case"pinchstart":return r?!1:this._onPinchStart(n);case"pinchmove":return this._onPinch(n);case"pinchend":return this._onPinchEnd(n);case"tripanstart":return r?!1:this._onTriplePanStart(n);case"tripanmove":return this._onTriplePan(n);case"tripanend":return this._onTriplePanEnd(n);case"doubletap":return this._onDoubleTap(n);case"wheel":return this._onWheel(n);case"keydown":return this._onKeyDown(n);default:return!1}}},{key:"getCenter",value:function(n){var r=n.offsetCenter,o=r.x,l=r.y;return[o,l]}},{key:"isFunctionKeyPressed",value:function(n){var r=n.srcEvent;return Boolean(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}},{key:"blockEvents",value:function(n){var r=this,o=setTimeout(function(){r._eventStartBlocked===o&&(r._eventStartBlocked=null)},n);this._eventStartBlocked=o}},{key:"updateViewport",value:function(n,r,o){var l=this.mapState instanceof Jh?this.mapState.getViewportProps():this.mapState,s=Gi(Gi({},n.getViewportProps()),r),p=Object.keys(s).some(function(g){return l[g]!==s[g]});this._state=n.getState(),this._setInteractionState(o),p&&this.onViewportChange(s,this._interactionState,l)}},{key:"getMapState",value:function(n){return new Jh(Gi(Gi(Gi({},this.mapStateProps),this._state),n))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(n){var r=n.onViewportChange,o=n.onStateChange,l=n.eventManager,s=l===void 0?this.eventManager:l,p=n.isInteractive,g=p===void 0?!0:p,_=n.scrollZoom,w=_===void 0?this.scrollZoom:_,P=n.dragPan,A=P===void 0?this.dragPan:P,M=n.dragRotate,F=M===void 0?this.dragRotate:M,X=n.doubleClickZoom,B=X===void 0?this.doubleClickZoom:X,U=n.touchZoom,H=U===void 0?this.touchZoom:U,tt=n.touchRotate,st=tt===void 0?this.touchRotate:tt,pt=n.keyboard,_t=pt===void 0?this.keyboard:pt;this.onViewportChange=r,this.onStateChange=o;var Ot=this.mapStateProps||{},Dt=Ot.height!==n.height||Ot.width!==n.width;this.mapStateProps=n,Dt&&(this.mapState=Ot,this.updateViewport(new Jh(n))),this._transitionManager.processViewportChange(n),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(xh.WHEEL,g&&Boolean(w)),this.toggleEvents(xh.PAN,g&&Boolean(A||F)),this.toggleEvents(xh.PINCH,g&&Boolean(H||st)),this.toggleEvents(xh.TRIPLE_PAN,g&&Boolean(st)),this.toggleEvents(xh.DOUBLE_TAP,g&&Boolean(B)),this.toggleEvents(xh.KEYBOARD,g&&Boolean(_t)),this.scrollZoom=w,this.dragPan=A,this.dragRotate=F,this.doubleClickZoom=B,this.touchZoom=H,this.touchRotate=st,this.keyboard=_t}},{key:"toggleEvents",value:function(n,r){var o=this;this.eventManager&&n.forEach(function(l){o._events[l]!==r&&(o._events[l]=r,r?o.eventManager.on(l,o.handleEvent):o.eventManager.off(l,o.handleEvent))})}},{key:"_onPanStart",value:function(n){var r=this.getCenter(n);this._panRotate=this.isFunctionKeyPressed(n)||n.rightButton;var o=this._panRotate?this.mapState.rotateStart({pos:r}):this.mapState.panStart({pos:r});return this.updateViewport(o,ju,{isDragging:!0}),!0}},{key:"_onPan",value:function(n){return this.isDragging()?this._panRotate?this._onPanRotate(n):this._onPanMove(n):!1}},{key:"_onPanEnd",value:function(n){return this.isDragging()?this._panRotate?this._onPanRotateEnd(n):this._onPanMoveEnd(n):!1}},{key:"_onPanMove",value:function(n){if(!this.dragPan)return!1;var r=this.getCenter(n),o=this.mapState.pan({pos:r});return this.updateViewport(o,ju,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(n){if(this.dragPan){var r=this.dragPan.inertia,o=r===void 0?wg:r;if(o&&n.velocity){var l=this.getCenter(n),s=[l[0]+n.velocityX*o/2,l[1]+n.velocityY*o/2],p=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(p,Gi(Gi({},Xa),{},{transitionDuration:o,transitionEasing:Tg}),{isDragging:!1,isPanning:!0}),!0}}var g=this.mapState.panEnd();return this.updateViewport(g,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(n){if(!this.dragRotate)return!1;var r=this.getCenter(n),o=this.mapState.rotate({pos:r});return this.updateViewport(o,ju,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(n){if(this.dragRotate){var r=this.dragRotate.inertia,o=r===void 0?wg:r;if(o&&n.velocity){var l=this.getCenter(n),s=[l[0]+n.velocityX*o/2,l[1]+n.velocityY*o/2],p=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(p,Gi(Gi({},Xa),{},{transitionDuration:o,transitionEasing:Tg}),{isDragging:!1,isRotating:!0}),!0}}var g=this.mapState.panEnd();return this.updateViewport(g,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(n){if(!this.scrollZoom)return!1;var r=this.scrollZoom,o=r.speed,l=o===void 0?.01:o,s=r.smooth,p=s===void 0?!1:s;n.preventDefault();var g=this.getCenter(n),_=n.delta,w=2/(1+Math.exp(-Math.abs(_*l)));_<0&&w!==0&&(w=1/w);var P=this.mapState.zoom({pos:g,scale:w});return P.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(P,Gi(Gi({},Xa),{},{transitionInterpolator:new Yp({around:g}),transitionDuration:p?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(n){var r=this.getCenter(n),o=this.mapState.zoomStart({pos:r}).rotateStart({pos:r});return this._startPinchRotation=n.rotation,this._lastPinchEvent=n,this.updateViewport(o,ju,{isDragging:!0}),!0}},{key:"_onPinch",value:function(n){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var r=this.mapState;if(this.touchZoom){var o=n.scale,l=this.getCenter(n);r=r.zoom({pos:l,scale:o})}if(this.touchRotate){var s=n.rotation;r=r.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(r,ju,{isDragging:!0,isPanning:Boolean(this.touchZoom),isZooming:Boolean(this.touchZoom),isRotating:Boolean(this.touchRotate)}),this._lastPinchEvent=n,!0}},{key:"_onPinchEnd",value:function(n){if(!this.isDragging())return!1;if(this.touchZoom){var r=this.touchZoom.inertia,o=r===void 0?wg:r,l=this._lastPinchEvent;if(o&&l&&n.scale!==l.scale){var s=this.getCenter(n),p=this.mapState.rotateEnd(),g=Math.log2(n.scale),_=(g-Math.log2(l.scale))/(n.deltaTime-l.deltaTime),w=Math.pow(2,g+_*o/2);return p=p.zoom({pos:s,scale:w}).zoomEnd(),this.updateViewport(p,Gi(Gi({},Xa),{},{transitionInterpolator:new Yp({around:s}),transitionDuration:o,transitionEasing:Tg}),{isDragging:!1,isPanning:Boolean(this.touchZoom),isZooming:Boolean(this.touchZoom),isRotating:!1}),this.blockEvents(o),!0}}var P=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(P,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(n){var r=this.getCenter(n),o=this.mapState.rotateStart({pos:r});return this.updateViewport(o,ju,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(n){if(!this.isDragging()||!this.touchRotate)return!1;var r=this.getCenter(n);r[0]-=n.deltaX;var o=this.mapState.rotate({pos:r});return this.updateViewport(o,ju,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(n){if(!this.isDragging())return!1;if(this.touchRotate){var r=this.touchRotate.inertia,o=r===void 0?wg:r;if(o&&n.velocityY){var l=this.getCenter(n),s=[l[0],l[1]+=n.velocityY*o/2],p=this.mapState.rotate({pos:s});return this.updateViewport(p,Gi(Gi({},Xa),{},{transitionDuration:o,transitionEasing:Tg}),{isDragging:!1,isRotating:!0}),this.blockEvents(o),!1}}var g=this.mapState.rotateEnd();return this.updateViewport(g,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(n){if(!this.doubleClickZoom)return!1;var r=this.getCenter(n),o=this.isFunctionKeyPressed(n),l=this.mapState.zoom({pos:r,scale:o?.5:2});return this.updateViewport(l,Object.assign({},Xa,{transitionInterpolator:new Yp({around:r})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(n){if(!this.keyboard)return!1;var r=this.isFunctionKeyPressed(n),o=this.keyboard,l=o.zoomSpeed,s=l===void 0?2:l,p=o.moveSpeed,g=p===void 0?100:p,_=o.rotateSpeedX,w=_===void 0?15:_,P=o.rotateSpeedY,A=P===void 0?10:P,M=this.mapStateProps,F;switch(n.srcEvent.keyCode){case 189:r?F=this.getMapState({zoom:M.zoom-Math.log2(s)-1}):F=this.getMapState({zoom:M.zoom-Math.log2(s)});break;case 187:r?F=this.getMapState({zoom:M.zoom+Math.log2(s)+1}):F=this.getMapState({zoom:M.zoom+Math.log2(s)});break;case 37:r?F=this.getMapState({bearing:M.bearing-w}):F=this.mapState.pan({pos:[g,0],startPos:[0,0]});break;case 39:r?F=this.getMapState({bearing:M.bearing+w}):F=this.mapState.pan({pos:[-g,0],startPos:[0,0]});break;case 38:r?F=this.getMapState({pitch:M.pitch+A}):F=this.mapState.pan({pos:[0,g],startPos:[0,0]});break;case 40:r?F=this.getMapState({pitch:M.pitch-A}):F=this.mapState.pan({pos:[0,-g],startPos:[0,0]});break;default:return!1}return this.updateViewport(F,Xa)}}]),e}();function o2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Va(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var NN=Object.assign({},cl.propTypes,{maxZoom:Tt.number,minZoom:Tt.number,maxPitch:Tt.number,minPitch:Tt.number,onViewStateChange:Tt.func,onViewportChange:Tt.func,onInteractionStateChange:Tt.func,transitionDuration:Tt.oneOfType([Tt.number,Tt.string]),transitionInterpolator:Tt.object,transitionInterruption:Tt.number,transitionEasing:Tt.func,onTransitionStart:Tt.func,onTransitionInterrupt:Tt.func,onTransitionEnd:Tt.func,scrollZoom:Tt.oneOfType([Tt.bool,Tt.object]),dragPan:Tt.oneOfType([Tt.bool,Tt.object]),dragRotate:Tt.oneOfType([Tt.bool,Tt.object]),doubleClickZoom:Tt.bool,touchZoom:Tt.oneOfType([Tt.bool,Tt.object]),touchRotate:Tt.oneOfType([Tt.bool,Tt.object]),keyboard:Tt.oneOfType([Tt.bool,Tt.object]),onHover:Tt.func,onClick:Tt.func,onDblClick:Tt.func,onContextMenu:Tt.func,onMouseDown:Tt.func,onMouseMove:Tt.func,onMouseUp:Tt.func,onTouchStart:Tt.func,onTouchMove:Tt.func,onTouchEnd:Tt.func,onMouseEnter:Tt.func,onMouseLeave:Tt.func,onMouseOut:Tt.func,onWheel:Tt.func,touchAction:Tt.string,eventRecognizerOptions:Tt.object,clickRadius:Tt.number,interactiveLayerIds:Tt.array,getCursor:Tt.func,controller:Tt.instanceOf(OM)}),BN=function(t){var n=t.isDragging,r=t.isHovering;return n?"grabbing":r?"pointer":"grab"},UN=Object.assign({},cl.defaultProps,ec,Jb.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(t){return t.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:BN});function tw(e){if(e.lngLat||!e.offsetCenter)return e;var t=e.offsetCenter,n=t.x,r=t.y;if(!Number.isFinite(n)||!Number.isFinite(r))return e;var o=[n,r];return e.point=o,e.lngLat=this.viewport.unproject(o),e}function RM(e){var t=this.map;if(!t||!e)return null;var n={},r=this.props.clickRadius;this.props.interactiveLayerIds&&(n.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(r?[[e[0]-r,e[1]+r],[e[0]+r,e[1]-r]]:e,n)}catch{return null}}function el(e,t){var n=this.props[e];n&&n(tw.call(this,t))}function VN(e){el.call(this,e.pointerType==="touch"?"onTouchStart":"onMouseDown",e)}function jN(e){el.call(this,e.pointerType==="touch"?"onTouchEnd":"onMouseUp",e)}function GN(e){if(el.call(this,e.pointerType==="touch"?"onTouchMove":"onMouseMove",e),!this.state.isDragging){var t=this.props,n=t.onHover,r=t.interactiveLayerIds,o;e=tw.call(this,e),(r||n)&&(o=RM.call(this,e.point));var l=Boolean(r&&o&&o.length>0),s=l&&!this.state.isHovering,p=!l&&this.state.isHovering;(n||s)&&(e.features=o,n&&n(e)),s&&el.call(this,"onMouseEnter",e),p&&el.call(this,"onMouseLeave",e),(s||p)&&this.setState({isHovering:l})}}function s2(e){var t=this.props,n=t.onClick,r=t.onNativeClick,o=t.onDblClick,l=t.doubleClickZoom,s=[],p=o||l;switch(e.type){case"anyclick":s.push(r),p||s.push(n);break;case"click":p&&s.push(n);break}s=s.filter(Boolean),s.length&&(e=tw.call(this,e),e.features=RM.call(this,e.point),s.forEach(function(g){return g(e)}))}function WN(e){return{getMap:e.current&&e.current.getMap,queryRenderedFeatures:e.current&&e.current.queryRenderedFeatures}}var ew=Rt.forwardRef(function(e,t){var n=Rt.useContext(Tc),r=Rt.useMemo(function(){return e.controller||new OM},[]),o=Rt.useMemo(function(){return new kM(null,{touchAction:e.touchAction,recognizerOptions:e.eventRecognizerOptions})},[]),l=Rt.useRef(null),s=Rt.useRef(null),p=Rt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),g=p.current;g.props=e,g.map=s.current&&s.current.getMap(),g.setState=function(_t){g.state=Va(Va({},g.state),_t),l.current.style.cursor=e.getCursor(g.state)};var _=!0,w,P,A=function(Ot,Dt,kt){if(_){w=[Ot,Dt,kt];return}var qt=g.props,ee=qt.onViewStateChange,_e=qt.onViewportChange;ee&&ee({viewState:Ot,interactionState:Dt,oldViewState:kt}),_e&&_e(Ot,Dt,kt)};Rt.useImperativeHandle(t,function(){return WN(s)},[]);var M=Rt.useMemo(function(){return Va(Va({},n),{},{eventManager:o,container:n.container||l.current})},[n,l.current]);M.onViewportChange=A,M.viewport=n.viewport||CM(g),g.viewport=M.viewport;var F=function(Ot){var Dt=Ot.isDragging,kt=Dt===void 0?!1:Dt;if(kt!==g.state.isDragging&&g.setState({isDragging:kt}),_){P=Ot;return}var qt=g.props.onInteractionStateChange;qt&&qt(Ot)},X=function(){g.width&&g.height&&r.setOptions(Va(Va(Va({},g.props),g.props.viewState),{},{isInteractive:Boolean(g.props.onViewStateChange||g.props.onViewportChange),onViewportChange:A,onStateChange:F,eventManager:o,width:g.width,height:g.height}))},B=function(Ot){var Dt=Ot.width,kt=Ot.height;g.width=Dt,g.height=kt,X(),g.props.onResize({width:Dt,height:kt})};Rt.useEffect(function(){return o.setElement(l.current),o.on({pointerdown:VN.bind(g),pointermove:GN.bind(g),pointerup:jN.bind(g),pointerleave:el.bind(g,"onMouseOut"),click:s2.bind(g),anyclick:s2.bind(g),dblclick:el.bind(g,"onDblClick"),wheel:el.bind(g,"onWheel"),contextmenu:el.bind(g,"onContextMenu")}),function(){o.destroy()}},[]),a1(function(){w&&A.apply(void 0,tD(w)),P&&F(P)}),X();var U=e.width,H=e.height,tt=e.style,st=e.getCursor,pt=Rt.useMemo(function(){return Va(Va({position:"relative"},tt),{},{width:U,height:H,cursor:st(g.state)})},[tt,U,H,st,g.state]);return(!w||!g._child)&&(g._child=Rt.createElement($b,{value:M},Rt.createElement("div",{key:"event-canvas",ref:l,style:pt},Rt.createElement(cl,nv({},e,{width:"100%",height:"100%",style:null,onResize:B,ref:s}))))),_=!1,g._child});ew.supported=cl.supported;ew.propTypes=NN;ew.defaultProps=UN;Tt.string.isRequired,Tt.string;var HN=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];Tt.oneOf(HN).isRequired,Tt.string,Tt.string,Tt.string;var cu={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},ms={captureScroll:Tt.bool,captureDrag:Tt.bool,captureClick:Tt.bool,captureDoubleClick:Tt.bool,capturePointerMove:Tt.bool};function qN(e){var t=e.containerRef.current,n=e.context.eventManager;if(!(!t||!n)){var r={wheel:function(l){var s=e.props;s.captureScroll&&l.stopPropagation(),s.onScroll&&s.onScroll(l,e)},panstart:function(l){var s=e.props;s.captureDrag&&l.stopPropagation(),s.onDragStart&&s.onDragStart(l,e)},anyclick:function(l){var s=e.props;s.captureClick&&l.stopPropagation(),s.onNativeClick&&s.onNativeClick(l,e)},click:function(l){var s=e.props;s.captureClick&&l.stopPropagation(),s.onClick&&s.onClick(l,e)},dblclick:function(l){var s=e.props;s.captureDoubleClick&&l.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(l,e)},pointermove:function(l){var s=e.props;s.capturePointerMove&&l.stopPropagation(),s.onPointerMove&&s.onPointerMove(l,e)}};return n.watch(r,t),function(){n.off(r)}}}function hu(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Rt.useContext(Tc),n=Rt.useRef(null),r=Rt.useRef({props:e,state:{},context:t,containerRef:n}),o=r.current;return o.props=e,o.context=t,Rt.useEffect(function(){return qN(o)},[t.eventManager]),o}function ZN(e){var t=XN();return function(){var r=iu(e),o;if(t){var l=iu(this).constructor;o=Reflect.construct(r,arguments,l)}else o=r.apply(this,arguments);return Kb(this,o)}}function XN(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function $N(e){var t=e.instance,n=hu(e),r=n.context,o=n.containerRef;return t._context=r,t._containerRef=o,t._render()}var zM=function(e){Yb(n,e);var t=ZN(n);function n(){var r;lu(this,n);for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];return r=t.call.apply(t,[this].concat(l)),L(Za(r),"_context",{}),L(Za(r),"_containerRef",Rt.createRef()),L(Za(r),"_onScroll",function(p){}),L(Za(r),"_onDragStart",function(p){}),L(Za(r),"_onDblClick",function(p){}),L(Za(r),"_onClick",function(p){}),L(Za(r),"_onPointerMove",function(p){}),r}return uu(n,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Rt.createElement($N,nv({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),n}(Rt.PureComponent);L(zM,"propTypes",ms);L(zM,"defaultProps",cu);function a2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function l2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?a2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var YN=Object.assign({},ms,{draggable:Tt.bool,onDrag:Tt.func,onDragEnd:Tt.func,onDragStart:Tt.func,offsetLeft:Tt.number,offsetTop:Tt.number}),KN=Object.assign({},cu,{draggable:!1,offsetLeft:0,offsetTop:0});function DM(e){var t=e.offsetCenter,n=t.x,r=t.y;return[n,r]}function JN(e,t){var n=e.center,r=n.x,o=n.y;if(t){var l=t.getBoundingClientRect();return[l.left-r,l.top-o]}return null}function nw(e,t,n,r){var o=e[0]+t[0]-n.offsetLeft,l=e[1]+t[1]-n.offsetTop;return r.viewport.unproject([o,l])}function QN(e,t){var n=t.props,r=t.callbacks,o=t.state,l=t.context,s=t.containerRef,p=n.draggable;if(p){e.stopPropagation();var g=DM(e),_=JN(e,s.current);if(o.setDragPos(g),o.setDragOffset(_),r.onDragStart&&_){var w=Object.assign({},e);w.lngLat=nw(g,_,n,l),r.onDragStart(w)}}}function tB(e,t){var n=t.props,r=t.callbacks,o=t.state,l=t.context;e.stopPropagation();var s=DM(e);o.setDragPos(s);var p=o.dragOffset;if(r.onDrag&&p){var g=Object.assign({},e);g.lngLat=nw(s,p,n,l),r.onDrag(g)}}function eB(e,t){var n=t.props,r=t.callbacks,o=t.state,l=t.context;e.stopPropagation();var s=o.dragPos,p=o.dragOffset;if(o.setDragPos(null),o.setDragOffset(null),r.onDragEnd&&s&&p){var g=Object.assign({},e);g.lngLat=nw(s,p,n,l),r.onDragEnd(g)}}function nB(e,t){var n=t.state;e.stopPropagation(),n.setDragPos(null),n.setDragOffset(null)}function rB(e){var t=e.context.eventManager;if(!(!t||!e.state.dragPos)){var n={panmove:function(o){return tB(o,e)},panend:function(o){return eB(o,e)},pancancel:function(o){return nB(o,e)}};return t.watch(n),function(){t.off(n)}}}function iB(e){var t=Rt.useState(null),n=Br(t,2),r=n[0],o=n[1],l=Rt.useState(null),s=Br(l,2),p=s[0],g=s[1],_=hu(l2(l2({},e),{},{onDragStart:QN}));return _.callbacks=e,_.state.dragPos=r,_.state.setDragPos=o,_.state.dragOffset=p,_.state.setDragOffset=g,Rt.useEffect(function(){return rB(_)},[_.context.eventManager,Boolean(r)]),_}var u2=typeof window<"u"&&window.devicePixelRatio||1,yd=function(t){return Math.round(t*u2)/u2},c2=function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(t===null)return n;var o=r==="x"?t.offsetWidth:t.offsetHeight;return yd(n/100*o)/o*100};function h2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function oB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?h2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var sB=Object.assign({},YN,{className:Tt.string,longitude:Tt.number.isRequired,latitude:Tt.number.isRequired,style:Tt.object}),aB=Object.assign({},KN,{className:""});function lB(e){var t=e.props,n=e.state,r=e.context,o=t.longitude,l=t.latitude,s=t.offsetLeft,p=t.offsetTop,g=n.dragPos,_=n.dragOffset;if(g&&_)return[g[0]+_[0],g[1]+_[1]];var w=r.viewport.project([o,l]),P=Br(w,2),A=P[0],M=P[1];return A+=s,M+=p,[A,M]}function rw(e){var t=iB(e),n=t.state,r=t.containerRef,o=e.children,l=e.className,s=e.draggable,p=e.style,g=n.dragPos,_=lB(t),w=Br(_,2),P=w[0],A=w[1],M="translate(".concat(yd(P),"px, ").concat(yd(A),"px)"),F=s?g?"grabbing":"grab":"auto",X=Rt.useMemo(function(){var U=oB({position:"absolute",left:0,top:0,transform:M,cursor:F},p);return Rt.createElement("div",{className:"mapboxgl-marker ".concat(l),ref:t.containerRef,style:U},o)},[o,l]),B=r.current;return B&&(B.style.transform=M,B.style.cursor=F),X}rw.defaultProps=aB;rw.propTypes=sB;Rt.memo(rw);var vd={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},uB=Object.keys(vd);function cB(e){var t=e.x,n=e.y,r=e.width,o=e.height,l=e.selfWidth,s=e.selfHeight,p=e.anchor,g=e.padding,_=g===void 0?0:g,w=vd[p],P=w.x,A=w.y,M=n-A*s,F=M+s,X=Math.max(0,_-M)+Math.max(0,F-o+_);if(X>0){var B=A,U=X;for(A=0;A<=1;A+=.5)M=n-A*s,F=M+s,X=Math.max(0,_-M)+Math.max(0,F-o+_),X<U&&(U=X,B=A);A=B}var H=.5;A===.5&&(P=Math.floor(P),H=1);var tt=t-P*l,st=tt+l,pt=Math.max(0,_-tt)+Math.max(0,st-r+_);if(pt>0){var _t=P,Ot=pt;for(P=0;P<=1;P+=H)tt=t-P*l,st=tt+l,pt=Math.max(0,_-tt)+Math.max(0,st-r+_),pt<Ot&&(Ot=pt,_t=P);P=_t}return uB.find(function(Dt){var kt=vd[Dt];return kt.x===P&&kt.y===A})||p}var hB=Object.assign({},ms,{className:Tt.string,longitude:Tt.number.isRequired,latitude:Tt.number.isRequired,altitude:Tt.number,offsetLeft:Tt.number,offsetTop:Tt.number,tipSize:Tt.number,closeButton:Tt.bool,closeOnClick:Tt.bool,anchor:Tt.oneOf(Object.keys(vd)),dynamicPosition:Tt.bool,sortByDepth:Tt.bool,onClose:Tt.func}),fB=Object.assign({},cu,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function pB(e,t,n,r){var o=Br(r,2),l=o[0],s=o[1],p=e.anchor,g=e.dynamicPosition,_=e.tipSize;return n&&g?cB({x:l,y:s,anchor:p,padding:_,width:t.width,height:t.height,selfWidth:n.clientWidth,selfHeight:n.clientHeight}):p}function dB(e,t,n,r,o){var l=Br(r,3),s=l[0],p=l[1],g=l[2],_=e.offsetLeft,w=e.offsetTop,P=e.sortByDepth,A=vd[o],M=s+_,F=p+w,X=c2(n,-A.x*100),B=c2(n,-A.y*100,"y"),U={position:"absolute",transform:`
      translate(`.concat(X,"%, ").concat(B,`%)
      translate(`).concat(yd(M),"px, ").concat(yd(F),`px)
    `),display:void 0,zIndex:void 0};return P&&(g>1||g<-1||s<0||s>t.width||p<0||p>t.height?U.display="none":U.zIndex=Math.floor((1-g)/2*1e5)),U}function iw(e){var t=Rt.useRef(null),n=hu(e),r=n.context,o=n.containerRef,l=Rt.useState(!1),s=Br(l,2),p=s[1];Rt.useEffect(function(){p(!0)},[t.current]),Rt.useEffect(function(){if(r.eventManager&&e.closeOnClick){var st=function(){return n.props.onClose()};return r.eventManager.on("anyclick",st),function(){r.eventManager.off("anyclick",st)}}},[r.eventManager,e.closeOnClick]);var g=r.viewport,_=e.className,w=e.longitude,P=e.latitude,A=e.altitude,M=e.tipSize,F=e.closeButton,X=e.children,B=g.project([w,P,A]),U=pB(e,g,t.current,B),H=dB(e,g,o.current,B,U),tt=Rt.useCallback(function(st){n.props.onClose();var pt=n.context.eventManager;pt&&pt.once("click",function(_t){return _t.stopPropagation()},st.target)},[]);return Rt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(U," ").concat(_),style:H,ref:o},Rt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:M}}),Rt.createElement("div",{key:"content",ref:t,className:"mapboxgl-popup-content"},F&&Rt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:tt},"×"),X))}iw.propTypes=hB;iw.defaultProps=fB;Rt.memo(iw);function f2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function mB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var gB=Object.assign({},ms,{toggleLabel:Tt.string,className:Tt.string,style:Tt.object,compact:Tt.bool,customAttribution:Tt.oneOfType([Tt.string,Tt.arrayOf(Tt.string)])}),yB=Object.assign({},cu,{className:"",toggleLabel:"Toggle Attribution"});function vB(e,t,n,r){var o=new aa.AttributionControl(e);return o._map=t,o._container=n,o._innerContainer=r,o._updateAttributions(),o._updateEditLink(),t.on("styledata",o._updateData),t.on("sourcedata",o._updateData),o}function _B(e){e._map.off("styledata",e._updateData),e._map.off("sourcedata",e._updateData)}function ow(e){var t=hu(e),n=t.context,r=t.containerRef,o=Rt.useRef(null),l=Rt.useState(!1),s=Br(l,2),p=s[0],g=s[1];Rt.useEffect(function(){var A;return n.map&&(A=vB({customAttribution:e.customAttribution},n.map,r.current,o.current)),function(){return A&&_B(A)}},[n.map]);var _=e.compact===void 0?n.viewport.width<=640:e.compact;Rt.useEffect(function(){!_&&p&&g(!1)},[_]);var w=Rt.useCallback(function(){return g(function(A){return!A})},[]),P=Rt.useMemo(function(){return mB({position:"absolute"},e.style)},[e.style]);return Rt.createElement("div",{style:P,className:e.className},Rt.createElement("div",{ref:r,"aria-pressed":p,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(_?"mapboxgl-compact":""," ").concat(p?"mapboxgl-compact-show":"")},Rt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:e.toggleLabel,onClick:w}),Rt.createElement("div",{ref:o,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}ow.propTypes=gB;ow.defaultProps=yB;Rt.memo(ow);function p2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var bB=Object.assign({},ms,{className:Tt.string,style:Tt.object,container:Tt.object,label:Tt.string}),wB=Object.assign({},cu,{className:"",container:null,label:"Toggle fullscreen"});function sw(e){var t=hu(e),n=t.context,r=t.containerRef,o=Rt.useState(!1),l=Br(o,2),s=l[0],p=l[1],g=Rt.useState(!1),_=Br(g,2),w=_[0],P=_[1],A=Rt.useState(null),M=Br(A,2),F=M[0],X=M[1];Rt.useEffect(function(){var pt=new aa.FullscreenControl;X(pt),P(pt._checkFullscreenSupport());var _t=function(){var Dt=!pt._fullscreen;pt._fullscreen=Dt,p(Dt)};return Ka.addEventListener(pt._fullscreenchange,_t),function(){Ka.removeEventListener(pt._fullscreenchange,_t)}},[]);var B=function(){F&&(F._container=e.container||n.container,F._onClickFullscreen())},U=Rt.useMemo(function(){return xB({position:"absolute"},e.style)},[e.style]);if(!w)return null;var H=e.className,tt=e.label,st=s?"shrink":"fullscreen";return Rt.createElement("div",{style:U,className:H},Rt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},Rt.createElement("button",{key:st,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(st),type:"button",title:tt,onClick:B},Rt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}sw.propTypes=bB;sw.defaultProps=wB;Rt.memo(sw);var bh;function TB(){return bh!==void 0?Promise.resolve(bh):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(e){return bh=e.state!=="denied",bh}):(bh=Boolean(window.navigator.geolocation),Promise.resolve(bh))}function d2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function EB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var m2=function(){},SB=Object.assign({},ms,{className:Tt.string,style:Tt.object,label:Tt.string,disabledLabel:Tt.string,auto:Tt.bool,positionOptions:Tt.object,fitBoundsOptions:Tt.object,trackUserLocation:Tt.bool,showUserLocation:Tt.bool,showAccuracyCircle:Tt.bool,showUserHeading:Tt.bool,onViewStateChange:Tt.func,onViewportChange:Tt.func,onGeolocate:Tt.func}),PB=Object.assign({},cu,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function AB(e){var t=new aa.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=t.toBounds(n);return[[r._ne.lng,r._ne.lat],[r._sw.lng,r._sw.lat]]}function CB(e,t,n){var r=new aa.GeolocateControl(t);r._container=Ka.createElement("div"),r._map={on:function(){},_getUIString:function(){return""}},r._setupUI(!0),r._map=e.map,r._geolocateButton=n;var o=e.eventManager;return r.options.trackUserLocation&&o&&o.on("panstart",function(){r._watchState==="ACTIVE_LOCK"&&(r._watchState="BACKGROUND",n.classList.add("mapboxgl-ctrl-geolocate-background"),n.classList.remove("mapboxgl-ctrl-geolocate-active"))}),r.on("geolocate",t.onGeolocate),r}function IB(e,t){var n=t.context,r=t.props,o=AB(e),l=n.viewport.fitBounds(o,r.fitBoundsOptions),s=l.longitude,p=l.latitude,g=l.zoom,_=Object.assign({},n.viewport,{longitude:s,latitude:p,zoom:g}),w=new Jh(_),P=Object.assign({},w.getViewportProps(),Xa),A=r.onViewportChange||n.onViewportChange||m2,M=r.onViewStateChange||n.onViewStateChange||m2;M({viewState:P}),A(P)}function aw(e){var t=hu(e),n=t.context,r=t.containerRef,o=Rt.useRef(null),l=Rt.useState(null),s=Br(l,2),p=s[0],g=s[1],_=Rt.useState(!1),w=Br(_,2),P=w[0],A=w[1];Rt.useEffect(function(){var tt;return n.map&&TB().then(function(st){A(st),o.current&&(tt=CB(n,e,o.current),tt._updateCamera=function(pt){return IB(pt,t)},g(tt))}),function(){tt&&tt._clearWatch()}},[n.map]);var M=Rt.useCallback(function(){p&&(p.options=t.props,p.trigger())},[p]);Rt.useEffect(function(){e.auto&&M()},[p,e.auto]),Rt.useEffect(function(){p&&p._onZoom()},[n.viewport.zoom]);var F=e.className,X=e.label,B=e.disabledLabel,U=e.trackUserLocation,H=Rt.useMemo(function(){return EB({position:"absolute"},e.style)},[e.style]);return Rt.createElement("div",{style:H,className:F},Rt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},Rt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:o,disabled:!P,"aria-pressed":!U,type:"button",title:P?X:B,"aria-label":P?X:B,onClick:M},Rt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}aw.propTypes=SB;aw.defaultProps=PB;Rt.memo(aw);function MB(e,t){for(var n=(e||"").split(".").map(Number),r=(t||"").split(".").map(Number),o=0;o<3;o++){var l=n[o]||0,s=r[o]||0;if(l<s)return-1;if(l>s)return 1}return 0}function g2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function LB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var y2=function(){},kB=Object.assign({},ms,{className:Tt.string,style:Tt.object,onViewStateChange:Tt.func,onViewportChange:Tt.func,showCompass:Tt.bool,showZoom:Tt.bool,zoomInLabel:Tt.string,zoomOutLabel:Tt.string,compassLabel:Tt.string}),OB=Object.assign({},cu,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),RB=1,d1=2;function zB(e){return MB(e,"1.6.0")>=0?d1:RB}function y0(e,t,n){var r=e.viewport,o=new Jh(Object.assign({},r,n)),l=Object.assign({},o.getViewportProps(),Xa),s=t.onViewportChange||e.onViewportChange||y2,p=t.onViewStateChange||e.onViewStateChange||y2;p({viewState:l}),s(l)}function v0(e,t,n,r){return Rt.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:n},r||Rt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function DB(e){var t=Rt.useMemo(function(){return e.map?zB(e.map.version):d1},[e.map]),n=e.viewport.bearing,r={transform:"rotate(".concat(-n,"deg)")};return t===d1?Rt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:r}):Rt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:r})}function lw(e){var t=hu(e),n=t.context,r=t.containerRef,o=function(){y0(n,e,{zoom:n.viewport.zoom+1})},l=function(){y0(n,e,{zoom:n.viewport.zoom-1})},s=function(){y0(n,e,{bearing:0,pitch:0})},p=e.className,g=e.showCompass,_=e.showZoom,w=e.zoomInLabel,P=e.zoomOutLabel,A=e.compassLabel,M=Rt.useMemo(function(){return LB({position:"absolute"},e.style)},[e.style]);return Rt.createElement("div",{style:M,className:p},Rt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},_&&v0("zoom-in",w,o),_&&v0("zoom-out",P,l),g&&v0("compass",A,s,DB(n))))}lw.propTypes=kB;lw.defaultProps=OB;const FB=Rt.memo(lw);function v2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function NB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v2(Object(n),!0).forEach(function(r){L(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var BB=Object.assign({},ms,{className:Tt.string,style:Tt.object,maxWidth:Tt.number,unit:Tt.oneOf(["imperial","metric","nautical"])}),UB=Object.assign({},cu,{className:"",maxWidth:100,unit:"metric"});function uw(e){var t=hu(e),n=t.context,r=t.containerRef,o=Rt.useState(null),l=Br(o,2),s=l[0],p=l[1];Rt.useEffect(function(){if(n.map){var _=new aa.ScaleControl;_._map=n.map,_._container=r.current,p(_)}},[n.map]),s&&(s.options=e,s._onMove&&s._onMove());var g=Rt.useMemo(function(){return NB({position:"absolute"},e.style)},[e.style]);return Rt.createElement("div",{style:g,className:e.className},Rt.createElement("div",{ref:r,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}uw.propTypes=BB;uw.defaultProps=UB;Rt.memo(uw);Object.assign({},ms,{redraw:Tt.func.isRequired});Object.assign({},ms,{redraw:Tt.func.isRequired,style:Tt.object});Object.assign({},ms,{redraw:Tt.func.isRequired,style:Tt.object});aa&&aa.setRTLTextPlugin;function cv(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const cw=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),_2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_2&&parseFloat(_2[1]);const VB="3.2.13";function sl(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const gy=typeof process!="object"||String(process)!=="[object process]"||process.browser,jB=typeof window<"u"&&typeof window.orientation<"u",x2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);x2&&parseFloat(x2[1]);class GB{constructor(t,n){L(this,"name",void 0),L(this,"workerThread",void 0),L(this,"isRunning",!0),L(this,"result",void 0),L(this,"_resolve",()=>{}),L(this,"_reject",()=>{}),this.name=t,this.workerThread=n,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}done(t){sl(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){sl(this.isRunning),this.isRunning=!1,this._reject(t)}}let _0=class{};const x0=new Map;function WB(e){sl(e.source&&!e.url||!e.source&&e.url);let t=x0.get(e.source||e.url);return t||(e.url&&(t=HB(e.url),x0.set(e.url,t)),e.source&&(t=FM(e.source),x0.set(e.source,t))),sl(t),t}function HB(e){if(!e.startsWith("http"))return e;const t=qB(e);return FM(t)}function FM(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function qB(e){return`try {
  importScripts('`.concat(e,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function NM(e,t=!0,n){const r=n||new Set;if(e){if(b2(e))r.add(e);else if(b2(e.buffer))r.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const o in e)NM(e[o],t,r)}}return n===void 0?Array.from(r):[]}function b2(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const b0=()=>{};class m1{static isSupported(){return typeof Worker<"u"&&gy||typeof _0<"u"&&!gy}constructor(t){L(this,"name",void 0),L(this,"source",void 0),L(this,"url",void 0),L(this,"terminated",!1),L(this,"worker",void 0),L(this,"onMessage",void 0),L(this,"onError",void 0),L(this,"_loadableURL","");const{name:n,source:r,url:o}=t;sl(r||o),this.name=n,this.source=r,this.url=o,this.onMessage=b0,this.onError=l=>console.log(l),this.worker=gy?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=b0,this.onError=b0,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,n){n=n||NM(t),this.worker.postMessage(t,n)}_getErrorFromErrorEvent(t){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(n+="".concat(t.message," in ")),t.lineno&&(n+=":".concat(t.lineno,":").concat(t.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=WB({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},t.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},t.onmessageerror=n=>console.error(n),t}_createNodeWorker(){let t;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new _0(r,{eval:!1})}else if(this.source)t=new _0(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",n=>{this.onMessage(n)}),t.on("error",n=>{this.onError(n)}),t.on("exit",n=>{}),t}}class ZB{static isSupported(){return m1.isSupported()}constructor(t){L(this,"name","unnamed"),L(this,"source",void 0),L(this,"url",void 0),L(this,"maxConcurrency",1),L(this,"maxMobileConcurrency",1),L(this,"onDebug",()=>{}),L(this,"reuseWorkers",!0),L(this,"props",{}),L(this,"jobQueue",[]),L(this,"idleQueue",[]),L(this,"count",0),L(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,n=(o,l,s)=>o.done(s),r=(o,l)=>o.error(l)){const o=new Promise(l=>(this.jobQueue.push({name:t,onMessage:n,onError:r,onStart:l}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length});const r=new GB(n.name,t);t.onMessage=o=>n.onMessage(r,o.type,o.payload),t.onError=o=>n.onError(r,o),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new m1({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return jB?this.maxMobileConcurrency:this.maxConcurrency}}const XB={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ja{static isSupported(){return m1.isSupported()}static getWorkerFarm(t={}){return Ja._workerFarm=Ja._workerFarm||new Ja({}),Ja._workerFarm.setProps(t),Ja._workerFarm}constructor(t){L(this,"props",void 0),L(this,"workerPools",new Map),this.props={...XB},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:n,source:r,url:o}=t;let l=this.workerPools.get(n);return l||(l=new ZB({name:n,source:r,url:o}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}L(Ja,"_workerFarm",void 0);const $B="latest";function YB(e,t={}){const n=t[e.id]||{},r="".concat(e.id,"-worker.js");let o=n.workerUrl;if(!o&&e.id==="compression"&&(o=t.workerUrl),t._workerType==="test"&&(o="modules/".concat(e.module,"/dist/").concat(r)),!o){let l=e.version;l==="latest"&&(l=$B);const s=l?"@".concat(l):"";o="https://unpkg.com/@loaders.gl/".concat(e.module).concat(s,"/dist/").concat(r)}return sl(o),o}function KB(e,t=VB){sl(e,"no worker provided");const n=e.version;return!(!t||!n)}function JB(e,t){return!Ja.isSupported()||!gy&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function QB(e,t,n,r,o){const l=e.id,s=YB(e,n),g=Ja.getWorkerFarm(n).getWorkerPool({name:l,url:s});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const _=await g.startJob("process-on-worker",t4.bind(null,o));return _.postMessage("process",{input:t,options:n,context:r}),await(await _.result).result}async function t4(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:o,input:l,options:s}=r;try{const p=await e(l,s);t.postMessage("done",{id:o,result:p})}catch(p){const g=p instanceof Error?p.message:"unknown error";t.postMessage("error",{id:o,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function BM(e){return e&&typeof e=="object"&&e.isBuffer}function e4(e){return BM(e)?new Uint8Array(e.buffer,e.byteOffset,e.length).slice().buffer:e}function UM(e){if(BM(e))return e4(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function n4(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),o=new Uint8Array(t);for(let l=0;l<r.length;++l)if(r[l]!==o[l])return!1;return!0}function r4(...e){const t=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),n=t.reduce((l,s)=>l+s.byteLength,0),r=new Uint8Array(n);let o=0;for(const l of t)r.set(l,o),o+=l.byteLength;return r.buffer}async function i4(e){const t=[];for await(const n of e)t.push(n);return r4(...t)}function w2(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class T2{constructor(t,n){L(this,"name",void 0),L(this,"type",void 0),L(this,"sampleSize",1),L(this,"time",void 0),L(this,"count",void 0),L(this,"samples",void 0),L(this,"lastTiming",void 0),L(this,"lastSampleTime",void 0),L(this,"lastSampleCount",void 0),L(this,"_count",0),L(this,"_time",0),L(this,"_samples",0),L(this,"_startTime",0),L(this,"_timerPending",!1),this.name=t,this.type=n,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=w2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(w2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class qv{constructor(t){L(this,"id",void 0),L(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const n in this.stats)t(this.stats[n])}getTable(){const t={};return this.forEach(n=>{t[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(t){if(!t||!t.name)return null;const{name:n,type:r}=t;return this.stats[n]||(t instanceof T2?this.stats[n]=t:this.stats[n]=new T2(n,r)),this.stats[n]}}const o4="Queued Requests",s4="Active Requests",a4="Cancelled Requests",l4="Queued Requests Ever",u4="Active Requests Ever",c4={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class h4{constructor(t={}){L(this,"props",void 0),L(this,"stats",void 0),L(this,"activeRequestCount",0),L(this,"requestQueue",[]),L(this,"requestMap",new Map),L(this,"deferredUpdate",null),this.props={...c4,...t},this.stats=new qv({id:this.props.id}),this.stats.get(o4),this.stats.get(s4),this.stats.get(a4),this.stats.get(l4),this.stats.get(u4)}scheduleRequest(t,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:n},o=new Promise(l=>(r.resolve=l,r));return this.requestQueue.push(r),this.requestMap.set(t,o),this._issueNewRequests(),o}_issueRequest(t){const{handle:n,resolve:r}=t;let o=!1;const l=()=>{o||(o=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:l}):Promise.resolve({done:l})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let n=0;n<t;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const t=this.requestQueue;for(let n=0;n<t.length;++n){const r=t[n];this._updateRequest(r)||(t.splice(n,1),this.requestMap.delete(r.handle),n--)}t.sort((n,r)=>n.priority-r.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let f4="";const E2={};function p4(e){for(const t in E2)if(e.startsWith(t)){const n=E2[t];e=e.replace(t,n)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e="".concat(f4).concat(e)),e}function d4(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}const m4=e=>typeof e=="boolean",Qp=e=>typeof e=="function",Vd=e=>e!==null&&typeof e=="object",S2=e=>Vd(e)&&e.constructor==={}.constructor,g4=e=>e&&typeof e[Symbol.iterator]=="function",y4=e=>e&&typeof e[Symbol.asyncIterator]=="function",wf=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Tf=e=>typeof Blob<"u"&&e instanceof Blob,v4=e=>e&&typeof e=="object"&&e.isBuffer,_4=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Vd(e)&&Qp(e.tee)&&Qp(e.cancel)&&Qp(e.getReader),x4=e=>Vd(e)&&Qp(e.read)&&Qp(e.pipe)&&m4(e.readable),VM=e=>_4(e)||x4(e),b4=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,w4=/^([-\w.]+\/[-\w.+]+)/;function T4(e){const t=w4.exec(e);return t?t[1]:e}function P2(e){const t=b4.exec(e);return t?t[1]:""}const E4=/\?.*/;function Zv(e){if(wf(e)){const t=w0(e.url||""),n=e.headers.get("content-type")||"";return{url:t,type:T4(n)||P2(t)}}return Tf(e)?{url:w0(e.name||""),type:e.type||""}:typeof e=="string"?{url:w0(e),type:P2(e)}:{url:"",type:""}}function S4(e){return wf(e)?e.headers["content-length"]||-1:Tf(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function w0(e){return e.replace(E4,"")}async function jM(e){if(wf(e))return e;const t={},n=S4(e);n>=0&&(t["content-length"]=String(n));const{url:r,type:o}=Zv(e);o&&(t["content-type"]=o);const l=await C4(e);l&&(t["x-first-bytes"]=l),typeof e=="string"&&(e=new TextEncoder().encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:r}),s}async function P4(e){if(!e.ok){const t=await A4(e);throw new Error(t)}}async function A4(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const n=e.headers.get("Content-Type");let r=e.statusText;n.includes("application/json")&&(r+=" ".concat(await e.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function C4(e){if(typeof e=="string")return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const n=e.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=l=>{var s;return r(l==null||(s=l.target)===null||s===void 0?void 0:s.result)},o.readAsDataURL(n)})}if(e instanceof ArrayBuffer){const n=e.slice(0,5),r=I4(n);return"data:base64,".concat(r)}return null}function I4(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}async function A2(e,t){if(typeof e=="string"){e=p4(e);let n=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(n=t.fetch),await fetch(e,n)}return await jM(e)}function GM(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function hl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||GM()}const yy={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Eg=yy.window||yy.self||yy.global,Pp=yy.process||{},WM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";hl();const T0=globalThis;function HM(e){if(!e&&!hl())return"Node";if(GM(e))return"Electron";const n=e||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return r||o?"IE":T0.chrome?"Chrome":T0.safari?"Safari":T0.mozInnerScreenX?"Firefox":"Unknown"}function M4(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}class L4{constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";L(this,"storage",void 0),L(this,"id",void 0),L(this,"config",void 0),this.storage=M4(r),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}function k4(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function O4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function E0(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>r&&(n=Math.min(n,r/e.width));const l=e.width*n,s=e.height*n,p=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(l/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(o,");"),"background-size:".concat(l,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),p]}let hv;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(hv||(hv={}));function C2(e){return typeof e=="string"?hv[e.toUpperCase()]||hv.WHITE:e}function R4(e,t,n){return!hl&&typeof e=="string"&&(t&&(t=C2(t),e="\x1B[".concat(t,"m").concat(e,"\x1B[39m")),n&&(t=C2(n),e="\x1B[".concat(n+10,"m").concat(e,"\x1B[49m"))),e}function z4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n);for(const o of r)typeof e[o]=="function"&&(t.find(l=>o===l)||(e[o]=e[o].bind(e)))}function fv(e,t){if(!e)throw new Error(t||"Assertion failed")}function wh(){let e;if(hl&&"performance"in Eg){var t,n;e=Eg==null||(t=Eg.performance)===null||t===void 0||(n=t.now)===null||n===void 0?void 0:n.call(t)}else if("hrtime"in Pp){var r;const o=Pp==null||(r=Pp.hrtime)===null||r===void 0?void 0:r.call(Pp);e=o[0]*1e3+o[1]/1e6}else e=Date.now();return e}const Th={debug:hl&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},D4={enabled:!0,level:0};function No(){}const I2={},M2={once:!0};class jd{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};L(this,"id",void 0),L(this,"VERSION",WM),L(this,"_startTs",wh()),L(this,"_deltaTs",wh()),L(this,"_storage",void 0),L(this,"userData",{}),L(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new L4("__probe-".concat(this.id,"__"),D4),this.timeStamp("".concat(this.id," started")),z4(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wh()-this._startTs).toPrecision(10))}getDelta(){return Number((wh()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){fv(t,n)}warn(t){return this._getLogFunction(0,t,Th.warn,arguments,M2)}error(t){return this._getLogFunction(0,t,Th.error,arguments)}deprecated(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}probe(t,n){return this._getLogFunction(t,n,Th.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,Th.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),l=2;l<r;l++)o[l-2]=arguments[l];return this._getLogFunction(t,n,Th.debug||Th.info,arguments,M2)}table(t,n,r){return n?this._getLogFunction(t,n,console.table||No,r&&[r],{tag:U4(n)}):No}image(t){let{logLevel:n,priority:r,image:o,message:l="",scale:s=1}=t;return this._shouldLog(n||r)?hl?B4({image:o,message:l,scale:s}):N4():No}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||No)}group(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=L2({logLevel:t,message:n,opts:r}),{collapsed:l}=r;return o.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||No)}withGroup(t,n,r){this.group(t,n)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=qM(t)}_getLogFunction(t,n,r,o,l){if(this._shouldLog(t)){l=L2({logLevel:t,message:n,args:o,opts:l}),r=r||l.method,fv(r),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=wh();const s=l.tag||l.message;if(l.once)if(!I2[s])I2[s]=wh();else return No;return n=F4(this.id,l.message,l),r.bind(console,n,...l.args)}return No}}L(jd,"VERSION",WM);function qM(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return fv(Number.isFinite(t)&&t>=0),t}function L2(e){const{logLevel:t,message:n}=e;e.logLevel=qM(t);const r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const o=typeof e.message;return fv(o==="string"||o==="object"),Object.assign(e,{args:r},e.opts)}function F4(e,t,n){if(typeof t=="string"){const r=n.time?O4(k4(n.total)):"";t=n.time?"".concat(e,": ").concat(r,"  ").concat(t):"".concat(e,": ").concat(t),t=R4(t,n.color,n.background)}return t}function N4(e){return console.warn("removed"),No}function B4(e){let{image:t,message:n="",scale:r=1}=e;if(typeof t=="string"){const l=new Image;return l.onload=()=>{const s=E0(l,n,r);console.log(...s)},l.src=t,No}const o=t.nodeName||"";if(o.toLowerCase()==="img")return console.log(...E0(t,n,r)),No;if(o.toLowerCase()==="canvas"){const l=new Image;return l.onload=()=>console.log(...E0(l,n,r)),l.src=t.toDataURL(),No}return No}function U4(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const k2=new jd({id:"loaders.gl"});class V4{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class j4{constructor(){L(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const ZM={fetch:null,mimeType:void 0,nothrow:!1,log:new j4,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:cw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},G4={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function XM(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const $M=()=>{const e=XM();return e.globalOptions=e.globalOptions||{...ZM},e.globalOptions};function W4(e,t,n,r){return n=n||[],n=Array.isArray(n)?n:[n],H4(e,n),Z4(t,e,r)}function YM(e,t){const n=$M(),r=e||n;return typeof r.fetch=="function"?r.fetch:Vd(r.fetch)?o=>A2(o,r):t!=null&&t.fetch?t==null?void 0:t.fetch:A2}function H4(e,t){O2(e,null,ZM,G4,t);for(const n of t){const r=e&&e[n.id]||{},o=n.options&&n.options[n.id]||{},l=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};O2(r,n.id,o,l,t)}}function O2(e,t,n,r,o){const l=t||"Top level",s=t?"".concat(t,"."):"";for(const p in e){const g=!t&&Vd(e[p]),_=p==="baseUri"&&!t,w=p==="workerUrl"&&t;if(!(p in n)&&!_&&!w){if(p in r)k2.warn("".concat(l," loader option '").concat(s).concat(p,"' no longer supported, use '").concat(r[p],"'"))();else if(!g){const P=q4(p,o);k2.warn("".concat(l," loader option '").concat(s).concat(p,"' not recognized. ").concat(P))()}}}}function q4(e,t){const n=e.toLowerCase();let r="";for(const o of t)for(const l in o.options){if(e===l)return"Did you mean '".concat(o.id,".").concat(l,"'?");const s=l.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(r=r||"Did you mean '".concat(o.id,".").concat(l,"'?"))}return r}function Z4(e,t,n){const o={...e.options||{}};return X4(o,n),o.log===null&&(o.log=new V4),R2(o,$M()),R2(o,t),o}function R2(e,t){for(const n in t)if(n in t){const r=t[n];S2(r)&&S2(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function X4(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function hw(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function fw(e){var t,n;cv(e,"null loader"),cv(hw(e),"invalid loader");let r;return Array.isArray(e)&&(r=e[1],e=e[0],e={...e,options:{...e.options,...r}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(n=e)!==null&&n!==void 0&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const KM=()=>{const e=XM();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function $4(e){const t=KM();e=Array.isArray(e)?e:[e];for(const n of e){const r=fw(n);t.find(o=>r===o)||t.unshift(r)}}function Y4(){return KM()}const K4=new jd({id:"loaders.gl"}),J4=/\.([^.]+)$/;async function Q4(e,t=[],n,r){if(!JM(e))return null;let o=z2(e,t,{...n,nothrow:!0},r);if(o)return o;if(Tf(e)&&(e=await e.slice(0,10).arrayBuffer(),o=z2(e,t,n,r)),!o&&!(n!=null&&n.nothrow))throw new Error(QM(e));return o}function z2(e,t=[],n,r){if(!JM(e))return null;if(t&&!Array.isArray(t))return fw(t);let o=[];t&&(o=o.concat(t)),n!=null&&n.ignoreRegisteredLoaders||o.push(...Y4()),e5(o);const l=t5(e,o,n,r);if(!l&&!(n!=null&&n.nothrow))throw new Error(QM(e));return l}function t5(e,t,n,r){const{url:o,type:l}=Zv(e),s=o||(r==null?void 0:r.url);let p=null,g="";if(n!=null&&n.mimeType&&(p=S0(t,n==null?void 0:n.mimeType),g="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),p=p||n5(t,s),g=g||(p?"matched url ".concat(s):""),p=p||S0(t,l),g=g||(p?"matched MIME type ".concat(l):""),p=p||i5(t,e),g=g||(p?"matched initial data ".concat(tL(e)):""),p=p||S0(t,n==null?void 0:n.fallbackMimeType),g=g||(p?"matched fallback MIME type ".concat(l):""),g){var _;K4.log(1,"selectLoader selected ".concat((_=p)===null||_===void 0?void 0:_.name,": ").concat(g,"."))}return p}function JM(e){return!(e instanceof Response&&e.status===204)}function QM(e){const{url:t,type:n}=Zv(e);let r="No valid loader found (";r+=t?"".concat(d4(t),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=e?tL(e):"";return r+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",r+=")",r}function e5(e){for(const t of e)fw(t)}function n5(e,t){const n=t&&J4.exec(t),r=n&&n[1];return r?r5(e,r):null}function r5(e,t){t=t.toLowerCase();for(const n of e)for(const r of n.extensions)if(r.toLowerCase()===t)return n;return null}function S0(e,t){for(const n of e)if(n.mimeTypes&&n.mimeTypes.includes(t)||t==="application/x.".concat(n.id))return n;return null}function i5(e,t){if(!t)return null;for(const n of e)if(typeof t=="string"){if(o5(t,n))return n}else if(ArrayBuffer.isView(t)){if(D2(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&D2(t,0,n))return n;return null}function o5(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(r=>e.startsWith(r))}function D2(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>s5(e,t,n,o))}function s5(e,t,n,r){if(r instanceof ArrayBuffer)return n4(r,e,r.byteLength);switch(typeof r){case"function":return r(e,n);case"string":const o=g1(e,t,r.length);return r===o;default:return!1}}function tL(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?g1(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?g1(e,0,t):""}function g1(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let o="";for(let l=0;l<n;l++)o+=String.fromCharCode(r.getUint8(t+l));return o}const a5=256*1024;function*l5(e,t){const n=(t==null?void 0:t.chunkSize)||a5;let r=0;const o=new TextEncoder;for(;r<e.length;){const l=Math.min(e.length-r,n),s=e.slice(r,r+l);r+=l,yield o.encode(s)}}const u5=256*1024;function*c5(e,t={}){const{chunkSize:n=u5}=t;let r=0;for(;r<e.byteLength;){const o=Math.min(e.byteLength-r,n),l=new ArrayBuffer(o),s=new Uint8Array(e,r,o);new Uint8Array(l).set(s),r+=o,yield l}}const h5=1024*1024;async function*f5(e,t){const n=(t==null?void 0:t.chunkSize)||h5;let r=0;for(;r<e.size;){const o=r+n,l=await e.slice(r,o).arrayBuffer();r=o,yield l}}function F2(e,t){return cw?p5(e,t):d5(e)}async function*p5(e,t){const n=e.getReader();let r;try{for(;;){const o=r||n.read();t!=null&&t._streamReadAhead&&(r=n.read());const{done:l,value:s}=await o;if(l)return;yield UM(s)}}catch{n.releaseLock()}}async function*d5(e,t){for await(const n of e)yield UM(n)}function m5(e,t){if(typeof e=="string")return l5(e,t);if(e instanceof ArrayBuffer)return c5(e,t);if(Tf(e))return f5(e,t);if(VM(e))return F2(e,t);if(wf(e))return F2(e.body,t);throw new Error("makeIterator")}const eL="Cannot convert supplied data type";function g5(e,t,n){if(t.text&&typeof e=="string")return e;if(v4(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const o=e.byteLength||e.length;return(e.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(e.byteOffset,e.byteOffset+o)),r}throw new Error(eL)}async function y5(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||r)return g5(e,t);if(Tf(e)&&(e=await jM(e)),wf(e)){const o=e;return await P4(o),t.binary?await o.arrayBuffer():await o.text()}if(VM(e)&&(e=m5(e,n)),g4(e)||y4(e))return i4(e);throw new Error(eL)}function v5(e,t,n=null){if(n)return n;const r={fetch:YM(t,e),...e};return Array.isArray(r.loaders)||(r.loaders=null),r}function _5(e,t){if(!t&&e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const r=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function pw(e,t,n,r){sl(!r||typeof r=="object"),t&&!Array.isArray(t)&&!hw(t)&&(r=void 0,n=t,t=void 0),e=await e,n=n||{};const{url:o}=Zv(e),s=_5(t,r),p=await Q4(e,s,n);return p?(n=W4(n,p,s,o),r=v5({url:o,parse:pw,loaders:s},n,r),await x5(p,e,n,r)):null}async function x5(e,t,n,r){if(KB(e),wf(t)){const o=t,{ok:l,redirected:s,status:p,statusText:g,type:_,url:w}=o,P=Object.fromEntries(o.headers.entries());r.response={headers:P,ok:l,redirected:s,status:p,statusText:g,type:_,url:w}}if(t=await y5(t,e,n),e.parseTextSync&&typeof t=="string")return n.dataType="text",e.parseTextSync(t,n,r,e);if(JB(e,n))return await QB(e,t,n,r,pw);if(e.parseText&&typeof t=="string")return await e.parseText(t,n,r,e);if(e.parse)return await e.parse(t,n,r,e);throw sl(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}async function pv(e,t,n,r){!Array.isArray(t)&&!hw(t)&&(n=t,t=void 0);const o=YM(n);let l=e;return typeof e=="string"&&(l=await o(e)),Tf(e)&&(l=await o(e)),await pw(l,t,n)}const b5="3.2.13",{_parseImageNode:w5}=globalThis,y1=typeof Image<"u",v1=typeof ImageBitmap<"u",T5=Boolean(w5),_1=cw?!0:T5;function E5(e){switch(e){case"auto":return v1||y1||_1;case"imagebitmap":return v1;case"image":return y1;case"data":return _1;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}function S5(){if(v1)return"imagebitmap";if(y1)return"image";if(_1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function P5(e){const t=C5(e);if(!t)throw new Error("Not an image");return t}function A5(e){switch(P5(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function C5(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const I5=/^data:image\/svg\+xml/,M5=/\.svg((\?|#).*)?$/;function dw(e){return e&&(I5.test(e)||M5.test(e))}function L5(e,t){if(dw(t)){let r=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(l){throw new Error(l.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return nL(e,t)}function nL(e,t){if(dw(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function rL(e,t,n){const r=L5(e,n),o=self.URL||self.webkitURL,l=typeof r!="string"&&o.createObjectURL(r);try{return await k5(l||r,t)}finally{l&&o.revokeObjectURL(l)}}async function k5(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,o)=>{try{n.onload=()=>r(n),n.onerror=l=>o(new Error("Could not load image ".concat(e,": ").concat(l)))}catch(l){o(l)}})}const O5={};let N2=!0;async function R5(e,t,n){let r;dw(n)?r=await rL(e,t,n):r=nL(e,n);const o=t&&t.imagebitmap;return await z5(r,o)}async function z5(e,t=null){if((D5(t)||!N2)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),N2=!1}return await createImageBitmap(e)}function D5(e){for(const t in e||O5)return!1;return!0}const Ks=!1,td=!0;function iL(e){const t=Gd(e);return F5(t)||U5(t)||N5(t)||B5(t)}function F5(e){const t=Gd(e);return t.byteLength>=24&&t.getUint32(0,Ks)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ks),height:t.getUint32(20,Ks)}:null}function N5(e){const t=Gd(e);return t.byteLength>=10&&t.getUint32(0,Ks)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,td),height:t.getUint16(8,td)}:null}function B5(e){const t=Gd(e);return t.byteLength>=14&&t.getUint16(0,Ks)===16973&&t.getUint32(2,td)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,td),height:t.getUint32(22,td)}:null}function U5(e){const t=Gd(e);if(!(t.byteLength>=3&&t.getUint16(0,Ks)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=V5();let l=2;for(;l+9<t.byteLength;){const s=t.getUint16(l,Ks);if(o.has(s))return{mimeType:"image/jpeg",height:t.getUint16(l+5,Ks),width:t.getUint16(l+7,Ks)};if(!r.has(s))return null;l+=2,l+=t.getUint16(l,Ks)}return null}function V5(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Gd(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function j5(e,t){const{mimeType:n}=iL(e)||{},r=globalThis._parseImageNode;return cv(r),await r(e,n)}async function G5(e,t,n){t=t||{};const o=(t.image||{}).type||"auto",{url:l}=n||{},s=W5(o);let p;switch(s){case"imagebitmap":p=await R5(e,t,l);break;case"image":p=await rL(e,t,l);break;case"data":p=await j5(e);break;default:cv(!1)}return o==="data"&&(p=A5(p)),p}function W5(e){switch(e){case"auto":case"data":return S5();default:return E5(e),e}}const H5=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],q5=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Z5={image:{type:"auto",decode:!0}},oL={id:"image",module:"images",name:"Images",version:b5,mimeTypes:q5,extensions:H5,parse:G5,tests:[e=>Boolean(iL(new DataView(e)))],options:Z5},cn=new jd({id:"deck"});let x1={};function X5(e){x1=e}function Ri(e,t,n,r){cn.level>0&&x1[e]&&x1[e].call(null,t,n,r)}function $5(e){const t=e[0],n=e[e.length-1];return t==="{"&&n==="}"||t==="["&&n==="]"}const Y5={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:$5,parseTextSync:JSON.parse},ed="8.8.23",vy=globalThis.deck&&globalThis.deck.VERSION;if(vy&&vy!==ed)throw new Error("deck.gl - multiple versions detected: ".concat(vy," vs ").concat(ed));vy||(cn.log(1,"deck.gl ".concat(ed))(),globalThis.deck={...globalThis.deck,VERSION:ed,version:ed,log:cn,_registerLoggers:X5},$4([Y5,[oL,{imagebitmap:{premultiplyAlpha:"none"}}]]));const K5=globalThis.deck,ke=new jd({id:"luma.gl"});function Wi(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const J5="Invalid WebGLRenderingContext",Q5="Requires WebGL2";function Xv(e){return typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&Number.isFinite(e._version))}function pn(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function t6(e){return pn(e)?e:null}function $v(e){return Wi(Xv(e),J5),e}function Di(e){return Wi(pn(e),Q5),e}const Bp={};function e6(e){globalThis.console&&globalThis.console.error&&globalThis.console.error(e)}function n6(e){globalThis.console&&globalThis.console.log&&globalThis.console.log(e)}function r6(e,t){Bp[e]=!0,t!==void 0&&e6(t)}function i6(e){const t=e.getError;e.getError=function(){let r;do r=t.apply(e),r!==0&&(Bp[r]=!0);while(r!==0);for(r in Bp)if(Bp[r])return delete Bp[r],parseInt(r,10);return 0}}const Wd=function e(t){const n=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const o=new e.VertexAttrib(n);this.attribs[r]=o}this.maxAttrib=0};Wd.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Wd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Ec=function(t){const n=this;this.gl=t,i6(t);const r=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(l){return l===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(l){const s=n.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,l);const p=s.attribs[l];return p.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(l){const s=n.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,l);const p=s.attribs[l];return p.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(l,s){switch(l){case 34962:n.currentArrayBuffer=s;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=s;break}return r.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(l,s){const g=n.currentVertexArrayObject.attribs[l];switch(s){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(l,s,p,g,_,w){const P=n.currentVertexArrayObject;P.maxAttrib=Math.max(P.maxAttrib,l);const A=P.attribs[l];return A.buffer=n.currentArrayBuffer,A.size=s,A.type=p,A.normalized=g,A.stride=_,A.offset=w,A.recache(),r.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{n6("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Ec.prototype.VERTEX_ARRAY_BINDING_OES=34229;Ec.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Wd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Ec.prototype.createVertexArrayOES=function(){const t=new Wd(this);return this.vertexArrayObjects.push(t),t};Ec.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)};Ec.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof Wd&&t.hasBeenBound&&t.ext===this)};Ec.prototype.bindVertexArrayOES=function(t){const n=this.gl;if(t&&!t.isAlive){r6(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const l=this.currentVertexArrayObject;if(o===l)return;(!o||l.elementArrayBuffer!==o.elementArrayBuffer)&&r.bindBuffer.call(n,34963,l.elementArrayBuffer);let s=this.currentArrayBuffer;const p=Math.max(o?o.maxAttrib:0,l.maxAttrib);for(let g=0;g<=p;g++){const _=l.attribs[g],w=o?o.attribs[g]:null;if((!o||_.enabled!==w.enabled)&&(_.enabled?r.enableVertexAttribArray.call(n,g):r.disableVertexAttribArray.call(n,g)),_.enabled){let P=!1;(!o||_.buffer!==w.buffer)&&(s!==_.buffer&&(r.bindBuffer.call(n,34962,_.buffer),s=_.buffer),P=!0),(P||_.cached!==w.cached)&&r.vertexAttribPointer.call(n,g,_.size,_.type,_.normalized,_.stride,_.offset)}}this.currentArrayBuffer!==s&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function o6(e){if(typeof e.createVertexArray=="function")return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const o=t.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=e.getExtension;e.getExtension=function(o){const l=n.call(this,o);return l||(o!=="OES_vertex_array_object"?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Ec(this)),this.__OESVertexArrayObject))}}const B2="OES_element_index",U2="WEBGL_draw_buffers",s6="EXT_disjoint_timer_query",a6="EXT_disjoint_timer_query_webgl2",l6="EXT_texture_filter_anisotropic",V2="WEBGL_debug_renderer_info",u6=35723,c6=4352,h6=36795,f6=34047,p6=37445,d6=37446,qn=e=>pn(e)?void 0:0,m6={[3074]:e=>pn(e)?void 0:36064,[u6]:e=>pn(e)?void 0:c6,[35977]:qn,[32937]:qn,[h6]:(e,t)=>{const n=pn(e)?e.getExtension(a6):e.getExtension(s6);return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0},[p6]:(e,t)=>{const n=e.getExtension(V2);return t(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[d6]:(e,t)=>{const n=e.getExtension(V2);return t(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[f6]:(e,t)=>{const n=e.luma.extensions[l6];return n?t(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:qn,[35071]:qn,[37447]:qn,[36063]:(e,t)=>{if(!pn(e)){const n=e.getExtension(U2);return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:qn,[35374]:qn,[35377]:qn,[34852]:e=>{if(!pn(e)){const t=e.getExtension(U2);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:e=>e.getExtension(B2)?2147483647:65535,[33001]:e=>e.getExtension(B2)?16777216:65535,[33e3]:e=>16777216,[37157]:qn,[35373]:qn,[35657]:qn,[36183]:qn,[37137]:qn,[34045]:qn,[35978]:qn,[35979]:qn,[35968]:qn,[35376]:qn,[35375]:qn,[35659]:qn,[37154]:qn,[35371]:qn,[35658]:qn,[35076]:qn,[35077]:qn,[35380]:qn};function g6(e,t,n){const r=m6[n],o=typeof r=="function"?r(e,t,n):r;return o!==void 0?o:t(n)}const y6="OES_vertex_array_object",sL="ANGLE_instanced_arrays",v6="WEBGL_draw_buffers",_6="EXT_disjoint_timer_query",x6="EXT_texture_filter_anisotropic",b6="VertexArray requires WebGL2 or OES_vertex_array_object extension";function w6(e,t){return{webgl2:pn(e),ext:e.getExtension(t)}}const aL={[y6]:{meta:{suffix:"OES"},createVertexArray:()=>{Wi(!1,b6)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[sL]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Wi(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[v6]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Wi(!1)}},[_6]:{meta:{suffix:"EXT"},createQuery:()=>{Wi(!1)},deleteQuery:()=>{Wi(!1)},beginQuery:()=>{Wi(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},P0={readBuffer:(e,t,n)=>{pn(e)&&t(n)},getVertexAttrib:(e,t,n,r)=>{const{webgl2:o,ext:l}=w6(e,sL);let s;switch(r){case 35069:s=o?void 0:!1;break;case 35070:s=!o&&!l?0:void 0;break}return s!==void 0?s:t(n,r)},getProgramParameter:(e,t,n,r)=>{if(!pn(e))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(n,r)},getInternalformatParameter:(e,t,n,r,o)=>{if(!pn(e))switch(o){case 32937:return new Int32Array([0])}return e.getInternalformatParameter(n,r,o)},getTexParameter(e,t,n,r){switch(r){case 34046:const{extensions:o}=e.luma,l=o[x6];r=l&&l.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(n,r)},getParameter:g6,hint(e,t,n,r){return t(n,r)}};function T6(e){e.luma=e.luma||{};const{luma:t}=e;return t.polyfilled||(o6(e),E6(e),P6(e,aL),S6(e,{target:t,target2:e}),t.polyfilled=!0),e}globalThis.polyfillContext=T6;function E6(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const n of t)e.luma[n]=e.getExtension(n)}function S6(e,t){let{target:n,target2:r}=t;Object.keys(P0).forEach(o=>{if(typeof P0[o]=="function"){const l=e[o]?e[o].bind(e):()=>{},s=P0[o].bind(null,e,l);n[o]=s,r[o]=s}})}function P6(e,t){for(const n of Object.getOwnPropertyNames(t))n!=="overrides"&&A6(e,{extension:n,target:e.luma,target2:e})}function A6(e,t){let{extension:n,target:r,target2:o}=t;const l=aL[n];Wi(l);const{meta:s={}}=l,{suffix:p=""}=s,g=e.getExtension(n);for(const _ of Object.keys(l)){const w="".concat(_).concat(p);let P=null;_==="meta"||typeof e[_]=="function"||(g&&typeof g[w]=="function"?P=function(){return g[w](...arguments)}:typeof l[_]=="function"&&(P=l[_].bind(r))),P&&(r[_]=P,o[_]=P)}}const mw={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Ol=(e,t,n)=>t?e.enable(n):e.disable(n),j2=(e,t,n)=>e.hint(n,t),wo=(e,t,n)=>e.pixelStorei(n,t),C6=(e,t)=>{const n=pn(e)?36009:36160;return e.bindFramebuffer(n,t)},I6=(e,t)=>e.bindFramebuffer(36008,t);function Ap(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const M6={[3042]:Ol,[32773]:(e,t)=>e.blendColor(...t),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(e,t)=>e.clearColor(...t),[3107]:(e,t)=>e.colorMask(...t),[2884]:Ol,[2885]:(e,t)=>e.cullFace(t),[2929]:Ol,[2931]:(e,t)=>e.clearDepth(t),[2932]:(e,t)=>e.depthFunc(t),[2928]:(e,t)=>e.depthRange(...t),[2930]:(e,t)=>e.depthMask(t),[3024]:Ol,[35723]:j2,[36006]:C6,[2886]:(e,t)=>e.frontFace(t),[33170]:j2,[2849]:(e,t)=>e.lineWidth(t),[32823]:Ol,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Ol,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Ol,[3088]:(e,t)=>e.scissor(...t),[2960]:Ol,[2961]:(e,t)=>e.clearStencil(t),[2968]:(e,t)=>e.stencilMaskSeparate(1028,t),[36005]:(e,t)=>e.stencilMaskSeparate(1029,t),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(e,t)=>e.viewport(...t),[3333]:wo,[3317]:wo,[37440]:wo,[37441]:wo,[37443]:wo,[3330]:wo,[3332]:wo,[3331]:wo,[36010]:I6,[3314]:wo,[32878]:wo,[3316]:wo,[3315]:wo,[32877]:wo,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=Ap(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=Ap(t)&&t.length===2?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Ap(t)?t:[t,t];const[n,r]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,r)},stencilFunc:(e,t)=>{t=Ap(t)&&t.length===3?[...t,...t]:t;const[n,r,o,l,s,p]=t;e.stencilFuncSeparate(1028,n,r,o),e.stencilFuncSeparate(1029,l,s,p)},stencilOp:(e,t)=>{t=Ap(t)&&t.length===3?[...t,...t]:t;const[n,r,o,l,s,p]=t;e.stencilOpSeparate(1028,n,r,o),e.stencilOpSeparate(1029,l,s,p)},viewport:(e,t)=>e.viewport(...t)};function Tr(e,t,n){return t[e]!==void 0?t[e]:n[e]}const L6={blendEquation:(e,t,n)=>e.blendEquationSeparate(Tr(32777,t,n),Tr(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Tr(32969,t,n),Tr(32968,t,n),Tr(32971,t,n),Tr(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Tr(32824,t,n),Tr(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Tr(32938,t,n),Tr(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Tr(2962,t,n),Tr(2967,t,n),Tr(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Tr(34816,t,n),Tr(36003,t,n),Tr(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Tr(2964,t,n),Tr(2965,t,n),Tr(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Tr(34817,t,n),Tr(34818,t,n),Tr(34819,t,n))},G2={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({[36006]:n,[36010]:n});case 36009:return e({[36006]:n});case 36008:return e({[36010]:n});default:return null}},blendColor:(e,t,n,r,o)=>e({[32773]:new Float32Array([t,n,r,o])}),blendEquation:(e,t)=>e({[32777]:t,[34877]:t}),blendEquationSeparate:(e,t,n)=>e({[32777]:t,[34877]:n}),blendFunc:(e,t,n)=>e({[32969]:t,[32968]:n,[32971]:t,[32970]:n}),blendFuncSeparate:(e,t,n,r,o)=>e({[32969]:t,[32968]:n,[32971]:r,[32970]:o}),clearColor:(e,t,n,r,o)=>e({[3106]:new Float32Array([t,n,r,o])}),clearDepth:(e,t)=>e({[2931]:t}),clearStencil:(e,t)=>e({[2961]:t}),colorMask:(e,t,n,r,o)=>e({[3107]:[t,n,r,o]}),cullFace:(e,t)=>e({[2885]:t}),depthFunc:(e,t)=>e({[2932]:t}),depthRange:(e,t,n)=>e({[2928]:new Float32Array([t,n])}),depthMask:(e,t)=>e({[2930]:t}),frontFace:(e,t)=>e({[2886]:t}),lineWidth:(e,t)=>e({[2849]:t}),polygonOffset:(e,t,n)=>e({[32824]:t,[10752]:n}),sampleCoverage:(e,t,n)=>e({[32938]:t,[32939]:n}),scissor:(e,t,n,r,o)=>e({[3088]:new Int32Array([t,n,r,o])}),stencilMask:(e,t)=>e({[2968]:t,[36005]:t}),stencilMaskSeparate:(e,t,n)=>e({[t===1028?2968:36005]:n}),stencilFunc:(e,t,n,r)=>e({[2962]:t,[2967]:n,[2963]:r,[34816]:t,[36003]:n,[36004]:r}),stencilFuncSeparate:(e,t,n,r,o)=>e({[t===1028?2962:34816]:n,[t===1028?2967:36003]:r,[t===1028?2963:36004]:o}),stencilOp:(e,t,n,r)=>e({[2964]:t,[2965]:n,[2966]:r,[34817]:t,[34818]:n,[34819]:r}),stencilOpSeparate:(e,t,n,r,o)=>e({[t===1028?2964:34817]:n,[t===1028?2965:34818]:r,[t===1028?2966:34819]:o}),viewport:(e,t,n,r,o)=>e({[2978]:[t,n,r,o]})},Xs=(e,t)=>e.isEnabled(t),W2={[3042]:Xs,[2884]:Xs,[2929]:Xs,[3024]:Xs,[32823]:Xs,[32926]:Xs,[32928]:Xs,[3089]:Xs,[2960]:Xs,[35977]:Xs};function lL(e){for(const t in e)return!1;return!0}function k6(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&r&&e.length===t.length){for(let o=0;o<e.length;++o)if(e[o]!==t[o])return!1;return!0}return!1}function H2(e,t){const n=e[t].bind(e);e[t]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in e.state.cache?e.state.enable?e.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function O6(e,t,n){const r=e[t].bind(e);e[t]=function(){for(var l=arguments.length,s=new Array(l),p=0;p<l;p++)s[p]=arguments[p];const{valueChanged:g,oldValue:_}=n(e.state._updateCache,...s);return g&&r(...s),_},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function R6(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}class z6{constructor(t){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?F6(t):Object.assign({},mw),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Wi(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];al(this.gl,t),this.stateStack.pop()}_updateCache(t){let n=!1,r;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const l in t){Wi(l!==void 0);const s=t[l],p=this.cache[l];k6(s,p)||(n=!0,r=p,o&&!(l in o)&&(o[l]=p),this.cache[l]=s)}return{valueChanged:n,oldValue:r}}}function uL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=t;if(Wi(r!==void 0),!e.state){const{polyfillContext:o}=globalThis;o&&o(e),e.state=new z6(e,{copyState:r}),R6(e);for(const l in G2){const s=G2[l];O6(e,l,s)}H2(e,"getParameter"),H2(e,"isEnabled")}return e.state.enable=n,e}function D6(e){e.state||uL(e,{copyState:!1}),e.state.push()}function q2(e){Wi(e.state),e.state.pop()}function al(e,t){if(Wi(Xv(e),"setParameters requires a WebGL context"),lL(t))return;const n={};for(const o in t){const l=Number(o),s=M6[o];s&&(typeof s=="string"?n[s]=!0:s(e,t[o],l))}const r=e.state&&e.state.cache;if(r)for(const o in n){const l=L6[o];l(e,t,r)}}function F6(e,t){if(t=t||mw,typeof t=="number"){const o=t,l=W2[o];return l?l(e,o):e.getParameter(o)}const n=Array.isArray(t)?t:Object.keys(t),r={};for(const o of n){const l=W2[o];r[o]=l?l(e,Number(o)):e.getParameter(Number(o))}return r}function N6(e){al(e,mw)}function jo(e,t,n){if(lL(t))return n(e);const{nocatch:r=!0}=t;D6(e),al(e,t);let o;if(r)o=n(e),q2(e);else try{o=n(e)}finally{q2(e)}return o}function ff(e){const{luma:t}=e;if(e.canvas&&t){const{clientWidth:n}=t.canvasSizeInfo;return n?e.drawingBufferWidth/n:1}return 1}function A0(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=ff(e),o=e.drawingBufferWidth,l=e.drawingBufferHeight;return U6(t,r,o,l,n)}function B6(e){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}function U6(e,t,n,r,o){const l=Z2(e[0],t,n);let s=X2(e[1],t,r,o),p=Z2(e[0]+1,t,n);const g=p===n-1?p:p-1;p=X2(e[1]+1,t,r,o);let _;return o?(p=p===0?p:p+1,_=s,s=p):_=p===r-1?p:p-1,{x:l,y:s,width:Math.max(g-l+1,1),height:Math.max(_-s+1,1)}}function Z2(e,t,n){return Math.min(Math.round(e*t),n-1)}function X2(e,t,n,r){return r?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const gw=hl(),V6=gw&&typeof document<"u",cL={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function hL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Wi(gw,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),e=Object.assign({},cL,e);const{width:t,height:n}=e;function r(p){if(e.throwOnError)throw new Error(p);return console.error(p),null}e.onError=r;let o;const{canvas:l}=e,s=H6({canvas:l,width:t,height:n,onError:r});return o=W6(s,e),o?(o=yw(o,e),q6(o),o):null}function yw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e||e._instrumented)return e;e._version=e._version||Z6(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},cL,t);const{manageState:n,debug:r}=t;return n&&uL(e,{copyState:!1,log:function(){for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];return ke.log(1,...l)()}}),gw&&r&&(globalThis.makeDebugContext?(e=globalThis.makeDebugContext(e,t),ke.level=Math.max(ke.level,1)):ke.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function j6(e){const t=e.getParameter(7936),n=e.getParameter(7937),r=e.getExtension("WEBGL_debug_renderer_info"),o=r&&e.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),l=r&&e.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||t,renderer:l||n,vendorMasked:t,rendererMasked:n,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}function G6(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.canvas){const r=B6(t.useDevicePixels);X6(e,r,t);return}const n=e.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in t&&"height"in t&&n.resize(t.width,t.height)}function W6(e,t){const{onError:n}=t;let r=null;const o=g=>r=g.statusMessage||r;e.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:l=!0,webgl2:s=!0}=t;let p=null;return s&&(p=p||e.getContext("webgl2",t),p=p||e.getContext("experimental-webgl2",t)),l&&(p=p||e.getContext("webgl",t),p=p||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",o,!1),p?(t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1),p):n("Failed to create ".concat(s&&!l?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function H6(e){let{canvas:t,width:n=800,height:r=600,onError:o}=e,l;return typeof t=="string"?(V6&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(t,"' before page was loaded")),l=document.getElementById(t)):t?l=t:(l=document.createElement("canvas"),l.id="lumagl-canvas",l.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",l.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(l,document.body.firstChild)),l}function q6(e){const t=pn(e)?"WebGL2":"WebGL1",n=j6(e),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=e.debug?" debug":"";ke.info(1,"".concat(t).concat(o," context ").concat(r))()}function Z6(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?2:1}function X6(e,t,n){let r="width"in n?n.width:e.canvas.clientWidth,o="height"in n?n.height:e.canvas.clientHeight;(!r||!o)&&(ke.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=e.canvas.width||1,o=e.canvas.height||1),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const l=e.luma.canvasSizeInfo;if(l.clientWidth!==r||l.clientHeight!==o||l.devicePixelRatio!==t){let s=t;const p=Math.floor(r*s),g=Math.floor(o*s);e.canvas.width=p,e.canvas.height=g,(e.drawingBufferWidth!==p||e.drawingBufferHeight!==g)&&(ke.warn("Device pixel ratio clamped")(),s=Math.min(e.drawingBufferWidth/r,e.drawingBufferHeight/o),e.canvas.width=Math.floor(r*s),e.canvas.height=Math.floor(o*s)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:r,clientHeight:o,devicePixelRatio:t})}}const nd="8.5.18",$6="set luma.log.level=1 (or higher) to trace rendering";class Y6{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new qv({id:t})),this.stats.get(t)}}const nc=new Y6;if(globalThis.luma&&globalThis.luma.VERSION!==nd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(nd));globalThis.luma||(hl()&&ke.log(1,"luma.gl ".concat(nd," - ").concat($6))(),globalThis.luma=globalThis.luma||{VERSION:nd,version:nd,log:ke,stats:nc,globals:{modules:{},nodeIO:{}}});function K6(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function J6(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function de(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function C0(e,t){if(typeof t!="string")return t;const n=Number(t);if(!isNaN(n))return n;t=t.replace(/^.*\./,"");const r=e[t];return de(r!==void 0,"Accessing undefined constant GL.".concat(t)),r}function tu(e,t){t=Number(t);for(const n in e)if(e[n]===t)return"GL.".concat(n);return String(t)}const I0={};function ou(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";I0[e]=I0[e]||1;const t=I0[e]++;return"".concat(e,"-").concat(t)}function $2(e){return de(typeof e=="number","Input must be a number"),e&&(e&e-1)===0}function pf(e){let t=!0;for(const n in e){t=!1;break}return t}function fL(e,t,n,r){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),l=Object.getPrototypeOf(e);r.forEach(s=>{l.methodName||(l[s]=()=>{throw ke.removed("Calling removed method ".concat(t,".").concat(s,": "),o)(),new Error(s)})})}const Eh="Resource subclass must define virtual methods";let fl=class{get[Symbol.toStringTag](){return"Resource"}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$v(t);const{id:r,userData:o={}}=n;this.gl=t,this.gl2=t,this.id=r||ou(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&t&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let n;return this._bound?n=t():(this._bindHandle(this.handle),this._bound=!0,n=t(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=C0(this.gl,t),de(t);const o=(this.constructor.PARAMETERS||{})[t];if(o){const l=pn(this.gl);if(!((!("webgl2"in o)||l)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const p=o.webgl1,g="webgl2"in o?o.webgl2:o.webgl1;return l?g:p}}return this._getParameter(t,n)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=t,o=this.constructor.PARAMETERS||{},l=pn(this.gl),s={},p=n||Object.keys(o);for(const g of p){const _=o[g];if(_&&(!("webgl2"in _)||l)&&(!("extension"in _)||this.gl.getExtension(_.extension))){const P=r?tu(this.gl,g):g;s[P]=this.getParameter(g,t),r&&_.type==="GLenum"&&(s[P]=tu(this.gl,s[P]))}}return s}setParameter(t,n){t=C0(this.gl,t),de(t);const o=(this.constructor.PARAMETERS||{})[t];if(o){const l=pn(this.gl);if(!((!("webgl2"in o)||l)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=C0(n))}return this._setParameter(t,n),this}setParameters(t){for(const n in t)this.setParameter(n,t[n]);return this}stubRemovedMethods(t,n,r){return fL(this,t,n,r)}initialize(t){}_createHandle(){throw new Error(Eh)}_deleteHandle(){throw new Error(Eh)}_bindHandle(t){throw new Error(Eh)}_getOptsFromHandle(){throw new Error(Eh)}_getParameter(t,n){throw new Error(Eh)}_setParameter(t,n){throw new Error(Eh)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],n=nc.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(t,"s Created")).incrementCount(),n.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];nc.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,n),this._trackAllocatedMemoryForContext(t,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=nc.get("Memory Usage".concat(r));o.get("GPU Memory").addCount(t),o.get("".concat(n," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=nc.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(t," Memory")).subtractCount(this.byteLength)}};const Q6="Failed to deduce GL constant from typed array";function b1(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Q6)}}function _d(e){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function tU(e){let{data:t,width:n,height:r,bytesPerPixel:o=4,temp:l}=e;const s=n*o;l=l||new Uint8Array(s);for(let p=0;p<r/2;++p){const g=p*s,_=(r-p-1)*s;l.set(t.subarray(g,g+s)),t.copyWithin(g,_,_+s),t.set(l,_)}}function eU(e){let{data:t,width:n,height:r}=e;const o=Math.round(n/2),l=Math.round(r/2),s=new Uint8Array(o*l*4);for(let p=0;p<l;p++)for(let g=0;g<o;g++)for(let _=0;_<4;_++)s[(p*o+g)*4+_]=t[(p*2*n+g*2)*4+_];return{data:s,width:o,height:l}}function w1(e,t,n){const{removedProps:r={},deprecatedProps:o={},replacedProps:l={}}=n;for(const p in r)if(p in t){const _=r[p]?"".concat(e,".").concat(r[p]):"N/A";ke.removed("".concat(e,".").concat(p),_)()}for(const p in o)if(p in t){const g=o[p];ke.deprecated("".concat(e,".").concat(p),"".concat(e,".").concat(g))()}let s=null;for(const p in l)if(p in t){const g=l[p];ke.deprecated("".concat(e,".").concat(p),"".concat(e,".").concat(g))(),s=s||Object.assign({},t),s[g]=t[p],delete s[p]}return s||t}const nU={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},rU={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Po{static getBytesPerElement(t){return _d(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return de(t.size),_d(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new Po(nU,...n)}constructor(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Po.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Po.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=w1("Accessor",t,rU),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const Y2=10,pL={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},iU={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:pL},oU={removedProps:pL};class zn extends fl{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Po.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Po.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=w1("Buffer",t,iU),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=w1("Buffer",t,oU),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new Po(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:n,offset:r=0,srcOffset:o=0}=t,l=t.byteLength||t.length;de(n);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),o!==0||l!==void 0?(Di(this.gl),this.gl.bufferSubData(this.target,r,n,o,l)):this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(n),this}copyData(t){let{sourceBuffer:n,readOffset:r=0,writeOffset:o=0,size:l}=t;const{gl:s}=this;return Di(s),s.bindBuffer(36662,n.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,r,o,l),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:n=0,dstOffset:r=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Di(this.gl);const l=_d(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(n),p=r;let g,_;t?(_=t.length,g=_-p):(g=Math.min(s,o||s),_=p+g);const w=Math.min(s,g);return o=o||w,de(o<=w),t=t||new l(_),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,t,r,o),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?o!==void 0?this.gl.bindBufferRange(t,n,this.handle,r,o):(de(r===0),this.gl.bindBufferBase(t,n,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,n,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Y2,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+n;de(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.usage),this.gl.bufferSubData(o,n,t),this.gl.bindBuffer(o,null),this.debugData=t.slice(0,Y2),this.bytesUsed=r,this._trackAllocatedMemory(r);const l=b1(t);return de(l),this.setAccessor(new Po(this.accessor,{type:l})),this}_setByteLength(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;de(t>=0),this._trackDeallocatedMemory();let r=t;t===0&&(r=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const n=_d(this.accessor.type||5126,{clamped:!1}),r=t/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(t){this.accessor.type||this.setAccessor(new Po(this.accessor,{type:b1(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),n}get type(){return ke.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return ke.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return ke.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return ke.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Po(this.accessor,t),this}}const vw={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},dL={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},mL={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function sU(e,t){const n=vw[t];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=pn(e)&&n.gl2||n.gl1;return typeof r=="string"?e.getExtension(r):r}function aU(e,t){const n=vw[t];switch(n&&n.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}const lU=[9729,9728],K2=globalThis.WebGLBuffer||function(){};class dc extends fl{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:o}=n;let l=!0;return r&&(l=l&&sU(t,r),l=l&&(!o||aU(t,r))),l}constructor(t,n){const{id:r=ou("texture"),handle:o,target:l}=n;super(t,{id:r,handle:o}),this.target=l,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.data;if(n instanceof Promise)return n.then(H=>this.initialize(Object.assign({},t,{pixels:H,data:H}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:o=null,format:l=6408,border:s=0,recreate:p=!1,parameters:g={},pixelStore:_={},textureUnit:w=void 0}=t;n||(n=o);let{width:P,height:A,dataFormat:M,type:F,compressed:X=!1,mipmaps:B=!0}=t;const{depth:U=0}=t;return{width:P,height:A,compressed:X,dataFormat:M,type:F}=this._deduceParameters({format:l,type:F,dataFormat:M,compressed:X,data:n,width:P,height:A}),this.width=P,this.height=A,this.depth=U,this.format=l,this.type=F,this.dataFormat=M,this.border=s,this.textureUnit=w,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),B&&this._isNPOT()&&(ke.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),B=!1,this._updateForNPOT(g)),this.mipmaps=B,this.setImageData({data:n,width:P,height:A,depth:U,format:l,type:F,dataFormat:M,border:s,mipmaps:B,parameters:_,compressed:X}),B&&this.generateMipmap(),this.setParameters(g),p&&(this.data=n),r&&(this._video={video:n,parameters:g,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:n,lastTime:r}=this._video;if(r===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:n,width:r,mipmaps:o=!1}=t;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ke.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),jo(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:o=0,format:l=this.format,border:s=this.border,offset:p=0,parameters:g={}}=t;let{data:_=null,type:w=this.type,width:P=this.width,height:A=this.height,dataFormat:M=this.dataFormat,compressed:F=!1}=t;_||(_=r),{type:w,dataFormat:M,compressed:F,width:P,height:A}=this._deduceParameters({format:l,type:w,dataFormat:M,compressed:F,data:_,width:P,height:A});const{gl:X}=this;X.bindTexture(this.target,this.handle);let B=null;({data:_,dataType:B}=this._getDataType({data:_,compressed:F}));let U,H=0;if(jo(this.gl,g,()=>{switch(B){case"null":X.texImage2D(n,o,l,P,A,s,M,w,_);break;case"typed-array":X.texImage2D(n,o,l,P,A,s,M,w,_,p);break;case"buffer":U=Di(X),U.bindBuffer(35052,_.handle||_),U.texImage2D(n,o,l,P,A,s,M,w,p),U.bindBuffer(35052,null);break;case"browser-object":pn(X)?X.texImage2D(n,o,l,P,A,s,M,w,_):X.texImage2D(n,o,l,M,w,_);break;case"compressed":for(const[tt,st]of _.entries())X.compressedTexImage2D(n,tt,st.format,st.width,st.height,s,st.data),H+=st.levelSize;break;default:de(!1,"Unknown image data type")}}),B==="compressed")this._trackAllocatedMemory(H,"Texture");else if(_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const tt=dL[this.dataFormat]||4,st=mL[this.type]||1;this._trackAllocatedMemory(this.width*this.height*tt*st,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:n=this.target,pixels:r=null,data:o=null,x:l=0,y:s=0,width:p=this.width,height:g=this.height,level:_=0,format:w=this.format,type:P=this.type,dataFormat:A=this.dataFormat,compressed:M=!1,offset:F=0,border:X=this.border,parameters:B={}}=t;if({type:P,dataFormat:A,compressed:M,width:p,height:g}=this._deduceParameters({format:w,type:P,dataFormat:A,compressed:M,data:o,width:p,height:g}),de(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=r),o&&o.data){const U=o;o=U.data,p=U.shape[0],g=U.shape[1]}o instanceof zn&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),jo(this.gl,B,()=>{if(M)this.gl.compressedTexSubImage2D(n,_,l,s,p,g,w,o);else if(o===null)this.gl.texSubImage2D(n,_,l,s,p,g,A,P,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,_,l,s,p,g,A,P,o,F);else if(o instanceof K2){const U=Di(this.gl);U.bindBuffer(35052,o),U.texSubImage2D(n,_,l,s,p,g,A,P,F),U.bindBuffer(35052,null)}else pn(this.gl)?Di(this.gl).texSubImage2D(n,_,l,s,p,g,A,P,o):this.gl.texSubImage2D(n,_,l,s,A,P,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return ke.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,null),t}_getDataType(t){let{data:n,compressed:r=!1}=t;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof zn?{data:n.handle,dataType:"buffer"}:n instanceof K2?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(t){const{format:n,data:r}=t;let{width:o,height:l,dataFormat:s,type:p,compressed:g}=t;const _=vw[n];return s=s||_&&_.dataFormat,p=p||_&&_.types[0],g=g||_&&_.compressed,{width:o,height:l}=this._deduceImageSize(r,o,l),{dataFormat:s,type:p,compressed:g,width:o,height:l,format:n,data:r}}_deduceImageSize(t,n,r){let o;return typeof ImageData<"u"&&t instanceof ImageData?o={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?o={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?o={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?o={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?o={width:t.videoWidth,height:t.videoHeight}:t?o={width:n,height:r}:o={width:n>=0?n:1,height:r>=0?r:1},de(o,"Could not deduced texture size"),de(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),de(r===void 0||o.height===r,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),n}}_setParameter(t,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(t,n),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,n);break;case 4096:case 4097:de(!1);break;default:this.gl.texParameteri(this.target,t,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return pn(this.gl)||!this.width||!this.height?!1:!$2(this.width)||!$2(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,n){if(this._isNPOT())switch(t){case 10241:lU.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let uU="";function cU(e,t){return de(typeof e=="string"),e=uU+e,new Promise((n,r)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>r(new Error("Could not load image ".concat(e,"."))),o.crossOrigin=t&&t.crossOrigin||"anonymous",o.src=e}catch(o){r(o)}})}class Zi extends dc{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,n){return dc.isSupported(t,n)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$v(t),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:cU(n.data)})),super(t,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const T1=[34069,34070,34071,34072,34073,34074];class gL extends dc{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$v(t),super(t,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,n&&this.generateMipmap(t),this.setParameters(r)}),this}subImage(t){let{face:n,data:r,x:o=0,y:l=0,mipmapLevel:s=0}=t;return this._subImage({target:n,data:r,x:o,y:l,mipmapLevel:s})}async setCubeMapImageData(t){let{width:n,height:r,pixels:o,data:l,border:s=0,format:p=6408,type:g=5121}=t;const{gl:_}=this,w=o||l,P=await Promise.all(T1.map(A=>{const M=w[A];return Promise.all(Array.isArray(M)?M:[M])}));this.bind(),T1.forEach((A,M)=>{P[M].length>1&&this.opts.mipmaps!==!1&&ke.warn("".concat(this.id," has mipmap and multiple LODs."))(),P[M].forEach((F,X)=>{n&&r?_.texImage2D(A,X,p,n,r,s,p,g,F):_.texImage2D(A,X,p,p,g,F)})}),this.unbind()}setImageDataForFace(t){const{face:n,width:r,height:o,pixels:l,data:s,border:p=0,format:g=6408,type:_=5121}=t,{gl:w}=this,P=l||s;return this.bind(),P instanceof Promise?P.then(A=>this.setImageDataForFace(Object.assign({},t,{face:n,data:A,pixels:A}))):this.width||this.height?w.texImage2D(n,0,g,r,o,p,g,_,P):w.texImage2D(n,0,g,g,_,P),this}}gL.FACES=T1;class hU extends dc{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return pn(t)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Di(t),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(t,n),this.initialize(n),Object.seal(this)}setImageData(t){let{level:n=0,dataFormat:r=6408,width:o,height:l,depth:s=1,border:p=0,format:g,type:_=5121,offset:w=0,data:P,parameters:A={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),jo(this.gl,A,()=>{ArrayBuffer.isView(P)&&this.gl.texImage3D(this.target,n,r,o,l,s,p,g,_,P),P instanceof zn&&(this.gl.bindBuffer(35052,P.handle),this.gl.texImage3D(this.target,n,r,o,l,s,p,g,_,w))}),P&&P.byteLength)this._trackAllocatedMemory(P.byteLength,"Texture");else{const M=dL[this.dataFormat]||4,F=mL[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*M*F,"Texture")}return this.loaded=!0,this}}const Gu="EXT_color_buffer_float",J2={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Gu,bpp:2},[33327]:{gl2:Gu,bpp:4},[34842]:{gl2:Gu,bpp:8},[33326]:{gl2:Gu,bpp:4},[33328]:{gl2:Gu,bpp:8},[34836]:{gl2:Gu,bpp:16},[35898]:{gl2:Gu,bpp:4}};function fU(e,t,n){const r=n[t];if(!r)return!1;const o=pn(e)&&r.gl2||r.gl1;return typeof o=="string"?e.getExtension(o):o}class Bh extends fl{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||fU(t,n,J2)}static getSamplesForFormat(t,n){let{format:r}=n;return t.getInternalformatParameter(36161,r,32937)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n),this.initialize(n),Object.seal(this)}initialize(t){let{format:n,width:r=1,height:o=1,samples:l=0}=t;return de(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),l!==0&&pn(this.gl)?this.gl.renderbufferStorageMultisample(36161,l,n,r,o):this.gl.renderbufferStorage(36161,n,r,o),this.format=n,this.width=r,this.height=o,this.samples=l,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*J2[this.format].bpp),this}resize(t){let{width:n,height:r}=t;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const pU=256,dU=1024,mU=16384,Q2=6144,tP=6145,eP=6146,nP=34041,yL="clear: bad arguments";function _w(e){let{framebuffer:t=null,color:n=null,depth:r=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l={};t&&(l.framebuffer=t);let s=0;n&&(s|=mU,n!==!0&&(l.clearColor=n)),r&&(s|=pU,r!==!0&&(l.clearDepth=r)),o&&(s|=dU,r!==!0&&(l.clearStencil=r)),de(s!==0,yL),jo(e,l,()=>{e.clear(s)})}function gU(e){let{framebuffer:t=null,buffer:n=Q2,drawBuffer:r=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Di(e),jo(e,{framebuffer:t},()=>{switch(n){case Q2:switch(o.constructor){case Int32Array:e.clearBufferiv(n,r,o);break;case Uint32Array:e.clearBufferuiv(n,r,o);break;case Float32Array:default:e.clearBufferfv(n,r,o)}break;case tP:e.clearBufferfv(tP,0,[o]);break;case eP:e.clearBufferiv(eP,0,[o]);break;case nP:const[l,s]=o;e.clearBufferfi(nP,0,l,s);break;default:de(!1,yL)}})}function yU(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return de(!1),0}}function Yv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:o=6408}=t;let{sourceAttachment:l=36064,target:s=null,sourceWidth:p,sourceHeight:g,sourceType:_}=t;const{framebuffer:w,deleteFramebuffer:P}=vL(e);de(w);const{gl:A,handle:M,attachments:F}=w;p=p||w.width,g=g||w.height,l===36064&&M===null&&(l=1028),de(F[l]),_=_||F[l].type,s=_U(s,_,o,p,g),_=_||b1(s);const X=A.bindFramebuffer(36160,M);return A.readPixels(n,r,p,g,o,_,s),A.bindFramebuffer(36160,X||null),P&&w.delete(),s}function rP(e){let{sourceAttachment:t=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Yv(e,{sourceAttachment:t}),{width:o,height:l}=e;for(;l>n;)({data:r,width:o,height:l}=eU({data:r,width:o,height:l}));tU({data:r,width:o,height:l});const s=document.createElement("canvas");s.width=o,s.height=l;const p=s.getContext("2d"),g=p.createImageData(o,l);return g.data.set(r),p.putImageData(g,0,0),s.toDataURL()}function vU(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:o=0,targetMipmaplevel:l=0,targetInternalFormat:s=6408}=n;let{targetX:p,targetY:g,targetZ:_,width:w,height:P}=n;const{framebuffer:A,deleteFramebuffer:M}=vL(e);de(A);const{gl:F,handle:X}=A,B=typeof p<"u"||typeof g<"u"||typeof _<"u";p=p||0,g=g||0,_=_||0;const U=F.bindFramebuffer(36160,X);de(t);let H=null;if(t instanceof dc&&(H=t,w=Number.isFinite(w)?w:H.width,P=Number.isFinite(P)?P:H.height,H.bind(0),t=H.target),!B)F.copyTexImage2D(t,l,s,r,o,w,P,0);else switch(t){case 3553:case 34067:F.copyTexSubImage2D(t,l,p,g,r,o,w,P);break;case 35866:case 32879:Di(F).copyTexSubImage3D(t,l,p,g,_,r,o,w,P);break}return H&&H.unbind(),F.bindFramebuffer(36160,U||null),M&&A.delete(),H}function vL(e){return e instanceof Ur?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:IU(e),deleteFramebuffer:!0}}function _U(e,t,n,r,o){if(e)return e;t=t||5121;const l=_d(t,{clamped:!1}),s=yU(n);return new l(r*o*s)}const tr={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function xU(e){const t=new Zi(e,{format:6408,type:5126,dataFormat:6408}),n=new Ur(e,{id:"test-framebuffer",check:!1,attachments:{[36064]:t}}),r=n.getStatus();return t.delete(),n.delete(),r===36053}const _L={[tr.WEBGL2]:[!1,!0],[tr.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[tr.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[tr.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[tr.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[tr.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[tr.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[tr.FLOAT_BLEND]:["EXT_float_blend"],[tr.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[tr.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[tr.TEXTURE_FLOAT]:["OES_texture_float",!0],[tr.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[tr.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[tr.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[tr.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[tr.COLOR_ATTACHMENT_RGBA32F]:[xU,"EXT_color_buffer_float"],[tr.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[tr.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[tr.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[tr.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[tr.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[tr.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},bU=2;function wU(e,t){return xw(e,t)}function xw(e,t){return t=Array.isArray(t)?t:[t],t.every(n=>xL(e,n))}function TU(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in _L)e.luma.caps[t]===void 0&&(e.luma.caps[t]=xL(e,t));return e.luma.caps}function xL(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},e.luma.caps[t]===void 0&&(e.luma.caps[t]=EU(e,t)),e.luma.caps[t]||ke.log(bU,"Feature: ".concat(t," not supported"))(),e.luma.caps[t]}function EU(e,t){const n=_L[t];de(n,t);let r;const o=pn(e)&&n[1]||n[0];if(typeof o=="function")r=o(e);else if(Array.isArray(o)){r=!0;for(const l of o)r=r&&Boolean(e.getExtension(l))}else typeof o=="string"?r=Boolean(e.getExtension(o)):typeof o=="boolean"?r=o:de(!1);return r}const iP="Multiple render targets not supported";class Ur extends fl{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:o}=n;let l=!0;return r&&(l=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),o&&(l=l&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),l}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Ur(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Di(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Di(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:n=1,height:r=1,attachments:o=null,color:l=!0,depth:s=!0,stencil:p=!1,check:g=!0,readBuffer:_=void 0,drawBuffers:w=void 0}=t;if(de(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,o)for(const P in o){const A=o[P];(Array.isArray(A)?A[0]:A).resize({width:n,height:r})}else o=this._createDefaultAttachments(l,s,p,n,r);this.update({clearAttachments:!0,attachments:o,readBuffer:_,drawBuffers:w}),o&&g&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:n={},readBuffer:r,drawBuffers:o,clearAttachments:l=!1,resizeAttachments:s=!0}=t;this.attach(n,{clearAttachments:l,resizeAttachments:s});const{gl:p}=this,g=p.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),o&&this._setDrawBuffers(o),p.bindFramebuffer(36160,g||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=t;if(this.handle===null)return de(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&ke.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(t){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(s=>{o[s]=null}),Object.assign(o,t);const l=this.gl.bindFramebuffer(36160,this.handle);for(const s in o){de(s!==void 0,"Misspelled framebuffer binding point?");const p=Number(s),g=o[p];let _=g;if(!_)this._unattach(p);else if(_ instanceof Bh)this._attachRenderbuffer({attachment:p,renderbuffer:_});else if(Array.isArray(g)){const[w,P=0,A=0]=g;_=w,this._attachTexture({attachment:p,texture:w,layer:P,level:A})}else this._attachTexture({attachment:p,texture:_,layer:0,level:0});r&&_&&_.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,l||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(s=>!this.attachments[s]).forEach(s=>{delete this.attachments[s]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(PU(t));return this}getStatus(){const{gl:t}=this,n=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,n||null),r}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:o,drawBuffers:l=[]}=t,s=this.gl.bindFramebuffer(36160,this.handle);return(n||r||o)&&_w(this.gl,{color:n,depth:r,stencil:o}),l.forEach((p,g)=>{gU(this.gl,{drawBuffer:g,value:p})}),this.gl.bindFramebuffer(36160,s||null),this}readPixels(){return ke.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return ke.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return ke.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return ke.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return ke.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return ke.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:n=[],x:r=0,y:o=0,width:l,height:s}=t;const p=Di(this.gl),g=p.bindFramebuffer(36008,this.handle);return r===0&&o===0&&l===void 0&&s===void 0?p.invalidateFramebuffer(36008,n):p.invalidateFramebuffer(36008,n,r,o,l,s),p.bindFramebuffer(36008,g),this}getAttachmentParameter(t,n,r){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,t,n),this.gl.bindFramebuffer(36160,null)),r&&o>1e3&&(o=tu(this.gl,o)),o}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const l of r){const s=n?tu(this.gl,l):l;o[s]=this.getAttachmentParameter(t,l,n)}return o}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const o of n){const l=Number(o),s=t?tu(this.gl,l):l;r[s]=this.getAttachmentParameters(l,t)}return r}show(){return typeof window<"u"&&window.open(rP(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>ke.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=rP(this,{targetMaxHeight:100});return ke.image({logLevel:t,message:n,image:r},n)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,n,r,o,l){let s=null;return t&&(s=s||{},s[36064]=new Zi(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:l,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(s[36064])),n&&r?(s=s||{},s[33306]=new Bh(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(s[33306])):n?(s=s||{},s[36096]=new Bh(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:l}),this.ownResources.push(s[36096])):r&&de(!1),s}_unattach(t){const n=this.attachments[t];n&&(n instanceof Bh?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:n=36064,renderbuffer:r}=t;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(t){let{attachment:n=36064,texture:r,layer:o,level:l}=t;const{gl:s}=this;switch(s.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Di(s).framebufferTextureLayer(36160,n,r.target,l,o);break;case 34067:const g=SU(o);s.framebufferTexture2D(36160,n,g,r.handle,l);break;case 3553:s.framebufferTexture2D(36160,n,3553,r.handle,l);break;default:de(!1,"Illegal texture type")}s.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(t){const n=t6(this.gl);n?n.readBuffer(t):de(t===36064||t===1029,iP),this.readBuffer=t}_setDrawBuffers(t){const{gl:n}=this,r=Di(n);if(r)r.drawBuffers(t);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(t):de(t.length===1&&(t[0]===36064||t[0]===1029),iP)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const n=TU(this.gl);switch(t){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function SU(e){return e<34069?e+34069:e}function PU(e){return(Ur.STATUS||{})[e]||"Framebuffer error ".concat(e)}const AU=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ur.ATTACHMENT_PARAMETERS=AU;function CU(e,t){de(e instanceof Zi||e instanceof gL||e instanceof hU);const n=e.constructor,{gl:r,width:o,height:l,format:s,type:p,dataFormat:g,border:_,mipmaps:w}=e,P=Object.assign({width:o,height:l,format:s,type:p,dataFormat:g,border:_,mipmaps:w},t);return new n(r,P)}function IU(e,t){const{gl:n,width:r,height:o,id:l}=e;return new Ur(n,Object.assign({},t,{id:"framebuffer-for-".concat(l),width:r,height:o,attachments:{[36064]:e}}))}function _y(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=e.match(n);return r?r[1]:t}const MU=35632,LU=35633;function kU(e){switch(e){case MU:return"fragment";case LU:return"vertex";default:return"unknown type"}}function OU(e,t,n,r){const o=e.split(/\r?\n/),l={},s={},p=r||_y(t)||"(unnamed)",g="".concat(kU(n)," shader ").concat(p);for(let w=0;w<o.length;w++){const P=o[w];if(P.length<=1)continue;const A=P.split(":"),M=A[0],F=parseInt(A[2],10);if(isNaN(F))throw new Error("GLSL compilation error in ".concat(g,": ").concat(e));M!=="WARNING"?l[F]=P:s[F]=P}const _=RU(t);return{shaderName:g,errors:oP(l,_),warnings:oP(s,_)}}function oP(e,t){let n="";for(let r=0;r<t.length;r++){const o=t[r];if(!(!e[r+3]&&!e[r+2]&&!e[r+1])&&(n+="".concat(o,`
`),e[r+1])){const l=e[r+1],s=l.split(":",3),p=s[0],g=parseInt(s[1],10)||0,_=l.substring(s.join(":").length+1).trim();n+=bL("^^^ ".concat(p,": ").concat(_,`

`),g)}}return n}function RU(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=e.split(/\r?\n/),o=String(r.length+t-1).length;return r.map((l,s)=>{const p=String(s+t),g=p.length;return bL(p,o-g)+n+l})}function bL(e,t){let n="";for(let r=0;r<t;++r)n+=" ";return"".concat(n).concat(e)}function wL(e){let t=100;const n=e.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(t=r)}return t}const zU="Shader: GLSL source code must be a JavaScript string";class xd extends fl{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return de(!1),"unknown"}}constructor(t,n){$v(t),de(typeof n.source=="string",zU);const r=_y(n.source,null)||n.id||ou("unnamed ".concat(xd.getTypeName(n.shaderType)));super(t,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(t){let{source:n}=t;const r=_y(n,null);r&&(this.id=ou(r)),this._compile(n)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(xd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return _y(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:l,warnings:s}=OU(r,this.source,this.shaderType,this.id);throw ke.error("GLSL compilation errors in ".concat(o,`
`).concat(l))(),ke.warn("GLSL compilation warnings in ".concat(o,`
`).concat(s))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class M0 extends xd{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,n){typeof n=="string"&&(n={source:n}),super(t,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class L0 extends xd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,n){typeof n=="string"&&(n={source:n}),super(t,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const DU={[5126]:Qn.bind(null,"uniform1fv",To,1,Li),[35664]:Qn.bind(null,"uniform2fv",To,2,Li),[35665]:Qn.bind(null,"uniform3fv",To,3,Li),[35666]:Qn.bind(null,"uniform4fv",To,4,Li),[5124]:Qn.bind(null,"uniform1iv",Rl,1,Li),[35667]:Qn.bind(null,"uniform2iv",Rl,2,Li),[35668]:Qn.bind(null,"uniform3iv",Rl,3,Li),[35669]:Qn.bind(null,"uniform4iv",Rl,4,Li),[35670]:Qn.bind(null,"uniform1iv",Rl,1,Li),[35671]:Qn.bind(null,"uniform2iv",Rl,2,Li),[35672]:Qn.bind(null,"uniform3iv",Rl,3,Li),[35673]:Qn.bind(null,"uniform4iv",Rl,4,Li),[35674]:Qn.bind(null,"uniformMatrix2fv",To,4,ja),[35675]:Qn.bind(null,"uniformMatrix3fv",To,9,ja),[35676]:Qn.bind(null,"uniformMatrix4fv",To,16,ja),[35678]:ui,[35680]:ui,[5125]:Qn.bind(null,"uniform1uiv",Sg,1,Li),[36294]:Qn.bind(null,"uniform2uiv",Sg,2,Li),[36295]:Qn.bind(null,"uniform3uiv",Sg,3,Li),[36296]:Qn.bind(null,"uniform4uiv",Sg,4,Li),[35685]:Qn.bind(null,"uniformMatrix2x3fv",To,6,ja),[35686]:Qn.bind(null,"uniformMatrix2x4fv",To,8,ja),[35687]:Qn.bind(null,"uniformMatrix3x2fv",To,6,ja),[35688]:Qn.bind(null,"uniformMatrix3x4fv",To,12,ja),[35689]:Qn.bind(null,"uniformMatrix4x2fv",To,8,ja),[35690]:Qn.bind(null,"uniformMatrix4x3fv",To,12,ja),[35678]:ui,[35680]:ui,[35679]:ui,[35682]:ui,[36289]:ui,[36292]:ui,[36293]:ui,[36298]:ui,[36299]:ui,[36300]:ui,[36303]:ui,[36306]:ui,[36307]:ui,[36308]:ui,[36311]:ui},FU={},NU={},BU={},sP=[0];function bw(e,t,n,r){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(sP[0]=e,e=sP);const o=e.length;if(o%t&&ke.warn("Uniform size should be multiples of ".concat(t),e)(),e instanceof n)return e;let l=r[o];l||(l=new n(o),r[o]=l);for(let s=0;s<o;s++)l[s]=e[s];return l}function To(e,t){return bw(e,t,Float32Array,FU)}function Rl(e,t){return bw(e,t,Int32Array,NU)}function Sg(e,t){return bw(e,t,Uint32Array,BU)}function aP(e,t,n){const r=DU[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}function UU(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,n=e.match(t);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function VU(e,t,n){for(const r in e){const o=e[r];if((!n||Boolean(n[r]))&&!jU(o))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(r),o),new Error("".concat(t," Bad uniform ").concat(r))}return!0}function jU(e){return Array.isArray(e)||ArrayBuffer.isView(e)?WU(e):isFinite(e)||e===!0||e===!1||e instanceof dc||e instanceof Bh?!0:e instanceof Ur?Boolean(e.texture):!1}function GU(e,t,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(e[t]){const r=e[t];for(let o=0,l=n.length;o<l;++o)r[o]=n[o]}else e[t]=n.slice();else e[t]=n}function WU(e){if(e.length===0)return!1;const t=Math.min(e.length,16);for(let n=0;n<t;++n)if(!Number.isFinite(e[n]))return!1;return!0}function ui(){let e=null;return(t,n,r)=>{const o=e!==r;return o&&(t.uniform1i(n,r),e=r),o}}function Qn(e,t,n,r){let o=null,l=null;return(s,p,g)=>{const _=t(g,n),w=_.length;let P=!1;if(o===null)o=new Float32Array(w),l=w,P=!0;else{de(l===w,"Uniform length cannot change.");for(let A=0;A<w;++A)if(_[A]!==o[A]){P=!0;break}}return P&&(r(s,e,p,_),o.set(_)),P}}function Li(e,t,n,r){e[t](n,r)}function ja(e,t,n,r){e[t](n,!1,r)}const HU=5120,qU=5121,ZU=5122,XU=5123,lP=0,Pg=1,$U=2,YU=3,Ag=4,KU=5,JU=6,Xr=5126,QU=35664,tV=35665,eV=35666,Cp=5124,nV=35667,rV=35668,iV=35669,Ip=5125,oV=36294,sV=36295,aV=36296,lV=35670,uV=35671,cV=35672,hV=35673,fV=35674,pV=35675,dV=35676,mV=35685,gV=35686,yV=35687,vV=35688,_V=35689,xV=35690,E1={[Xr]:[Xr,1,"float"],[QU]:[Xr,2,"vec2"],[tV]:[Xr,3,"vec3"],[eV]:[Xr,4,"vec4"],[Cp]:[Cp,1,"int"],[nV]:[Cp,2,"ivec2"],[rV]:[Cp,3,"ivec3"],[iV]:[Cp,4,"ivec4"],[Ip]:[Ip,1,"uint"],[oV]:[Ip,2,"uvec2"],[sV]:[Ip,3,"uvec3"],[aV]:[Ip,4,"uvec4"],[lV]:[Xr,1,"bool"],[uV]:[Xr,2,"bvec2"],[cV]:[Xr,3,"bvec3"],[hV]:[Xr,4,"bvec4"],[fV]:[Xr,8,"mat2"],[mV]:[Xr,8,"mat2x3"],[gV]:[Xr,8,"mat2x4"],[pV]:[Xr,12,"mat3"],[yV]:[Xr,12,"mat3x2"],[vV]:[Xr,12,"mat3x4"],[dV]:[Xr,16,"mat4"],[_V]:[Xr,16,"mat4x2"],[xV]:[Xr,16,"mat4x3"]};function bV(e){switch(e){case lP:return lP;case Pg:return Pg;case YU:return Pg;case $U:return Pg;case Ag:return Ag;case KU:return Ag;case JU:return Ag;default:return de(!1),0}}function uP(e){const t=E1[e];if(!t)return null;const[n,r]=t;return{type:n,components:r}}function TL(e,t){switch(e){case HU:case qU:case ZU:case XU:e=Xr;break}for(const n in E1){const[r,o,l]=E1[n];if(r===e&&o===t)return{glType:n,name:l}}return null}class wV{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const n=Number(t);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const n=this.getAttributeInfo(t);return n?n.location:-1}getAttributeAccessor(t){const n=this.getAttributeInfo(t);return n?n.accessor:null}getVaryingInfo(t){const n=Number(t);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(t){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(t){const{gl:n}=t,r=n.getProgramParameter(t.handle,35721);for(let o=0;o<r;o++){const{name:l,type:s,size:p}=n.getActiveAttrib(t.handle,o),g=n.getAttribLocation(t.handle,l);g>=0&&this._addAttribute(g,l,s,p)}this.attributeInfos.sort((o,l)=>o.location-l.location)}_readVaryingsFromProgram(t){const{gl:n}=t;if(!pn(n))return;const r=n.getProgramParameter(t.handle,35971);for(let o=0;o<r;o++){const{name:l,type:s,size:p}=n.getTransformFeedbackVarying(t.handle,o);this._addVarying(o,l,s,p)}this.varyingInfos.sort((o,l)=>o.location-l.location)}_addAttribute(t,n,r,o){const{type:l,components:s}=uP(r),p={type:l,size:o*s};this._inferProperties(t,n,p);const g={location:t,name:n,accessor:new Po(p)};this.attributeInfos.push(g),this.attributeInfosByLocation[t]=g,this.attributeInfosByName[g.name]=g}_inferProperties(t,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(t,n,r,o){const{type:l,components:s}=uP(r),p=new Po({type:l,size:o*s}),g={location:t,name:n,accessor:p};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const cP=4,TV=35981,EV=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class EL extends fl{get[Symbol.toStringTag](){return"Program"}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n),this.stubRemovedMethods("Program","v6.0",EV),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:o,varyings:l,bufferMode:s=TV}=t;return this.hash=n||"",this.vs=typeof r=="string"?new M0(this.gl,{id:"".concat(t.id,"-vs"),source:r}):r,this.fs=typeof o=="string"?new L0(this.gl,{id:"".concat(t.id,"-fs"),source:o}):o,de(this.vs instanceof M0),de(this.fs instanceof L0),this.uniforms={},this._textureUniforms={},l&&l.length>0&&(Di(this.gl),this.varyings=l,this.gl2.transformFeedbackVaryings(this.handle,l,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new wV(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:n,drawMode:r=4,vertexCount:o,offset:l=0,start:s,end:p,isIndexed:g=!1,indexType:_=5123,instanceCount:w=0,isInstanced:P=w>0,vertexArray:A=null,transformFeedback:M,framebuffer:F,parameters:X={},uniforms:B,samplers:U}=t;if((B||U)&&(ke.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(B||{})),ke.priority>=n){const H=F?F.id:"default",tt="mode=".concat(tu(this.gl,r)," verts=").concat(o," ")+"instances=".concat(w," indexType=").concat(tu(this.gl,_)," ")+"isInstanced=".concat(P," isIndexed=").concat(g," ")+"Framebuffer=".concat(H);ke.log(n,tt)()}return de(A),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||P&&w===0?!1:(A.bindForDraw(o,w,()=>{if(F!==void 0&&(X=Object.assign({},X,{framebuffer:F})),M){const H=bV(r);M.begin(H)}this._bindTextures(),jo(this.gl,X,()=>{g&&P?this.gl2.drawElementsInstanced(r,o,_,l,w):g&&pn(this.gl)&&!isNaN(s)&&!isNaN(p)?this.gl2.drawRangeElements(r,s,p,o,_,l):g?this.gl.drawElements(r,o,_,l):P?this.gl2.drawArraysInstanced(r,l,o,w):this.gl.drawArrays(r,l,o)}),M&&M.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ke.priority>=2&&VU(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in t){const r=t[n],o=this._uniformSetters[n];if(o){let l=r,s=!1;if(l instanceof Ur&&(l=l.texture),l instanceof dc)if(s=this.uniforms[n]!==r,s){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const p=l,{textureIndex:g}=o;p.bind(g),l=g,this._textureUniforms[n]=p}else l=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(l)||s)&&GU(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let t=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),t=t&&r.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const n=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const n=this.gl.getAttachedShaders(t),r={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new M0({handle:o});break;case 35632:r.fs=new L0({handle:o});break}return r}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const n=this._getName();this.id=ou(n)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ke.time(cP,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),ke.timeEnd(cP,"linkProgram for ".concat(this._getName()))(),t.debug||ke.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:o}=UU(r.name);let l=t.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=aP(t,l,r),r.size>1)for(let s=0;s<r.size;s++)l=t.getUniformLocation(this.handle,"".concat(o,"[").concat(s,"]")),this._uniformSetters["".concat(o,"[").concat(s,"]")]=aP(t,l,r)}this._textureIndexCounter=0}getActiveUniforms(t,n){return this.gl2.getActiveUniforms(this.handle,t,n)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,n){return this.gl2.getActiveUniformBlockParameter(this.handle,t,n)}uniformBlockBinding(t,n){this.gl2.uniformBlockBinding(this.handle,t,n)}}const SV=34918,PV=34919,AV=35007,CV=36795,IV=35976,MV=35887,LV=36202;class dv extends fl{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=pn(t),o=xw(t,tr.TIMER_QUERY);let l=r||o;for(const s of n)switch(s){case"queries":l=l&&r;break;case"timers":l=l&&o;break;default:de(!1)}return l}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(AV)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?LV:MV)}beginTransformFeedbackQuery(){return this.begin(IV)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,PV);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(CV)}getResult(){return this.gl2.getQueryParameter(this.handle,SV)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,o)=>{const l=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>t?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}_createHandle(){return dv.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class SL extends fl{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return pn(t)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Di(t),super(t,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,pf(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])}),this}setBuffer(t,n){const r=this._getVaryingIndex(t),{buffer:o,byteSize:l,byteOffset:s}=this._getBufferParams(n);return r<0?(this.unused[t]=o,ke.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,o,s,l),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let n,r,o;return t instanceof zn?o=t:(o=t.buffer,r=t.byteSize,n=t.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:r}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const n=Number(t);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:n,byteSize:r,byteOffset:o}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,n,o,r)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const l=n&&n.handle;return!l||o===void 0?this.gl.bindBufferBase(35982,t,l):this.gl.bindBufferRange(35982,t,l,r,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let Cg=null;function kV(e){return(!Cg||Cg.byteLength<e)&&(Cg=new ArrayBuffer(e)),Cg}function OV(e,t){const n=kV(e.BYTES_PER_ELEMENT*t);return new e(n,0,t)}function RV(e){let{target:t,source:n,start:r=0,count:o=1}=e;const l=n.length,s=o*l;let p=0;for(let g=r;p<l;p++)t[g++]=n[p];for(;p<s;)p<s-p?(t.copyWithin(r+p,r,r+p),p*=2):(t.copyWithin(r+p,r,r+s-p),p=s);return t}const zV="elements must be GL.ELEMENT_ARRAY_BUFFER";class So extends fl{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?pn(t)||HM()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new So(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return So.MAX_ATTRIBUTES=So.MAX_ATTRIBUTES||t.getParameter(34921),So.MAX_ATTRIBUTES}static setConstant(t,n,r){switch(r.constructor){case Float32Array:So._setConstantFloatArray(t,n,r);break;case Int32Array:So._setConstantIntArray(t,n,r);break;case Uint32Array:So._setConstantUintArray(t,n,r);break;default:de(!1)}}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(t,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=t,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return So.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return de(!t||t.target===34963,zV),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:o,type:l,stride:s,offset:p,normalized:g,integer:_,divisor:w}=r,{gl:P,gl2:A}=this;return t=Number(t),this.bind(()=>{P.bindBuffer(34962,n.handle),_?(de(pn(P)),A.vertexAttribIPointer(t,o,l,s,p)):P.vertexAttribPointer(t,o,l,g,s,p),P.enableVertexAttribArray(t),A.vertexAttribDivisor(t,w||0)}),this}enable(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&t===0&&!So.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>n?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,n){const r=this._normalizeConstantArrayValue(n),o=r.byteLength*t,l=r.length*t;let s=!this.buffer;if(this.buffer=this.buffer||new zn(this.gl,o),s=s||this.buffer.reallocate(o),s=s||!this._compareConstantArrayValues(r,this.bufferValue),s){const p=OV(n.constructor,l);RV({target:p,source:r,start:0,count:l}),this.buffer.subData(p),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,n){if(!t||!n||t.length!==n.length||t.constructor!==n.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==n[r])return!1;return!0}static _setConstantFloatArray(t,n,r){switch(r.length){case 1:t.vertexAttrib1fv(n,r);break;case 2:t.vertexAttrib2fv(n,r);break;case 3:t.vertexAttrib3fv(n,r);break;case 4:t.vertexAttrib4fv(n,r);break;default:de(!1)}}static _setConstantIntArray(t,n,r){switch(de(pn(t)),r.length){case 1:t.vertexAttribI1iv(n,r);break;case 2:t.vertexAttribI2iv(n,r);break;case 3:t.vertexAttribI3iv(n,r);break;case 4:t.vertexAttribI4iv(n,r);break;default:de(!1)}}static _setConstantUintArray(t,n,r){switch(de(pn(t)),r.length){case 1:t.vertexAttribI1uiv(n,r);break;case 2:t.vertexAttribI2uiv(n,r);break;case 3:t.vertexAttribI3uiv(n,r);break;case 4:t.vertexAttribI4uiv(n,r);break;default:de(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,n){let{location:r}=n;return de(Number.isFinite(r)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(r,t);default:return this.gl.getVertexAttrib(r,t)}})}}const DV="VertexArray: attributes must be Buffers or constants (i.e. typed array)",FV=/^(.+)__LOCATION_([0-9]+)$/,NV=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class BV{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new So(t),fL(this,"VertexArray","v6.0",NV),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const n in t){const r=t[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,n),this}setBuffer(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:o,accessor:l}=this._resolveLocationAndAccessor(t,n,n.accessor,r);return o>=0&&(this.values[o]=n,this.accessors[o]=l,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,l)),this}setConstant(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:l}=this._resolveLocationAndAccessor(t,n,Object.assign({size:n.length},r));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=l,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new zn(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof zn&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const n=this.values[t];n instanceof zn&&this.setBuffer(t,n)}}),this}bindForDraw(t,n,r){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,n),o=r()}),o}_resolveLocationAndAccessor(t,n,r,o){const l={location:-1,accessor:null},{location:s,name:p}=this._getAttributeIndex(t);if(!Number.isFinite(s)||s<0)return this.unused[t]=n,ke.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),l;const g=this._getAttributeInfo(p||s);if(!g)return l;const _=this.accessors[s]||{},w=Po.resolve(g.accessor,_,r,o),{size:P,type:A}=w;return de(Number.isFinite(P)&&Number.isFinite(A)),{location:s,accessor:w}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const n=Number(t);if(Number.isFinite(n))return{location:n};const r=FV.exec(t),o=r?r[1]:t,l=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+l,name:o}:{location:-1}}_setAttribute(t,n){if(n instanceof zn)this.setBuffer(t,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof zn){const r=n[0],o=n[1];this.setBuffer(t,r,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(t,r)}else if(n.buffer instanceof zn){const r=n;this.setBuffer(t,r.buffer,r)}else throw new Error(DV)}_setConstantAttributes(t,n){const r=Math.max(t|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,r);for(let l=1;l<this.vertexArrayObject.MAX_ATTRIBUTES;l++)o=this.values[l],ArrayBuffer.isView(o)&&this._setConstantAttribute(l,o)}_setConstantAttributeZero(t,n){if(So.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const r=this.vertexArrayObject.getConstantBuffer(n,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(t,n){So.setConstant(this.gl,t,n)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(t,n);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,n){const r=this.values[n],o=this.accessors[n];if(!r)return;const{divisor:l}=o,s=l>0;if(t.isInstanced=t.isInstanced||s,r instanceof zn){const p=r;if(s){const g=p.getVertexCount(o);t.instanceCount=Math.min(t.instanceCount,g)}else{const g=p.getVertexCount(o);t.vertexCount=Math.min(t.vertexCount,g)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ke.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,n)}}function UV(e,t){const{maxElts:n=16,size:r=1}=t;let o="[";for(let s=0;s<e.length&&s<n;++s)s>0&&(o+=",".concat(s%r===0?" ":"")),o+=bd(e[s],t);const l=e.length>n?"...":"]";return"".concat(o).concat(l)}function bd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return UV(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<n)return r?"0":"0.";if(r||Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const o=e.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function hP(e){let{header:t="Uniforms",program:n,uniforms:r,undefinedOnly:o=!1}=e;de(n);const l=".*_.*",s=".*Matrix",p=n._uniformSetters,g={},_=Object.keys(p).sort();let w=0;for(const M of _)!M.match(l)&&!M.match(s)&&k0({table:g,header:t,uniforms:r,uniformName:M,undefinedOnly:o})&&w++;for(const M of _)M.match(s)&&k0({table:g,header:t,uniforms:r,uniformName:M,undefinedOnly:o})&&w++;for(const M of _)g[M]||k0({table:g,header:t,uniforms:r,uniformName:M,undefinedOnly:o})&&w++;let P=0;const A={};if(!o)for(const M in r){const F=r[M];g[M]||(P++,A[M]={Type:"NOT USED: ".concat(F),[t]:bd(F)})}return{table:g,count:w,unusedTable:A,unusedCount:P}}function k0(e){let{table:t,header:n,uniforms:r,uniformName:o,undefinedOnly:l}=e;const s=r[o],p=VV(s);return!l||!p?(t[o]={[n]:p?bd(s):"N/A","Uniform Type":p?s:"NOT PROVIDED"},!0):!1}function VV(e){return e!=null}function jV(e){let{vertexArray:t,header:n="Attributes"}=e;if(!t.configuration)return{};const r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=fP(t,t.elements,null,n));const o=t.values;for(const l in o){const s=t._getAttributeInfo(l);if(s){let p="".concat(l,": ").concat(s.name);const g=t.accessors[s.location];g&&(p="".concat(l,": ").concat(GV(s.name,g))),r[p]=fP(t,o[l],g,n)}}return r}function fP(e,t,n,r){const{gl:o}=e;if(!t)return{[r]:"null","Format ":"N/A"};let l="NOT PROVIDED",s=1,p=0,g=0,_,w,P;if(n&&(l=n.type,s=n.size,l=String(l).replace("Array",""),_=l.indexOf("nt")!==-1),t instanceof zn){const A=t,{data:M,changed:F}=A.getDebugData();w=F?"*":"",P=M,g=A.byteLength,p=g/M.BYTES_PER_ELEMENT/s;let X;if(n){const B=n.divisor>0;X="".concat(B?"I ":"P "," ").concat(p," (x").concat(s,"=").concat(g," bytes ").concat(tu(o,l),")")}else _=!0,X="".concat(g," bytes");return{[r]:"".concat(w).concat(bd(P,{size:s,isInteger:_})),"Format ":X}}return P=t,s=t.length,l=String(t.constructor.name).replace("Array",""),_=l.indexOf("nt")!==-1,{[r]:"".concat(bd(P,{size:s,isInteger:_})," (constant)"),"Format ":"".concat(s,"x").concat(l," (constant)")}}function GV(e,t){const{type:n,size:r}=t,o=TL(n,r);return o?"".concat(e," (").concat(o.name,")"):e}function WV(e){const t={},n="Accessors for ".concat(e.id);for(const r of e.attributeInfos)if(r){const o=pP(r);t["in ".concat(o)]={[n]:JSON.stringify(r.accessor)}}for(const r of e.varyingInfos)if(r){const o=pP(r);t["out ".concat(o)]={[n]:JSON.stringify(r.accessor)}}return t}function pP(e){const{type:t,size:n}=e.accessor,r=TL(t,n);return r?"".concat(r.name," ").concat(e.name):e.name}const dP=hl()&&typeof document<"u";let HV=0;class qV{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=B=>hL(B),onAddHTML:r=null,onInitialize:o=()=>{},onRender:l=()=>{},onFinalize:s=()=>{},onError:p,gl:g=null,glOptions:_={},debug:w=!1,createFramebuffer:P=!1,autoResizeViewport:A=!0,autoResizeDrawingBuffer:M=!0,stats:F=nc.get("animation-loop-".concat(HV++))}=t;let{useDevicePixels:X=!0}=t;"useDevicePixelRatio"in t&&(ke.deprecated("useDevicePixelRatio","useDevicePixels")(),X=t.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:o,onRender:l,onFinalize:s,onError:p,gl:g,glOptions:_,debug:w,createFramebuffer:P},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=F,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:A,autoResizeDrawingBuffer:M,useDevicePixels:X}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return de(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=dv.isSupported(this.gl,["timers"])?new dv(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(t);return r?Number(r.value):n}setViewParameters(){return ke.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=dP?new Promise((t,n)=>{if(dP&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):J6(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):K6(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:n,aspect:r}=this._getSizeAndAspect();(t!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?yw(this.props.gl,t):this.onCreateContext(t),!Xv(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");N6(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:o}=this.gl;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:t>0&&n>0&&(r=t/n),{width:t,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&G6(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ur(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Hd="vs",ww="fs";function Io(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const O0={number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},array:{validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function ZV(e){const t={};for(const n in e){const r=e[n],o=XV(r);t[n]=o}return t}function XV(e){let t=mP(e);return t==="object"?e?"type"in e?Object.assign({},e,O0[e.type]):"value"in e?(t=mP(e.value),Object.assign({type:t},e,O0[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},O0[t])}function mP(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const $V="vs",YV="fs";class gP{constructor(t){let{name:n,vs:r,fs:o,dependencies:l=[],uniforms:s,getUniforms:p,deprecations:g=[],defines:_={},inject:w={},vertexShader:P,fragmentShader:A}=t;Io(typeof n=="string"),this.name=n,this.vs=r||P,this.fs=o||A,this.getModuleUniforms=p,this.dependencies=l,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=_,this.injections=KV(w),s&&(this.uniforms=ZV(s))}getModuleSource(t){let n;switch(t){case $V:n=this.vs||"";break;case YV:n=this.fs||"";break;default:Io(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,n){return this.getModuleUniforms?this.getModuleUniforms(t,n):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,n){this.deprecations.forEach(r=>{r.regex.test(t)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(t){return t.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const o in r){const l=r[o];o in t&&!l.private?(l.validate&&Io(l.validate(t[o],l),"".concat(this.name,": invalid ").concat(o)),n[o]=t[o]):n[o]=l.value}return n}}function KV(e){const t={vs:{},fs:{}};for(const n in e){let r=e[n];const o=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),t[o][n]=r}return t}function JV(e){return QV(AL(e))}function QV(e){const t={},n={};return PL({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort((r,o)=>n[o]-n[r]).map(r=>t[r])}function PL(e){let{modules:t,level:n,moduleMap:r,moduleDepth:o}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const l of t)r[l.name]=l,(o[l.name]===void 0||o[l.name]<n)&&(o[l.name]=n);for(const l of t)l.dependencies&&PL({modules:l.dependencies,level:n+1,moduleMap:r,moduleDepth:o})}function AL(e,t){return e.map(n=>(n instanceof gP||(Io(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Io(n.name,"shader module has no name"),n=new gP(n),n.dependencies=AL(n.dependencies)),n))}function tj(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},n=e.userAgent||t.userAgent||"",r=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return r||o}const ej=7936,nj=7937,rj=7938,ij=35724,Tw={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Xu={};Object.keys(Tw).forEach(e=>{Xu[e]=e});function oj(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function sj(e){const t=e.getExtension("WEBGL_debug_renderer_info"),n=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||ej),r=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||nj);return{gpuVendor:aj(n,r),vendor:n,renderer:r,version:e.getParameter(rj),shadingLanguageVersion:e.getParameter(ij)}}function aj(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const R0={};function yP(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Tw[t];if(Io(r,t),!tj(n))return!0;if(t in R0)return R0[t];const o=r[0],l=n.behavior||"enable",s="#extension GL_".concat(o," : ").concat(l,`
void main(void) {}`),p=e.createShader(35633);e.shaderSource(p,s),e.compileShader(p);const g=e.getShaderParameter(p,35713);return e.deleteShader(p),R0[t]=g,g}function lj(e,t){const n=Tw[t];Io(n,t);const r=oj(e)&&n[1]||n[0],o=typeof r=="string"?Boolean(e.getExtension(r)):r;return Io(o===!1||o===!0),o}function Ig(e,t){return t=Array.isArray(t)?t:[t],t.every(n=>lj(e,n))}function uj(e){switch(sj(e).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function cj(e,t,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Ig(e,Xu.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Ig(e,Xu.GLSL_DERIVATIVES)&&yP(e,Xu.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Ig(e,Xu.GLSL_FRAG_DATA)&&yP(e,Xu.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Ig(e,Xu.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const hj=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fj=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,pj={[Hd]:hj,[ww]:fj},xy="__LUMA_INJECT_DECLARATIONS__",vP=/void\s+main\s*\([^)]*\)\s*\{\n?/,_P=/}\n?[^{}]*$/,z0=[];function xP(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=t===Hd;for(const l in n){const s=n[l];s.sort((g,_)=>g.order-_.order),z0.length=s.length;for(let g=0,_=s.length;g<_;++g)z0[g]=s[g].injection;const p="".concat(z0.join(`
`),`
`);switch(l){case"vs:#decl":o&&(e=e.replace(xy,p));break;case"vs:#main-start":o&&(e=e.replace(vP,g=>g+p));break;case"vs:#main-end":o&&(e=e.replace(_P,g=>p+g));break;case"fs:#decl":o||(e=e.replace(xy,p));break;case"fs:#main-start":o||(e=e.replace(vP,g=>g+p));break;case"fs:#main-end":o||(e=e.replace(_P,g=>p+g));break;default:e=e.replace(l,g=>g+p)}}return e=e.replace(xy,""),r&&(e=e.replace(/\}\s*$/,l=>l+pj[t])),e}function S1(e){const t={};return Io(Array.isArray(e)&&e.length>1),e.forEach(n=>{for(const r in n)t[r]=t[r]?"".concat(t[r],`
`).concat(n[r]):n[r]}),t}function df(e){return new RegExp("\\b".concat(e,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const CL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],dj=[...CL,[df("attribute"),"in $1"],[df("varying"),"out $1"]],mj=[...CL,[df("varying"),"in $1"]],IL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],gj=[...IL,[df("in"),"attribute $1"],[df("out"),"varying $1"]],yj=[...IL,[df("in"),"varying $1"]],P1="gl_FragColor",A1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,vj=/void\s+main\s*\([^)]*\)\s*\{\n?/;function _j(e,t,n){switch(t){case 300:return n?mv(e,dj):xj(e);case 100:return n?mv(e,gj):bj(e);default:throw new Error("unknown GLSL version ".concat(t))}}function mv(e,t){for(const[n,r]of t)e=e.replace(n,r);return e}function xj(e){e=mv(e,mj);const t=e.match(A1);if(t){const n=t[1];e=e.replace(new RegExp("\\b".concat(P1,"\\b"),"g"),n)}else{const n="fragmentColor";e=e.replace(vj,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(P1,"\\b"),"g"),n)}return e}function bj(e){e=mv(e,yj);const t=e.match(A1);if(t){const n=t[1];e=e.replace(A1,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),P1)}return e}const wj=`

`.concat(xy,`

`),ML={[Hd]:"vertex",[ww]:"fragment"},Tj=`precision highp float;

`;function Ej(e,t){const{vs:n,fs:r}=t,o=JV(t.modules||[]);return{gl:e,vs:bP(e,Object.assign({},t,{source:n,type:Hd,modules:o})),fs:bP(e,Object.assign({},t,{source:r,type:ww,modules:o})),getUniforms:Sj(o)}}function bP(e,t){let{id:n,source:r,type:o,modules:l,defines:s={},hookFunctions:p=[],inject:g={},transpileToGLSL100:_=!1,prologue:w=!0,log:P}=t;Io(typeof r=="string","shader source must be a string");const A=o===Hd,M=r.split(`
`);let F=100,X="",B=r;M[0].indexOf("#version ")===0?(F=300,X=M[0],B=M.slice(1).join(`
`)):X="#version ".concat(F);const U={};l.forEach(Ot=>{Object.assign(U,Ot.getDefines())}),Object.assign(U,s);let H=w?"".concat(X,`
`).concat(Aj({id:n,source:r,type:o}),`
`).concat(Pj({type:o}),`
`).concat(uj(e),`
`).concat(cj(e),`
`).concat(Cj(U),`
`).concat(A?"":Tj,`
`):"".concat(X,`
`);const tt=Mj(p),st={},pt={},_t={};for(const Ot in g){const Dt=typeof g[Ot]=="string"?{injection:g[Ot],order:0}:g[Ot],kt=Ot.match(/^(v|f)s:(#)?([\w-]+)$/);if(kt){const qt=kt[2],ee=kt[3];qt?ee==="decl"?pt[Ot]=[Dt]:_t[Ot]=[Dt]:st[Ot]=[Dt]}else _t[Ot]=[Dt]}for(const Ot of l){P&&Ot.checkDeprecations(B,P);const Dt=Ot.getModuleSource(o,F);H+=Dt;const kt=Ot.injections[o];for(const qt in kt){const ee=qt.match(/^(v|f)s:#([\w-]+)$/);if(ee){const ae=ee[2]==="decl"?pt:_t;ae[qt]=ae[qt]||[],ae[qt].push(kt[qt])}else st[qt]=st[qt]||[],st[qt].push(kt[qt])}}return H+=wj,H=xP(H,o,pt),H+=Ij(tt[o],st),H+=B,H=xP(H,o,_t),H=_j(H,_?100:F,A),H}function Sj(e){return function(n){const r={};for(const o of e){const l=o.getUniforms(n,r);Object.assign(r,l)}return r}}function Pj(e){let{type:t}=e;return`
#define SHADER_TYPE_`.concat(ML[t].toUpperCase(),`
`)}function Aj(e){let{id:t,source:n,type:r}=e;return t&&typeof t=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(ML[r],`

`):""}function Cj(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,n="";for(const r in e){t===0&&(n+=`
// APPLICATION DEFINES
`),t++;const o=e[r];(o||Number.isFinite(o))&&(n+="#define ".concat(r.toUpperCase()," ").concat(e[r],`
`))}return t===0&&(n+=`
`),n}function Ij(e,t){let n="";for(const r in e){const o=e[r];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),t[r]){const l=t[r];l.sort((s,p)=>s.order-p.order);for(const s of l)n+="  ".concat(s.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function Mj(e){const t={vs:{},fs:{}};return e.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[o,l]=n.split(":"),s=n.replace(/\(.+/,"");t[o][s]=Object.assign(r,{signature:l})}),t}const Lj="void main() {gl_FragColor = vec4(0);}",LL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,kj=`#version 300 es
`.concat(LL);function kL(e,t){t=Array.isArray(t)?t:[t];const n=e.replace(/^\s+/,"").split(/\s+/),[r,o,l]=n;if(!t.includes(r)||!o||!l)return null;const s=l.split(";")[0];return{qualifier:r,type:o,name:s}}function OL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:n,inputType:r,output:o}=e;if(!n)return t===300?kj:t>300?"#version ".concat(t,`
`).concat(LL):Lj;const l=zj(n,r);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(l,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(l,`;
}`)}function Oj(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Io(!1),null}}function Rj(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Io(!1),null}}function zj(e,t){switch(t){case"float":return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(e,", 0.0, 1.0)");case"vec3":return"vec4(".concat(e,", 1.0)");case"vec4":return e;default:return Io(!1),null}}const Dj=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Fj={name:"fp32",vs:Dj,fs:null};function wd(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}const Hi={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Nj(e,{precision:t=Hi.precision}={}){return e=Bj(e),"".concat(parseFloat(e.toPrecision(t)))}function mc(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ci(e,t,n){return Vj(e,r=>Math.max(t,Math.min(n,r)))}function mf(e,t,n){return mc(e)?e.map((r,o)=>mf(r,t[o],n)):n*t+(1-n)*e}function oa(e,t,n){const r=Hi.EPSILON;n&&(Hi.EPSILON=n);try{if(e===t)return!0;if(mc(e)&&mc(t)){if(e.length!==t.length)return!1;for(let o=0;o<e.length;++o)if(!oa(e[o],t[o]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Hi.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Hi.EPSILON=r}}function Bj(e){return Math.round(e/Hi.EPSILON)*Hi.EPSILON}function Uj(e){return e.clone?e.clone():new Array(e.length)}function Vj(e,t,n){if(mc(e)){const r=e;n=n||Uj(r);for(let o=0;o<n.length&&o<r.length;++o)n[o]=t(e[o],o,n);return n}return t(e)}function jj(e){function t(){var n=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class Ew extends jj(Array){clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+n];return this.check()}toArray(t=[],n=0){for(let r=0;r<this.ELEMENTS;++r)t[n+r]=this[r];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:mc(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Hi)}formatString(t){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+Nj(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!oa(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,r){if(r===void 0)return this.lerp(this,t,n);for(let o=0;o<this.ELEMENTS;++o){const l=t[o];this[o]=l+r*(n[o]-l)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),n[r]);return this.check()}add(...t){for(const n of t)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...t){for(const n of t)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if(Hi.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),n);return this.check()}get elements(){return this}}function Gj(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function Bn(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function rd(e,t,n=""){if(Hi.debug&&!Gj(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}class RL extends Ew{get x(){return this[0]}set x(t){this[0]=Bn(t)}get y(){return this[1]}set y(t){this[1]=Bn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-t[r];n+=o*o}return Bn(n)}dot(t){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*t[r];return Bn(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...t){for(const n of t)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return wd(t>=0&&t<this.ELEMENTS,"index is out of range"),Bn(this[t])}setComponent(t,n){return wd(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}}function Wj(e,t,n){const r=t[0],o=t[1],l=n[3]*r+n[7]*o||1;return e[0]=(n[0]*r+n[4]*o)/l,e[1]=(n[1]*r+n[5]*o)/l,e}function zL(e,t,n){const r=t[0],o=t[1],l=t[2],s=n[3]*r+n[7]*o+n[11]*l||1;return e[0]=(n[0]*r+n[4]*o+n[8]*l)/s,e[1]=(n[1]*r+n[5]*o+n[9]*l)/s,e[2]=(n[2]*r+n[6]*o+n[10]*l)/s,e}function Hj(e,t,n){const r=t[0],o=t[1];return e[0]=n[0]*r+n[2]*o,e[1]=n[1]*r+n[3]*o,e[2]=t[2],e}function qj(e,t,n){const r=t[0],o=t[1];return e[0]=n[0]*r+n[2]*o,e[1]=n[1]*r+n[3]*o,e[2]=t[2],e[3]=t[3],e}function DL(e,t,n){const r=t[0],o=t[1],l=t[2];return e[0]=n[0]*r+n[3]*o+n[6]*l,e[1]=n[1]*r+n[4]*o+n[7]*l,e[2]=n[2]*r+n[5]*o+n[8]*l,e[3]=t[3],e}const D0=[0,0,0];let Mg;class be extends RL{static get ZERO(){return Mg||(Mg=new be(0,0,0),Object.freeze(Mg)),Mg}constructor(t=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&mc(t)?this.copy(t):(Hi.debug&&(Bn(t),Bn(n),Bn(r)),this[0]=t,this[1]=n,this[2]=r)}set(t,n,r){return this[0]=t,this[1]=n,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Hi.debug&&(Bn(t.x),Bn(t.y),Bn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Bn(t)}angle(t){return YD(this,t)}cross(t){return dy(this,this,t),this.check()}rotateX({radians:t,origin:n=D0}){return ZD(this,this,n,t),this.check()}rotateY({radians:t,origin:n=D0}){return XD(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=D0}){return $D(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Hb(this,this,t),this.check()}transformAsVector(t){return zL(this,this,t),this.check()}transformByMatrix3(t){return oM(this,this,t),this.check()}transformByMatrix2(t){return Hj(this,this,t),this.check()}transformByQuaternion(t){return sM(this,this,t),this.check()}}let Lg;class Sw extends RL{static get ZERO(){return Lg||(Lg=new Sw(0,0,0,0),Object.freeze(Lg)),Lg}constructor(t=0,n=0,r=0,o=0){super(-0,-0,-0,-0),mc(t)&&arguments.length===1?this.copy(t):(Hi.debug&&(Bn(t),Bn(n),Bn(r),Bn(o)),this[0]=t,this[1]=n,this[2]=r,this[3]=o)}set(t,n,r,o){return this[0]=t,this[1]=n,this[2]=r,this[3]=o,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Hi.debug&&(Bn(t.x),Bn(t.y),Bn(t.z),Bn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Bn(t)}get w(){return this[3]}set w(t){this[3]=Bn(t)}transform(t){return Hb(this,this,t),this.check()}transformByMatrix3(t){return DL(this,this,t),this.check()}transformByMatrix2(t){return qj(this,this,t),this.check()}transformByQuaternion(t){return sM(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class FL extends Ew{toString(){let t="[";if(Hi.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+n])}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,r){return this[n*this.RANK+t]=Bn(r),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[r+o];return n}setColumn(t,n){const r=t*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=n[o];return this}}function Zj(){var e=new ps(9);return ps!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Xj(e,t){if(e===t){var n=t[1],r=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function $j(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=t[4],p=t[5],g=t[6],_=t[7],w=t[8],P=w*s-p*_,A=-w*l+p*g,M=_*l-s*g,F=n*P+r*A+o*M;return F?(F=1/F,e[0]=P*F,e[1]=(-w*r+o*_)*F,e[2]=(p*r-o*s)*F,e[3]=A*F,e[4]=(w*n-o*g)*F,e[5]=(-p*n+o*l)*F,e[6]=M*F,e[7]=(-_*n+r*g)*F,e[8]=(s*n-r*l)*F,e):null}function Yj(e){var t=e[0],n=e[1],r=e[2],o=e[3],l=e[4],s=e[5],p=e[6],g=e[7],_=e[8];return t*(_*l-s*g)+n*(-_*o+s*p)+r*(g*o-l*p)}function wP(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3],p=t[4],g=t[5],_=t[6],w=t[7],P=t[8],A=n[0],M=n[1],F=n[2],X=n[3],B=n[4],U=n[5],H=n[6],tt=n[7],st=n[8];return e[0]=A*r+M*s+F*_,e[1]=A*o+M*p+F*w,e[2]=A*l+M*g+F*P,e[3]=X*r+B*s+U*_,e[4]=X*o+B*p+U*w,e[5]=X*l+B*g+U*P,e[6]=H*r+tt*s+st*_,e[7]=H*o+tt*p+st*w,e[8]=H*l+tt*g+st*P,e}function Kj(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3],p=t[4],g=t[5],_=t[6],w=t[7],P=t[8],A=n[0],M=n[1];return e[0]=r,e[1]=o,e[2]=l,e[3]=s,e[4]=p,e[5]=g,e[6]=A*r+M*s+_,e[7]=A*o+M*p+w,e[8]=A*l+M*g+P,e}function Jj(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3],p=t[4],g=t[5],_=t[6],w=t[7],P=t[8],A=Math.sin(n),M=Math.cos(n);return e[0]=M*r+A*s,e[1]=M*o+A*p,e[2]=M*l+A*g,e[3]=M*s-A*r,e[4]=M*p-A*o,e[5]=M*g-A*l,e[6]=_,e[7]=w,e[8]=P,e}function TP(e,t,n){var r=n[0],o=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Qj(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=n+n,p=r+r,g=o+o,_=n*s,w=r*s,P=r*p,A=o*s,M=o*p,F=o*g,X=l*s,B=l*p,U=l*g;return e[0]=1-P-F,e[3]=w-U,e[6]=A+B,e[1]=w+U,e[4]=1-_-F,e[7]=M-X,e[2]=A-B,e[5]=M+X,e[8]=1-_-P,e}var C1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(C1||(C1={}));const t8=Object.freeze([1,0,0,0,1,0,0,0,1]);class hi extends FL{static get IDENTITY(){return n8()}static get ZERO(){return e8()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return C1}constructor(t,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(t8)}fromObject(t){return this.check()}fromQuaternion(t){return Qj(this,t),this.check()}set(t,n,r,o,l,s,p,g,_){return this[0]=t,this[1]=n,this[2]=r,this[3]=o,this[4]=l,this[5]=s,this[6]=p,this[7]=g,this[8]=_,this.check()}setRowMajor(t,n,r,o,l,s,p,g,_){return this[0]=t,this[1]=o,this[2]=p,this[3]=n,this[4]=l,this[5]=g,this[6]=r,this[7]=s,this[8]=_,this.check()}determinant(){return Yj(this)}transpose(){return Xj(this,this),this.check()}invert(){return $j(this,this),this.check()}multiplyLeft(t){return wP(this,t,this),this.check()}multiplyRight(t){return wP(this,this,t),this.check()}rotate(t){return Jj(this,this,t),this.check()}scale(t){return Array.isArray(t)?TP(this,this,t):TP(this,this,[t,t]),this.check()}translate(t){return Kj(this,this,t),this.check()}transform(t,n){let r;switch(t.length){case 2:r=DD(n||[-0,-0],t,this);break;case 3:r=oM(n||[-0,-0,-0],t,this);break;case 4:r=DL(n||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return rd(r,t.length),r}transformVector(t,n){return this.transform(t,n)}transformVector2(t,n){return this.transform(t,n)}transformVector3(t,n){return this.transform(t,n)}}let kg,Og;function e8(){return kg||(kg=new hi([0,0,0,0,0,0,0,0,0]),Object.freeze(kg)),kg}function n8(){return Og||(Og=new hi,Object.freeze(Og)),Og}var I1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(I1||(I1={}));const r8=45*Math.PI/180,i8=1,F0=.1,N0=500,o8=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class fi extends FL{static get IDENTITY(){return a8()}static get ZERO(){return s8()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return I1}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,r,o,l,s,p,g,_,w,P,A,M,F,X,B){return this[0]=t,this[1]=n,this[2]=r,this[3]=o,this[4]=l,this[5]=s,this[6]=p,this[7]=g,this[8]=_,this[9]=w,this[10]=P,this[11]=A,this[12]=M,this[13]=F,this[14]=X,this[15]=B,this.check()}setRowMajor(t,n,r,o,l,s,p,g,_,w,P,A,M,F,X,B){return this[0]=t,this[1]=l,this[2]=_,this[3]=M,this[4]=n,this[5]=s,this[6]=w,this[7]=F,this[8]=r,this[9]=p,this[10]=P,this[11]=X,this[12]=o,this[13]=g,this[14]=A,this[15]=B,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(o8)}fromObject(t){return this.check()}fromQuaternion(t){return PD(this,t),this.check()}frustum(t){const{left:n,right:r,bottom:o,top:l,near:s=F0,far:p=N0}=t;return p===1/0?l8(this,n,r,o,l,s):AD(this,n,r,o,l,s,p),this.check()}lookAt(t){const{eye:n,center:r=[0,0,0],up:o=[0,1,0]}=t;return LD(this,n,r,o),this.check()}ortho(t){const{left:n,right:r,bottom:o,top:l,near:s=F0,far:p=N0}=t;return MD(this,n,r,o,l,s,p),this.check()}orthographic(t){const{fovy:n=r8,aspect:r=i8,focalDistance:o=1,near:l=F0,far:s=N0}=t;EP(n);const p=n/2,g=o*Math.tan(p),_=g*r;return this.ortho({left:-_,right:_,bottom:-g,top:g,near:l,far:s})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:r=1,near:o=.1,far:l=500}=t;return EP(n),eM(this,n,r,o,l),this.check()}determinant(){return wD(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),o=1/r[0],l=1/r[1],s=1/r[2];return t[0]=this[0]*o,t[1]=this[1]*l,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*o,t[5]=this[5]*l,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*o,t[9]=this[9]*l,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),o=1/r[0],l=1/r[1],s=1/r[2];return t[0]=this[0]*o,t[1]=this[1]*l,t[2]=this[2]*s,t[3]=this[4]*o,t[4]=this[5]*l,t[5]=this[6]*s,t[6]=this[8]*o,t[7]=this[9]*l,t[8]=this[10]*s,t}transpose(){return bD(this,this),this.check()}invert(){return rv(this,this),this.check()}multiplyLeft(t){return ra(this,t,this),this.check()}multiplyRight(t){return ra(this,this,t),this.check()}rotateX(t){return QI(this,this,t),this.check()}rotateY(t){return ED(this,this,t),this.check()}rotateZ(t){return tM(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return TD(this,this,t,n),this.check()}scale(t){return Gv(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return md(this,this,t),this.check()}transform(t,n){return t.length===4?(n=bf(n||[-0,-0,-0,-0],t,this),rd(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:r}=t;let o;switch(r){case 2:o=FD(n||[-0,-0],t,this);break;case 3:o=Hb(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return rd(o,t.length),o}transformAsVector(t,n){let r;switch(t.length){case 2:r=Wj(n||[-0,-0],t,this);break;case 3:r=zL(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return rd(r,t.length),r}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,r){return this.identity().translate([t,n,r])}}let Rg,zg;function s8(){return Rg||(Rg=new fi([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Rg)),Rg}function a8(){return zg||(zg=new fi,Object.freeze(zg)),zg}function EP(e){if(e>Math.PI*2)throw Error("expected radians")}function l8(e,t,n,r,o,l){const s=2*l/(n-t),p=2*l/(o-r),g=(n+t)/(n-t),_=(o+r)/(o-r),w=-1,P=-1,A=-2*l;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=g,e[9]=_,e[10]=w,e[11]=P,e[12]=0,e[13]=0,e[14]=A,e[15]=0,e}function SP(){var e=new ps(4);return ps!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function u8(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function NL(e,t,n){n=n*.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function PP(e,t,n){var r=t[0],o=t[1],l=t[2],s=t[3],p=n[0],g=n[1],_=n[2],w=n[3];return e[0]=r*w+s*p+o*_-l*g,e[1]=o*w+s*g+l*p-r*_,e[2]=l*w+s*_+r*g-o*p,e[3]=s*w-r*p-o*g-l*_,e}function c8(e,t,n){n*=.5;var r=t[0],o=t[1],l=t[2],s=t[3],p=Math.sin(n),g=Math.cos(n);return e[0]=r*g+s*p,e[1]=o*g+l*p,e[2]=l*g-o*p,e[3]=s*g-r*p,e}function h8(e,t,n){n*=.5;var r=t[0],o=t[1],l=t[2],s=t[3],p=Math.sin(n),g=Math.cos(n);return e[0]=r*g-l*p,e[1]=o*g+s*p,e[2]=l*g+r*p,e[3]=s*g-o*p,e}function f8(e,t,n){n*=.5;var r=t[0],o=t[1],l=t[2],s=t[3],p=Math.sin(n),g=Math.cos(n);return e[0]=r*g+o*p,e[1]=o*g-r*p,e[2]=l*g+s*p,e[3]=s*g-l*p,e}function p8(e,t){var n=t[0],r=t[1],o=t[2];return e[0]=n,e[1]=r,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-o*o)),e}function by(e,t,n,r){var o=t[0],l=t[1],s=t[2],p=t[3],g=n[0],_=n[1],w=n[2],P=n[3],A,M,F,X,B;return M=o*g+l*_+s*w+p*P,M<0&&(M=-M,g=-g,_=-_,w=-w,P=-P),1-M>kr?(A=Math.acos(M),F=Math.sin(A),X=Math.sin((1-r)*A)/F,B=Math.sin(r*A)/F):(X=1-r,B=r),e[0]=X*o+B*g,e[1]=X*l+B*_,e[2]=X*s+B*w,e[3]=X*p+B*P,e}function d8(e,t){var n=t[0],r=t[1],o=t[2],l=t[3],s=n*n+r*r+o*o+l*l,p=s?1/s:0;return e[0]=-n*p,e[1]=-r*p,e[2]=-o*p,e[3]=l*p,e}function m8(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function BL(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);var l=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[o*3+o]-t[l*3+l]-t[s*3+s]+1),e[o]=.5*r,r=.5/r,e[3]=(t[l*3+s]-t[s*3+l])*r,e[l]=(t[l*3+o]+t[o*3+l])*r,e[s]=(t[s*3+o]+t[o*3+s])*r}return e}var g8=hD,y8=jb,v8=mD,_8=gD,x8=fD,b8=pD,UL=dD,w8=function(){var e=rM(),t=ES(1,0,0),n=ES(0,1,0);return function(r,o,l){var s=iM(o,l);return s<-.999999?(dy(e,t,o),lM(e)<1e-6&&dy(e,n,o),HD(e,e),NL(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(dy(e,o,l),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,UL(r,r))}}();(function(){var e=SP(),t=SP();return function(n,r,o,l,s,p){return by(e,r,s,p),by(t,o,l,p),by(n,e,t,2*p*(1-p)),n}})();(function(){var e=Zj();return function(t,n,r,o){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],UL(t,BL(t,e))}})();const T8=[0,0,0,1];class AP extends Ew{constructor(t=0,n=0,r=0,o=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,n,r,o)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,n,r,o){return this[0]=t,this[1]=n,this[2]=r,this[3]=o,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return BL(this,t),this.check()}fromAxisRotation(t,n){return NL(this,t,n),this.check()}identity(){return u8(this),this.check()}setAxisAngle(t,n){return this.fromAxisRotation(t,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Bn(t)}get y(){return this[1]}set y(t){this[1]=Bn(t)}get z(){return this[2]}set z(t){this[2]=Bn(t)}get w(){return this[3]}set w(t){this[3]=Bn(t)}len(){return x8(this)}lengthSquared(){return b8(this)}dot(t){return v8(this,t)}rotationTo(t,n){return w8(this,t,n),this.check()}add(t){return g8(this,this,t),this.check()}calculateW(){return p8(this,this),this.check()}conjugate(){return m8(this,this),this.check()}invert(){return d8(this,this),this.check()}lerp(t,n,r){return r===void 0?this.lerp(this,t,n):(_8(this,t,n,r),this.check())}multiplyRight(t){return PP(this,this,t),this.check()}multiplyLeft(t){return PP(this,t,this),this.check()}normalize(){const t=this.len(),n=t>0?1/t:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,t===0&&(this[3]=1),this.check()}rotateX(t){return c8(this,this,t),this.check()}rotateY(t){return h8(this,this,t),this.check()}rotateZ(t){return f8(this,this,t),this.check()}scale(t){return y8(this,this,t),this.check()}slerp(t,n,r){let o,l,s;switch(arguments.length){case 1:({start:o=T8,target:l,ratio:s}=t);break;case 2:o=this,l=t,s=n;break;default:o=t,l=n,s=r}return by(this,o,l,s),this.check()}transformVector4(t,n=new Sw){return yD(n,t,this),rd(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,n){return this.setAxisAngle(t,n)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const VL={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},CP=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,E8={lightSources:{}};function B0(){let{color:e=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.map(n=>n*t/255)}function S8(e){let{ambientLight:t,pointLights:n=[],directionalLights:r=[]}=e;const o={};return t?o["lighting_uAmbientLight.color"]=B0(t):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((l,s)=>{o["lighting_uPointLight[".concat(s,"].color")]=B0(l),o["lighting_uPointLight[".concat(s,"].position")]=l.position,o["lighting_uPointLight[".concat(s,"].attenuation")]=l.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,r.forEach((l,s)=>{o["lighting_uDirectionalLight[".concat(s,"].color")]=B0(l),o["lighting_uDirectionalLight[".concat(s,"].direction")]=l.direction}),o.lighting_uDirectionalLightCount=r.length,o}function jL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E8;if("lightSources"in e){const{ambientLight:t,pointLights:n,directionalLights:r}=e.lightSources||{};return t||n&&n.length>0||r&&r.length>0?Object.assign({},S8({ambientLight:t,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const t={pointLights:[],directionalLights:[]};for(const n of e.lights||[])switch(n.type){case"ambient":t.ambientLight=n;break;case"directional":t.directionalLights.push(n);break;case"point":t.pointLights.push(n);break}return jL({lightSources:t})}return{}}const P8={name:"lights",vs:CP,fs:CP,getUniforms:jL,defines:{MAX_LIGHTS:3}},A8=new Uint8Array([0,255,255,255]),C8={pickingSelectedColor:null,pickingHighlightColor:A8,pickingActive:!1,pickingAttribute:!1};function I8(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C8;const t={};if(e.pickingSelectedColor!==void 0)if(!e.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const n=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=n}if(e.pickingHighlightColor){const n=Array.from(e.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),t.picking_uHighlightColor=n}return e.pickingActive!==void 0&&(t.picking_uActive=Boolean(e.pickingActive),t.picking_uAttribute=Boolean(e.pickingAttribute)),t}const M8=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,L8=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,k8={name:"picking",vs:M8,fs:L8,getUniforms:I8},O8=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,R8={};function z8(e){const{ambient:t=.35,diffuse:n=.6,shininess:r=32,specularColor:o=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:o.map(l=>l/255)}}function D8(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R8;if(!("material"in e))return{};const{material:t}=e;return t?z8(t):{lighting_uEnabled:!1}}const F8={name:"gouraud-lighting",dependencies:[P8],vs:O8,defines:{LIGHTING_VERTEX:1},getUniforms:D8},N8=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,B8={name:"transform",vs:N8,fs:null};class qd{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new qd(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(n=>n.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const n=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(t,n){n&&(t=Object.assign(n,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:o={},inject:l={},varyings:s=[],bufferMode:p=35981,transpileToGLSL100:g=!1}=t,_=this._getModuleList(t.modules),w=this._getHash(n),P=this._getHash(r),A=_.map(tt=>this._getHash(tt.name)).sort(),M=s.map(tt=>this._getHash(tt)),F=Object.keys(o).sort(),X=Object.keys(l).sort(),B=[],U=[];for(const tt of F)B.push(this._getHash(tt)),B.push(this._getHash(o[tt]));for(const tt of X)U.push(this._getHash(tt)),U.push(this._getHash(l[tt]));const H="".concat(w,"/").concat(P,"D").concat(B.join("/"),"M").concat(A.join("/"),"I").concat(U.join("/"),"V").concat(M.join("/"),"H").concat(this.stateHash,"B").concat(p).concat(g?"T":"");if(!this._programCache[H]){const tt=Ej(this.gl,{vs:n,fs:r,modules:_,inject:l,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[H]=new EL(this.gl,{hash:H,vs:tt.vs,fs:tt.fs,varyings:s,bufferMode:p}),this._getUniforms[H]=tt.getUniforms||(st=>{}),this._useCounts[H]=0}return this._useCounts[H]++,this._programCache[H]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const n=t.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+t.length),r={};let o=0;for(let l=0,s=this._defaultModules.length;l<s;++l){const p=this._defaultModules[l],g=p.name;n[o++]=p,r[g]=!0}for(let l=0,s=t.length;l<s;++l){const p=t[l],g=p.name;r[g]||(n[o++]=p,r[g]=!0)}return n.length=o,n}}const U8={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function V8(e,t,n){const r={};let o=t.indices;for(const l in t.attributes){const s=t.attributes[l],p=j8(l,n);if(l==="indices")o=s;else if(s.constant)r[p]=s.value;else{const g=s.value,_={...s};delete _.value,r[p]=[new zn(e,g),_],G8(l,_)}}if(o){const l=o.value||o;de(l instanceof Uint16Array||l instanceof Uint32Array,'attribute array for "indices" must be of integer type');const s={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};r.indices=[new zn(e,{data:l,target:34963}),s]}return r}function j8(e,t){const{attributeMap:n=U8}=t||{};return n&&n[e]||e}function G8(e,t){let n;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}de(Number.isFinite(t.size),"attribute ".concat(e," needs size"))}const Sh=2,W8=1e4,H8="Model needs drawMode and vertexCount",IP=()=>{},q8={};class gc{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=ou("model")}=n;de(Xv(t)),this.id=r,this.gl=t,this.id=n.id||ou("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(t){this.props={},this.programManager=t.programManager||qd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:o,modules:l,defines:s,inject:p,varyings:g,bufferMode:_,transpileToGLSL100:w}=t;this.programProps={program:n,vs:r,fs:o,modules:l,defines:s,inject:p,varyings:g,bufferMode:_,transpileToGLSL100:w},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},de(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),H8)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:n,vs:r,fs:o,modules:l,defines:s,inject:p,varyings:g,bufferMode:_,transpileToGLSL100:w}=t;this.programProps={program:n,vs:r,fs:o,modules:l,defines:s,inject:p,varyings:g,bufferMode:_,transpileToGLSL100:w},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return de(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return de(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=V8(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(pf(t))return this;const n={};for(const r in t){const o=t[r];n[r]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(t):{}}updateModuleSettings(t){const n=this.getModuleUniforms(t||{});return this.setUniforms(n)}clear(t){return _w(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:o={},attributes:l={},transformFeedback:s=this.transformFeedback,parameters:p={},vertexArray:g=this.vertexArray}=t;this.setAttributes(l),this.updateModuleSettings(n),this.setUniforms(o);let _;ke.priority>=Sh&&(_=this._logDrawCallStart(Sh));const w=this.vertexArray.getDrawParams(),{isIndexed:P=w.isIndexed,indexType:A=w.indexType,indexOffset:M=w.indexOffset,vertexArrayInstanced:F=w.isInstanced}=this.props;F&&!this.isInstanced&&ke.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:X,instanceCount:B}=this,{onBeforeRender:U=IP,onAfterRender:H=IP}=this.props;U(),this.program.setUniforms(this.uniforms);const tt=this.program.draw(Object.assign(q8,t,{logPriority:_,uniforms:null,framebuffer:r,parameters:p,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:s,isIndexed:P,indexType:A,isInstanced:X,instanceCount:B,offset:P?M:0}));return H(),ke.priority>=Sh&&this._logDrawCallEnd(_,g,r),tt}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:o=[]}=t;let{parameters:l}=t;r&&this._setFeedbackBuffers(r),n&&(l=Object.assign({},l,{[35977]:n})),o.forEach(s=>s.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:l}))}finally{o.forEach(s=>s.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ke.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:o,modules:l,inject:s,defines:p,varyings:g,bufferMode:_,transpileToGLSL100:w}=this.programProps;n=this.programManager.get({vs:r,fs:o,modules:l,inject:s,defines:p,varyings:g,bufferMode:_,transpileToGLSL100:w}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}de(n instanceof EL,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new BV(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const n=this.geometryBuffers[t][0]||this.geometryBuffers[t];n instanceof zn&&n.delete()}}_setAnimationProps(t){this.animated&&de(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(pf(t))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new SL(n,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const n=t>3?0:W8;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),ke.group(Sh,">>> DRAWING MODEL ".concat(this.id),{collapsed:ke.level<=2})(),t}_logDrawCallEnd(t,n,r,o){if(t===void 0)return;const l=jV({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:s,unusedTable:p,unusedCount:g}=hP({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:_,count:w}=hP({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});w>0&&ke.log("MISSING UNIFORMS",Object.keys(_))(),g>0&&ke.log("UNUSED UNIFORMS",Object.keys(p))();const P=WV(this.vertexArray.configuration);ke.table(t,l)(),ke.table(t,s)(),ke.table(t+1,P)(),o&&o.log({logLevel:Sh,message:"Rendered to ".concat(o.id)}),ke.groupEnd(Sh)()}}class Z8{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(t){for(const n of this.bindings)this._setupTransformFeedback(n,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(t=Object.assign({},t,{varyings:n})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:o}=n;return{attributes:Object.assign({},r,t.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=t?n[t]:null;return r?r instanceof zn?r:r.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=t,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&de(pn(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:n={}}=t,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const l=this.feedbackMap[o];o in n&&(r[l]=o)}Object.assign(r,t.feedbackBuffers);for(const o in r){const l=r[o];if(typeof l=="string"){const s=n[l],{byteLength:p,usage:g,accessor:_}=s;r[o]=this._createNewBuffer(o,{byteLength:p,usage:g,accessor:_})}}return r}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const r=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(t,n){let{model:r}=n;const{program:o}=r;t.transformFeedback=new SL(this.gl,{program:o,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(t,n){return t?(Object.assign(t.sourceBuffers,n.sourceBuffers),Object.assign(t.feedbackBuffers,n.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const n=Object.assign({},t.sourceBuffers),r=Object.assign({},t.feedbackBuffers);for(const o in this.feedbackMap){const l=this.feedbackMap[o];n[o]=t.feedbackBuffers[l],r[l]=t.sourceBuffers[o],de(r[l]instanceof zn)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(t,n){const r=new zn(this.gl,n);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const X8="transform_uSampler_",gv="transform_uSize_",MP="transform_position";function $8(e){let{vs:t,sourceTextureMap:n,targetTextureVarying:r,targetTexture:o}=e,s=Object.keys(n).length,p=null;const g={};let _=t,w={};if(s>0||r){const P=_.split(`
`),A=P.slice();if(P.forEach((M,F,X)=>{if(s>0){const B=tG(M,n);if(B){const{updatedLine:U,inject:H}=B;A[F]=U,w=S1([w,H]),Object.assign(g,B.samplerTextureMap),s--}}r&&!p&&(p=Q8(M,r))}),r){de(o);const M="".concat(gv).concat(r),F="uniform vec2 ".concat(M,`;
`),X="     vec2 ".concat(MP," = transform_getPos(").concat(M,`);
     gl_Position = vec4(`).concat(MP,`, 0, 1.);
`);w=S1([w,{"vs:#decl":F,"vs:#main-start":X}])}_=A.join(`
`)}return{vs:_,targetTextureType:p,inject:w,samplerTextureMap:g}}function Y8(e){let{sourceTextureMap:t,targetTextureVarying:n,targetTexture:r}=e;const o={};let l,s;n&&({width:l,height:s}=r,o["".concat(gv).concat(n)]=[l,s]);for(const p in t)({width:l,height:s}=t[p]),o["".concat(gv).concat(p)]=[l,s];return o}function K8(e){return kL(e,["attribute","in"])}function J8(e){const t="".concat(X8).concat(e),n="".concat(gv).concat(e),r="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(n,";");return{samplerName:t,sizeName:n,uniformDeclerations:r}}function Q8(e,t){const n=kL(e,["varying","out"]);return n&&n.name===t?n.type:null}function tG(e,t){const n={},r=K8(e);if(!r)return null;const{type:o,name:l}=r;if(l&&t[l]){const s="// ".concat(e," => Replaced by Transform with a sampler"),{samplerName:p,sizeName:g,uniformDeclerations:_}=J8(l),w=Oj(o),P="  ".concat(o," ").concat(l," = transform_getInput(").concat(p,", ").concat(g,").").concat(w,`;
`);return n[p]=l,{updatedLine:s,inject:{"vs:#decl":_,"vs:#main-start":P},samplerTextureMap:n}}return null}const eG={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},nG="transform_output";class rG{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(t);return Object.assign({},t,n)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:o,targetTexture:l}=this.bindings[this.currentIndex],s=Object.assign({},n,t.attributes),p=Object.assign({},t.uniforms),g=Object.assign({},t.parameters);let _=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const P in this.samplerTextureMap){const A=this.samplerTextureMap[P];p[P]=r[A]}this._setSourceTextureParameters();const w=Y8({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:l});Object.assign(p,w)}return this.hasTargetTexture&&(_=!1,g.viewport=[0,0,o.width,o.height]),{attributes:s,framebuffer:o,uniforms:p,discard:_,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=Yv(n);if(!t)return r;const o=r.constructor,l=Rj(this.targetTextureType),s=new o(r.length*l/4);let p=0;for(let g=0;g<r.length;g+=4)for(let _=0;_<l;_++)s[p++]=r[g+_];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=t;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:n,textureOrReference:r}=t;if(r instanceof Zi)return r;const o=n[r];return o?(this._targetRefTexName=r,this._createNewTexture(o)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:o}=t,l=this._createTargetTexture({sourceTextures:r,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:l}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const n=new Float32Array(t);n.forEach((r,o,l)=>{l[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new zn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:r})}}_updateBinding(t,n){const{sourceBuffers:r,sourceTextures:o,targetTexture:l}=n;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,o),Object.assign(t.sourceBuffers,r),l){t.targetTexture=l;const{width:s,height:p}=l,{framebuffer:g}=t;g?(g.update({attachments:{[36064]:l},resizeAttachments:!1}),g.resize({width:s,height:p})):t.framebuffer=new Ur(this.gl,{id:"transform-framebuffer",width:s,height:p,attachments:{[36064]:l}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:n}=this.bindings[t];for(const r in n)n[r].setParameters(eG)}_swapTextures(t){if(!this._swapTexture)return null;const n=Object.assign({},t.sourceTextures);n[this._swapTexture]=t.targetTexture;const r=t.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(t){const n=CU(t,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:o,uniforms:l,targetTextureType:s,inject:p,samplerTextureMap:g}=$8({vs:t.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),_=S1([t.inject||{},p]);this.targetTextureType=s,this.samplerTextureMap=g;const w=t._fs||OL({version:wL(o),input:this.targetTextureVarying,inputType:s,output:nG}),P=this.hasSourceTextures||this.targetTextureVarying?[B8].concat(t.modules||[]):t.modules;return{vs:o,fs:w,modules:P,uniforms:l,inject:_}}}class Pw{static isSupported(t){return pn(t)}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:t,bufferTransform:n,textureTransform:r}=this;t&&t.delete(),n&&n.delete(),r&&r.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=t,r=this._updateDrawOptions(t);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let t=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)t=t||r.swap();de(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const o=r.getData(t);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,t),t=this._updateModelProps(t),this.model=new gc(n,Object.assign({},t,{fs:t.fs||OL({version:wL(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let n=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of r)n=o.updateModelProps(n);return n}_buildResourceTransforms(t,n){iG(n)&&(this.bufferTransform=new Z8(t,n)),oG(n)&&(this.textureTransform=new rG(t,n)),de(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let n=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of r)n=Object.assign(n,o.getDrawOptions(n));return n}}function iG(e){return!!(!pf(e.feedbackBuffers)||!pf(e.feedbackMap)||e.varyings&&e.varyings.length>0)}function oG(e){return!!(!pf(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)}const LP={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Zd{static get DRAW_MODE(){return LP}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=ou("geometry"),drawMode:r=LP.TRIANGLES,attributes:o={},indices:l=null,vertexCount:s=null}=t;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(o,l),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in t){let o=t[r];o=ArrayBuffer.isView(o)?{value:o}:o,de(ArrayBuffer.isView(o.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!o.size&&(o.size=3),r==="indices"?(de(!this.indices),this.indices=o):this.attributes[r]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,n){if(n)return n.value.length;let r=1/0;for(const o in t){const l=t[o],{value:s,size:p,constant:g}=l;!g&&s&&p>=1&&(r=Math.min(r,s.length/p))}return de(Number.isFinite(r)),r}}let sG=1,aG=1;class GL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:l=1}=t,s=sG++,p={time:0,delay:n,duration:r,rate:o,repeat:l};return this._setChannelTime(p,this.time),this.channels.set(s,p),s}removeChannel(t){this.channels.delete(t);for(const[n,r]of this.animations)r.channel===t&&this.detachAnimation(n)}isFinished(t){const n=this.channels.get(t);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(t){if(t===void 0)return this.time;const n=this.channels.get(t);return n===void 0?-1:n.time}setTime(t){this.time=Math.max(0,t);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:l,channel:s}=o;l.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,n){const r=aG++;return this.animations.set(r,{animation:t,channel:n}),t.setTime(this.getTime(n)),r}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,n){const r=n-t.delay,o=t.duration*t.repeat;r>=o?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}const WL="#define SMOOTH_EDGE_RADIUS 0.5",lG=`
`.concat(WL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),uG=`
`.concat(WL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),cG={name:"geometry",vs:lG,fs:uG},bn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(bn,"IDENTITY",{get:()=>(cn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ls={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},yc={common:0,meters:1,pixels:2},kP={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Xd={DRAW:"draw",MASK:"mask"},hG=Object.keys(bn).map(e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(bn[e],";")).join(""),fG=Object.keys(ls).map(e=>"const int PROJECTION_MODE_".concat(e," = ").concat(ls[e],";")).join(""),pG=Object.keys(yc).map(e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(yc[e],";")).join(""),dG="".concat(hG,`
`).concat(fG,`
`).concat(pG,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function mG(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}function $d(e){let t={},n;return r=>{for(const o in r)if(!mG(r[o],t[o])){n=e(r),t=r;break}return n}}const OP=[0,0,0,0],gG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],HL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],yG=[0,0,0],qL=[0,0,0],vG=$d(bG);function ZL(e,t,n=qL){n.length<3&&(n=[n[0],n[1],0]);let r=n,o,l=!0;switch(t===bn.LNGLAT_OFFSETS||t===bn.METER_OFFSETS?o=n:o=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case ls.WEB_MERCATOR:(t===bn.LNGLAT||t===bn.CARTESIAN)&&(o=[0,0,0],l=!1);break;case ls.WEB_MERCATOR_AUTO_OFFSET:t===bn.LNGLAT?r=o:t===bn.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],o=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case ls.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case ls.GLOBE:l=!1,o=null;break;default:l=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:l}}function _G(e,t,n){const{viewMatrixUncentered:r,projectionMatrix:o}=e;let{viewMatrix:l,viewProjectionMatrix:s}=e,p=OP,g=OP,_=e.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:P,offsetMode:A}=ZL(e,t,n);return A&&(g=e.projectPosition(w||P),_=[_[0]-g[0],_[1]-g[1],_[2]-g[2]],g[3]=1,p=bf([],g,s),l=r||l,s=ra([],o,l),s=ra([],s,gG)),{viewMatrix:l,viewProjectionMatrix:s,projectionCenter:p,originCommon:g,cameraPosCommon:_,shaderCoordinateOrigin:P,geospatialOrigin:w}}function xG({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:r=bn.DEFAULT,coordinateOrigin:o=qL,autoWrapLongitude:l=!1}){r===bn.DEFAULT&&(r=e.isGeospatial?bn.LNGLAT:bn.CARTESIAN);const s=vG({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:o});return s.project_uWrapLongitude=l,s.project_uModelMatrix=n||HL,s}function bG({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:l,originCommon:s,cameraPosCommon:p,shaderCoordinateOrigin:g,geospatialOrigin:_}=_G(e,n,r),w=e.getDistanceScales(),P=[e.width*t,e.height*t],A=bf([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,M={project_uCoordinateSystem:n,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:g,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:P,project_uDevicePixelRatio:t,project_uFocalDistance:A,project_uCommonUnitsPerMeter:w.unitsPerMeter,project_uCommonUnitsPerWorldUnit:w.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:yG,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:HL,project_uCameraPosition:p};if(_){const F=e.getDistanceScales(_);switch(n){case bn.METER_OFFSETS:M.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,M.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case bn.LNGLAT:case bn.LNGLAT_OFFSETS:e._pseudoMeters||(M.project_uCommonUnitsPerMeter=F.unitsPerMeter),M.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,M.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case bn.CARTESIAN:M.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],M.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return M}const wG={};function TG(e=wG){return"viewport"in e?xG(e):{}}const Aw={name:"project",dependencies:[Fj,cG],vs:dG,getUniforms:TG},EG=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Yd={name:"project32",dependencies:[Aw],vs:EG},SG=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,PG=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,AG=$d(kG),CG=$d(OG),IG=[0,0,0,1],MG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function LG(e,t){const[n,r,o]=e,l=cf([n,r,o],t);return Number.isFinite(o)?l:[l[0],l[1],0]}function kG({viewport:e,center:t}){return new fi(e.viewProjectionMatrix).invert().transform(t)}function OG({viewport:e,shadowMatrices:t}){const n=[],r=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,l=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>LG(s,r));for(const s of t){const p=s.clone().translate(new be(e.center).negate()),g=l.map(w=>p.transform(w)),_=new fi().ortho({left:Math.min(...g.map(w=>w[0])),right:Math.max(...g.map(w=>w[0])),bottom:Math.min(...g.map(w=>w[1])),top:Math.max(...g.map(w=>w[1])),near:Math.min(...g.map(w=>-w[2])),far:Math.max(...g.map(w=>-w[2]))});n.push(_.multiplyRight(s))}return n}function RG(e,t){const{shadowEnabled:n=!0}=e;if(!n||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||IG,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},o=AG({viewport:e.viewport,center:t.project_uCenter}),l=[],s=CG({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let p=0;p<e.shadowMatrices.length;p++){const g=s[p],_=g.clone().translate(new be(e.viewport.center).negate());t.project_uCoordinateSystem===bn.LNGLAT&&t.project_uProjectionMode===ls.WEB_MERCATOR?(s[p]=_,l[p]=o):(s[p]=g.clone().multiplyRight(MG),l[p]=_.transform(o))}for(let p=0;p<s.length;p++)r["shadow_uViewProjectionMatrices[".concat(p,"]")]=s[p],r["shadow_uProjectCenters[".concat(p,"]")]=l[p],e.shadowMaps&&e.shadowMaps.length>0?r["shadow_uShadowMap".concat(p)]=e.shadowMaps[p]:r["shadow_uShadowMap".concat(p)]=e.dummyShadowMap;return r}const U0={name:"shadow",dependencies:[Aw],vs:SG,fs:PG,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?RG(e,t):{}},Kd={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...k8},zG=[Aw],DG=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function FG(e){const t=qd.getDefaultProgramManager(e);for(const n of zG)t.addDefaultModule(n);for(const n of DG)t.addShaderHook(n);return t}const NG=[255,255,255],BG=1;let UG=0;class VG{constructor(t={}){L(this,"id",void 0),L(this,"color",void 0),L(this,"intensity",void 0),L(this,"type","ambient");const{color:n=NG}=t,{intensity:r=BG}=t;this.id=t.id||"ambient-".concat(UG++),this.color=n,this.intensity=r}}const jG=[255,255,255],GG=1,WG=[0,0,-1];let HG=0;class RP{constructor(t={}){L(this,"id",void 0),L(this,"color",void 0),L(this,"intensity",void 0),L(this,"type","directional"),L(this,"direction",void 0),L(this,"shadow",void 0);const{color:n=jG}=t,{intensity:r=GG}=t,{direction:o=WG}=t,{_shadow:l=!1}=t;this.id=t.id||"directional-".concat(HG++),this.color=n,this.intensity=r,this.type="directional",this.direction=new be(o).normalize().toArray(),this.shadow=l}getProjectedLight(t){return this}}class qG{constructor(t,n={id:"pass"}){L(this,"id",void 0),L(this,"gl",void 0),L(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=t,this.props={...n}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Kv extends qG{constructor(...t){super(...t),L(this,"_lastRenderIndex",-1)}render(t){const n=this.gl;return al(n,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:n,moduleParameters:r,viewports:o,views:l,onViewportActive:s,clearStack:p=!0,clearCanvas:g=!0}=t;t.pass=t.pass||"unknown";const _=this.gl;g&&XG(_),p&&(this._lastRenderIndex=-1);const w=[];for(const P of o){const A=l&&l[P.id];s(P);const M=this._getDrawLayerParams(P,t),F=P.subViewports||[P];for(const X of F){const B=this._drawLayersInViewport(_,{target:n,moduleParameters:r,viewport:X,view:A,pass:t.pass,layers:t.layers},M);w.push(B)}}return w}_getDrawLayerParams(t,{layers:n,pass:r,layerFilter:o,cullRect:l,effects:s,moduleParameters:p}){const g=[],_=XL(this._lastRenderIndex+1),w={layer:n[0],viewport:t,isPicking:r.startsWith("picking"),renderPass:r,cullRect:l},P={};for(let A=0;A<n.length;A++){const M=n[A],F=this._shouldDrawLayer(M,w,o,P),X={shouldDrawLayer:F};F&&(X.layerRenderIndex=_(M,F),X.moduleParameters=this._getModuleParameters(M,s,r,p),X.layerParameters=this.getLayerParameters(M,A,t)),g[A]=X}return g}_drawLayersInViewport(t,{layers:n,moduleParameters:r,pass:o,target:l,viewport:s,view:p},g){const _=ZG(t,{moduleParameters:r,target:l,viewport:s});if(p&&p.props.clear){const P=p.props.clear===!0?{color:!0,depth:!0}:p.props.clear;jo(t,{scissorTest:!0,scissor:_},()=>_w(t,P))}const w={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};al(t,{viewport:_});for(let P=0;P<n.length;P++){const A=n[P],{shouldDrawLayer:M,layerRenderIndex:F,moduleParameters:X,layerParameters:B}=g[P];if(M&&A.props.pickable&&w.pickableCount++,A.isComposite)w.compositeCount++;else if(M){w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),X.viewport=s;try{A._drawLayer({moduleParameters:X,uniforms:{layerIndex:F},parameters:B})}catch(U){A.raiseError(U,"drawing ".concat(A," to ").concat(o))}}}return w}shouldDrawLayer(t){return!0}getModuleParameters(t,n){return null}getLayerParameters(t,n,r){return t.props.parameters}_shouldDrawLayer(t,n,r,o){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;n.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(n))return!1;n.layer=s,s=s.parent}if(r){const p=n.layer.id;if(p in o||(o[p]=r(n)),!o[p])return!1}return t.activateViewport(n.viewport),!0}_getModuleParameters(t,n,r,o){var l;const s=Object.assign(Object.create(((l=t.internalState)===null||l===void 0?void 0:l.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:ff(this.gl)});if(n)for(const g of n){var p;Object.assign(s,(p=g.getModuleParameters)===null||p===void 0?void 0:p.call(g,t))}return Object.assign(s,this.getModuleParameters(t,n),o)}}function XL(e=0,t={}){const n={},r=(o,l)=>{const s=o.props._offset,p=o.id,g=o.parent&&o.parent.id;let _;if(g&&!(g in t)&&r(o.parent,!1),g in n){const w=n[g]=n[g]||XL(t[g],t);_=w(o,l),n[p]=w}else Number.isFinite(s)?(_=s+(t[g]||0),n[p]=null):_=e;return l&&_>=e&&(e=_+1),t[p]=_,_};return r}function ZG(e,{moduleParameters:t,target:n,viewport:r}){const o=n&&n.id!=="default-framebuffer",l=t&&t.devicePixelRatio||ff(e),s=o?n.height:e.drawingBufferHeight,p=r;return[p.x*l,s-(p.y+p.height)*l,p.width*l,p.height*l]}function XG(e){const t=e.drawingBufferWidth,n=e.drawingBufferHeight;al(e,{viewport:[0,0,t,n]}),e.clear(16640)}class $G extends Kv{constructor(t,n){super(t,n),L(this,"shadowMap",void 0),L(this,"depthBuffer",void 0),L(this,"fbo",void 0),this.shadowMap=new Zi(t,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Bh(t,{format:33189,width:1,height:1}),this.fbo=new Ur(t,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(t){const n=this.fbo;jo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=t.viewports[0],o=ff(this.gl),l=r.width*o,s=r.height*o;(l!==n.width||s!==n.height)&&n.resize({width:l,height:s}),super.render({...t,target:n,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const YG={color:[255,255,255],intensity:1},zP=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],KG=[0,0,0,200/255];class $L{constructor(t={}){L(this,"id","lighting-effect"),L(this,"props",null),L(this,"shadowColor",KG),L(this,"shadow",void 0),L(this,"ambientLight",null),L(this,"directionalLights",[]),L(this,"pointLights",[]),L(this,"shadowPasses",[]),L(this,"shadowMaps",[]),L(this,"dummyShadowMap",null),L(this,"programManager",void 0),L(this,"shadowMatrices",void 0);for(const n in t){const r=t[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(t,{layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=qd.getDefaultProgramManager(t),U0&&this.programManager.addDefaultModule(U0)),this.dummyShadowMap||(this.dummyShadowMap=new Zi(t,{width:1,height:1}));for(let p=0;p<this.shadowPasses.length;p++)this.shadowPasses[p].render({layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:s,moduleParameters:{shadowLightId:p,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:t})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:t}))},n}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(U0),this.programManager=null)}_calculateMatrices(){const t=[];for(const n of this.directionalLights){const r=new fi().lookAt({eye:new be(n.direction).negate()});t.push(r)}return t}_createShadowPasses(t){for(let n=0;n<this.directionalLights.length;n++){const r=new $G(t);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:n,directionalLights:r}=this;!t&&n.length===0&&r.length===0&&(this.ambientLight=new VG(YG),this.directionalLights.push(new RP(zP[0]),new RP(zP[1])))}}class JG{constructor(t={}){L(this,"_pool",[]),L(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,n,{size:r=1,type:o,padding:l=0,copy:s=!1,initialize:p=!1,maxCount:g}){const _=o||t&&t.constructor||Float32Array,w=n*r+l;if(ArrayBuffer.isView(t)){if(w<=t.length)return t;if(w*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new _(t.buffer,0,w)}let P=1/0;g&&(P=g*r+l);const A=this._allocate(_,w,p,P);return t&&s?A.set(t):p||A.fill(0,0,4),this._release(t),A}release(t){this._release(t)}_allocate(t,n,r,o){let l=Math.max(Math.ceil(n*this.opts.overAlloc),1);l>o&&(l=o);const s=this._pool,p=t.BYTES_PER_ELEMENT*l,g=s.findIndex(_=>_.byteLength>=p);if(g>=0){const _=new t(s.splice(g,1)[0],0,l);return r&&_.fill(0),_}return new t(l)}_release(t){if(!ArrayBuffer.isView(t))return;const n=this._pool,{buffer:r}=t,{byteLength:o}=r,l=n.findIndex(s=>s.byteLength>=o);l<0?n.push(r):(l>0||n.length<this.opts.poolSize)&&n.splice(l,0,r),n.length>this.opts.poolSize&&n.shift()}}const gf=new JG;function Up(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function QG(e,t){const n=e%t;return n<0?t+n:n}function t9(e){return[e[12],e[13],e[14]]}function e9(e){return{left:Ph(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Ph(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Ph(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Ph(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Ph(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Ph(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const DP=new be;function Ph(e,t,n,r){DP.set(e,t,n);const o=DP.len();return{distance:r/o,normal:new be(-e/o,-t/o,-n/o)}}function n9(e){return e-Math.fround(e)}let Mp;function V0(e,t){const{size:n=1,startIndex:r=0}=t,o=t.endIndex!==void 0?t.endIndex:e.length,l=(o-r)/n;Mp=gf.allocate(Mp,l,{type:Float32Array,size:n*2});let s=r,p=0;for(;s<o;){for(let g=0;g<n;g++){const _=e[s++];Mp[p+g]=_,Mp[p+g+n]=n9(_)}p+=n*2}return Mp.subarray(0,l*n*2)}const r9=Math.PI/180,i9=Up(),FP=[0,0,0],o9={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function s9({width:e,height:t,orthographic:n,fovyRadians:r,focalDistance:o,padding:l,near:s,far:p}){const g=e/t,_=n?new fi().orthographic({fovy:r,aspect:g,focalDistance:o,near:s,far:p}):new fi().perspective({fovy:r,aspect:g,near:s,far:p});if(l){const{left:w=0,right:P=0,top:A=0,bottom:M=0}=l,F=ci((w+e-P)/2,0,e)-e/2,X=ci((A+t-M)/2,0,t)-t/2;_[8]-=F*2/e,_[9]+=X*2/t}return _}class fu{constructor(t={}){L(this,"id",void 0),L(this,"x",void 0),L(this,"y",void 0),L(this,"width",void 0),L(this,"height",void 0),L(this,"padding",void 0),L(this,"isGeospatial",void 0),L(this,"zoom",void 0),L(this,"focalDistance",void 0),L(this,"position",void 0),L(this,"modelMatrix",void 0),L(this,"distanceScales",void 0),L(this,"scale",void 0),L(this,"center",void 0),L(this,"cameraPosition",void 0),L(this,"projectionMatrix",void 0),L(this,"viewMatrix",void 0),L(this,"viewMatrixUncentered",void 0),L(this,"viewMatrixInverse",void 0),L(this,"viewProjectionMatrix",void 0),L(this,"pixelProjectionMatrix",void 0),L(this,"pixelUnprojectionMatrix",void 0),L(this,"resolution",void 0),L(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||o9,this.focalDistance=t.focalDistance||1,this.position=t.position||FP,this.modelMatrix=t.modelMatrix||null;const{longitude:n,latitude:r}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ls.WEB_MERCATOR:ls.WEB_MERCATOR_AUTO_OFFSET:ls.IDENTITY}equals(t){return t instanceof fu?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&oa(t.projectionMatrix,this.projectionMatrix)&&oa(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:n=!0}={}){const r=this.projectPosition(t),o=Zb(r,this.pixelProjectionMatrix),[l,s]=o,p=n?s:this.height-s;return t.length===2?[l,p]:[l,p,o[2]]}unproject(t,{topLeft:n=!0,targetZ:r}={}){const[o,l,s]=t,p=n?l:this.height-l,g=r&&r*this.distanceScales.unitsPerMeter[2],_=cf([o,p,s],this.pixelUnprojectionMatrix,g),[w,P,A]=this.unprojectPosition(_);return Number.isFinite(s)?[w,P,A]:Number.isFinite(r)?[w,P,r]:[w,P]}projectPosition(t){const[n,r]=this.projectFlat(t),o=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,o]}unprojectPosition(t){const[n,r]=this.unprojectFlat(t),o=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,o]}projectFlat(t){if(this.isGeospatial){const n=Uo(t);return n[1]=ci(n[1],-318,830),n}return t}unprojectFlat(t){return this.isGeospatial?ia(t):t}getBounds(t={}){const n={targetZ:t.z||0},r=this.unproject([0,0],n),o=this.unproject([this.width,0],n),l=this.unproject([0,this.height],n),s=this.unproject([this.width,this.height],n);return[Math.min(r[0],o[0],l[0],s[0]),Math.min(r[1],o[1],l[1],s[1]),Math.max(r[0],o[0],l[0],s[0]),Math.max(r[1],o[1],l[1],s[1])]}getDistanceScales(t){return t?iv({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:n,width:r=1,height:o=1}){return t<this.x+this.width&&this.x<t+r&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,e9(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,n){return null}_initProps(t){const n=t.longitude,r=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=JD({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||iv({latitude:r,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:l,modelMatrix:s}=t;let p=FP;if(l&&(p=s?new fi(s).transformAsVector(l,[]):l),this.isGeospatial){const g=this.projectPosition([n,r,0]);this.center=new be(p).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(p)}_initMatrices(t){const{viewMatrix:n=i9,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:l,fovy:s=75,near:p=.1,far:g=1e3,padding:_=null,focalDistance:w=1}=t;this.viewMatrixUncentered=n,this.viewMatrix=new fi().multiplyRight(n).translate(new be(this.center).negate()),this.projectionMatrix=r||s9({width:this.width,height:this.height,orthographic:o,fovyRadians:l||s*r9,focalDistance:w,padding:_,near:p,far:g});const P=Up();ra(P,P,this.projectionMatrix),ra(P,P,this.viewMatrix),this.viewProjectionMatrix=P,this.viewMatrixInverse=rv([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=t9(this.viewMatrixInverse);const A=Up(),M=Up();Gv(A,A,[this.width/2,-this.height/2,1]),md(A,A,[1,-1,0]),ra(M,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=M,this.pixelUnprojectionMatrix=rv(Up(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||cn.warn("Pixel project matrix not invertible")()}}L(fu,"displayName","Viewport");const a9=512,l9=4003e4,u9=Math.PI/180;function NP(e){const t=Math.cos(e*u9);return a9/l9/t}class la extends fu{constructor(t={}){const{latitude:n=0,longitude:r=0,zoom:o=0,pitch:l=0,bearing:s=0,nearZMultiplier:p=.1,farZMultiplier:g=1.01,orthographic:_=!1,projectionMatrix:w,repeat:P=!1,worldOffset:A=0,legacyMeterSizes:M=!1}=t;let{width:F,height:X,altitude:B=1.5}=t;const U=Math.pow(2,o);F=F||1,X=X||1;let H,tt=null;w?(B=w[5]/2,H=uf(B)):(t.fovy?(H=t.fovy,B=qb(H)):H=uf(B),tt=dM({width:F,height:X,pitch:l,fovy:H,nearZMultiplier:p,farZMultiplier:g}));let st=pM({height:X,pitch:l,bearing:s,scale:U,altitude:B});A&&(st=new fi().translate([512*A,0,0]).multiplyLeft(st)),super({...t,width:F,height:X,viewMatrix:st,longitude:r,latitude:n,zoom:o,...tt,fovy:H,focalDistance:B}),L(this,"longitude",void 0),L(this,"latitude",void 0),L(this,"pitch",void 0),L(this,"bearing",void 0),L(this,"altitude",void 0),L(this,"fovy",void 0),L(this,"orthographic",void 0),L(this,"_subViewports",void 0),L(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=o,this.pitch=l,this.bearing=s,this.altitude=B,this.fovy=H,this.orthographic=_,this._subViewports=P?[]:null,this._pseudoMeters=M,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),n=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360);for(let o=n;o<=r;o++){const l=o?new la({...this,worldOffset:o}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[n,r]=this.projectFlat(t),o=(t[2]||0)*NP(t[1]);return[n,r,o]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[n,r]=this.unprojectFlat(t),o=(t[2]||0)/NP(r);return[n,r,o]}addMetersToLngLat(t,n){return fM(t,n)}panByPosition(t,n){const r=cf(n,this.pixelUnprojectionMatrix),o=this.projectFlat(t),l=fc([],o,Wb([],r)),s=fc([],this.center,l),[p,g]=this.unprojectFlat(s);return{longitude:p,latitude:g}}getBounds(t={}){const n=mM(this,t.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(t,n={}){const{width:r,height:o}=this,{longitude:l,latitude:s,zoom:p}=Xb({width:r,height:o,bounds:t,...n});return new la({width:r,height:o,longitude:l,latitude:s,zoom:p})}}L(la,"displayName","WebMercatorViewport");function j0(e,t,n=!1){const r=t.projectPosition(e);if(n&&t instanceof la){const[o,l,s=0]=e,p=t.getDistanceScales([o,l]);r[2]=s*p.unitsPerMeter[2]}return r}function c9(e){const{viewport:t,modelMatrix:n,coordinateOrigin:r}=e;let{coordinateSystem:o,fromCoordinateSystem:l,fromCoordinateOrigin:s}=e;return o===bn.DEFAULT&&(o=t.isGeospatial?bn.LNGLAT:bn.CARTESIAN),l===void 0&&(l=o),s===void 0&&(s=r),{viewport:t,coordinateSystem:o,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:l,fromCoordinateOrigin:s}}function YL(e,{viewport:t,modelMatrix:n,coordinateSystem:r,coordinateOrigin:o,offsetMode:l}){let[s,p,g=0]=e;switch(n&&([s,p,g]=bf([],[s,p,g,1],n)),r){case bn.LNGLAT:return j0([s,p,g],t,l);case bn.LNGLAT_OFFSETS:return j0([s+o[0],p+o[1],g+(o[2]||0)],t,l);case bn.METER_OFFSETS:return j0(fM(o,[s,p,g]),t,l);case bn.CARTESIAN:default:return t.isGeospatial?[s+o[0],p+o[1],g+o[2]]:t.projectPosition([s,p,g])}}function h9(e,t){const{viewport:n,coordinateSystem:r,coordinateOrigin:o,modelMatrix:l,fromCoordinateSystem:s,fromCoordinateOrigin:p}=c9(t),{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:w}=ZL(n,r,o),P=YL(e,{viewport:n,modelMatrix:l,coordinateSystem:s,coordinateOrigin:p,offsetMode:w});if(w){const A=n.projectPosition(g||_);aM(P,P,A)}return P}const Mh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},yv=Symbol.for("component"),Qh=Symbol.for("asyncPropDefaults"),vc=Symbol.for("asyncPropOriginal"),Hl=Symbol.for("asyncPropResolved");function Jv(e,t=()=>!0){return Array.isArray(e)?KL(e,t,[]):t(e)?[e]:[]}function KL(e,t,n){let r=-1;for(;++r<e.length;){const o=e[r];Array.isArray(o)?KL(o,t,n):t(o)&&n.push(o)}return n}function f9({target:e,source:t,start:n=0,count:r=1}){const o=t.length,l=r*o;let s=0;for(let p=n;s<o;s++)e[p++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+l-s),s=l);return e}class p9{constructor(t,n,r){L(this,"id",void 0),L(this,"context",void 0),L(this,"isLoaded",void 0),L(this,"persistent",void 0),L(this,"_loadCount",0),L(this,"_subscribers",new Set),L(this,"_data",void 0),L(this,"_loader",void 0),L(this,"_error",void 0),L(this,"_content",void 0),this.id=t,this.context=r,this.setData(n)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,n){if(t===this._data&&!n)return;this._data=t;const r=++this._loadCount;let o=t;typeof t=="string"&&(o=pv(t)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const l of this._subscribers)l.onChange(this.getData())}}class d9{constructor({gl:t,protocol:n}){L(this,"protocol",void 0),L(this,"_context",void 0),L(this,"_resources",void 0),L(this,"_consumers",void 0),L(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:n,forceUpdate:r=!1,persistent:o=!0}){let l=this._resources[t];l?l.setData(n,r):(l=new p9(t,n,this._context),this._resources[t]=l),l.persistent=o}remove(t){const n=this._resources[t];n&&(n.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const n=this._consumers[t];if(n){for(const r in n){const o=n[r],l=this._resources[o.resourceId];l&&l.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:n,consumerId:r,requestId:o="default"}){const{_resources:l,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),l[t]||this.add({resourceId:t,data:null,persistent:!1}));const p=l[t];if(this._track(r,o,p,n),p)return p.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,n,r,o){const l=this._consumers,s=l[t]=l[t]||{},p=s[n]||{},g=p.resourceId&&this._resources[p.resourceId];g&&(g.unsubscribe(p),this.prune()),r&&(s[n]=p,p.onChange=o,p.resourceId=r.id,r.subscribe(p))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const n=this._resources[t];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[t])}}}const m9="layerManager.setLayers",g9="layerManager.activateViewport";class y9{constructor(t,{deck:n,stats:r,viewport:o,timeline:l}={}){L(this,"layers",void 0),L(this,"context",void 0),L(this,"resourceManager",void 0),L(this,"_lastRenderedLayers",[]),L(this,"_needsRedraw",!1),L(this,"_needsUpdate",!1),L(this,"_nextLayers",null),L(this,"_debug",!1),L(this,"activateViewport",s=>{Ri(g9,this,s),s&&(this.context.viewport=s)}),this.layers=[],this.resourceManager=new d9({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:n,programManager:t&&FG(t),stats:r||new qv({id:"deck.gl"}),viewport:o||new fu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new GL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let n=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(t);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(n=>t.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,n){Ri(m9,this,n,t),this._lastRenderedLayers=t;const r=Jv(t,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,n,r){r.raiseError(n,"".concat(t," of ").concat(r))}_updateLayers(t,n){const r={};for(const s of t)r[s.id]?cn.warn("Multiple old layers with same id ".concat(s.id))():r[s.id]=s;const o=[];this._updateSublayersRecursively(n,r,o),this._finalizeOldLayers(r);let l=!1;for(const s of o)if(s.hasUniformTransition()){l="Uniform transition in ".concat(s);break}this._needsUpdate=l,this.layers=o}_updateSublayersRecursively(t,n,r){for(const o of t){o.context=this.context;const l=n[o.id];l===null&&cn.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let s=null;try{this._debug&&l!==o&&o.validateProps(),l?(this._transferLayerState(l,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),s=o.isComposite?o.getSubLayers():null}catch(p){this._handleError("matching",p,o)}s&&this._updateSublayersRecursively(s,n,r)}}_finalizeOldLayers(t){for(const n in t){const r=t[n];r&&this._finalizeLayer(r)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Mh.INITIALIZED}catch(n){this._handleError("initialization",n,t)}}_transferLayerState(t,n){n._transferState(t),n.lifecycle=Mh.MATCHED,n!==t&&(t.lifecycle=Mh.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(n){this._handleError("update",n,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=Mh.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Mh.FINALIZED}catch(n){this._handleError("finalization",n,t)}}}function Sc(e,t){if(e===t)return!0;if(!e||!t)return!1;for(const n in e){const r=e[n],o=t[n];if(!(r===o||Array.isArray(r)&&Array.isArray(o)&&Sc(r,o)))return!1}return!0}class v9{constructor(t){L(this,"width",void 0),L(this,"height",void 0),L(this,"views",void 0),L(this,"viewState",void 0),L(this,"controllers",void 0),L(this,"timeline",void 0),L(this,"_viewports",void 0),L(this,"_viewportMap",void 0),L(this,"_isUpdating",void 0),L(this,"_needsRedraw",void 0),L(this,"_needsUpdate",void 0),L(this,"_eventManager",void 0),L(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const n=this.controllers[t];n&&n.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const n=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const n=this.controllers[t];n&&n.updateTransition()}}getViewports(t){return t?this._viewports.filter(n=>n.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(n=>{t[n.id]=n}),t}getView(t){return this.views.find(n=>n.id===t)}getViewState(t){const n=typeof t=="string"?this.getView(t):t,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(t){return this._viewportMap[t]}unproject(t,n){const r=this.getViewports(),o={x:t[0],y:t[1]};for(let l=r.length-1;l>=0;--l){const s=r[l];if(s.containsPixel(o)){const p=t.slice();return p[0]-=s.x,p[1]-=s.y,s.unproject(p,n)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,n){(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Jv(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Sc(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):cn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:t})}_createController(t,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>{var s;return(s=this.getView(t.id))===null||s===void 0?void 0:s.makeViewport({viewState:l,width:this.width,height:this.height})}})}_updateController(t,n,r,o){const l=t.controller;if(l){const s={...n,...l,id:t.id,x:r.x,y:r.y,width:r.width,height:r.height};return o||(o=this._createController(t,s)),o&&o.setProps(s),o}return null}_rebuildViewports(){const{views:t}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=t.length;o--;){const l=t[o],s=this.getViewState(l),p=l.makeViewport({viewState:s,width:this.width,height:this.height});let g=n[l.id];const _=Boolean(l.controller);_&&!g&&(r=!0),(r||!_)&&g&&(g.finalize(),g=null),this.controllers[l.id]=this._updateController(l,s,p,g),this._viewports.unshift(p)}for(const o in n){const l=n[o];l&&!this.controllers[o]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,n){return t.length!==n.length?!0:t.some((r,o)=>!t[o].equals(n[o]))}}const _9=/([0-9]+\.?[0-9]*)(%|px)/;function zl(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=_9.exec(e);if(t&&t.length>=3){const n=t[2]==="%",r=parseFloat(t[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(e))}}function Dl(e,t){return e.relative?Math.round(e.position*t):e.position}function ri(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class _c{constructor(t){L(this,"id",void 0),L(this,"viewportInstance",void 0),L(this,"_x",void 0),L(this,"_y",void 0),L(this,"_width",void 0),L(this,"_height",void 0),L(this,"_padding",void 0),L(this,"props",void 0);const{id:n,x:r=0,y:o=0,width:l="100%",height:s="100%",padding:p=null,viewportInstance:g}=t||{};ri(!g||g instanceof fu),this.viewportInstance=g,this.id=n||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=zl(r),this._y=zl(o),this._width=zl(l),this._height=zl(s),this._padding=p&&{left:zl(p.left||0),right:zl(p.right||0),top:zl(p.top||0),bottom:zl(p.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&Sc(this.props,t.props)}makeViewport({width:t,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const o=this.getDimensions({width:t,height:n});return new this.ViewportType({...r,...this.props,...o})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...t};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return t}getDimensions({width:t,height:n}){const r={x:Dl(this._x,t),y:Dl(this._y,n),width:Dl(this._width,t),height:Dl(this._height,n)};return this._padding&&(r.padding={left:Dl(this._padding.left,t),top:Dl(this._padding.top,n),right:Dl(this._padding.right,t),bottom:Dl(this._padding.bottom,n)}),r}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Jd{constructor(t){L(this,"_inProgress",void 0),L(this,"_handle",void 0),L(this,"_timeline",void 0),L(this,"time",void 0),L(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var n,r;this.cancel(),this.settings=t,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var t,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(n=this.settings).onEnd)===null||t===void 0||t.call(n,this)}}cancel(){if(this._inProgress){var t,n;(t=(n=this.settings).onInterrupt)===null||t===void 0||t.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(n=this.settings).onUpdate)===null||t===void 0||t.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const BP=()=>{},M1={BREAK:1,SNAP_TO_END:2,IGNORE:3},x9=e=>e,b9=M1.BREAK;class w9{constructor(t){L(this,"getControllerState",void 0),L(this,"props",void 0),L(this,"propsInTransition",void 0),L(this,"transition",void 0),L(this,"onViewStateChange",void 0),L(this,"onStateChange",void 0),L(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:o,startProps:l,endProps:s,duration:p,easing:g}}=n,_=g(r/p),w=o.interpolateProps(l,s,_);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Jd(t.timeline),this.onViewStateChange=t.onViewStateChange||BP,this.onStateChange=t.onStateChange||BP}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let n=!1;const r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){let o=r;if(this.transition.inProgress){const{interruption:l,endProps:s}=this.transition.settings;o={...r,...l===M1.SNAP_TO_END?s:this.propsInTransition||r}}this._triggerTransition(o,t),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:n,transitionInterpolator:r}=t;return(n>0||n==="auto")&&Boolean(r)}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,n){return this.transition.inProgress?this.transition.settings.interruption===M1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(t,n):!0}_triggerTransition(t,n){const r=this.getControllerState(t),o=this.getControllerState(n).shortestPathFrom(r),l=n.transitionInterpolator,s=l.getDuration?l.getDuration(t,n):n.transitionDuration;if(s===0)return;const p=l.initializeProps(t,o);this.propsInTransition={};const g={duration:s,easing:n.transitionEasing||x9,interpolator:l,interruption:n.transitionInterruption||b9,startProps:p.start,endProps:p.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(n)}}}class T9{constructor(t){L(this,"_propsToCompare",void 0),L(this,"_propsToExtract",void 0),L(this,"_requiredProps",void 0);const{compare:n,extract:r,required:o}=t;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=o}arePropsEqual(t,n){for(const r of this._propsToCompare)if(!(r in t)||!(r in n)||!oa(t[r],n[r]))return!1;return!0}initializeProps(t,n){const r={},o={};for(const l of this._propsToExtract)(l in t||l in n)&&(r[l]=t[l],o[l]=n[l]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(t,n){return n.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(n=>{const r=t[n];ri(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const E9=["longitude","latitude","zoom","bearing","pitch"],S9=["longitude","latitude","zoom"];class Cw extends T9{constructor(t={}){const n=Array.isArray(t)?t:t.transitionProps,r=Array.isArray(t)?{}:t;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:E9,required:S9},super(r.transitionProps),L(this,"opts",void 0),this.opts=r}initializeProps(t,n){const r=super.initializeProps(t,n),{makeViewport:o,around:l}=this.opts;if(o&&l){const s=o(t),p=o(n),g=s.unproject(l);r.start.around=l,Object.assign(r.end,{around:p.project(g),aroundPosition:g,width:n.width,height:n.height})}return r}interpolateProps(t,n,r){const o={};for(const l of this._propsToExtract)o[l]=mf(t[l]||0,n[l]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...n,...o});Object.assign(o,l.panByPosition(n.aroundPosition,mf(t.around,n.around,r)))}return o}}const Fl={transitionDuration:0},P9=300,Dg=e=>1-(1-e)*(1-e),Ah={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Wu={};class JL{constructor(t){L(this,"props",void 0),L(this,"state",{}),L(this,"transitionManager",void 0),L(this,"eventManager",void 0),L(this,"onViewStateChange",void 0),L(this,"onStateChange",void 0),L(this,"makeViewport",void 0),L(this,"_controllerState",void 0),L(this,"_events",{}),L(this,"_interactionState",{isDragging:!1}),L(this,"_customEvents",[]),L(this,"_eventStartBlocked",null),L(this,"_panMove",!1),L(this,"invertPan",!1),L(this,"dragMode","rotate"),L(this,"inertia",0),L(this,"scrollZoom",!0),L(this,"dragPan",!0),L(this,"dragRotate",!0),L(this,"doubleClickZoom",!0),L(this,"touchZoom",!0),L(this,"touchRotate",!1),L(this,"keyboard",!0),this.transitionManager=new w9({...t,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var t;(t=this.eventManager)===null||t===void 0||t.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const n=this._eventStartBlocked;switch(t.type){case"panstart":return n?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return n?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return n?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:n,y:r}=this.props,{offsetCenter:o}=t;return[o.x-n,o.y-r]}isPointInBounds(t,n){const{width:r,height:o}=this.props;if(n&&n.handled)return!1;const l=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=o;return l&&n&&n.stopPropagation(),l}isFunctionKeyPressed(t){const{srcEvent:n}=t;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=n}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:n}=t;this.inertia=Number.isFinite(n)?n:n===!0?P9:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:l=!0,doubleClickZoom:s=!0,touchZoom:p=!0,touchRotate:g=!1,keyboard:_=!0}=t,w=Boolean(this.onViewStateChange);this.toggleEvents(Ah.WHEEL,w&&r),this.toggleEvents(Ah.PAN,w&&(o||l)),this.toggleEvents(Ah.PINCH,w&&(p||g)),this.toggleEvents(Ah.TRIPLE_PAN,w&&g),this.toggleEvents(Ah.DOUBLE_TAP,w&&s),this.toggleEvents(Ah.KEYBOARD,w&&_),this.scrollZoom=r,this.dragPan=o,this.dragRotate=l,this.doubleClickZoom=s,this.touchZoom=p,this.touchRotate=g,this.keyboard=_}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,n){this.eventManager&&t.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(t,n=null,r={}){const o={...t.getViewportProps(),...n},l=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(r),l){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:s})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;let r=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(o,Fl,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const n=this.getCenter(t),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Fl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:n}=this;if(this.dragPan&&n&&t.velocity){const r=this.getCenter(t),o=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],l=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Dg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const n=this.getCenter(t),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Fl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:n}=this;if(this.dragRotate&&n&&t.velocity){const r=this.getCenter(t),o=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],l=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Dg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;t.srcEvent.preventDefault();const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=t;let s=2/(1+Math.exp(-Math.abs(l*r)));l<0&&s!==0&&(s=1/s);const p=this.controllerState.zoom({pos:n,scale:s});return this.updateViewport(p,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Fl,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(t);n[0]-=t.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Fl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&t.velocityY){const r=this.getCenter(t),o=[r[0],r[1]+=t.velocityY*n/2],l=this.controllerState.rotate({pos:o});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Dg},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Wu._startPinchRotation=t.rotation,Wu._lastPinchEvent=t,this.updateViewport(r,Fl,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=t,o=this.getCenter(t);n=n.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=t;n=n.rotate({deltaAngleX:Wu._startPinchRotation-r})}return this.updateViewport(n,Fl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Wu._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Wu;if(this.touchZoom&&n&&r&&t.scale!==r.scale){const o=this.getCenter(t);let l=this.controllerState.rotateEnd();const s=Math.log2(t.scale),p=(s-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),g=Math.pow(2,s+p*n/2);l=l.zoom({pos:o,scale:g}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:Dg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Wu._startPinchRotation=null,Wu._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const r=this.isFunctionKeyPressed(t),o=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(t),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:l,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:p}=this;let g;const _={};switch(t.srcEvent.code){case"Minus":g=n?p.zoomOut(r).zoomOut(r):p.zoomOut(r),_.isZooming=!0;break;case"Equal":g=n?p.zoomIn(r).zoomIn(r):p.zoomIn(r),_.isZooming=!0;break;case"ArrowLeft":n?(g=p.rotateLeft(l),_.isRotating=!0):(g=p.moveLeft(o),_.isPanning=!0);break;case"ArrowRight":n?(g=p.rotateRight(l),_.isRotating=!0):(g=p.moveRight(o),_.isPanning=!0);break;case"ArrowUp":n?(g=p.rotateUp(s),_.isRotating=!0):(g=p.moveUp(o),_.isPanning=!0);break;case"ArrowDown":n?(g=p.rotateDown(s),_.isRotating=!0):(g=p.moveDown(o),_.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),_),!0}_getTransitionProps(t){const{transition:n}=this;return!n||!n.transitionInterpolator?Fl:t?{...n,transitionInterpolator:new Cw({...t,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class QL{constructor(t,n){L(this,"_viewportProps",void 0),L(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const UP=5,A9=1.2;class C9 extends QL{constructor(t){const{width:n,height:r,latitude:o,longitude:l,zoom:s,bearing:p=0,pitch:g=0,altitude:_=1.5,position:w=[0,0,0],maxZoom:P=20,minZoom:A=0,maxPitch:M=60,minPitch:F=0,startPanLngLat:X,startZoomLngLat:B,startRotatePos:U,startBearing:H,startPitch:tt,startZoom:st,normalize:pt=!0}=t;ri(Number.isFinite(l)),ri(Number.isFinite(o)),ri(Number.isFinite(s)),super({width:n,height:r,latitude:o,longitude:l,zoom:s,bearing:p,pitch:g,altitude:_,maxZoom:P,minZoom:A,maxPitch:M,minPitch:F,normalize:pt,position:w},{startPanLngLat:X,startZoomLngLat:B,startRotatePos:U,startBearing:H,startPitch:tt,startZoom:st}),L(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(r,t);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:l,startPitch:s}=this.getState();if(!o||l===void 0||s===void 0)return this;let p;return t?p=this._getNewRotation(t,o,s,l):p={bearing:l+n,pitch:s+r},this._getUpdatedState(p)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:n,scale:r}){let{startZoom:o,startZoomLngLat:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(n)||this._unproject(t)),!l)return this;const{maxZoom:s,minZoom:p}=this.getViewportProps();let g=o+Math.log2(r);g=ci(g,p,s);const _=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,..._.panByPosition(l,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const n=t.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:l}=r;return Math.abs(o-n.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(l-n.longitude)>180&&(r.longitude=l<0?l+360:l-360),r}applyConstraints(t){const{maxZoom:n,minZoom:r,zoom:o}=t;t.zoom=ci(o,r,n);const{maxPitch:l,minPitch:s,pitch:p}=t;t.pitch=ci(p,s,l);const{normalize:g=!0}=t;return g&&Object.assign(t,gM(t)),t}_zoomFromCenter(t){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:t})}_panFromCenter(t){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const n=this.makeViewport(this.getViewportProps());return t&&n.unproject(t)}_getNewRotation(t,n,r,o){const l=t[0]-n[0],s=t[1]-n[1],p=t[1],g=n[1],{width:_,height:w}=this.getViewportProps(),P=l/_;let A=0;s>0?Math.abs(w-g)>UP&&(A=s/(g-w)*A9):s<0&&g>UP&&(A=1-p/g),A=ci(A,-1,1);const{minPitch:M,maxPitch:F}=this.getViewportProps(),X=o+180*P;let B=r;return A>0?B=r+A*(F-r):A<0&&(B=r-A*(M-r)),{pitch:B,bearing:X}}}class I9 extends JL{constructor(...t){super(...t),L(this,"ControllerState",C9),L(this,"transition",{transitionDuration:300,transitionInterpolator:new Cw({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),L(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const n=this.props;super.setProps(t),(!n||n.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class tk extends _c{get ViewportType(){return la}get ControllerType(){return I9}}L(tk,"displayName","MapView");class M9 extends Kv{constructor(t,n){super(t,n),L(this,"maskMap",void 0),L(this,"fbo",void 0);const{mapSize:r=2048}=n;this.maskMap=new Zi(t,{width:r,height:r,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new Ur(t,{id:"maskmap",width:r,height:r,attachments:{[36064]:this.maskMap}})}render(t){const n=this.gl,r=[!1,!1,!1,!1];return r[t.channel]=!0,jo(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:r,depthTest:!1},()=>super.render({...t,target:this.fbo,pass:"mask"}))}shouldDrawLayer(t){return t.props.operation===Xd.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const L9=new fi().lookAt({eye:[0,0,1]});function k9({width:e,height:t,near:n,far:r,padding:o}){let l=-e/2,s=e/2,p=-t/2,g=t/2;if(o){const{left:_=0,right:w=0,top:P=0,bottom:A=0}=o,M=ci((_+e-w)/2,0,e)-e/2,F=ci((P+t-A)/2,0,t)-t/2;l-=M,s-=M,p+=F,g+=F}return new fi().ortho({left:l,right:s,bottom:p,top:g,near:n,far:r})}class O9 extends fu{constructor(t){const{width:n,height:r,near:o=.1,far:l=1e3,zoom:s=0,target:p=[0,0,0],padding:g=null,flipY:_=!0}=t,w=Array.isArray(s)?s[0]:s,P=Array.isArray(s)?s[1]:s,A=Math.min(w,P),M=Math.pow(2,A);let F;if(w!==P){const X=Math.pow(2,w),B=Math.pow(2,P);F={unitsPerMeter:[X/M,B/M,1],metersPerUnit:[M/X,M/B,1]}}super({...t,longitude:void 0,position:p,viewMatrix:L9.clone().scale([M,M*(_?-1:1),M]),projectionMatrix:k9({width:n||1,height:r||1,padding:g,near:o,far:l}),zoom:A,distanceScales:F})}projectFlat([t,n]){const{unitsPerMeter:r}=this.distanceScales;return[t*r[0],n*r[1]]}unprojectFlat([t,n]){const{metersPerUnit:r}=this.distanceScales;return[t*r[0],n*r[1]]}panByPosition(t,n){const r=cf(n,this.pixelUnprojectionMatrix),o=this.projectFlat(t),l=fc([],o,Wb([],r)),s=fc([],this.center,l);return{target:this.unprojectFlat(s)}}}class R9 extends QL{constructor(t){const{width:n,height:r,rotationX:o=0,rotationOrbit:l=0,target:s=[0,0,0],zoom:p=0,minRotationX:g=-90,maxRotationX:_=90,minZoom:w=-1/0,maxZoom:P=1/0,startPanPosition:A,startRotatePos:M,startRotationX:F,startRotationOrbit:X,startZoomPosition:B,startZoom:U}=t;super({width:n,height:r,rotationX:o,rotationOrbit:l,target:s,zoom:p,minRotationX:g,maxRotationX:_,minZoom:w,maxZoom:P},{startPanPosition:A,startRotatePos:M,startRotationX:F,startRotationOrbit:X,startZoomPosition:B,startZoom:U}),L(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanPosition:this._unproject(t)})}pan({pos:t,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(r,t);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:t,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:o,startRotationX:l,startRotationOrbit:s}=this.getState(),{width:p,height:g}=this.getViewportProps();if(!o||l===void 0||s===void 0)return this;let _;if(t){let w=(t[0]-o[0])/p;const P=(t[1]-o[1])/g;(l<-90||l>90)&&(w*=-1),_={rotationX:l+P*180,rotationOrbit:s+w*180}}else _={rotationX:l+r,rotationOrbit:s+n};return this._getUpdatedState(_)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const n=t.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:o}=r;return Math.abs(o-n.rotationOrbit)>180&&(r.rotationOrbit=o<0?o+360:o-360),r}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:n,scale:r}){let{startZoom:o,startZoomPosition:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(n)||this._unproject(t)),!l)return this;const s=this._calculateNewZoom({scale:r,startZoom:o}),p=this.makeViewport({...this.getViewportProps(),zoom:s});return this._getUpdatedState({zoom:s,...p.panByPosition(l,t)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){return this._panFromCenter([-t,0])}moveRight(t=50){return this._panFromCenter([t,0])}moveUp(t=50){return this._panFromCenter([0,-t])}moveDown(t=50){return this._panFromCenter([0,t])}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){const n=this.makeViewport(this.getViewportProps());return t&&n.unproject(t)}_calculateNewZoom({scale:t,startZoom:n}){const{maxZoom:r,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const l=n+Math.log2(t);return ci(l,o,r)}_panFromCenter(t){const{width:n,height:r,target:o}=this.getViewportProps();return this.pan({startPosition:o,pos:[n/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{maxZoom:n,minZoom:r,zoom:o,maxRotationX:l,minRotationX:s,rotationOrbit:p}=t;return t.zoom=Array.isArray(o)?[ci(o[0],r,n),ci(o[1],r,n)]:ci(o,r,n),t.rotationX=ci(t.rotationX,s,l),(p<-180||p>180)&&(t.rotationOrbit=QG(p+180,360)-180),t}}class z9 extends R9{constructor(t){super(t),L(this,"zoomAxis",void 0),this.zoomAxis=t.zoomAxis||"all"}_calculateNewZoom({scale:t,startZoom:n}){const{maxZoom:r,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let l=Math.log2(t);if(Array.isArray(n)){let[s,p]=n;switch(this.zoomAxis){case"X":s=ci(s+l,o,r);break;case"Y":p=ci(p+l,o,r);break;default:let g=Math.min(s+l,p+l);g<o&&(l+=o-g),g=Math.max(s+l,p+l),g>r&&(l+=r-g),s+=l,p+=l}return[s,p]}return ci(n+l,o,r)}}class D9 extends JL{constructor(...t){super(...t),L(this,"ControllerState",z9),L(this,"transition",{transitionDuration:300,transitionInterpolator:new Cw(["target","zoom"])}),L(this,"dragMode","pan")}_onPanRotate(){return!1}}class ek extends _c{get ViewportType(){return O9}get ControllerType(){return D9}}L(ek,"displayName","OrthographicView");function F9({layers:e,viewport:t}){let n=null;for(const l of e){const s=l.getBounds();s&&(n?(n[0]=Math.min(n[0],s[0][0]),n[1]=Math.min(n[1],s[0][1]),n[2]=Math.max(n[2],s[1][0]),n[3]=Math.max(n[3],s[1][1])):n=[s[0][0],s[0][1],s[1][0],s[1][1]])}const r=t.getBounds();if(!n)return r;const o=B9(r);return n[2]-n[0]<o[2]-o[0]||n[3]-n[1]<o[3]-o[1]||(n[0]=Math.max(n[0],o[0]),n[1]=Math.max(n[1],o[1]),n[2]=Math.min(n[2],o[2]),n[3]=Math.min(n[3],o[3])),n}function N9({bounds:e,viewport:t,width:n,height:r}){if(e[2]<=e[0]||e[3]<=e[1])return null;const o=1;if(n-=o*2,r-=o*2,t instanceof la){const{longitude:p,latitude:g,zoom:_}=Xb({width:n,height:r,bounds:[[e[0],e[1]],[e[2],e[3]]],maxZoom:20});return new la({longitude:p,latitude:g,zoom:_,x:o,y:o,width:n,height:r})}const l=[(e[0]+e[2])/2,(e[1]+e[3])/2,0],s=Math.min(20,n/(e[2]-e[0]),r/(e[3]-e[1]));return new ek({x:o,y:o}).makeViewport({width:n,height:r,viewState:{target:l,zoom:Math.log2(s)}})}function B9(e){const t={x:e[2]-e[0],y:e[3]-e[1]},n={x:e[0]+.5*t.x,y:e[1]+.5*t.y};return[n.x-t.x,n.y-t.y,n.x+t.x,n.y+t.y]}class U9{constructor(){L(this,"id","mask-effect"),L(this,"props",null),L(this,"useInPicking",!0),L(this,"dummyMaskMap",void 0),L(this,"channels",[]),L(this,"masks",null),L(this,"maskPass",void 0),L(this,"maskMap",void 0),L(this,"lastViewport",void 0)}preRender(t,{layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:s}){this.dummyMaskMap||(this.dummyMaskMap=new Zi(t,{width:1,height:1}));const p=n.filter(P=>P.props.visible&&P.props.operation===Xd.MASK);if(p.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new M9(t,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const g=this._sortMaskChannels(p),_=o[0],w=!this.lastViewport||!this.lastViewport.equals(_);for(const P in g)this._renderChannel(g[P],{layerFilter:r,onViewportActive:l,views:s,viewport:_,viewportChanged:w})}_renderChannel(t,{layerFilter:n,onViewportActive:r,views:o,viewport:l,viewportChanged:s}){const p=this.channels[t.index];if(!p)return;const g=t===p||p.layers.length!==t.layers.length||t.layerBounds.some((_,w)=>_!==p.layerBounds[w]);if(t.bounds=p.bounds,t.maskBounds=p.maskBounds,this.channels[t.index]=t,(g||s)&&(this.lastViewport=l,t.bounds=F9({layers:t.layers,viewport:l}),g||!oa(t.bounds,p.bounds))){const{maskPass:_,maskMap:w}=this,P=N9({bounds:t.bounds,viewport:l,width:w.width,height:w.height});t.maskBounds=P?P.getBounds():[0,0,1,1],_.render({pass:"mask",channel:t.index,layers:t.layers,layerFilter:n,viewports:P?[P]:[],onViewportActive:r,views:o,moduleParameters:{devicePixelRatio:1}})}this.masks[t.id]={index:t.index,bounds:t.maskBounds,coordinateOrigin:t.coordinateOrigin,coordinateSystem:t.coordinateSystem}}_sortMaskChannels(t){const n={};let r=0;for(const o of t){const{id:l}=o.root;let s=n[l];if(!s){if(++r>4){cn.warn("Too many mask layers. The max supported is 4")();continue}s={id:l,index:this.channels.findIndex(p=>(p==null?void 0:p.id)===l),layers:[],layerBounds:[],coordinateOrigin:o.root.props.coordinateOrigin,coordinateSystem:o.root.props.coordinateSystem},n[l]=s}s.layers.push(o),s.layerBounds.push(o.getBounds())}for(let o=0;o<4;o++){const l=this.channels[o];(!l||!(l.id in n))&&(this.channels[o]=null)}for(const o in n){const l=n[o];l.index<0&&(l.index=this.channels.findIndex(s=>!s),this.channels[l.index]=l)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const V9=new $L;class j9{constructor(){L(this,"effects",void 0),L(this,"_internalEffects",void 0),L(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(t){"effects"in t&&(t.effects.length!==this.effects.length||!Sc(t.effects,this.effects))&&(this.setEffects(t.effects),this._needsRedraw="effects changed")}needsRedraw(t={clearRedrawFlags:!1}){const n=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(t=[]){this.cleanup(),this.effects=t,this._internalEffects=t.slice(),this._internalEffects.push(new U9),t.some(n=>n instanceof $L)||this._internalEffects.push(V9)}cleanup(){for(const t of this.effects)t.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}}class G9 extends Kv{shouldDrawLayer(t){return t.props.operation===Xd.DRAW}}const VP={blendFunc:[1,0,32771,0],blendEquation:32774};class nk extends Kv{constructor(...t){super(...t),L(this,"pickZ",void 0),L(this,"_colors",null)}render(t){return t.pickingFBO?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:n,views:r,viewports:o,onViewportActive:l,pickingFBO:s,deviceRect:{x:p,y:g,width:_,height:w},cullRect:P,effects:A,pass:M="picking",pickZ:F}){const X=this.gl;this.pickZ=F;const B=F?null:{byLayer:new Map,byAlpha:[]};this._colors=B;const U=jo(X,{scissorTest:!0,scissor:[p,g,_,w],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...VP,blend:!F},()=>super.render({target:s,layers:t,layerFilter:n,views:r,viewports:o,onViewportActive:l,cullRect:P,effects:A==null?void 0:A.filter(tt=>tt.useInPicking),pass:M}));return this._colors=null,{decodePickingColor:B&&H9.bind(null,B),stats:U}}shouldDrawLayer(t){return t.props.pickable&&t.props.operation===Xd.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,n,r){const o={...t.props.parameters};return this._colors?(Object.assign(o,VP),o.blend=!0,o.blendColor=W9(this._colors,t,r)):o.blend=!1,o}}function W9(e,t,n){const{byLayer:r,byAlpha:o}=e;let l,s=r.get(t);return s?(s.viewports.push(n),l=s.a):(l=r.size+1,l<=255?(s={a:l,layer:t,viewports:[n]},r.set(t,s),o[l]=s):(cn.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function H9(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}const q9="deckRenderer.renderLayers";class Z9{constructor(t){this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new G9(t),this.pickLayersPass=new nk(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=t.layerFilter||this.layerFilter,t.effects=t.effects||[],t.target=t.target||Ur.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);const r=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,o=n.render({...t,target:r});this._postRender(t.effects,t),this.renderCount++,Ri(q9,this,o,t)}needsRedraw(t={clearRedrawFlags:!1}){const n=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:t}=this;for(const n of t)n.delete();t.length=0}_preRender(t,n){let r=null;for(const o of t)o.preRender(this.gl,n),o.postRender&&(r=o);r&&this._resizeRenderBuffers(),this.lastPostProcessEffect=r}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new Ur(this.gl),new Ur(this.gl));for(const n of t)n.resize()}_postRender(t,n){const{renderBuffers:r}=this,o={inputBuffer:r[0],swapBuffer:r[1],target:null};for(const l of t)if(l.postRender){if(l===this.lastPostProcessEffect){o.target=n.target,l.postRender(this.gl,o);break}const s=l.postRender(this.gl,o);o.inputBuffer=s,o.swapBuffer=s===r[0]?r[1]:r[0]}}}const X9={pickedColor:null,pickedObjectIndex:-1};function $9({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:r,deviceRadius:o,deviceRect:l}){const{x:s,y:p,width:g,height:_}=l;let w=o*o,P=-1,A=0;for(let M=0;M<_;M++){const F=M+p-r,X=F*F;if(X>w)A+=4*g;else for(let B=0;B<g;B++){if(e[A+3]-1>=0){const H=B+s-n,tt=H*H+X;tt<=w&&(w=tt,P=A)}A+=4}}if(P>=0){const M=e.slice(P,P+4),F=t(M);if(F){const X=Math.floor(P/4/g),B=P/4-X*g;return{...F,pickedColor:M,pickedX:s+B,pickedY:p+X}}cn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return X9}function Y9({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e){for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){const l=e.slice(r,r+4),s=l.join(",");if(!n.has(s)){const p=t(l);p?n.set(s,{...p,color:l}):cn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function rk({pickInfo:e,viewports:t,pixelRatio:n,x:r,y:o,z:l}){let s=t[0];t.length>1&&(s=J9((e==null?void 0:e.pickedViewports)||t,{x:r,y:o}));let p;if(s){const g=[r-s.x,o-s.y];l!==void 0&&(g[2]=l),p=s.unproject(g)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:p,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function K9(e){const{pickInfo:t,lastPickedInfo:n,mode:r,layers:o}=e,{pickedColor:l,pickedLayer:s,pickedObjectIndex:p}=t,g=s?[s]:[];if(r==="hover"){const P=n.index,A=n.layerId,M=s?s.props.id:null;if(M!==A||p!==P){if(M!==A){const F=o.find(X=>X.props.id===A);F&&g.unshift(F)}n.layerId=M,n.index=p,n.info=null}}const _=rk(e),w=new Map;return w.set(null,_),g.forEach(P=>{let A={..._};P===s&&(A.color=l,A.index=p,A.picked=!0),A=ik({layer:P,info:A,mode:r});const M=A.layer;P===s&&r==="hover"&&(n.info=A),w.set(M.id,A),r==="hover"&&M.updateAutoHighlight(A)}),w}function ik({layer:e,info:t,mode:n}){for(;e&&t;){const r=t.layer||null;t.sourceLayer=r,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:r}),e=e.parent}return t}function J9(e,t){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.containsPixel(t))return r}return e[0]}class Q9{constructor(t){L(this,"gl",void 0),L(this,"pickingFBO",void 0),L(this,"depthFBO",void 0),L(this,"pickLayersPass",void 0),L(this,"layerFilter",void 0),L(this,"lastPickedInfo",void 0),L(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new nk(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:n,layers:r,viewports:o},l=this.lastPickedInfo.info){const s=l&&l.layer&&l.layer.id,p=l&&l.viewport&&l.viewport.id,g=s?r.find(A=>A.id===s):null,_=p&&o.find(A=>A.id===p)||o[0],w=_&&_.unproject([t-_.x,n-_.y]);return{...l,...{x:t,y:n,viewport:_,coordinate:w,layer:g}}}_resizeBuffer(){var t,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ur(r),Ur.isSupported(r,{colorBufferFloat:!0}))){const o=new Ur(r);o.attach({[36064]:new Zi(r,{format:pn(r)?34836:6408,type:5126})}),this.depthFBO=o}(t=this.pickingFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const n=t.filter(r=>r.isPickable()&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:t,views:n,viewports:r,x:o,y:l,radius:s=0,depth:p=1,mode:g="query",unproject3D:_,onViewportActive:w,effects:P}){const A=this._getPickable(t),M=ff(this.gl);if(!A)return{result:[],emptyInfo:rk({viewports:r,x:o,y:l,pixelRatio:M})};this._resizeBuffer();const F=A0(this.gl,[o,l],!0),X=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],B=Math.round(s*M),{width:U,height:H}=this.pickingFBO,tt=this._getPickingRect({deviceX:X[0],deviceY:X[1],deviceRadius:B,deviceWidth:U,deviceHeight:H}),st={x:o-s,y:l-s,width:s*2+1,height:s*2+1};let pt;const _t=[],Ot=new Set;for(let Dt=0;Dt<p;Dt++){let kt;if(tt){const ee=this._drawAndSample({layers:A,views:n,viewports:r,onViewportActive:w,deviceRect:tt,cullRect:st,effects:P,pass:"picking:".concat(g)});kt=$9({...ee,deviceX:X[0],deviceY:X[1],deviceRadius:B,deviceRect:tt})}else kt={pickedColor:null,pickedObjectIndex:-1};let qt;kt.pickedLayer&&_&&this.depthFBO&&(qt=this._drawAndSample({layers:[kt.pickedLayer],views:n,viewports:r,onViewportActive:w,deviceRect:{x:kt.pickedX,y:kt.pickedY,width:1,height:1},cullRect:st,effects:P,pass:"picking:".concat(g,":z")},!0).pickedColors[0]),kt.pickedLayer&&Dt+1<p&&(Ot.add(kt.pickedLayer),kt.pickedLayer.disablePickingIndex(kt.pickedObjectIndex)),pt=K9({pickInfo:kt,lastPickedInfo:this.lastPickedInfo,mode:g,layers:A,viewports:r,x:o,y:l,z:qt,pixelRatio:M});for(const ee of pt.values())ee.layer&&_t.push(ee);if(!kt.pickedColor)break}for(const Dt of Ot)Dt.restorePickingColors();return{result:_t,emptyInfo:pt.get(null)}}_pickVisibleObjects({layers:t,views:n,viewports:r,x:o,y:l,width:s=1,height:p=1,mode:g="query",maxObjects:_=null,onViewportActive:w,effects:P}){const A=this._getPickable(t);if(!A)return[];this._resizeBuffer();const M=ff(this.gl),F=A0(this.gl,[o,l],!0),X=F.x,B=F.y+F.height,U=A0(this.gl,[o+s,l+p],!0),H=U.x+U.width,tt=U.y,st={x:X,y:tt,width:H-X,height:B-tt},pt=this._drawAndSample({layers:A,views:n,viewports:r,onViewportActive:w,deviceRect:st,cullRect:{x:o,y:l,width:s,height:p},effects:P,pass:"picking:".concat(g)}),_t=Y9(pt),Ot=new Map,Dt=Number.isFinite(_);for(let kt=0;kt<_t.length&&!(Dt&&_&&Ot.size>=_);kt++){const qt=_t[kt];let ee={color:qt.pickedColor,layer:null,index:qt.pickedObjectIndex,picked:!0,x:o,y:l,pixelRatio:M};ee=ik({layer:qt.pickedLayer,info:ee,mode:g}),Ot.has(ee.object)||Ot.set(ee.object,ee)}return Array.from(Ot.values())}_drawAndSample({layers:t,views:n,viewports:r,onViewportActive:o,deviceRect:l,cullRect:s,effects:p,pass:g},_=!1){const w=_?this.depthFBO:this.pickingFBO,{decodePickingColor:P}=this.pickLayersPass.render({layers:t,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:o,pickingFBO:w,deviceRect:l,cullRect:s,effects:p,pass:g,pickZ:_}),{x:A,y:M,width:F,height:X}=l,B=new(_?Float32Array:Uint8Array)(F*X*4);return Yv(w,{sourceX:A,sourceY:M,sourceWidth:F,sourceHeight:X,target:B}),{pickedColors:B,decodePickingColor:P}}_getPickingRect({deviceX:t,deviceY:n,deviceRadius:r,deviceWidth:o,deviceHeight:l}){const s=Math.max(0,t-r),p=Math.max(0,n-r),g=Math.min(o,t+r+1)-s,_=Math.min(l,n+r+1)-p;return g<=0||_<=0?null:{x:s,y:p,width:g,height:_}}}const t7={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class e7{constructor(t){L(this,"el",null),L(this,"isVisible",!1);const n=t.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,t7),n.appendChild(this.el))}setTooltip(t,n,r){const o=this.el;if(o){if(typeof t=="string")o.innerText=t;else if(t)t.text&&(o.innerText=t.text),t.html&&(o.innerHTML=t.html),t.className&&(o.className=t.className),Object.assign(o.style,t.style);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(r,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}function Hu(){}const n7=({isDragging:e})=>e?"grabbing":"grab",ok={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Hu,onResize:Hu,onViewStateChange:Hu,onInteractionStateChange:Hu,onBeforeRender:Hu,onAfterRender:Hu,onLoad:Hu,onError:e=>cn.error(e.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:n7,getTooltip:null,debug:!1,drawPickingColors:!1};class Qv{constructor(t){L(this,"props",void 0),L(this,"width",0),L(this,"height",0),L(this,"userData",{}),L(this,"canvas",null),L(this,"viewManager",null),L(this,"layerManager",null),L(this,"effectManager",null),L(this,"deckRenderer",null),L(this,"deckPicker",null),L(this,"eventManager",null),L(this,"tooltip",null),L(this,"metrics",void 0),L(this,"animationLoop",void 0),L(this,"stats",void 0),L(this,"viewState",void 0),L(this,"cursorState",void 0),L(this,"_needsRedraw",void 0),L(this,"_pickRequest",void 0),L(this,"_lastPointerDownInfo",null),L(this,"_metricsCounter",void 0),L(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;r.x=o.x,r.y=o.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),L(this,"_onEvent",n=>{const r=kP[n.type],o=n.offsetCenter;if(!r||!o||!this.layerManager)return;const l=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:l,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:p}=s,g=p&&(p[r.handler]||p.props[r.handler]),_=this.props[r.handler];let w=!1;g&&(w=g.call(p,s,n)),!w&&_&&_(s,n)}),L(this,"_onPointerDown",n=>{const r=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...ok,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&cn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),HM()==="IE"&&cn.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new qv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&gf.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,n,r,o,l,s,p;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)===null||l===void 0||l.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(p=this.tooltip)===null||p===void 0||p.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var g;(g=this.canvas.parentElement)===null||g===void 0||g.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&cn.removed("onLayerHover","onHover")(),"onLayerClick"in t&&cn.removed("onLayerClick","onClick")(),t.initialViewState&&!Sc(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(t),o=this.layerManager.needsRedraw(t),l=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return n=n||r||o||l||s,n}redraw(t){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=t||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ri(this.viewManager),this.viewManager.views}getViewports(t){return ri(this.viewManager),this.viewManager.getViewports(t)}pickObject(t){const n=this._pick("pickObject","pickObject Time",t).result;return n.length?n[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,n=!1){for(const r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:n})}_removeResources(t){for(const n of t)this.layerManager.resourceManager.remove(n)}_pick(t,n,r){ri(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const l=this.deckPicker[t]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(n).timeEnd(),l}_createCanvas(t){let n=t.canvas;return typeof n=="string"&&(n=document.getElementById(n),ri(n)),n||(n=document.createElement("canvas"),n.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(n)),Object.assign(n.style,t.style),n}_setCanvasSize(t){if(!this.canvas)return;const{width:n,height:r}=t;if(n||n===0){const l=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=l}if(r||r===0){var o;const l=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((o=t.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=l}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const n=t.clientWidth||t.width,r=t.clientHeight||t.height;if(n!==this.width||r!==this.height){var o;this.width=n,this.height=r,(o=this.viewManager)===null||o===void 0||o.setProps({width:n,height:r}),this.props.onResize({width:n,height:r})}}_createAnimationLoop(t){const{width:n,height:r,gl:o,glOptions:l,debug:s,onError:p,onBeforeRender:g,onAfterRender:_,useDevicePixels:w}=t;return new qV({width:n,height:r,useDevicePixels:w,autoResizeViewport:!1,gl:o,onCreateContext:P=>hL({...l,...P,canvas:this.canvas,debug:s,onContextLost:()=>this._onContextLost()}),onInitialize:P=>this._setGLContext(P.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:_,onError:p})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new tk({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:r,emptyInfo:o}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let l=o,s=!1;for(const p of r){var n;l=p,s=((n=p.layer)===null||n===void 0?void 0:n.onHover(p,t.event))||s}if(!s&&this.props.onHover&&this.props.onHover(l,t.event),this.props.getTooltip&&this.tooltip){const p=this.props.getTooltip(l);this.tooltip.setTooltip(p,l.x,l.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,yw(t,{enable:!0,copyState:!0})),this.tooltip=new e7(this.canvas),al(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const n=new GL;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new kM(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in kP)this.eventManager.on(o,this._onEvent);this.viewManager=new v9({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new y9(t,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new j9,this.deckRenderer=new Z9(t),this.deckPicker=new Q9(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,n){const{gl:r}=this.layerManager.context;al(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),cn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const n=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const n=this.animationLoop.stats;t.get("GPU Time").addTime(n.get("GPU Time").lastTiming),t.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:n}=this;t.fps=n.get("frameRate").getHz(),t.setPropsTime=n.get("setProps Time").time,t.updateAttributesTime=n.get("Update Attributes").time,t.framesRedrawn=n.get("Redraw Count").count,t.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,t.pickCount=n.get("Pick Count").count,t.gpuTime=n.get("GPU Time").time,t.cpuTime=n.get("CPU Time").time,t.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=nc.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}L(Qv,"defaultProps",ok);L(Qv,"VERSION",K5.VERSION);class G0{constructor(t,n){L(this,"opts",void 0),L(this,"source",void 0),this.opts=n,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),n=this.getAccessor();if(t)return[t,n];const{value:r}=this.source,{size:o}=n;let l=r;if(r&&r.length!==o){l=new Float32Array(o);const s=n.elementOffset||0;for(let p=0;p<o;++p)l[p]=r[s+p]}return l}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function r7(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function wy(e){return e.stride||e.size*e.bytesPerElement}function sk(e,t){t.offset&&cn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=wy(e),r=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,o=t.elementOffset||0,l=r*n+o*e.bytesPerElement+(e.offset||0);return{...t,offset:l,stride:n}}function i7(e,t){const n=sk(e,t);return{high:n,low:{...n,offset:n.offset+e.size*4}}}class o7{constructor(t,n,r){L(this,"gl",void 0),L(this,"id",void 0),L(this,"size",void 0),L(this,"settings",void 0),L(this,"value",void 0),L(this,"doublePrecision",void 0),L(this,"_buffer",void 0),L(this,"state",void 0),this.gl=t,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,l=o===5130;let{defaultValue:s}=n;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let p;l?p=5126:!o&&n.isIndexed?p=t&&wU(t,tr.ELEMENT_INDEX_UINT32)?5125:5123:p=o||5126;let g=r7(o||p||5126);this.doublePrecision=l,l&&n.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...n,defaultType:g,defaultValue:s,logicalType:o,type:p,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:n}=this.settings;this._buffer=new zn(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*wy(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),gf.release(this.state.allocatedValue)}getShaderAttributes(t,n){if(this.doublePrecision){const r={},o=this.value instanceof Float64Array,l=i7(this.getAccessor(),n||{});return r[t]=new G0(this,l.high),r["".concat(t,"64Low")]=o?new G0(this,l.low):new Float32Array(this.size),r}if(n){const r=sk(this.getAccessor(),n);return{[t]:new G0(this,r)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const n=Array.from(this.value);t=[n,n]}else{const{value:n,numInstances:r,size:o}=this,l=r*o;if(n&&l&&n.length>=l){const s=new Array(o).fill(1/0),p=new Array(o).fill(-1/0);for(let g=0;g<l;)for(let _=0;_<o;_++){const w=n[g++];w<s[_]&&(s[_]=w),w>p[_]&&(p[_]=w)}t=[s,p]}}return this.state.bounds=t,t}setData(t){const{state:n}=this;let r;ArrayBuffer.isView(t)?r={value:t}:t instanceof zn?r={buffer:t}:r=t;const o={...this.settings,...r};if(n.bufferAccessor=o,n.bounds=null,r.constant){let l=r.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!n.constant||!this._areValuesEqual(l,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=l}else if(r.buffer){const l=r.buffer;n.externalBuffer=l,n.constant=!1,this.value=r.value||null;const s=r.value instanceof Float64Array;o.type=r.type||l.accessor.type,o.bytesPerElement=l.accessor.BYTES_PER_ELEMENT*(s?2:1),o.stride=wy(o)}else if(r.value){this._checkExternalBuffer(r);let l=r.value;n.externalBuffer=null,n.constant=!1,this.value=l,o.bytesPerElement=l.BYTES_PER_ELEMENT,o.stride=wy(o);const{buffer:s,byteOffset:p}=this;this.doublePrecision&&l instanceof Float64Array&&(l=V0(l,o));const g=l.byteLength+p+o.stride*2;s.byteLength<g&&s.reallocate(g),s.setAccessor(null),s.subData({data:l,offset:p}),o.type=r.type||s.accessor.type}return!0}updateSubBuffer(t={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:o}=t;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?V0(n,{size:this.size,startIndex:r,endIndex:o}):n.subarray(r,o),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t,n=!1){const{state:r}=this,o=r.allocatedValue,l=gf.allocate(o,t+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=l;const{buffer:s,byteOffset:p}=this;return s.byteLength<l.byteLength+p&&(s.reallocate(l.byteLength+p),n&&o&&s.subData({data:o instanceof Float64Array?V0(o,this):o,offset:p})),r.allocatedValue=l,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:n}=t;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in t)&&cn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(t).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(t).map(n=>n/255);case 5123:return new Float32Array(t).map(n=>n/65535);default:return t}}_normalizeValue(t,n,r){const{defaultValue:o,size:l}=this.settings;if(Number.isFinite(t))return n[r]=t,n;if(!t)return n[r]=o[0],n;switch(l){case 4:n[r+3]=Number.isFinite(t[3])?t[3]:o[3];case 3:n[r+2]=Number.isFinite(t[2])?t[2]:o[2];case 2:n[r+1]=Number.isFinite(t[1])?t[1]:o[1];case 1:n[r+0]=Number.isFinite(t[0])?t[0]:o[0];break;default:let s=l;for(;--s>=0;)n[r+s]=Number.isFinite(t[s])?t[s]:o[s]}return n}_areValuesEqual(t,n){if(!t||!n)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(t[o]!==n[o])return!1;return!0}}const jP=[],GP=[];function t_(e,t=0,n=1/0){let r=jP;const o={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?r=e:e.length>0&&(GP.length=e.length,r=GP):r=jP,(t>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,n),o.index=t-1),{iterable:r,objectInfo:o}}function ak(e){return e&&e[Symbol.asyncIterator]}function lk(e,t){const{size:n,stride:r,offset:o,startIndices:l,nested:s}=t,p=e.BYTES_PER_ELEMENT,g=r?r/p:n,_=o?o/p:0,w=Math.floor((e.length-_)/g);return(P,{index:A,target:M})=>{if(!l){const U=A*g+_;for(let H=0;H<n;H++)M[H]=e[U+H];return M}const F=l[A],X=l[A+1]||w;let B;if(s){B=new Array(X-F);for(let U=F;U<X;U++){const H=U*g+_;M=new Array(n);for(let tt=0;tt<n;tt++)M[tt]=e[H+tt];B[U-F]=M}}else if(g===n)B=e.subarray(F*n+_,X*n+_);else{B=new e.constructor((X-F)*n);let U=0;for(let H=F;H<X;H++){const tt=H*g+_;for(let st=0;st<n;st++)B[U++]=e[tt+st]}}return B}}const s7=[],Ty=[[0,1/0]];function a7(e,t){if(e===Ty||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const n=[],r=e.length;let o=0;for(let l=0;l<r;l++){const s=e[l];s[1]<t[0]?(n.push(s),o=l+1):s[0]>t[1]?n.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return n.splice(o,0,t),n}function W0(e){const{source:t,target:n,start:r=0,size:o,getData:l}=e,s=e.end||n.length,p=t.length,g=s-r;if(p>g){n.set(t.subarray(0,g),r);return}if(n.set(t,r),!l)return;let _=p;for(;_<g;){const w=l(_,t);for(let P=0;P<o;P++)n[r+_]=w[P]||0,_++}}function l7({source:e,target:t,size:n,getData:r,sourceStartIndices:o,targetStartIndices:l}){if(!Array.isArray(l))return W0({source:e,target:t,size:n,getData:r}),t;let s=0,p=0;const g=r&&((w,P)=>r(w+p,P)),_=Math.min(o.length,l.length);for(let w=1;w<_;w++){const P=o[w]*n,A=l[w]*n;W0({source:e.subarray(s,P),target:t,start:p,end:A,size:n,getData:g}),s=P,p=A}return p<t.length&&W0({source:[],target:t,start:p,size:n,getData:g}),t}const u7={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function uk(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...u7[n],...t,...e,type:n}}function ck(e,t){const n=t.getBuffer();return n?[n,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function hk(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function fk(e){e.push(e.shift())}function Iw(e,t){const{doublePrecision:n,settings:r,value:o,size:l}=e,s=n&&o instanceof Float64Array?2:1;return(r.noAlloc?o.length:t*l)*s}function pk({buffer:e,numInstances:t,attribute:n,fromLength:r,fromStartIndices:o,getData:l=s=>s}){const s=n.doublePrecision&&n.value instanceof Float64Array?2:1,p=n.size*s,g=n.byteOffset,_=n.startIndices,w=o&&_,P=Iw(n,t),A=n.isConstant;if(!w&&r>=P)return;const M=A?n.value:n.getBuffer().getData({srcByteOffset:g});if(n.settings.normalized&&!A){const U=l;l=(H,tt)=>n.normalizeConstant(U(H,tt))}const F=A?(U,H)=>l(M,H):(U,H)=>l(M.subarray(U,U+p),H),X=e.getData({length:r}),B=new Float32Array(P);l7({source:X,target:B,sourceStartIndices:o,targetStartIndices:_,size:p,getData:F}),e.byteLength<B.byteLength+g&&e.reallocate(B.byteLength+g),e.subData({data:B,offset:g})}class Mw extends o7{constructor(t,n){super(t,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ty}),L(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!t,n}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,o=Array.isArray(n)?t[n.find(l=>t[l])]:t[n];return uk(o,r)}setNeedsUpdate(t=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),n){const{startRow:r=0,endRow:o=1/0}=n;this.state.updateRanges=a7(this.state.updateRanges,[r,o])}else this.state.updateRanges=Ty}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=s7}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(t,n.updateRanges!==Ty),!0):!1}updateBuffer({numInstances:t,data:n,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:s,noAlloc:p}}=this;let g=!0;if(s){for(const[_,w]of l)s.call(o,this,{data:n,startRow:_,endRow:w,props:r,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[_,w]of l){const P=Number.isFinite(_)?this.getVertexOffset(_):0,A=Number.isFinite(w)?this.getVertexOffset(w):p||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:P,endOffset:A})}this._checkAttributeArray()}else g=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),g}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:n}=this;return t?(this.clearNeedsUpdate(),n.lastExternalBuffer===t||(n.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(t,n=null){const{state:r,settings:o}=this;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;ri(ArrayBuffer.isView(s.value),"invalid ".concat(o.accessor));const p=Boolean(s.size)&&s.size!==this.size;return r.binaryAccessor=lk(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:n,nested:p}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:n}=this;return(n?t<n.length?n[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in t)Object.assign(n,super.getShaderAttributes(r,t[r]));return n}_autoUpdater(t,{data:n,startRow:r,endRow:o,props:l,numInstances:s}){if(t.constant)return;const{settings:p,state:g,value:_,size:w,startIndices:P}=t,{accessor:A,transform:M}=p,F=g.binaryAccessor||(typeof A=="function"?A:l[A]);ri(typeof F=="function",'accessor "'.concat(A,'" is not a function'));let X=t.getVertexOffset(r);const{iterable:B,objectInfo:U}=t_(n,r,o);for(const H of B){U.index++;let tt=F(H,U);if(M&&(tt=M.call(this,tt)),P){const st=(U.index<P.length-1?P[U.index+1]:s)-P[U.index];if(tt&&Array.isArray(tt[0])){let pt=X;for(const _t of tt)t._normalizeValue(_t,_,pt),pt+=w}else tt&&tt.length>w?_.set(tt,X):(t._normalizeValue(tt,U.target,0),f9({target:_,source:U.target,start:X,count:st}));X+=st*w}else t._normalizeValue(tt,_,X),X+=w}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,n=Math.min(4,this.size);if(t&&t.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class c7{constructor({gl:t,attribute:n,timeline:r}){L(this,"gl",void 0),L(this,"type","interpolation"),L(this,"attributeInTransition",void 0),L(this,"settings",void 0),L(this,"attribute",void 0),L(this,"transition",void 0),L(this,"currentStartIndices",void 0),L(this,"currentLength",void 0),L(this,"transform",void 0),L(this,"buffers",void 0),this.gl=t,this.transition=new Jd(r),this.attribute=n,this.attributeInTransition=new Mw(t,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=f7(t,n);const o={byteLength:0,usage:35050};this.buffers=[new zn(t,o),new zn(t,o)]}get inProgress(){return this.transition.inProgress}start(t,n){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:r,buffers:o,attribute:l}=this;fk(o);const s={numInstances:n,attribute:l,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const p of o)pk({buffer:p,...s});this.currentStartIndices=l.startIndices,this.currentLength=Iw(l,n),this.attributeInTransition.setData({buffer:o[1],value:l.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/l.size),sourceBuffers:{aFrom:o[0],aTo:ck(r,l)},feedbackBuffers:{vCurrent:o[1]}})}update(){const t=this.transition.update();if(t){const{duration:n,easing:r}=this.settings,{time:o}=this.transition;let l=o/n;r&&(l=r(l)),this.transform.run({uniforms:{time:l}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const h7=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function f7(e,t){const n=hk(t.size);return new Pw(e,{vs:h7,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class p7{constructor({gl:t,attribute:n,timeline:r}){L(this,"gl",void 0),L(this,"type","spring"),L(this,"attributeInTransition",void 0),L(this,"settings",void 0),L(this,"attribute",void 0),L(this,"transition",void 0),L(this,"currentStartIndices",void 0),L(this,"currentLength",void 0),L(this,"texture",void 0),L(this,"framebuffer",void 0),L(this,"transform",void 0),L(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new Jd(r),this.attribute=n,this.attributeInTransition=new Mw(t,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=m7(t),this.framebuffer=g7(t,this.texture),this.transform=d7(t,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new zn(t,o),new zn(t,o),new zn(t,o)]}get inProgress(){return this.transition.inProgress}start(t,n){const{gl:r,buffers:o,attribute:l}=this,s={numInstances:n,attribute:l,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const p of o)pk({buffer:p,...s});this.settings=t,this.currentStartIndices=l.startIndices,this.currentLength=Iw(l,n),this.attributeInTransition.setData({buffer:o[1],value:l.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/l.size),sourceBuffers:{aTo:ck(r,l)}})}update(){const{buffers:t,transform:n,framebuffer:r,transition:o}=this;if(!o.update())return!1;const s=this.settings;return n.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),fk(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Yv(r)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function d7(e,t,n){const r=hk(t.size);return new Pw(e,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function m7(e){return new Zi(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function g7(e,t){return new Ur(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:t}})}const y7={interpolation:c7,spring:p7};class v7{constructor(t,{id:n,timeline:r}){L(this,"id",void 0),L(this,"isSupported",void 0),L(this,"gl",void 0),L(this,"timeline",void 0),L(this,"transitions",void 0),L(this,"needsRedraw",void 0),L(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Pw.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:n,numInstances:r}){this.numInstances=r||1;for(const o in t){const l=t[o],s=l.getTransitionSetting(n);s&&this._updateAttribute(o,l,s)}for(const o in this.transitions){const l=t[o];(!l||!l.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(t){const n=this.transitions[t];return n&&n.inProgress}getAttributes(){const t={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(t[n]=r.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,n,r){const o=this.transitions[t];let l=!o||o.type!==r.type;if(l){if(!this.isSupported){cn.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}o&&this._removeTransition(t);const s=y7[r.type];s?this.transitions[t]=new s({attribute:n,timeline:this.timeline,gl:this.gl}):(cn.error("unsupported transition type '".concat(r.type,"'"))(),l=!1)}(l||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}const WP="attributeManager.invalidate",_7="attributeManager.updateStart",x7="attributeManager.updateEnd",b7="attribute.updateStart",w7="attribute.allocate",T7="attribute.updateEnd";class E7{constructor(t,{id:n="attribute-manager",stats:r,timeline:o}={}){L(this,"id",void 0),L(this,"gl",void 0),L(this,"attributes",void 0),L(this,"updateTriggers",void 0),L(this,"needsRedraw",void 0),L(this,"userData",void 0),L(this,"stats",void 0),L(this,"attributeTransitionManager",void 0),this.id=n,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new v7(t,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const n of t)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(t,n){const r=this._invalidateTrigger(t,n);Ri(WP,this,t,r)}invalidateAll(t){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,t);Ri(WP,this,"all")}update({data:t,numInstances:n,startIndices:r=null,transitions:o,props:l={},buffers:s={},context:p={}}){let g=!1;Ri(_7,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const _ in this.attributes){const w=this.attributes[_],P=w.settings.accessor;w.startIndices=r,w.numInstances=n,l[_]&&cn.removed("props.".concat(_),"data.attributes.".concat(_))(),w.setExternalBuffer(s[_])||w.setBinaryValue(typeof P=="string"?s[P]:void 0,t.startIndices)||typeof P=="string"&&!s[P]&&w.setConstantValue(l[P])||w.needsUpdate()&&(g=!0,this._updateAttribute({attribute:w,numInstances:n,data:t,props:l,context:p})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}g&&Ri(x7,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:t}=this,n=t.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const l in n){const s=n[l];s.needsRedraw(t)&&!r.hasAttribute(l)&&(o[l]=s)}return o}getShaderAttributes(t,n={}){t||(t=this.getAttributes());const r={};for(const o in t)n[o]||Object.assign(r,t[o].getShaderAttributes());return r}_add(t,n={}){for(const r in t){const o=t[r];this.attributes[r]=this._createAttribute(r,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,n,r){const o={...n,id:t,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new Mw(this.gl,o)}_mapUpdateTriggersToAttributes(){const t={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{t[o]||(t[o]=[]),t[o].push(n)});this.updateTriggers=t}_invalidateTrigger(t,n){const{attributes:r,updateTriggers:o}=this,l=o[t];return l&&l.forEach(s=>{const p=r[s];p&&p.setNeedsUpdate(p.id,n)}),l}_updateAttribute(t){const{attribute:n,numInstances:r}=t;if(Ri(b7,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Ri(w7,n,r),n.updateBuffer(t)&&(this.needsRedraw=!0,Ri(T7,n,r))}}class S7 extends Jd{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:n,toValue:r,duration:o,easing:l}}=this,s=l(t/o);this._value=mf(n,r,s)}}const HP=1e-5;function qP(e,t,n,r,o){const l=t-e,p=(n-t)*o,g=-l*r;return p+g+l+t}function P7(e,t,n,r,o){if(Array.isArray(n)){const l=[];for(let s=0;s<n.length;s++)l[s]=qP(e[s],t[s],n[s],r,o);return l}return qP(e,t,n,r,o)}function ZP(e,t){if(Array.isArray(e)){let n=0;for(let r=0;r<e.length;r++){const o=e[r]-t[r];n+=o*o}return Math.sqrt(n)}return Math.abs(e-t)}class A7 extends Jd{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:n,damping:r,stiffness:o}=this.settings,{_prevValue:l=t,_currValue:s=t}=this;let p=P7(l,s,n,r,o);const g=ZP(p,n),_=ZP(p,s);g<HP&&_<HP&&(p=n,this.end()),this._prevValue=s,this._currValue=p}}const C7={interpolation:S7,spring:A7};class I7{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,n,r,o){const{transitions:l}=this;if(l.has(t)){const g=l.get(t),{value:_=g.settings.fromValue}=g;n=_,this.remove(t)}if(o=uk(o),!o)return;const s=C7[o.type];if(!s){cn.error("unsupported transition type '".concat(o.type,"'"))();return}const p=new s(this.timeline);p.start({...o,fromValue:n,toValue:r}),l.set(t,p)}remove(t){const{transitions:n}=this;n.has(t)&&(n.get(t).cancel(),n.delete(t))}update(){const t={};for(const[n,r]of this.transitions)r.update(),t[n]=r.value,r.inProgress||this.remove(n);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function M7(e){const t=Lw(e);for(const n in t){const r=t[n],{validate:o}=r;if(o&&!o(e[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(e[n]))}}function L7(e,t){const n=dk({newProps:e,oldProps:t,propTypes:Lw(e),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=O7(e,t);let o=!1;return r||(o=R7(e,t)),{dataChanged:r,propsChanged:n,updateTriggersChanged:o,extensionsChanged:z7(e,t),transitionsChanged:k7(e,t)}}function k7(e,t){if(!e.transitions)return!1;const n={},r=Lw(e);let o=!1;for(const l in e.transitions){const s=r[l],p=s&&s.type;(p==="number"||p==="color"||p==="array")&&L1(e[l],t[l],s)&&(n[l]=!0,o=!0)}return o?n:!1}function dk({newProps:e,oldProps:t,ignoreProps:n={},propTypes:r={},triggerName:o="props"}){if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const l of Object.keys(e))if(!(l in n)){if(!(l in t))return"".concat(o,".").concat(l," added");const s=L1(e[l],t[l],r[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}for(const l of Object.keys(t))if(!(l in n)){if(!(l in e))return"".concat(o,".").concat(l," dropped");if(!Object.hasOwnProperty.call(e,l)){const s=L1(e[l],t[l],r[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}}return!1}function L1(e,t,n){let r=n&&n.equal;return r&&!r(e,t,n)||!r&&(r=e&&t&&e.equals,r&&!r.call(e,t))?"changed deeply":!r&&t!==e?"changed shallowly":null}function O7(e,t){if(t===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:o}=e;return r?r(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied"),n&&o&&(n=o(e.data,t.data)||n),n}function R7(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&XP(e,t,"all"))return{all:!0};const n={};let r=!1;for(const o in e.updateTriggers)o!=="all"&&XP(e,t,o)&&(n[o]=!0,r=!0);return r?n:!1}function z7(e,t){if(t===null)return!0;const n=t.extensions,{extensions:r}=e;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(n[o]))return!0;return!1}function XP(e,t,n){let r=e.updateTriggers[n];r=r??{};let o=t.updateTriggers[n];return o=o??{},dk({oldProps:o,newProps:r,triggerName:n})}function Lw(e){const t=e[yv],n=t&&t.constructor;return n?n._propTypes:{}}const D7="count(): argument not an object",F7="count(): argument not a container";function N7(e){if(!U7(e))throw new Error(D7);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(B7(e))return Object.keys(e).length;throw new Error(F7)}function B7(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function U7(e){return e!==null&&typeof e=="object"}function V7(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(o=>o.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in t)if(!e.inject)n.inject=t.inject;else{const r={...e.inject};for(const o in t.inject)r[o]=(r[o]||"")+t.inject[o];n.inject=r}return n}const j7={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},k1={};function G7(e,t){const n=e.context&&e.context.gl;if(!n||!t)return null;if(t instanceof Zi)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let r=null;t.compressed&&(r={[10241]:t.data.length>1?9985:9729});const o=new Zi(n,{...t,parameters:{...j7,...r,...e.props.textureParameters}});return k1[o.id]=!0,o}function W7(e){!e||!(e instanceof Zi)||k1[e.id]&&(e.delete(),delete k1[e.id])}const H7={boolean:{validate(e,t){return!0},equal(e,t,n){return Boolean(e)===Boolean(t)}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||Td(e)&&(e.length===3||e.length===4)},equal(e,t,n){return H0(e,t)}},accessor:{validate(e,t){const n=vv(e);return n==="function"||n===vv(t.value)},equal(e,t,n){return typeof t=="function"?!0:H0(e,t)}},array:{validate(e,t){return t.optional&&!e||Td(e)},equal(e,t,n){return n.compare?H0(e,t):e===t}},object:{equal(e,t,n){return n.compare?Sc(e,t):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,n){return!n.compare||e===t}},data:{transform:(e,t,n)=>{const{dataTransform:r}=n.props;return r&&e?r(e):e}},image:{transform:(e,t,n)=>G7(n,e),release:e=>{W7(e)}}};function H0(e,t){if(e===t)return!0;if(!Td(e)||!Td(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function q7(e){const t={},n={},r={};for(const[o,l]of Object.entries(e)){const s=l==null?void 0:l.deprecatedFor;if(s)r[o]=Array.isArray(s)?s:[s];else{const p=Z7(o,l);t[o]=p,n[o]=p.value}}return{propTypes:t,defaultProps:n,deprecatedProps:r}}function Z7(e,t){switch(vv(t)){case"object":return Lp(e,t);case"array":return Lp(e,{type:"array",value:t,compare:!1});case"boolean":return Lp(e,{type:"boolean",value:t});case"number":return Lp(e,{type:"number",value:t});case"function":return Lp(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Lp(e,t){return"type"in t?{name:e,...H7[t.type],...t}:"value"in t?{name:e,type:vv(t.value),...t}:{name:e,type:"object",value:t}}function Td(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function vv(e){return Td(e)?"array":e===null?"null":typeof e}function X7(e,t){const n=mk(e.constructor),r=Object.create(n);r[yv]=e,r[vc]={},r[Hl]={};for(let o=0;o<t.length;++o){const l=t[o];for(const s in l)r[s]=l[s]}return Object.freeze(r),r}function mk(e){const t=_v(e,"_mergedDefaultProps");return t||($7(e),e._mergedDefaultProps)}function $7(e){if(!e.prototype)return;const n=Object.getPrototypeOf(e),r=mk(n),o=_v(e,"defaultProps")||{},l=q7(o),s=Y7(l.defaultProps,r,e),p={...n._propTypes,...l.propTypes};J7(s,p);const g={...n._deprecatedProps,...l.deprecatedProps};K7(s,g),e._mergedDefaultProps=s,e._propTypes=p,e._deprecatedProps=g}function Y7(e,t,n){const r=Object.create(null);Object.assign(r,t,e);const o=tW(n);return delete e.id,Object.defineProperties(r,{id:{writable:!0,value:o}}),r}function K7(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(r){const o="".concat(this.id,": ").concat(n);for(const l of t[n])gk(this,l)||(this[l]=r);cn.deprecated(o,t[n].join("/"))()}})}function J7(e,t){const n={},r={};for(const o in t){const l=t[o],{name:s,value:p}=l;l.async&&(n[s]=p,r[s]=Q7(s))}e[Qh]=n,e[vc]={},Object.defineProperties(e,r)}function Q7(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||ak(t)?this[vc][e]=t:this[Hl][e]=t},get(){if(this[Hl]){if(e in this[Hl])return this[Hl][e]||this[Qh][e];if(e in this[vc]){const t=this[yv]&&this[yv].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Qh][e]}}return this[Qh][e]}}}function gk(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _v(e,t){return gk(e,t)&&e[t]}function tW(e){const t=_v(e,"layerName")||_v(e,"componentName");return t||cn.once(0,"".concat(e.name,".componentName not specified"))(),t||e.name}let eW=0;class kw{constructor(...t){L(this,"id",void 0),L(this,"props",void 0),L(this,"count",void 0),this.props=X7(this,t),this.id=this.props.id,this.count=eW++}clone(t){const{props:n}=this,r={};for(const o in n[Qh])o in n[Hl]?r[o]=n[Hl][o]:o in n[vc]&&(r[o]=n[vc][o]);return new this.constructor({...n,...r,...t})}}L(kw,"componentName","Component");L(kw,"defaultProps",{});const nW=Object.freeze({});class rW{constructor(t){L(this,"component",void 0),L(this,"onAsyncPropUpdated",void 0),L(this,"asyncProps",void 0),L(this,"oldProps",void 0),L(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const n=this.asyncProps[t];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||nW}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const n=this.asyncProps[t];return n&&n.resolvedValue}isAsyncPropLoading(t){if(t){const n=this.asyncProps[t];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(t,n){this._watchPromise(t,Promise.resolve(n))}setAsyncProps(t){const n=t[Hl]||{},r=t[vc]||t,o=t[Qh]||{};for(const l in n){const s=n[l];this._createAsyncPropData(l,o[l]),this._updateAsyncProp(l,s),n[l]=this.getAsyncProp(l)}for(const l in r){const s=r[l];this._createAsyncPropData(l,o[l]),this._updateAsyncProp(l,s)}}_fetch(t,n){return null}_onResolve(t,n){}_onError(t,n){}_updateAsyncProp(t,n){if(this._didAsyncInputValueChange(t,n)){if(typeof n=="string"&&(n=this._fetch(t,n)),n instanceof Promise){this._watchPromise(t,n);return}if(ak(n)){this._resolveAsyncIterable(t,n);return}this._setPropValue(t,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,n){const r=this.asyncProps[t];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(t,n){this._freezeAsyncOldProps();const r=this.asyncProps[t];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(t,n,r){const o=this.asyncProps[t];o&&r>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=r,this.onAsyncPropUpdated(t,n))}_watchPromise(t,n){const r=this.asyncProps[t];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;n.then(l=>{l=this._postProcessValue(r,l),this._setAsyncPropValue(t,l,o),this._onResolve(t,l)}).catch(l=>{this._onError(t,l)})}}async _resolveAsyncIterable(t,n){if(t!=="data"){this._setPropValue(t,n);return}const r=this.asyncProps[t];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let l=[],s=0;for await(const p of n){const{dataTransform:g}=this.component.props;g?l=g(p,l):l=l.concat(p),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:s,endRow:l.length}]}),s=l.length,this._setAsyncPropValue(t,l,o)}this._onResolve(t,l)}_postProcessValue(t,n){const r=t.type;return r&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(t,n){if(!this.asyncProps[t]){const o=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:o&&o[t],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class iW extends rW{constructor({attributeManager:t,layer:n}){super(n),L(this,"attributeManager",void 0),L(this,"needsRedraw",void 0),L(this,"needsUpdate",void 0),L(this,"subLayers",void 0),L(this,"usesPickingColorCache",void 0),L(this,"changeFlags",void 0),L(this,"viewport",void 0),L(this,"uniformTransitions",void 0),L(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(t){this.component=t}_fetch(t,n){const r=this.component.props.fetch;return r?r(n,{propName:t,layer:this.layer}):super._fetch(t,n)}_onResolve(t,n){const r=this.component.props.onDataLoad;t==="data"&&r&&r(n,{propName:t,layer:this.layer})}_onError(t,n){this.layer.raiseError(n,"loading ".concat(t," of ").concat(this.layer))}}const oW="layer.changeFlag",sW="layer.initialize",aW="layer.update",lW="layer.finalize",uW="layer.matched",$P=2**24-1,cW=Object.freeze([]),hW=$d(({oldViewport:e,viewport:t})=>e.equals(t));let $s=new Uint8ClampedArray(0);const fW={data:{type:"data",value:cW,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:r,loadOptions:o,signal:l})=>{const{resourceManager:s}=n.context;if(o=o||n.getLoadOptions(),r=r||n.props.loaders,l){var p;o={...o,fetch:{...(p=o)===null||p===void 0?void 0:p.fetch,signal:l}}}let g=s.contains(e);return!g&&!o&&(s.add({resourceId:e,data:pv(e,r),persistent:!1}),g=!0),g?s.subscribe({resourceId:e,onChange:_=>{var w;return(w=n.internalState)===null||w===void 0?void 0:w.reloadAsyncProp(t,_)},consumerId:n.id,requestId:t}):pv(e,r,o)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:Xd.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:bn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class pl extends kw{constructor(...t){super(...t),L(this,"internalState",null),L(this,"lifecycle",Mh.NO_STATE),L(this,"context",void 0),L(this,"state",void 0),L(this,"parent",null)}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){ri(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=YL(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,l,s]=Zb(r,n.pixelProjectionMatrix);return t.length===2?[o,l]:[o,l,s]}unproject(t){return ri(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,n){ri(this.internalState);const r=this.internalState.viewport||this.context.viewport;return h9(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const n of this.getModels())n.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===bn.DEFAULT||t===bn.LNGLAT||t===bn.CARTESIAN}onHover(t,n){return this.props.onHover&&this.props.onHover(t,n)||!1}onClick(t,n){return this.props.onClick&&this.props.onClick(t,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,n=[]){return n[0]=t+1&255,n[1]=t+1>>8&255,n[2]=t+1>>8>>8&255,n}decodePickingColor(t){ri(t instanceof Uint8Array);const[n,r,o]=t;return n+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:N7(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;const n=this.getAttributeManager();if(!n)return null;const{positions:r,instancePositions:o}=n.attributes;return(t=r||o)===null||t===void 0?void 0:t.getBounds()}getShaders(t){for(const n of this.props.extensions)t=V7(t,n.getShaders.call(this,n));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const n=this.getAttributeManager(),{dataChanged:r}=t.changeFlags;if(r&&n)if(Array.isArray(r))for(const g of r)n.invalidateAll(g);else n.invalidateAll();const{props:o,oldProps:l}=t,s=Number.isInteger(l.highlightedObjectIndex)||l.pickable,p=Number.isInteger(o.highlightedObjectIndex)||o.pickable;if(s!==p&&n){const{pickingColors:g,instancePickingColors:_}=n.attributes,w=g||_;w&&(p&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!p&&(w.constant=!0,w.value=[0,0,0]))}}finalizeState(t){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const n of this.getModels())n.draw(t)}getPickingInfo({info:t,mode:n,sourceLayer:r}){const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(t,n){var r,o;if(n&&(t.message="".concat(n,": ").concat(t.message)),!((r=(o=this.props).onError)!==null&&r!==void 0&&r.call(o,t))){var l,s;(l=this.context)===null||l===void 0||(s=l.onError)===null||s===void 0||s.call(l,t,this)}}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=t,(!n||!hW({oldViewport:n,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const n=this.getAttributeManager();n&&(t==="all"?n.invalidateAll():n.invalidate(t))}updateAttributes(t){for(const n of this.getModels())this._setModelAttributes(n,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const n=this.props,r=this.getNumInstances(),o=this.getStartIndices();t.update({data:n.data,numInstances:r,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const l=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const n=t.update(),r=Object.create(this.props);for(const o in n)Object.defineProperty(r,o,{value:n[o]});return r}return this.props}calculateInstancePickingColors(t,{numInstances:n}){if(t.constant)return;const r=Math.floor($s.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>$P&&cn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$s=gf.allocate($s,n,{size:3,copy:!0,maxCount:Math.max(n,$P)});const o=Math.floor($s.length/3),l=[];for(let s=r;s<o;s++)this.encodePickingColor(s,l),$s[s*3+0]=l[0],$s[s*3+1]=l[1],$s[s*3+2]=l[2]}t.value=$s.subarray(0,n*3)}_setModelAttributes(t,n){const r=this.getAttributeManager(),o=t.userData.excludeAttributes||{},l=r.getShaderAttributes(n,o);t.setAttributes(l)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,o=n||r;if(!o)return;const l=o.getVertexOffset(t),s=o.getVertexOffset(t+1);o.buffer.subData({data:new Uint8Array(s-l),offset:l})}restorePickingColors(){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,r=t||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==$s.buffer&&(r.value=$s.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ri(!this.internalState),ri(Number.isFinite(this.props.coordinateSystem)),Ri(sW,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new iW({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(cn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.layer=this,this.internalState.uniformTransitions=new I7(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Ri(uW,this,this===t);const{state:n,internalState:r}=t;this!==t&&(this.internalState=r,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Ri(aW,this,t),!t)return;const n=this.props,r=this.context,o=this.internalState,l=r.viewport,s=this._updateUniformTransition();o.propsInTransition=s,r.viewport=o.viewport||l,this.props=s;try{const p=this._getUpdateParams(),g=this.getModels();if(r.gl)this.updateState(p);else try{this.updateState(p)}catch{}for(const w of this.props.extensions)w.updateState.call(this,p,w);const _=this.getModels()[0]!==g[0];this._postUpdate(p,_)}finally{r.viewport=l,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Ri(lW,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,t)}_drawLayer({moduleParameters:t=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;n.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:p}=this.props,g=p&&p(n)||[0,0];al(l.gl,{polygonOffset:g}),jo(l.gl,r,()=>{const _={moduleParameters:t,uniforms:n,parameters:r,context:l};for(const w of this.props.extensions)w.draw.call(this,_,w);this.draw(_)})}finally{this.props=o}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in t)if(t[o]){let l=!1;switch(o){case"dataChanged":const s=t[o],p=n[o];s&&Array.isArray(p)&&(n.dataChanged=Array.isArray(s)?p.concat(s):s,l=!0);default:n[o]||(n[o]=t[o],l=!0)}l&&Ri(oW,this,o,t)}const r=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,n){const r=L7(t,n);if(r.updateTriggersChanged)for(const l in r.updateTriggersChanged)r.updateTriggersChanged[l]&&this.invalidateAttribute(l);if(r.transitionsChanged)for(const l in r.transitionsChanged){var o;this.internalState.uniformTransitions.add(l,n[l],t[l],(o=t.transitions)===null||o===void 0?void 0:o[l])}return this.setChangeFlags(r)}validateProps(){M7(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const n={pickingSelectedColor:t.picked?t.color:null},{highlightColor:r}=this.props;t.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(t)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new E7(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,n){const{props:r,oldProps:o}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:l}=this.state;l==null||l.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:p,highlightColor:g}=r;if(n||o.autoHighlight!==s||o.highlightedObjectIndex!==p||o.highlightColor!==g){const _={};s||(_.pickingSelectedColor=null),Array.isArray(g)&&(_.pickingHighlightColor=g),(n||p!==o.highlightedObjectIndex)&&(_.pickingSelectedColor=Number.isFinite(p)&&p>=0?this.encodePickingColor(p):null),this.setModuleParameters(_)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(t):!1;return n=n||o,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}L(pl,"defaultProps",fW);L(pl,"layerName","Layer");const pW="compositeLayer.renderLayers";class e_ extends pl{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:n}=t;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(t.object=n.__source.object,t.index=n.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,n){return n&&n.length}getSubLayerClass(t,n){const{_subLayerProps:r}=this.props;return r&&r[t]&&r[t].type||n}getSubLayerRow(t,n,r){return t.__source={parent:this,object:n,index:r},t}getSubLayerAccessor(t){if(typeof t=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(n.index=r.__source.index,t(r.__source.object,n)):t(r,o)}return t}getSubLayerProps(t={}){var n;const{opacity:r,pickable:o,visible:l,parameters:s,getPolygonOffset:p,highlightedObjectIndex:g,autoHighlight:_,highlightColor:w,coordinateSystem:P,coordinateOrigin:A,wrapLongitude:M,positionFormat:F,modelMatrix:X,extensions:B,fetch:U,operation:H,_subLayerProps:tt}=this.props,st={id:"",updateTriggers:{},opacity:r,pickable:o,visible:l,parameters:s,getPolygonOffset:p,highlightedObjectIndex:g,autoHighlight:_,highlightColor:w,coordinateSystem:P,coordinateOrigin:A,wrapLongitude:M,positionFormat:F,modelMatrix:X,extensions:B,fetch:U,operation:H},pt=tt&&t.id&&tt[t.id],_t=pt&&pt.updateTriggers,Ot=t.id||"sublayer";if(pt){const Dt=this.constructor._propTypes,kt=t.type?t.type._propTypes:{};for(const qt in pt){const ee=kt[qt]||Dt[qt];ee&&ee.type==="accessor"&&(pt[qt]=this.getSubLayerAccessor(pt[qt]))}}Object.assign(st,t,pt),st.id="".concat(this.props.id,"-").concat(Ot),st.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...t.updateTriggers,..._t};for(const Dt of B){const kt=Dt.getSubLayerProps.call(this,Dt);kt&&Object.assign(st,kt,{updateTriggers:Object.assign(st.updateTriggers,kt.updateTriggers)})}return st}_updateAutoHighlight(t){for(const n of this.getSubLayers())n.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,n){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const l=this.renderLayers();r=Jv(l,Boolean),this.internalState.subLayers=r}Ri(pW,this,o,r);for(const l of r)l.parent=this}}L(e_,"layerName","CompositeLayer");const Fg=Math.PI/180,YP=180/Math.PI,Ey=6370972,Uh=256;function dW(){const e=Uh/Ey,t=Math.PI/180*Uh;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}class mW extends fu{constructor(t={}){const{latitude:n=0,longitude:r=0,zoom:o=0,nearZMultiplier:l=.1,farZMultiplier:s=2,resolution:p=10}=t;let{height:g,altitude:_=1.5}=t;g=g||1,_=Math.max(.75,_);const w=new fi().lookAt({eye:[0,-_,0],up:[0,0,1]}),P=Math.pow(2,o);w.rotateX(n*Fg),w.rotateZ(-r*Fg),w.scale(P/g);const A=Math.atan(.5/_),M=Uh*2*P/g;super({...t,height:g,viewMatrix:w,longitude:r,latitude:n,zoom:o,distanceScales:dW(),fovyRadians:A*2,focalDistance:_,near:l,far:Math.min(2,1/M+1)*_*s}),L(this,"longitude",void 0),L(this,"latitude",void 0),L(this,"resolution",void 0),this.latitude=n,this.longitude=r,this.resolution=p}get projectionMode(){return ls.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const n={targetZ:t.z||0},r=this.unproject([0,this.height/2],n),o=this.unproject([this.width/2,0],n),l=this.unproject([this.width,this.height/2],n),s=this.unproject([this.width/2,this.height],n);return l[0]<this.longitude&&(l[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],l[0],o[0],s[0]),Math.min(r[1],l[1],o[1],s[1]),Math.max(r[0],l[0],o[0],s[0]),Math.max(r[1],l[1],o[1],s[1])]}unproject(t,{topLeft:n=!0,targetZ:r}={}){const[o,l,s]=t,p=n?l:this.height-l,{pixelUnprojectionMatrix:g}=this;let _;if(Number.isFinite(s))_=q0(g,[o,p,s,1]);else{const M=q0(g,[o,p,-1,1]),F=q0(g,[o,p,1,1]),X=((r||0)/Ey+1)*Uh,B=f0(aM([],M,F)),U=f0(M),H=f0(F),st=4*((4*U*H-(B-U-H)**2)/16)/B,pt=Math.sqrt(U-st),_t=Math.sqrt(Math.max(0,X*X-st)),Ot=(pt-_t)/Math.sqrt(B);_=qD([],M,F,Ot)}const[w,P,A]=this.unprojectPosition(_);return Number.isFinite(s)?[w,P,A]:Number.isFinite(r)?[w,P,r]:[w,P]}projectPosition(t){const[n,r,o=0]=t,l=n*Fg,s=r*Fg,p=Math.cos(s),g=(o/Ey+1)*Uh;return[Math.sin(l)*p*g,-Math.cos(l)*p*g,Math.sin(s)*g]}unprojectPosition(t){const[n,r,o]=t,l=lM(t),s=Math.asin(o/l),g=Math.atan2(n,-r)*YP,_=s*YP,w=(l/Uh-1)*Ey;return[g,_,w]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,n){const r=this.unproject(n);return{longitude:t[0]-r[0]+this.longitude,latitude:t[1]-r[1]+this.latitude}}}function q0(e,t){const n=bf([],t,e);return jb(n,n,1/n[3]),n}class yk{constructor(t){L(this,"opts",void 0),t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&Sc(this.opts,t.opts)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:n}=t.constructor,r={updateTriggers:{}};for(const o in n)if(o in this.props){const l=n[o],s=this.props[o];r[o]=s,l&&l.type==="accessor"&&(r.updateTriggers[o]=this.props.updateTriggers[o],typeof s=="function"&&(r[o]=this.getSubLayerAccessor(s)))}return r}initializeState(t,n){}updateState(t,n){}draw(t,n){}finalizeState(t,n){}}L(yk,"defaultProps",{});class vk{constructor(t){L(this,"opts",void 0),L(this,"typedArrayManager",void 0),L(this,"indexStarts",[0]),L(this,"vertexStarts",[0]),L(this,"vertexCount",0),L(this,"instanceCount",0),L(this,"attributes",void 0),L(this,"_attributeDefs",void 0),L(this,"data",void 0),L(this,"getGeometry",void 0),L(this,"geometryBuffer",void 0),L(this,"buffers",void 0),L(this,"positionSize",void 0),L(this,"normalize",void 0);const{attributes:n={}}=t;this.typedArrayManager=gf,this.attributes={},this._attributeDefs=n,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:n,buffers:r={},getGeometry:o,geometryBuffer:l,positionFormat:s,dataChanged:p,normalize:g=!0}=this.opts;if(this.data=n,this.getGeometry=o,this.positionSize=l&&l.size||(s==="XY"?2:3),this.buffers=r,this.normalize=g,l&&(ri(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(l),g||(r.positions=l)),this.geometryBuffer=r.positions,Array.isArray(p))for(const _ of p)this._rebuildGeometry(_);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:n}){this._rebuildGeometry({startRow:t,endRow:n})}getGeometryFromBuffer(t){const n=t.value||t;return ArrayBuffer.isView(n)?lk(n,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,n){const{attributes:r,buffers:o,_attributeDefs:l,typedArrayManager:s}=this;for(const p in l)if(p in o)s.release(r[p]),r[p]=null;else{const g=l[p];g.copy=n,r[p]=s.allocate(r[p],t,g)}}_forEachGeometry(t,n,r){const{data:o,getGeometry:l}=this,{iterable:s,objectInfo:p}=t_(o,n,r);for(const g of s){p.index++;const _=l?l(g,p):null;t(_,p.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:o}=this;const{data:l,geometryBuffer:s}=this,{startRow:p=0,endRow:g=1/0}=t||{},_={};if(t||(n=[0],r=[0]),this.normalize||!s)this._forEachGeometry((P,A)=>{const M=P&&this.normalizeGeometry(P);_[A]=M,r[A+1]=r[A]+(M?this.getGeometrySize(M):0)},p,g),o=r[r.length-1];else if(r=l.startIndices,o=r[l.length]||0,ArrayBuffer.isView(s))o=o||s.length/this.positionSize;else if(s instanceof zn){const P=s.accessor.stride||this.positionSize*4;o=o||s.byteLength/P}else if(s.buffer){const P=s.stride||this.positionSize*4;o=o||s.buffer.byteLength/P}else if(s.value){const P=s.value,A=s.stride/P.BYTES_PER_ELEMENT||this.positionSize;o=o||P.length/A}this._allocate(o,Boolean(t)),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=o;const w={};this._forEachGeometry((P,A)=>{const M=_[A]||P;w.vertexStart=r[A],w.indexStart=n[A];const F=A<r.length-1?r[A+1]:o;w.geometrySize=F-r[A],w.geometryIndex=A,this.updateGeometryAttributes(M,w)},p,g),this.vertexCount=n[n.length-1]}}const gW=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,yW=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,vW=1024,_W=4,KP=()=>{},JP={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function xW(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function bW(e,t,n,r){return n===t.width&&r===t.height?t:(e.canvas.height=r,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,n,r),e.canvas)}function Ed(e){return e&&(e.id||e.url)}function wW(e,t,n,r){const o=e.width,l=e.height,s=new Zi(e.gl,{width:t,height:n,parameters:r});return vU(e,s,{targetY:0,width:o,height:l}),e.delete(),s}function QP(e,t,n){for(let r=0;r<t.length;r++){const{icon:o,xOffset:l}=t[r],s=Ed(o);e[s]={...o,x:l,y:n}}}function TW({icons:e,buffer:t,mapping:n={},xOffset:r=0,yOffset:o=0,rowHeight:l=0,canvasWidth:s}){let p=[];for(let g=0;g<e.length;g++){const _=e[g],w=Ed(_);if(!n[w]){const{height:P,width:A}=_;r+A+t>s&&(QP(n,p,o),r=0,o=l+o+t,l=0,p=[]),p.push({icon:_,xOffset:r}),r=r+A+t,l=Math.max(l,P)}}return p.length>0&&QP(n,p,o),{mapping:n,rowHeight:l,xOffset:r,yOffset:o,canvasWidth:s,canvasHeight:xW(l+o+t)}}function EW(e,t,n){if(!e||!t)return null;n=n||{};const r={},{iterable:o,objectInfo:l}=t_(e);for(const s of o){l.index++;const p=t(s,l),g=Ed(p);if(!p)throw new Error("Icon is missing.");if(!p.url)throw new Error("Icon url is missing.");!r[g]&&(!n[g]||p.url!==n[g].url)&&(r[g]={...p,source:s,sourceIndex:l.index})}return r}class SW{constructor(t,{onUpdate:n=KP,onError:r=KP}){L(this,"gl",void 0),L(this,"onUpdate",void 0),L(this,"onError",void 0),L(this,"_loadOptions",null),L(this,"_texture",null),L(this,"_externalTexture",null),L(this,"_mapping",{}),L(this,"_textureParameters",null),L(this,"_pendingCount",0),L(this,"_autoPacking",!1),L(this,"_xOffset",0),L(this,"_yOffset",0),L(this,"_rowHeight",0),L(this,"_buffer",_W),L(this,"_canvasWidth",vW),L(this,"_canvasHeight",0),L(this,"_canvas",null),this.gl=t,this.onUpdate=n,this.onError=r}finalize(){var t;(t=this._texture)===null||t===void 0||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const n=this._autoPacking?Ed(t):t;return this._mapping[n]||{}}setProps({loadOptions:t,autoPacking:n,iconAtlas:r,iconMapping:o,textureParameters:l}){if(t&&(this._loadOptions=t),n!==void 0&&(this._autoPacking=n),o&&(this._mapping=o),r){var s;(s=this._texture)===null||s===void 0||s.delete(),this._texture=null,this._externalTexture=r}l&&(this._textureParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(t,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(EW(t,n,this._mapping)||{});if(r.length>0){const{mapping:o,xOffset:l,yOffset:s,rowHeight:p,canvasHeight:g}=TW({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=p,this._mapping=o,this._xOffset=l,this._yOffset=s,this._canvasHeight=g,this._texture||(this._texture=new Zi(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||JP})),this._texture.height!==this._canvasHeight&&(this._texture=wW(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||JP)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(t){const n=this._canvas.getContext("2d");for(const r of t)this._pendingCount++,pv(r.url,oL,this._loadOptions).then(o=>{const l=Ed(r),{x:s,y:p,width:g,height:_}=this._mapping[l],w=bW(n,o,g,_);this._texture.setSubImageData({data:w,x:s,y:p,width:g,height:_}),this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const _k=[0,0,0,255],PW={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:_k},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class n_ extends pl{constructor(...t){super(...t),L(this,"state",void 0)}getShaders(){return super.getShaders({vs:gW,fs:yW,modules:[Yd,Kd]})}initializeState(){this.state={iconManager:new SW(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:_k},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:n,oldProps:r,changeFlags:o}=t,l=this.getAttributeManager(),{iconAtlas:s,iconMapping:p,data:g,getIcon:_,textureParameters:w}=n,{iconManager:P}=this.state,A=s||this.internalState.isAsyncPropLoading("iconAtlas");if(P.setProps({loadOptions:n.loadOptions,autoPacking:!A,iconAtlas:s,iconMapping:A?p:null,textureParameters:w}),A?r.iconMapping!==n.iconMapping&&l.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&P.packIcons(g,_),o.extensionsChanged){var M;const{gl:F}=this.context;(M=this.state.model)===null||M===void 0||M.delete(),this.state.model=this._getModel(F),l.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:l,billboard:s,alphaCutoff:p}=this.props,{iconManager:g}=this.state,_=g.getTexture();_&&this.state.model.setUniforms(t).setUniforms({iconsTexture:_,iconsTextureDim:[_.width,_.height],sizeUnits:yc[l],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o,billboard:s,alphaCutoff:p}).draw()}_getModel(t){const n=[-1,-1,-1,1,1,1,1,-1];return new gc(t,{...this.getShaders(),id:this.props.id,geometry:new Zd({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(t):cn.error(t.error.message)()}getInstanceOffset(t){const{width:n,height:r,anchorX:o=n/2,anchorY:l=r/2}=this.state.iconManager.getIconMapping(t);return[n/2-o,r/2-l]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:n,y:r,width:o,height:l}=this.state.iconManager.getIconMapping(t);return[n,r,o,l]}}L(n_,"defaultProps",PW);L(n_,"layerName","IconLayer");const AW=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,CW=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,tA=[0,0,0,255],IW={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:tA},getLineColor:{type:"accessor",value:tA},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Ow extends pl{getShaders(){return super.getShaders({vs:AW,fs:CW,modules:[Yd,Kd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){if(super.updateState(t),t.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:l,stroked:s,filled:p,billboard:g,antialiasing:_,lineWidthUnits:w,lineWidthScale:P,lineWidthMinPixels:A,lineWidthMaxPixels:M}=this.props;this.state.model.setUniforms(t).setUniforms({stroked:s?1:0,filled:p,billboard:g,antialiasing:_,radiusUnits:yc[n],radiusScale:r,radiusMinPixels:o,radiusMaxPixels:l,lineWidthUnits:yc[w],lineWidthScale:P,lineWidthMinPixels:A,lineWidthMaxPixels:M}).draw()}_getModel(t){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new gc(t,{...this.getShaders(),id:this.props.id,geometry:new Zd({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}L(Ow,"defaultProps",IW);L(Ow,"layerName","ScatterplotLayer");const xk={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function bk(e,t,n={}){return MW(e,n)!==t?(LW(e,n),!0):!1}function MW(e,t={}){return Math.sign(xv(e,t))}function xv(e,t={}){const{start:n=0,end:r=e.length}=t,o=t.size||2;let l=0;for(let s=n,p=r-o;s<r;s+=o)l+=(e[s]-e[p])*(e[s+1]+e[p+1]),p=s;return l/2}function LW(e,t){const{start:n=0,end:r=e.length,size:o=2}=t,l=(r-n)/o,s=Math.floor(l/2);for(let p=0;p<s;++p){const g=n+p*o,_=n+(l-1-p)*o;for(let w=0;w<o;++w){const P=e[g+w];e[g+w]=e[_+w],e[_+w]=P}}}function kW(e,t,n=2,r){const o=t&&t.length,l=o?t[0]*n:e.length;let s=wk(e,0,l,n,!0,r&&r[0]);const p=[];if(!s||s.next===s.prev)return p;let g,_,w,P,A,M,F;if(o&&(s=FW(e,t,s,n,r)),e.length>80*n){P=_=e[0],A=w=e[1];for(let X=n;X<l;X+=n)M=e[X],F=e[X+1],M<P&&(P=M),F<A&&(A=F),M>_&&(_=M),F>w&&(w=F);g=Math.max(_-P,w-A),g=g!==0?1/g:0}return Sd(s,p,n,P,A,g),p}function wk(e,t,n,r,o,l){let s,p;if(l===void 0&&(l=xv(e,{start:t,end:n,size:r})),o===l<0)for(s=t;s<n;s+=r)p=eA(s,e[s],e[s+1],p);else for(s=n-r;s>=t;s-=r)p=eA(s,e[s],e[s+1],p);return p&&r_(p,p.next)&&(Ad(p),p=p.next),p}function su(e,t){if(!e)return e;t||(t=e);let n=e,r;do if(r=!1,!n.steiner&&(r_(n,n.next)||dr(n.prev,n,n.next)===0)){if(Ad(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t}function Sd(e,t,n,r,o,l,s){if(!e)return;!s&&l&&jW(e,r,o,l);let p=e,g,_;for(;e.prev!==e.next;){if(g=e.prev,_=e.next,l?RW(e,r,o,l):OW(e)){t.push(g.i/n),t.push(e.i/n),t.push(_.i/n),Ad(e),e=_.next,p=_.next;continue}if(e=_,e===p){s?s===1?(e=zW(su(e),t,n),Sd(e,t,n,r,o,l,2)):s===2&&DW(e,t,n,r,o,l):Sd(su(e),t,n,r,o,l,1);break}}}function OW(e){const t=e.prev,n=e,r=e.next;if(dr(t,n,r)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if(Vh(t.x,t.y,n.x,n.y,r.x,r.y,o.x,o.y)&&dr(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function RW(e,t,n,r){const o=e.prev,l=e,s=e.next;if(dr(o,l,s)>=0)return!1;const p=o.x<l.x?o.x<s.x?o.x:s.x:l.x<s.x?l.x:s.x,g=o.y<l.y?o.y<s.y?o.y:s.y:l.y<s.y?l.y:s.y,_=o.x>l.x?o.x>s.x?o.x:s.x:l.x>s.x?l.x:s.x,w=o.y>l.y?o.y>s.y?o.y:s.y:l.y>s.y?l.y:s.y,P=O1(p,g,t,n,r),A=O1(_,w,t,n,r);let M=e.prevZ,F=e.nextZ;for(;M&&M.z>=P&&F&&F.z<=A;){if(M!==e.prev&&M!==e.next&&Vh(o.x,o.y,l.x,l.y,s.x,s.y,M.x,M.y)&&dr(M.prev,M,M.next)>=0||(M=M.prevZ,F!==e.prev&&F!==e.next&&Vh(o.x,o.y,l.x,l.y,s.x,s.y,F.x,F.y)&&dr(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;M&&M.z>=P;){if(M!==e.prev&&M!==e.next&&Vh(o.x,o.y,l.x,l.y,s.x,s.y,M.x,M.y)&&dr(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;F&&F.z<=A;){if(F!==e.prev&&F!==e.next&&Vh(o.x,o.y,l.x,l.y,s.x,s.y,F.x,F.y)&&dr(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function zW(e,t,n){let r=e;do{const o=r.prev,l=r.next.next;!r_(o,l)&&Tk(o,r,r.next,l)&&Pd(o,l)&&Pd(l,o)&&(t.push(o.i/n),t.push(r.i/n),t.push(l.i/n),Ad(r),Ad(r.next),r=e=l),r=r.next}while(r!==e);return su(r)}function DW(e,t,n,r,o,l){let s=e;do{let p=s.next.next;for(;p!==s.prev;){if(s.i!==p.i&&HW(s,p)){let g=Ek(s,p);s=su(s,s.next),g=su(g,g.next),Sd(s,t,n,r,o,l),Sd(g,t,n,r,o,l);return}p=p.next}s=s.next}while(s!==e)}function FW(e,t,n,r,o){const l=[];let s,p,g,_,w;for(s=0,p=t.length;s<p;s++)g=t[s]*r,_=s<p-1?t[s+1]*r:e.length,w=wk(e,g,_,r,!1,o&&o[s+1]),w===w.next&&(w.steiner=!0),l.push(WW(w));for(l.sort(NW),s=0;s<l.length;s++)BW(l[s],n),n=su(n,n.next);return n}function NW(e,t){return e.x-t.x}function BW(e,t){if(t=UW(e,t),t){const n=Ek(t,e);su(t,t.next),su(n,n.next)}}function UW(e,t){let n=t;const r=e.x,o=e.y;let l=-1/0,s;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const A=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(A<=r&&A>l){if(l=A,A===r){if(o===n.y)return n;if(o===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(r===l)return s;const p=s,g=s.x,_=s.y;let w=1/0,P;n=s;do r>=n.x&&n.x>=g&&r!==n.x&&Vh(o<_?r:l,o,g,_,o<_?l:r,o,n.x,n.y)&&(P=Math.abs(o-n.y)/(r-n.x),Pd(n,e)&&(P<w||P===w&&(n.x>s.x||n.x===s.x&&VW(s,n)))&&(s=n,w=P)),n=n.next;while(n!==p);return s}function VW(e,t){return dr(e.prev,e,t.prev)<0&&dr(t.next,e,e.next)<0}function jW(e,t,n,r){let o=e;do o.z===null&&(o.z=O1(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,GW(o)}function GW(e){let t,n,r=1,o,l,s,p,g,_;do{for(l=e,e=null,_=null,o=0;l;){for(o++,p=l,s=0,n=0;n<r&&(s++,p=p.nextZ,!!p);n++);for(g=r;s>0||g>0&&p;)s!==0&&(g===0||!p||l.z<=p.z)?(t=l,l=l.nextZ,s--):(t=p,p=p.nextZ,g--),_?_.nextZ=t:e=t,t.prevZ=_,_=t;l=p}_.nextZ=null,r*=2}while(o>1);return e}function O1(e,t,n,r,o){return e=32767*(e-n)*o,t=32767*(t-r)*o,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function WW(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function Vh(e,t,n,r,o,l,s,p){return(o-s)*(t-p)-(e-s)*(l-p)>=0&&(e-s)*(r-p)-(n-s)*(t-p)>=0&&(n-s)*(l-p)-(o-s)*(r-p)>=0}function HW(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!qW(e,t)&&(Pd(e,t)&&Pd(t,e)&&ZW(e,t)&&(dr(e.prev,e,t.prev)||dr(e,t.prev,t))||r_(e,t)&&dr(e.prev,e,e.next)>0&&dr(t.prev,t,t.next)>0)}function dr(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function r_(e,t){return e.x===t.x&&e.y===t.y}function Tk(e,t,n,r){const o=Bg(dr(e,t,n)),l=Bg(dr(e,t,r)),s=Bg(dr(n,r,e)),p=Bg(dr(n,r,t));return!!(o!==l&&s!==p||o===0&&Ng(e,n,t)||l===0&&Ng(e,r,t)||s===0&&Ng(n,e,r)||p===0&&Ng(n,t,r))}function Ng(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Bg(e){return e>0?1:e<0?-1:0}function qW(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Tk(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Pd(e,t){return dr(e.prev,e,e.next)<0?dr(e,t,e.next)>=0&&dr(e,e.prev,t)>=0:dr(e,t,e.prev)<0||dr(e,e.next,t)<0}function ZW(e,t){let n=e,r=!1;const o=(e.x+t.x)/2,l=(e.y+t.y)/2;do n.y>l!=n.next.y>l&&n.next.y!==n.y&&o<(n.next.x-n.x)*(l-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function Ek(e,t){const n=new R1(e.i,e.x,e.y),r=new R1(t.i,t.x,t.y),o=e.next,l=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,l.next=r,r.prev=l,r}function eA(e,t,n,r){const o=new R1(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Ad(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R1(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function us(e,t){const n=t.length,r=e.length;if(r>0){let o=!0;for(let l=0;l<n;l++)if(e[r-n+l]!==t[l]){o=!1;break}if(o)return!1}for(let o=0;o<n;o++)e[r+o]=t[o];return!0}function z1(e,t){const n=t.length;for(let r=0;r<n;r++)e[r]=t[r]}function Cd(e,t,n,r,o=[]){const l=r+t*n;for(let s=0;s<n;s++)o[s]=e[l+s];return o}function D1(e,t,n,r,o=[]){let l,s;if(n&8)l=(r[3]-e[1])/(t[1]-e[1]),s=3;else if(n&4)l=(r[1]-e[1])/(t[1]-e[1]),s=1;else if(n&2)l=(r[2]-e[0])/(t[0]-e[0]),s=2;else if(n&1)l=(r[0]-e[0])/(t[0]-e[0]),s=0;else return null;for(let p=0;p<e.length;p++)o[p]=(s&1)===p?r[s]:l*(t[p]-e[p])+e[p];return o}function Sy(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function Sk(e,t){const{size:n=2,broken:r=!1,gridResolution:o=10,gridOffset:l=[0,0],startIndex:s=0,endIndex:p=e.length}=t||{},g=(p-s)/n;let _=[];const w=[_],P=Cd(e,0,n,s);let A,M;const F=Ak(P,o,l,[]),X=[];us(_,P);for(let B=1;B<g;B++){for(A=Cd(e,B,n,s,A),M=Sy(A,F);M;){D1(P,A,M,F,X);const U=Sy(X,F);U&&(D1(P,X,U,F,X),M=U),us(_,X),z1(P,X),$W(F,o,M),r&&_.length>n&&(_=[],w.push(_),us(_,P)),M=Sy(A,F)}us(_,A),z1(P,A)}return r?w:w[0]}const nA=0,XW=1;function Ug(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function Pk(e,t=null,n){if(!e.length)return[];const{size:r=2,gridResolution:o=10,gridOffset:l=[0,0],edgeTypes:s=!1}=n||{},p=[],g=[{pos:e,types:s?new Array(e.length/r).fill(XW):null,holes:t||[]}],_=[[],[]];let w=[];for(;g.length;){const{pos:P,types:A,holes:M}=g.shift();YW(P,r,M[0]||P.length,_),w=Ak(_[0],o,l,w);const F=Sy(_[1],w);if(F){let X=rA(P,A,r,0,M[0]||P.length,w,F);const B={pos:X[0].pos,types:X[0].types,holes:[]},U={pos:X[1].pos,types:X[1].types,holes:[]};g.push(B,U);for(let H=0;H<M.length;H++)X=rA(P,A,r,M[H],M[H+1]||P.length,w,F),X[0]&&(B.holes.push(B.pos.length),B.pos=Ug(B.pos,X[0].pos),s&&(B.types=Ug(B.types,X[0].types))),X[1]&&(U.holes.push(U.pos.length),U.pos=Ug(U.pos,X[1].pos),s&&(U.types=Ug(U.types,X[1].types)))}else{const X={positions:P};s&&(X.edgeTypes=A),M.length&&(X.holeIndices=M),p.push(X)}}return p}function rA(e,t,n,r,o,l,s){const p=(o-r)/n,g=[],_=[],w=[],P=[],A=[];let M,F,X;const B=Cd(e,p-1,n,r);let U=Math.sign(s&8?B[1]-l[3]:B[0]-l[2]),H=t&&t[p-1],tt=0,st=0;for(let pt=0;pt<p;pt++)M=Cd(e,pt,n,r,M),F=Math.sign(s&8?M[1]-l[3]:M[0]-l[2]),X=t&&t[r/n+pt],F&&U&&U!==F&&(D1(B,M,s,l,A),us(g,A)&&w.push(H),us(_,A)&&P.push(H)),F<=0?(us(g,M)&&w.push(X),tt-=F):w.length&&(w[w.length-1]=nA),F>=0?(us(_,M)&&P.push(X),st+=F):P.length&&(P[P.length-1]=nA),z1(B,M),U=F,H=X;return[tt?{pos:g,types:t&&w}:null,st?{pos:_,types:t&&P}:null]}function Ak(e,t,n,r){const o=Math.floor((e[0]-n[0])/t)*t+n[0],l=Math.floor((e[1]-n[1])/t)*t+n[1];return r[0]=o,r[1]=l,r[2]=o+t,r[3]=l+t,r}function $W(e,t,n){n&8?(e[1]+=t,e[3]+=t):n&4?(e[1]-=t,e[3]-=t):n&2?(e[0]+=t,e[2]+=t):n&1&&(e[0]-=t,e[2]-=t)}function YW(e,t,n,r){let o=1/0,l=-1/0,s=1/0,p=-1/0;for(let g=0;g<n;g+=t){const _=e[g],w=e[g+1];o=_<o?_:o,l=_>l?_:l,s=w<s?w:s,p=w>p?w:p}return r[0][0]=o,r[0][1]=s,r[1][0]=l,r[1][1]=p,r}const KW=85.051129;function JW(e,t){const{size:n=2,startIndex:r=0,endIndex:o=e.length,normalize:l=!0}=t||{},s=e.slice(r,o);Ck(s,n,0,o-r);const p=Sk(s,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(l)for(const g of p)Ik(g,n);return p}function QW(e,t=null,n){const{size:r=2,normalize:o=!0,edgeTypes:l=!1}=n||{};t=t||[];const s=[],p=[];let g=0,_=0;for(let P=0;P<=t.length;P++){const A=t[P]||e.length,M=_,F=tH(e,r,g,A);for(let X=F;X<A;X++)s[_++]=e[X];for(let X=g;X<F;X++)s[_++]=e[X];Ck(s,r,M,_),eH(s,r,M,_,n==null?void 0:n.maxLatitude),g=A,p[P]=_}p.pop();const w=Pk(s,p,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(o)for(const P of w)Ik(P.positions,r);return w}function tH(e,t,n,r){let o=-1,l=-1;for(let s=n+1;s<r;s+=t){const p=Math.abs(e[s]);p>o&&(o=p,l=s-1)}return l}function eH(e,t,n,r,o=KW){const l=e[n],s=e[r-t];if(Math.abs(l-s)>180){const p=Cd(e,0,t,n);p[0]+=Math.round((s-l)/360)*360,us(e,p),p[1]=Math.sign(p[1])*o,us(e,p),p[0]=l,us(e,p)}}function Ck(e,t,n,r){let o=e[0],l;for(let s=n;s<r;s+=t){l=e[s];const p=l-o;(p>180||p<-180)&&(l-=Math.round(p/360)*360),e[s]=o=l}}function Ik(e,t){let n;const r=e.length/t;for(let l=0;l<r&&(n=e[l*t],(n+180)%360===0);l++);const o=-Math.round(n/360)*360;if(o!==0)for(let l=0;l<r;l++)e[l*t]+=o}function nH(e,t,n,r){let o;if(Array.isArray(e[0])){const l=e.length*t;o=new Array(l);for(let s=0;s<e.length;s++)for(let p=0;p<t;p++)o[s*t+p]=e[s][p]||0}else o=e;return n?Sk(o,{size:t,gridResolution:n}):r?JW(o,{size:t}):o}const rH=1,iH=2,Z0=4;class oH extends vk{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?nH(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(iA(t)){let r=0;for(const o of t)r+=this.getGeometrySize(o);return r}const n=this.getPathLength(t);return n<2?0:this.isClosed(t)?n<3?0:n+2:n}updateGeometryAttributes(t,n){if(n.geometrySize!==0)if(t&&iA(t))for(const r of t){const o=this.getGeometrySize(r);n.geometrySize=o,this.updateGeometryAttributes(r,n),n.vertexStart+=o}else this._updateSegmentTypes(t,n),this._updatePositions(t,n)}_updateSegmentTypes(t,n){const r=this.attributes.segmentTypes,o=t?this.isClosed(t):!1,{vertexStart:l,geometrySize:s}=n;r.fill(0,l,l+s),o?(r[l]=Z0,r[l+s-2]=Z0):(r[l]+=rH,r[l+s-2]+=iH),r[l+s-1]=Z0}_updatePositions(t,n){const{positions:r}=this.attributes;if(!r||!t)return;const{vertexStart:o,geometrySize:l}=n,s=new Array(3);for(let p=o,g=0;g<l;p++,g++)this.getPointOnPath(t,g,s),r[p*3]=s[0],r[p*3+1]=s[1],r[p*3+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,n,r=[]){const{positionSize:o}=this;n*o>=t.length&&(n+=1-t.length/o);const l=n*o;return r[0]=t[l],r[1]=t[l+1],r[2]=o===3&&t[l+2]||0,r}isClosed(t){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,r=t.length-n;return t[0]===t[r]&&t[1]===t[r+1]&&(n===2||t[2]===t[r+2])}}function iA(e){return Array.isArray(e[0])}const sH=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aH=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Mk=[0,0,0,255],lH={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:Mk},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},X0={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class i_ extends pl{constructor(...t){super(...t),L(this,"state",void 0)}getShaders(){return super.getShaders({vs:sH,fs:aH,modules:[Yd,Kd]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:X0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:X0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:X0,defaultValue:Mk},instancePickingColors:{size:3,type:5121,accessor:(r,{index:o,target:l})=>this.encodePickingColor(r&&r.__source?r.__source.index:o,l)}}),this.setState({pathTesselator:new oH({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:n,changeFlags:r}=t,o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:p}=this.state,g=n.data.attributes||{};p.updateGeometry({data:n.data,geometryBuffer:g.getPath,buffers:g,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:p.instanceCount,startIndices:p.vertexStarts}),r.dataChanged||o.invalidateAll()}if(r.extensionsChanged){var s;const{gl:p}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(p),o.invalidateAll()}}getPickingInfo(t){const n=super.getPickingInfo(t),{index:r}=n,{data:o}=this.props;return o[0]&&o[0].__source&&(n.object=o.find(l=>l.__source.index===r)),n}disablePickingIndex(t){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===t&&this._disablePickingIndex(r);else this._disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:n,capRounded:r,billboard:o,miterLimit:l,widthUnits:s,widthScale:p,widthMinPixels:g,widthMaxPixels:_}=this.props;this.state.model.setUniforms(t).setUniforms({jointType:Number(n),capType:Number(r),billboard:o,widthUnits:yc[s],widthScale:p,miterLimit:l,widthMinPixels:g,widthMaxPixels:_}).draw()}_getModel(t){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new gc(t,{...this.getShaders(),id:this.props.id,geometry:new Zd({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:n}=this.state;t.startIndices=n.vertexStarts,t.value=n.get("positions")}calculateSegmentTypes(t){const{pathTesselator:n}=this.state;t.startIndices=n.vertexStarts,t.value=n.get("segmentTypes")}}L(i_,"defaultProps",lH);L(i_,"layerName","PathLayer");var bv={},uH={get exports(){return bv},set exports(e){bv=e}};uH.exports=o_;bv.default=o_;function o_(e,t,n){n=n||2;var r=t&&t.length,o=r?t[0]*n:e.length,l=Lk(e,0,o,n,!0),s=[];if(!l||l.next===l.prev)return s;var p,g,_,w,P,A,M;if(r&&(l=dH(e,t,l,n)),e.length>80*n){p=_=e[0],g=w=e[1];for(var F=n;F<o;F+=n)P=e[F],A=e[F+1],P<p&&(p=P),A<g&&(g=A),P>_&&(_=P),A>w&&(w=A);M=Math.max(_-p,w-g),M=M!==0?32767/M:0}return Id(l,s,n,p,g,M,0),s}function Lk(e,t,n,r,o){var l,s;if(o===B1(e,t,n,r)>0)for(l=t;l<n;l+=r)s=oA(l,e[l],e[l+1],s);else for(l=n-r;l>=t;l-=r)s=oA(l,e[l],e[l+1],s);return s&&s_(s,s.next)&&(Ld(s),s=s.next),s}function xc(e,t){if(!e)return e;t||(t=e);var n=e,r;do if(r=!1,!n.steiner&&(s_(n,n.next)||mr(n.prev,n,n.next)===0)){if(Ld(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t}function Id(e,t,n,r,o,l,s){if(e){!s&&l&&_H(e,r,o,l);for(var p=e,g,_;e.prev!==e.next;){if(g=e.prev,_=e.next,l?hH(e,r,o,l):cH(e)){t.push(g.i/n|0),t.push(e.i/n|0),t.push(_.i/n|0),Ld(e),e=_.next,p=_.next;continue}if(e=_,e===p){s?s===1?(e=fH(xc(e),t,n),Id(e,t,n,r,o,l,2)):s===2&&pH(e,t,n,r,o,l):Id(xc(e),t,n,r,o,l,1);break}}}}function cH(e){var t=e.prev,n=e,r=e.next;if(mr(t,n,r)>=0)return!1;for(var o=t.x,l=n.x,s=r.x,p=t.y,g=n.y,_=r.y,w=o<l?o<s?o:s:l<s?l:s,P=p<g?p<_?p:_:g<_?g:_,A=o>l?o>s?o:s:l>s?l:s,M=p>g?p>_?p:_:g>_?g:_,F=r.next;F!==t;){if(F.x>=w&&F.x<=A&&F.y>=P&&F.y<=M&&jh(o,p,l,g,s,_,F.x,F.y)&&mr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function hH(e,t,n,r){var o=e.prev,l=e,s=e.next;if(mr(o,l,s)>=0)return!1;for(var p=o.x,g=l.x,_=s.x,w=o.y,P=l.y,A=s.y,M=p<g?p<_?p:_:g<_?g:_,F=w<P?w<A?w:A:P<A?P:A,X=p>g?p>_?p:_:g>_?g:_,B=w>P?w>A?w:A:P>A?P:A,U=F1(M,F,t,n,r),H=F1(X,B,t,n,r),tt=e.prevZ,st=e.nextZ;tt&&tt.z>=U&&st&&st.z<=H;){if(tt.x>=M&&tt.x<=X&&tt.y>=F&&tt.y<=B&&tt!==o&&tt!==s&&jh(p,w,g,P,_,A,tt.x,tt.y)&&mr(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,st.x>=M&&st.x<=X&&st.y>=F&&st.y<=B&&st!==o&&st!==s&&jh(p,w,g,P,_,A,st.x,st.y)&&mr(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;tt&&tt.z>=U;){if(tt.x>=M&&tt.x<=X&&tt.y>=F&&tt.y<=B&&tt!==o&&tt!==s&&jh(p,w,g,P,_,A,tt.x,tt.y)&&mr(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;st&&st.z<=H;){if(st.x>=M&&st.x<=X&&st.y>=F&&st.y<=B&&st!==o&&st!==s&&jh(p,w,g,P,_,A,st.x,st.y)&&mr(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function fH(e,t,n){var r=e;do{var o=r.prev,l=r.next.next;!s_(o,l)&&kk(o,r,r.next,l)&&Md(o,l)&&Md(l,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(l.i/n|0),Ld(r),Ld(r.next),r=e=l),r=r.next}while(r!==e);return xc(r)}function pH(e,t,n,r,o,l){var s=e;do{for(var p=s.next.next;p!==s.prev;){if(s.i!==p.i&&wH(s,p)){var g=Ok(s,p);s=xc(s,s.next),g=xc(g,g.next),Id(s,t,n,r,o,l,0),Id(g,t,n,r,o,l,0);return}p=p.next}s=s.next}while(s!==e)}function dH(e,t,n,r){var o=[],l,s,p,g,_;for(l=0,s=t.length;l<s;l++)p=t[l]*r,g=l<s-1?t[l+1]*r:e.length,_=Lk(e,p,g,r,!1),_===_.next&&(_.steiner=!0),o.push(bH(_));for(o.sort(mH),l=0;l<o.length;l++)n=gH(o[l],n);return n}function mH(e,t){return e.x-t.x}function gH(e,t){var n=yH(e,t);if(!n)return t;var r=Ok(n,e);return xc(r,r.next),xc(n,n.next)}function yH(e,t){var n=t,r=e.x,o=e.y,l=-1/0,s;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var p=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(p<=r&&p>l&&(l=p,s=n.x<n.next.x?n:n.next,p===r))return s}n=n.next}while(n!==t);if(!s)return null;var g=s,_=s.x,w=s.y,P=1/0,A;n=s;do r>=n.x&&n.x>=_&&r!==n.x&&jh(o<w?r:l,o,_,w,o<w?l:r,o,n.x,n.y)&&(A=Math.abs(o-n.y)/(r-n.x),Md(n,e)&&(A<P||A===P&&(n.x>s.x||n.x===s.x&&vH(s,n)))&&(s=n,P=A)),n=n.next;while(n!==g);return s}function vH(e,t){return mr(e.prev,e,t.prev)<0&&mr(t.next,e,e.next)<0}function _H(e,t,n,r){var o=e;do o.z===0&&(o.z=F1(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,xH(o)}function xH(e){var t,n,r,o,l,s,p,g,_=1;do{for(n=e,e=null,l=null,s=0;n;){for(s++,r=n,p=0,t=0;t<_&&(p++,r=r.nextZ,!!r);t++);for(g=_;p>0||g>0&&r;)p!==0&&(g===0||!r||n.z<=r.z)?(o=n,n=n.nextZ,p--):(o=r,r=r.nextZ,g--),l?l.nextZ=o:e=o,o.prevZ=l,l=o;n=r}l.nextZ=null,_*=2}while(s>1);return e}function F1(e,t,n,r,o){return e=(e-n)*o|0,t=(t-r)*o|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function bH(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function jh(e,t,n,r,o,l,s,p){return(o-s)*(t-p)>=(e-s)*(l-p)&&(e-s)*(r-p)>=(n-s)*(t-p)&&(n-s)*(l-p)>=(o-s)*(r-p)}function wH(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!TH(e,t)&&(Md(e,t)&&Md(t,e)&&EH(e,t)&&(mr(e.prev,e,t.prev)||mr(e,t.prev,t))||s_(e,t)&&mr(e.prev,e,e.next)>0&&mr(t.prev,t,t.next)>0)}function mr(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function s_(e,t){return e.x===t.x&&e.y===t.y}function kk(e,t,n,r){var o=jg(mr(e,t,n)),l=jg(mr(e,t,r)),s=jg(mr(n,r,e)),p=jg(mr(n,r,t));return!!(o!==l&&s!==p||o===0&&Vg(e,n,t)||l===0&&Vg(e,r,t)||s===0&&Vg(n,e,r)||p===0&&Vg(n,t,r))}function Vg(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function jg(e){return e>0?1:e<0?-1:0}function TH(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&kk(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Md(e,t){return mr(e.prev,e,e.next)<0?mr(e,t,e.next)>=0&&mr(e,e.prev,t)>=0:mr(e,t,e.prev)<0||mr(e,e.next,t)<0}function EH(e,t){var n=e,r=!1,o=(e.x+t.x)/2,l=(e.y+t.y)/2;do n.y>l!=n.next.y>l&&n.next.y!==n.y&&o<(n.next.x-n.x)*(l-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function Ok(e,t){var n=new N1(e.i,e.x,e.y),r=new N1(t.i,t.x,t.y),o=e.next,l=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,l.next=r,r.prev=l,r}function oA(e,t,n,r){var o=new N1(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Ld(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function N1(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}o_.deviation=function(e,t,n,r){var o=t&&t.length,l=o?t[0]*n:e.length,s=Math.abs(B1(e,0,l,n));if(o)for(var p=0,g=t.length;p<g;p++){var _=t[p]*n,w=p<g-1?t[p+1]*n:e.length;s-=Math.abs(B1(e,_,w,n))}var P=0;for(p=0;p<r.length;p+=3){var A=r[p]*n,M=r[p+1]*n,F=r[p+2]*n;P+=Math.abs((e[A]-e[F])*(e[M+1]-e[A+1])-(e[A]-e[M])*(e[F+1]-e[A+1]))}return s===0&&P===0?0:Math.abs((P-s)/s)};function B1(e,t,n,r){for(var o=0,l=t,s=n-r;l<n;l+=r)o+=(e[s]-e[l])*(e[l+1]+e[s+1]),s=l;return o}o_.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var l=0;l<e[o].length;l++)for(var s=0;s<t;s++)n.vertices.push(e[o][l][s]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n};const Gg=xk.CLOCKWISE,sA=xk.COUNTER_CLOCKWISE,ql={isClosed:!0};function SH(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Vp(e){return"positions"in e?e.positions:e}function Py(e){return"holeIndices"in e?e.holeIndices:null}function PH(e){return Array.isArray(e[0])}function AH(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function CH(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function IH(e,t,n,r){for(let o=0;o<t;o++)if(e[n+o]!==e[r-t+o])return!1;return!0}function aA(e,t,n,r,o){let l=t;const s=n.length;for(let p=0;p<s;p++)for(let g=0;g<r;g++)e[l++]=n[p][g]||0;if(!CH(n))for(let p=0;p<r;p++)e[l++]=n[0][p]||0;return ql.start=t,ql.end=l,ql.size=r,bk(e,o,ql),l}function lA(e,t,n,r,o=0,l,s){l=l||n.length;const p=l-o;if(p<=0)return t;let g=t;for(let _=0;_<p;_++)e[g++]=n[o+_];if(!IH(n,r,o,l))for(let _=0;_<r;_++)e[g++]=n[o+_];return ql.start=t,ql.end=g,ql.size=r,bk(e,s,ql),g}function MH(e,t){SH(e);const n=[],r=[];if("positions"in e){const{positions:o,holeIndices:l}=e;if(l){let s=0;for(let p=0;p<=l.length;p++)s=lA(n,s,o,t,l[p-1],l[p],p===0?Gg:sA),r.push(s);return r.pop(),{positions:n,holeIndices:r}}e=o}if(!PH(e))return lA(n,0,e,t,0,n.length,Gg),n;if(!AH(e)){let o=0;for(const[l,s]of e.entries())o=aA(n,o,s,t,l===0?Gg:sA),r.push(o);return r.pop(),{positions:n,holeIndices:r}}return aA(n,0,e,t,Gg),n}function LH(e,t,n){let r=Py(e);r&&(r=r.map(l=>l/t));let o=Vp(e);if(n){const l=o.length;o=o.slice();const s=[];for(let p=0;p<l;p+=t){s[0]=o[p],s[1]=o[p+1];const g=n(s);o[p]=g[0],o[p+1]=g[1]}}return bv(o,r,t)}class kH extends vk{constructor(t){const{fp64:n,IndexType:r=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(t){const{attributes:n}=this;return t==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[t]}updateGeometry(t){super.updateGeometry(t);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const n=MH(t,this.positionSize);return this.opts.resolution?Pk(Vp(n),Py(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?QW(Vp(n),Py(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return t}getGeometrySize(t){if(uA(t)){let n=0;for(const r of t)n+=this.getGeometrySize(r);return n}return Vp(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,n){if(t&&uA(t))for(const r of t){const o=this.getGeometrySize(r);n.geometrySize=o,this.updateGeometryAttributes(r,n),n.vertexStart+=o,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(t,n),this._updatePositions(t,n),this._updateVertexValid(t,n)}_updateIndices(t,{geometryIndex:n,vertexStart:r,indexStart:o}){const{attributes:l,indexStarts:s,typedArrayManager:p}=this;let g=l.indices;if(!g||!t)return;let _=o;const w=LH(t,this.positionSize,this.opts.preproject);g=p.allocate(g,o+w.length,{copy:!0});for(let P=0;P<w.length;P++)g[_++]=w[P]+r;s[n+1]=o+w.length,l.indices=g}_updatePositions(t,{vertexStart:n,geometrySize:r}){const{attributes:{positions:o},positionSize:l}=this;if(!o||!t)return;const s=Vp(t);for(let p=n,g=0;g<r;p++,g++){const _=s[g*l],w=s[g*l+1],P=l>2?s[g*l+2]:0;o[p*3]=_,o[p*3+1]=w,o[p*3+2]=P}}_updateVertexValid(t,{vertexStart:n,geometrySize:r}){const{positionSize:o}=this,l=this.attributes.vertexValid,s=t&&Py(t);if(t&&t.edgeTypes?l.set(t.edgeTypes,n):l.fill(1,n,n+r),s)for(let p=0;p<s.length;p++)l[n+s[p]/o-1]=0;l[n+r-1]=0}}function uA(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const Rk=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OH=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Rk,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),RH=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Rk,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),zH=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,wv=[0,0,0,255],DH={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:wv},getLineColor:{type:"accessor",value:wv},material:!0},Wg={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Rw extends pl{constructor(...t){super(...t),L(this,"state",void 0)}getShaders(t){return super.getShaders({vs:t==="top"?OH:RH,fs:zH,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Yd,F8,Kd]})}get wrapLongitude(){return!1}initializeState(){const{gl:t,viewport:n}=this.context;let{coordinateSystem:r}=this.props;n.isGeospatial&&r===bn.DEFAULT&&(r=bn.LNGLAT),this.setState({numInstances:0,polygonTesselator:new kH({preproject:r===bn.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!t||xw(t,tr.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const o=this.getAttributeManager(),l=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Wg,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:Wg,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Wg,accessor:"getFillColor",defaultValue:wv,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Wg,accessor:"getLineColor",defaultValue:wv,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(s,{index:p,target:g})=>this.encodePickingColor(s&&s.__source?s.__source.index:p,g),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(t){const n=super.getPickingInfo(t),{index:r}=n,{data:o}=this.props;return o[0]&&o[0].__source&&(n.object=o.find(l=>l.__source.index===r)),n}disablePickingIndex(t){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===t&&this._disablePickingIndex(r);else this._disablePickingIndex(t)}draw({uniforms:t}){const{extruded:n,filled:r,wireframe:o,elevationScale:l}=this.props,{topModel:s,sideModel:p,polygonTesselator:g}=this.state,_={...t,extruded:Boolean(n),elevationScale:l};p&&(p.setInstanceCount(g.instanceCount-1),p.setUniforms(_),o&&(p.setDrawMode(3),p.setUniforms({isWireframe:!0}).draw()),r&&(p.setDrawMode(6),p.setUniforms({isWireframe:!1}).draw())),s&&(s.setVertexCount(g.vertexCount),s.setUniforms(_).draw())}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:n,oldProps:r,changeFlags:o}=t,l=this.getAttributeManager();if(o.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var p;(p=this.state.models)===null||p===void 0||p.forEach(g=>g.delete()),this.setState(this._getModels(this.context.gl)),l.invalidateAll()}}updateGeometry({props:t,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:l}=this.state,s=t.data.attributes||{};l.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(t){const{id:n,filled:r,extruded:o}=this.props;let l,s;if(r){const p=this.getShaders("top");p.defines.NON_INSTANCED_MODEL=1,l=new gc(t,{...p,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return o&&(s=new gc(t,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Zd({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),s.userData.excludeAttributes={indices:!0}),{models:[s,l].filter(Boolean),topModel:l,sideModel:s}}calculateIndices(t){const{polygonTesselator:n}=this.state;t.startIndices=n.indexStarts,t.value=n.get("indices")}calculatePositions(t){const{polygonTesselator:n}=this.state;t.startIndices=n.vertexStarts,t.value=n.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}L(Rw,"defaultProps",DH);L(Rw,"layerName","SolidPolygonLayer");function FH({data:e,getIndex:t,dataRange:n,replace:r}){const{startRow:o=0,endRow:l=1/0}=n,s=e.length;let p=s,g=s;for(let A=0;A<s;A++){const M=t(e[A]);if(p>A&&M>=o&&(p=A),M>=l){g=A;break}}let _=p;const P=g-p!==r.length?e.slice(g):void 0;for(let A=0;A<r.length;A++)e[_++]=r[A];if(P){for(let A=0;A<P.length;A++)e[_++]=P[A];e.length=_}return{startRow:p,endRow:p+r.length}}function NH(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,r=e.featureIds.value[n];return n!==-1?BH(e,r,n):null}function BH(e,t,n){const r={properties:{...e.properties[t]}};for(const o in e.numericProps)r.properties[o]=e.numericProps[o].value[n];return r}function UH(e,t){const n={points:null,lines:null,polygons:null};for(const r in n){const o=e[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(o.length*3);const l=[];for(let s=0;s<o.length;s++)t(o[s],l),n[r][s*3+0]=l[0],n[r][s*3+1]=l[1],n[r][s*3+2]=l[2]}return n}const VH=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,cA=192/256,hA=[],jH={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class zw extends n_{constructor(...t){super(...t),L(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:VH}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:o})=>this.encodePickingColor(r,o)}})}updateState(t){super.updateState(t);const{props:n,oldProps:r}=t;let{outlineColor:o}=n;o!==r.outlineColor&&(o=o.map(l=>l/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!n.sdf&&n.outlineWidth&&cn.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(t){const{sdf:n,smoothing:r,outlineWidth:o}=this.props,{outlineColor:l}=this.state;t.uniforms={...t.uniforms,buffer:cA,outlineBuffer:o?Math.max(r,cA*(1-o)):-1,gamma:r,sdf:Boolean(n),outlineColor:l},super.draw(t)}getInstanceOffset(t){return t?Array.from(t).flatMap(n=>super.getInstanceOffset(n)):hA}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(n=>super.getInstanceIconFrame(n)):hA}}L(zw,"defaultProps",jH);L(zw,"layerName","MultiIconLayer");var Tv={},GH={get exports(){return Tv},set exports(e){Tv=e}};GH.exports=Qd;Tv.default=Qd;var tf=1e20;function Qd(e,t,n,r,o,l){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=r||.25,this.fontFamily=o||"sans-serif",this.fontWeight=l||"normal",this.radius=n||8;var s=this.size=this.fontSize+this.buffer*2,p=s+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(s/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function WH(e,t,n,r,o,l,s){l.fill(tf,0,t*n),s.fill(0,0,t*n);for(var p=(t-r)/2,g=0;g<o;g++)for(var _=0;_<r;_++){var w=(g+p)*t+_+p,P=e.data[4*(g*r+_)+3]/255;if(P===1)l[w]=0,s[w]=tf;else if(P===0)l[w]=tf,s[w]=0;else{var A=Math.max(0,.5-P),M=Math.max(0,P-.5);l[w]=A*A,s[w]=M*M}}}function HH(e,t,n,r,o,l,s){for(var p=0;p<t*n;p++){var g=Math.sqrt(r[p])-Math.sqrt(o[p]);e[p]=Math.round(255-255*(g/l+s))}}Qd.prototype._draw=function(e,t){var n=this.ctx.measureText(e),r=n.width,o=2*this.buffer,l,s,p,g,_,w,P,A;t&&this.useMetrics?(_=Math.floor(n.actualBoundingBoxAscent),A=this.buffer+Math.ceil(n.actualBoundingBoxAscent),w=this.buffer,P=this.buffer,s=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),g=Math.min(this.size-w,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),l=s+o,p=g+o,this.ctx.textBaseline="alphabetic"):(l=s=this.size,p=g=this.size,_=19*this.fontSize/24,w=P=0,A=this.middle,this.ctx.textBaseline="middle");var M;s&&g&&(this.ctx.clearRect(P,w,s,g),this.ctx.fillText(e,this.buffer,A),M=this.ctx.getImageData(P,w,s,g));var F=new Uint8ClampedArray(l*p);return WH(M,l,p,s,g,this.gridOuter,this.gridInner),fA(this.gridOuter,l,p,this.f,this.v,this.z),fA(this.gridInner,l,p,this.f,this.v,this.z),HH(F,l,p,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:F,metrics:{width:s,height:g,sdfWidth:l,sdfHeight:p,top:_,left:0,advance:r}}};Qd.prototype.draw=function(e){return this._draw(e,!1).data};Qd.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function fA(e,t,n,r,o,l){for(var s=0;s<t;s++)pA(e,s,t,n,r,o,l);for(var p=0;p<n;p++)pA(e,p*t,1,t,r,o,l)}function pA(e,t,n,r,o,l,s){var p,g,_,w;for(l[0]=0,s[0]=-tf,s[1]=tf,p=0;p<r;p++)o[p]=e[t+p*n];for(p=1,g=0,_=0;p<r;p++){do w=l[g],_=(o[p]-o[w]+p*p-w*w)/(p-w)/2;while(_<=s[g]&&--g>-1);g++,l[g]=p,s[g]=_,s[g+1]=tf}for(p=0,g=0;p<r;p++){for(;s[g+1]<p;)g++;w=l[g],e[t+p*n]=o[w]+(p-w)*(p-w)}}const qH=32,ZH=[];function XH(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function $H({characterSet:e,getFontWidth:t,fontHeight:n,buffer:r,maxCanvasWidth:o,mapping:l={},xOffset:s=0,yOffset:p=0}){let g=0,_=s;for(const P of e)if(!l[P]){const A=t(P);_+A+r*2>o&&(_=0,g++),l[P]={x:_+r,y:p+g*(n+r*2)+r,width:A,height:n},_+=A+r*2}const w=n+r*2;return{mapping:l,xOffset:_,yOffset:p+g*w,canvasHeight:XH(p+(g+1)*w)}}function zk(e,t,n,r){let o=0;for(let s=t;s<n;s++){var l;const p=e[s];o+=((l=r[p])===null||l===void 0?void 0:l.width)||0}return o}function Dk(e,t,n,r,o,l){let s=t,p=0;for(let g=t;g<n;g++){const _=zk(e,g,g+1,o);p+_>r&&(s<g&&l.push(g),s=g,p=0),p+=_}return p}function YH(e,t,n,r,o,l){let s=t,p=t,g=t,_=0;for(let w=t;w<n;w++)if((e[w]===" "||e[w+1]===" "||w+1===n)&&(g=w+1),g>p){let P=zk(e,p,g,o);_+P>r&&(s<p&&(l.push(p),s=p,_=0),P>r&&(P=Dk(e,p,g,r,o,l),s=l[l.length-1])),p=g,_+=P}return _}function KH(e,t,n,r,o=0,l){l===void 0&&(l=e.length);const s=[];return t==="break-all"?Dk(e,o,l,n,r,s):YH(e,o,l,n,r,s),s}function JH(e,t,n,r,o,l){let s=0,p=0;for(let g=t;g<n;g++){const _=e[g],w=r[_];w?(p||(p=w.height),o[g]=s+w.width/2,s+=w.width):(cn.warn("Missing character: ".concat(_," (").concat(_.codePointAt(0),")"))(),o[g]=s,s+=qH)}l[0]=s,l[1]=p}function dA(e,t,n,r,o){const l=Array.from(e),s=l.length,p=new Array(s),g=new Array(s),_=new Array(s),w=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,P=[0,0],A=[0,0];let M=0,F=0,X=0;for(let B=0;B<=s;B++){const U=l[B];if((U===`
`||B===s)&&(X=B),X>F){const H=w?KH(l,n,r,o,F,X):ZH;for(let tt=0;tt<=H.length;tt++){const st=tt===0?F:H[tt-1],pt=tt<H.length?H[tt]:X;JH(l,st,pt,o,p,A);for(let _t=st;_t<pt;_t++)g[_t]=M+A[1]/2,_[_t]=A[0];M=M+A[1]*t,P[0]=Math.max(P[0],A[0])}F=X}U===`
`&&(p[F]=0,g[F]=0,_[F]=0,F++)}return P[1]=M,{x:p,y:g,rowWidth:_,size:P}}function QH({value:e,length:t,stride:n,offset:r,startIndices:o,characterSet:l}){const s=e.BYTES_PER_ELEMENT,p=n?n/s:1,g=r?r/s:0,_=o[t]||Math.ceil((e.length-g)/p),w=l&&new Set,P=new Array(t);let A=e;if(p>1||g>0){const M=e.constructor;A=new M(_);for(let F=0;F<_;F++)A[F]=e[F*p+g]}for(let M=0;M<t;M++){const F=o[M],X=o[M+1]||_,B=A.subarray(F,X);P[M]=String.fromCodePoint.apply(null,B),w&&B.forEach(w.add,w)}if(w)for(const M of w)l.add(String.fromCodePoint(M));return{texts:P,characterCount:_}}class Fk{constructor(t=5){L(this,"limit",void 0),L(this,"_cache",{}),L(this,"_order",[]),this.limit=t}get(t){const n=this._cache[t];return n&&(this._deleteOrder(t),this._appendOrder(t)),n}set(t,n){this._cache[t]?(this.delete(t),this._cache[t]=n,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=n,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const n=this._order.indexOf(t);n>=0&&this._order.splice(n,1)}_appendOrder(t){this._order.push(t)}}function tq(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}const id={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:tq(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},mA=1024,eq=.9,gA=1.2,Nk=3;let Ev=new Fk(Nk);function nq(e,t){let n;typeof t=="string"?n=new Set(Array.from(t)):n=new Set(t);const r=Ev.get(e);if(!r)return n;for(const o in r.mapping)n.has(o)&&n.delete(o);return n}function rq(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function yA(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function iq(e){cn.assert(Number.isFinite(e)&&e>=Nk,"Invalid cache limit"),Ev=new Fk(e)}class oq{constructor(){L(this,"props",{...id}),L(this,"_key",void 0),L(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return gA}setProps(t={}){Object.assign(this.props,t);const n=this._key;this._key=this._getKey();const r=nq(this._key,this.props.characterSet),o=Ev.get(this._key);if(o&&r.size===0){this._key!==n&&(this._atlas=o);return}const l=this._generateFontAtlas(this._key,r,o);this._atlas=l,Ev.set(this._key,l)}_generateFontAtlas(t,n,r){const{fontFamily:o,fontWeight:l,fontSize:s,buffer:p,sdf:g,radius:_,cutoff:w}=this.props;let P=r&&r.data;P||(P=document.createElement("canvas"),P.width=mA);const A=P.getContext("2d");yA(A,o,s,l);const{mapping:M,canvasHeight:F,xOffset:X,yOffset:B}=$H({getFontWidth:U=>A.measureText(U).width,fontHeight:s*gA,buffer:p,characterSet:n,maxCanvasWidth:mA,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(P.height!==F){const U=A.getImageData(0,0,P.width,P.height);P.height=F,A.putImageData(U,0,0)}if(yA(A,o,s,l),g){const U=new Tv(s,p,_,w,o,l),H=A.getImageData(0,0,U.size,U.size);for(const tt of n)rq(U.draw(tt),H),A.putImageData(H,M[tt].x-p,M[tt].y+p)}else for(const U of n)A.fillText(U,M[U].x,M[U].y+s*eq);return{xOffset:X,yOffset:B,mapping:M,data:P,width:P.width,height:P.height}}_getKey(){const{fontFamily:t,fontWeight:n,fontSize:r,buffer:o,sdf:l,radius:s,cutoff:p}=this.props;return l?"".concat(t," ").concat(n," ").concat(r," ").concat(o," ").concat(s," ").concat(p):"".concat(t," ").concat(n," ").concat(r," ").concat(o)}}const sq=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,aq=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lq={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Dw extends pl{constructor(...t){super(...t),L(this,"state",void 0)}getShaders(){return super.getShaders({vs:sq,fs:aq,modules:[Yd,Kd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:n}=t;if(n.extensionsChanged){var r;const{gl:o}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{billboard:n,sizeScale:r,sizeUnits:o,sizeMinPixels:l,sizeMaxPixels:s,getLineWidth:p}=this.props;let{padding:g}=this.props;g.length<4&&(g=[g[0],g[1],g[0],g[1]]),this.state.model.setUniforms(t).setUniforms({billboard:n,stroked:Boolean(p),padding:g,sizeUnits:yc[o],sizeScale:r,sizeMinPixels:l,sizeMaxPixels:s}).draw()}_getModel(t){const n=[0,0,1,0,1,1,0,1];return new gc(t,{...this.getShaders(),id:this.props.id,geometry:new Zd({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}L(Dw,"defaultProps",lq);L(Dw,"layerName","TextBackgroundLayer");const vA={start:1,middle:0,end:-1},_A={top:1,center:0,bottom:-1},$0=[0,0,0,255],uq=1,cq={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:$0},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:id.characterSet},fontFamily:id.fontFamily,fontWeight:id.fontWeight,lineHeight:uq,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:$0},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:$0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Fw extends e_{constructor(...t){super(...t),L(this,"state",void 0),L(this,"getBoundingRect",(n,r)=>{const o=this.state.fontAtlasManager.mapping,l=this.state.getText,{wordBreak:s,maxWidth:p,lineHeight:g,getTextAnchor:_,getAlignmentBaseline:w}=this.props,P=l(n,r)||"",{size:[A,M]}=dA(P,g,s,p,o),F=vA[typeof _=="function"?_(n,r):_],X=_A[typeof w=="function"?w(n,r):w];return[(F-1)*A/2,(X-1)*M/2,A,M]}),L(this,"getIconOffsets",(n,r)=>{const o=this.state.fontAtlasManager.mapping,l=this.state.getText,{wordBreak:s,maxWidth:p,lineHeight:g,getTextAnchor:_,getAlignmentBaseline:w}=this.props,P=l(n,r)||"",{x:A,y:M,rowWidth:F,size:[X,B]}=dA(P,g,s,p,o),U=vA[typeof _=="function"?_(n,r):_],H=_A[typeof w=="function"?w(n,r):w],tt=A.length,st=new Array(tt*2);let pt=0;for(let _t=0;_t<tt;_t++){const Ot=(1-U)*(X-F[_t])/2;st[pt++]=(U-1)*X/2+Ot+A[_t],st[pt++]=(H-1)*B/2+M[_t]}return st})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new oq}}updateState(t){const{props:n,oldProps:r,changeFlags:o}=t;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:o,characterSet:l}=this.state,s={...t,characterSet:l,fontFamily:n,fontWeight:r};if(!o.mapping)return o.setProps(s),!0;for(const p in s)if(s[p]!==o.props[p])return o.setProps(s),!0;return!1}_updateText(){var t;const{data:n,characterSet:r}=this.props,o=(t=n.attributes)===null||t===void 0?void 0:t.getText;let{getText:l}=this.props,s=n.startIndices,p;const g=r==="auto"&&new Set;if(o&&s){const{texts:_,characterCount:w}=QH({...ArrayBuffer.isView(o)?{value:o}:o,length:n.length,startIndices:s,characterSet:g});p=w,l=(P,{index:A})=>_[A]}else{const{iterable:_,objectInfo:w}=t_(n);s=[0],p=0;for(const P of _){w.index++;const A=Array.from(l(P,w)||"");g&&A.forEach(g.add,g),p+=A.length,s.push(p)}}this.setState({getText:l,startIndices:s,numInstances:p,characterSet:g||r})}renderLayers(){const{startIndices:t,numInstances:n,getText:r,fontAtlasManager:{scale:o,texture:l,mapping:s},styleVersion:p}=this.state,{data:g,_dataDiff:_,getPosition:w,getColor:P,getSize:A,getAngle:M,getPixelOffset:F,getBackgroundColor:X,getBorderColor:B,getBorderWidth:U,backgroundPadding:H,background:tt,billboard:st,fontSettings:pt,outlineWidth:_t,outlineColor:Ot,sizeScale:Dt,sizeUnits:kt,sizeMinPixels:qt,sizeMaxPixels:ee,transitions:_e,updateTriggers:ae}=this.props,he=this.getSubLayerClass("characters",zw),sn=this.getSubLayerClass("background",Dw);return[tt&&new sn({getFillColor:X,getLineColor:B,getLineWidth:U,padding:H,getPosition:w,getSize:A,getAngle:M,getPixelOffset:F,billboard:st,sizeScale:Dt/this.state.fontAtlasManager.props.fontSize,sizeUnits:kt,sizeMinPixels:qt,sizeMaxPixels:ee,transitions:_e&&{getPosition:_e.getPosition,getAngle:_e.getAngle,getSize:_e.getSize,getFillColor:_e.getBackgroundColor,getLineColor:_e.getBorderColor,getLineWidth:_e.getBorderWidth,getPixelOffset:_e.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ae.getPosition,getAngle:ae.getAngle,getSize:ae.getSize,getFillColor:ae.getBackgroundColor,getLineColor:ae.getBorderColor,getLineWidth:ae.getBorderWidth,getPixelOffset:ae.getPixelOffset,getBoundingRect:{getText:ae.getText,getTextAnchor:ae.getTextAnchor,getAlignmentBaseline:ae.getAlignmentBaseline,styleVersion:p}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:_,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new he({sdf:pt.sdf,smoothing:Number.isFinite(pt.smoothing)?pt.smoothing:id.smoothing,outlineWidth:_t,outlineColor:Ot,iconAtlas:l,iconMapping:s,getPosition:w,getColor:P,getSize:A,getAngle:M,getPixelOffset:F,billboard:st,sizeScale:Dt*o,sizeUnits:kt,sizeMinPixels:qt*o,sizeMaxPixels:ee*o,transitions:_e&&{getPosition:_e.getPosition,getAngle:_e.getAngle,getColor:_e.getColor,getSize:_e.getSize,getPixelOffset:_e.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:ae.getText,getPosition:ae.getPosition,getAngle:ae.getAngle,getColor:ae.getColor,getSize:ae.getSize,getPixelOffset:ae.getPixelOffset,getIconOffsets:{getText:ae.getText,getTextAnchor:ae.getTextAnchor,getAlignmentBaseline:ae.getAlignmentBaseline,styleVersion:p}}}),{data:g,_dataDiff:_,startIndices:t,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(t){iq(t)}}L(Fw,"defaultProps",cq);L(Fw,"layerName","TextLayer");const Ay={circle:{type:Ow,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:n_,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Fw,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Cy={type:i_,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},U1={type:Rw,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function kp({type:e,props:t}){const n={};for(const r in t)n[r]=e.defaultProps[t[r]];return n}function Y0(e,t){const{transitions:n,updateTriggers:r}=e.props,o={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const l in t){const s=t[l];let p=e.props[l];l.startsWith("get")&&(p=e.getSubLayerAccessor(p),o.updateTriggers[s]=r[l],n&&(o.transitions[s]=n[l])),o[s]=p}return o}function hq(e){if(Array.isArray(e))return e;switch(cn.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return cn.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function xA(e,t,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:l=e.length}=n;for(let s=o;s<l;s++){const p=e[s],{geometry:g}=p;if(g)if(g.type==="GeometryCollection"){cn.assert(Array.isArray(g.geometries),"GeoJSON does not have geometries array");const{geometries:_}=g;for(let w=0;w<_.length;w++){const P=_[w];bA(P,r,t,p,s)}}else bA(g,r,t,p,s)}return r}function bA(e,t,n,r,o){const{type:l,coordinates:s}=e,{pointFeatures:p,lineFeatures:g,polygonFeatures:_,polygonOutlineFeatures:w}=t;if(!pq(l,s)){cn.warn("".concat(l," coordinates are malformed"))();return}switch(l){case"Point":p.push(n({geometry:e},r,o));break;case"MultiPoint":s.forEach(P=>{p.push(n({geometry:{type:"Point",coordinates:P}},r,o))});break;case"LineString":g.push(n({geometry:e},r,o));break;case"MultiLineString":s.forEach(P=>{g.push(n({geometry:{type:"LineString",coordinates:P}},r,o))});break;case"Polygon":_.push(n({geometry:e},r,o)),s.forEach(P=>{w.push(n({geometry:{type:"LineString",coordinates:P}},r,o))});break;case"MultiPolygon":s.forEach(P=>{_.push(n({geometry:{type:"Polygon",coordinates:P}},r,o)),P.forEach(A=>{w.push(n({geometry:{type:"LineString",coordinates:A}},r,o))})});break}}const fq={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function pq(e,t){let n=fq[e];for(cn.assert(n,"Unknown GeoJSON type ".concat(e));t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}function Bk(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Hg(e){return e.geometry.coordinates}function dq(e,t){const n=Bk(),{pointFeatures:r,lineFeatures:o,polygonFeatures:l,polygonOutlineFeatures:s}=e;return n.points.data=r,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=Hg,n.lines.data=o,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=Hg,n.polygons.data=l,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=Hg,n.polygonsOutline.data=s,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=Hg,n}function mq(e,t){const n=Bk(),{points:r,lines:o,polygons:l}=e,s=UH(e,t);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:s.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:s.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.lines._pathType="open",n.polygons.data={length:l.polygonIndices.value.length-1,startIndices:l.polygonIndices.value,attributes:{...l.attributes,getPolygon:l.positions,pickingColors:{size:3,value:s.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},n.polygons._normalize=!1,l.triangles&&(n.polygons.data.attributes.indices=l.triangles.value),n.polygonsOutline.data={length:l.primitivePolygonIndices.value.length-1,startIndices:l.primitivePolygonIndices.value,attributes:{...l.attributes,getPath:l.positions,instancePickingColors:{size:3,value:s.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},n.polygonsOutline._pathType="open",n}const gq=["points","linestrings","polygons"],yq={...kp(Ay.circle),...kp(Ay.icon),...kp(Ay.text),...kp(Cy),...kp(U1),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class tm extends e_{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:t,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,o=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:o}),o?this._updateStateBinary({props:t,changeFlags:n}):this._updateStateJSON({props:t,changeFlags:n})}_updateStateBinary({props:t,changeFlags:n}){const r=mq(t.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:t,changeFlags:n}){const r=hq(t.data),o=this.getSubLayerRow.bind(this);let l={};const s={};if(Array.isArray(n.dataChanged)){const g=this.state.features;for(const _ in g)l[_]=g[_].slice(),s[_]=[];for(const _ of n.dataChanged){const w=xA(r,o,_);for(const P in g)s[P].push(FH({data:l[P],getIndex:A=>A.__source.index,dataRange:_,replace:w[P]}))}}else l=xA(r,o);const p=dq(l,s);this.setState({features:l,featuresDiff:s,layerProps:p})}getPickingInfo(t){const n=super.getPickingInfo(t),{index:r,sourceLayer:o}=n;return n.featureType=gq.find(l=>o.id.startsWith("".concat(this.id,"-").concat(l,"-"))),r>=0&&o.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(t){const n="".concat(this.id,"-points-"),r=t.featureType==="points";for(const o of this.getSubLayers())o.id.startsWith(n)===r&&o.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:n}=this.props,{layerProps:r}=this.state,o="polygons-fill",l=this.shouldRenderSubLayer(o,r.polygons.data)&&this.getSubLayerClass(o,U1.type);if(l){const s=Y0(this,U1.props),p=t&&n;return p||delete s.getLineColor,s.updateTriggers.lineColors=p,new l(s,this.getSubLayerProps({id:o,updateTriggers:s.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:n}=this.props,{layerProps:r}=this.state,o="polygons-stroke",l="linestrings",s=!t&&n&&this.shouldRenderSubLayer(o,r.polygonsOutline.data)&&this.getSubLayerClass(o,Cy.type),p=this.shouldRenderSubLayer(l,r.lines.data)&&this.getSubLayerClass(l,Cy.type);if(s||p){const g=Y0(this,Cy.props);return[s&&new s(g,this.getSubLayerProps({id:o,updateTriggers:g.updateTriggers}),r.polygonsOutline),p&&new p(g,this.getSubLayerProps({id:l,updateTriggers:g.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:o}=this.props;!r&&Number.isFinite(o)&&(o=n.points.data.findIndex(p=>p.__source.index===o));const l=new Set(t.split("+")),s=[];for(const p of l){const g="points-".concat(p),_=Ay[p],w=_&&this.shouldRenderSubLayer(g,n.points.data)&&this.getSubLayerClass(g,_.type);if(w){const P=Y0(this,_.props);let A=n.points;if(p==="text"&&r){const{instancePickingColors:M,...F}=A.data.attributes;A={...A,data:{...A.data,attributes:F}}}s.push(new w(P,this.getSubLayerProps({id:g,updateTriggers:P.updateTriggers,highlightedObjectIndex:o}),A))}}return s}renderLayers(){const{extruded:t}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),o=this._renderPointLayers();return[!t&&n,r,o,t&&n]}getSubLayerAccessor(t){const{binary:n}=this.state;return!n||typeof t!="function"?super.getSubLayerAccessor(t):(r,o)=>{const{data:l,index:s}=o,p=NH(l,s);return t(p,o)}}}L(tm,"layerName","GeoJsonLayer");L(tm,"defaultProps",yq);class vq{constructor(t){L(this,"index",void 0),L(this,"isVisible",void 0),L(this,"isSelected",void 0),L(this,"parent",void 0),L(this,"children",void 0),L(this,"content",void 0),L(this,"state",void 0),L(this,"layers",void 0),L(this,"id",void 0),L(this,"bbox",void 0),L(this,"zoom",void 0),L(this,"userData",void 0),L(this,"_abortController",void 0),L(this,"_loader",void 0),L(this,"_loaderId",void 0),L(this,"_isLoaded",void 0),L(this,"_isCancelled",void 0),L(this,"_needsReload",void 0),this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||cn.error("byteLength not defined in tile data")(),t}async _loadData({getData:t,requestScheduler:n,onLoad:r,onError:o}){const{index:l,id:s,bbox:p,userData:g,zoom:_}=this,w=this._loaderId;this._abortController=new AbortController;const{signal:P}=this._abortController,A=await n.scheduleRequest(this,X=>X.isSelected?1:-1);if(!A){this._isCancelled=!0;return}if(this._isCancelled){A.done();return}let M=null,F;try{M=await t({index:l,id:s,bbox:p,userData:g,zoom:_,signal:P})}catch(X){F=X||!0}finally{A.done()}if(w===this._loaderId){if(this._loader=void 0,this.content=M,this._isCancelled&&!M){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,F?o(F,this):r(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,(t=this._abortController)===null||t===void 0||t.abort())}}const zi={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},wA=new be,_q=new be;class Nw{constructor(t=[0,0,0],n=[0,0,0],r){L(this,"center",void 0),L(this,"halfDiagonal",void 0),L(this,"minimum",void 0),L(this,"maximum",void 0),r=r||wA.copy(t).add(n).scale(.5),this.center=new be(r),this.halfDiagonal=new be(n).subtract(this.center),this.minimum=new be(t),this.maximum=new be(n)}clone(){return new Nw(this.minimum,this.maximum,this.center)}equals(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:n}=this,r=_q.from(t.normal),o=n.x*Math.abs(r.x)+n.y*Math.abs(r.y)+n.z*Math.abs(r.z),l=this.center.dot(r)+t.distance;return l-o>0?zi.INSIDE:l+o<0?zi.OUTSIDE:zi.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=wA.from(t).subtract(this.center),{halfDiagonal:r}=this;let o=0,l;return l=Math.abs(n.x)-r.x,l>0&&(o+=l*l),l=Math.abs(n.y)-r.y,l>0&&(o+=l*l),l=Math.abs(n.z)-r.z,l>0&&(o+=l*l),o}}const Op=new be,TA=new be;class Bw{constructor(t=[0,0,0],n=0){L(this,"center",void 0),L(this,"radius",void 0),this.radius=-0,this.center=new be,this.fromCenterRadius(t,n)}fromCenterRadius(t,n){return this.center.from(t),this.radius=n,this}fromCornerPoints(t,n){return n=Op.from(n),this.center=new be().from(t).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Bw(this.center,this.radius)}union(t){const n=this.center,r=this.radius,o=t.center,l=t.radius,s=Op.copy(o).subtract(n),p=s.magnitude();if(r>=p+l)return this.clone();if(l>=p+r)return t.clone();const g=(r+p+l)*.5;return TA.copy(s).scale((-r+g)/p).add(n),this.center.copy(TA),this.radius=g,this}expand(t){const r=Op.from(t).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(t){this.center.transform(t);const n=SD(Op,t);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(t){const n=this.distanceTo(t);return n*n}distanceTo(t){const r=Op.from(t).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(t){const n=this.center,r=this.radius,l=t.normal.dot(n)+t.distance;return l<-r?zi.OUTSIDE:l<r?zi.INTERSECTING:zi.INSIDE}}const xq=new be,bq=new be,qg=new be,Zg=new be,Xg=new be,wq=new be,Tq=new be,Ga={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Uw{constructor(t=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){L(this,"center",void 0),L(this,"halfAxes",void 0),this.center=new be().from(t),this.halfAxes=new hi(n)}get halfSize(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new be(t).len(),new be(n).len(),new be(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),o=new be(t).normalize(),l=new be(n).normalize(),s=new be(r).normalize();return new AP().fromMatrix3(new hi([...o,...l,...s]))}fromCenterHalfSizeQuaternion(t,n,r){const o=new AP(r),l=new hi().fromQuaternion(o);return l[0]=l[0]*n[0],l[1]=l[1]*n[0],l[2]=l[2]*n[0],l[3]=l[3]*n[1],l[4]=l[4]*n[1],l[5]=l[5]*n[1],l[6]=l[6]*n[2],l[7]=l[7]*n[2],l[8]=l[8]*n[2],this.center=new be().from(t),this.halfAxes=l,this}clone(){return new Uw(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Bw){const n=this.halfAxes,r=n.getColumn(0,qg),o=n.getColumn(1,Zg),l=n.getColumn(2,Xg),s=xq.copy(r).add(o).add(l);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){const n=this.center,r=t.normal,o=this.halfAxes,l=r.x,s=r.y,p=r.z,g=Math.abs(l*o[Ga.COLUMN0ROW0]+s*o[Ga.COLUMN0ROW1]+p*o[Ga.COLUMN0ROW2])+Math.abs(l*o[Ga.COLUMN1ROW0]+s*o[Ga.COLUMN1ROW1]+p*o[Ga.COLUMN1ROW2])+Math.abs(l*o[Ga.COLUMN2ROW0]+s*o[Ga.COLUMN2ROW1]+p*o[Ga.COLUMN2ROW2]),_=r.dot(n)+t.distance;return _<=-g?zi.OUTSIDE:_>=g?zi.INSIDE:zi.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=bq.from(t).subtract(this.center),r=this.halfAxes,o=r.getColumn(0,qg),l=r.getColumn(1,Zg),s=r.getColumn(2,Xg),p=o.magnitude(),g=l.magnitude(),_=s.magnitude();o.normalize(),l.normalize(),s.normalize();let w=0,P;return P=Math.abs(n.dot(o))-p,P>0&&(w+=P*P),P=Math.abs(n.dot(l))-g,P>0&&(w+=P*P),P=Math.abs(n.dot(s))-_,P>0&&(w+=P*P),w}computePlaneDistances(t,n,r=[-0,-0]){let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const s=this.center,p=this.halfAxes,g=p.getColumn(0,qg),_=p.getColumn(1,Zg),w=p.getColumn(2,Xg),P=wq.copy(g).add(_).add(w).add(s),A=Tq.copy(P).subtract(t);let M=n.dot(A);return o=Math.min(M,o),l=Math.max(M,l),P.copy(s).add(g).add(_).subtract(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),P.copy(s).add(g).subtract(_).add(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),P.copy(s).add(g).subtract(_).subtract(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),s.copy(P).subtract(g).add(_).add(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),s.copy(P).subtract(g).add(_).subtract(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),s.copy(P).subtract(g).subtract(_).add(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),s.copy(P).subtract(g).subtract(_).subtract(w),A.copy(P).subtract(t),M=n.dot(A),o=Math.min(M,o),l=Math.max(M,l),r[0]=o,r[1]=l,r}transform(t){this.center.transformAsPoint(t);const n=this.halfAxes.getColumn(0,qg);n.transformAsPoint(t);const r=this.halfAxes.getColumn(1,Zg);r.transformAsPoint(t);const o=this.halfAxes.getColumn(2,Xg);return o.transformAsPoint(t),this.halfAxes=new hi([...n,...r,...o]),this}getTransform(){throw new Error("not implemented")}}const EA=new be,SA=new be;class yf{constructor(t=[0,0,1],n=0){L(this,"normal",void 0),L(this,"distance",void 0),this.normal=new be,this.distance=-0,this.fromNormalDistance(t,n)}fromNormalDistance(t,n){return wd(Number.isFinite(n)),this.normal.from(t).normalize(),this.distance=n,this}fromPointNormal(t,n){t=EA.from(t),this.normal.from(n).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,n,r,o){return this.normal.set(t,n,r),wd(oa(this.normal.len(),1)),this.distance=o,this}clone(){return new yf(this.normal,this.distance)}equals(t){return oa(this.distance,t.distance)&&oa(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const n=SA.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,n)}projectPointOntoPlane(t,n=[0,0,0]){t=EA.from(t);const r=this.getPointDistance(t),o=SA.copy(this.normal).scale(r);return t.subtract(o).to(n)}}const PA=[new be([1,0,0]),new be([0,1,0]),new be([0,0,1])],AA=new be,Eq=new be;new yf(new be(1,0,0),0);class nl{constructor(t=[]){L(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*PA.length;const n=t.center,r=t.radius;let o=0;for(const l of PA){let s=this.planes[o],p=this.planes[o+1];s||(s=this.planes[o]=new yf),p||(p=this.planes[o+1]=new yf);const g=AA.copy(l).scale(-r).add(n);-l.dot(g),s.fromPointNormal(g,l);const _=AA.copy(l).scale(r).add(n),w=Eq.copy(l).negate();-w.dot(_),p.fromPointNormal(_,w),o+=2}return this}computeVisibility(t){let n=zi.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case zi.OUTSIDE:return zi.OUTSIDE;case zi.INTERSECTING:n=zi.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(t,n){if(wd(Number.isFinite(n),"parentPlaneMask is required."),n===nl.MASK_OUTSIDE||n===nl.MASK_INSIDE)return n;let r=nl.MASK_INSIDE;const o=this.planes;for(let l=0;l<this.planes.length;++l){const s=l<31?1<<l:0;if(l<31&&!(n&s))continue;const p=o[l],g=t.intersectPlane(p);if(g===zi.OUTSIDE)return nl.MASK_OUTSIDE;g===zi.INTERSECTING&&(r|=s)}return r}}L(nl,"MASK_OUTSIDE",4294967295);L(nl,"MASK_INSIDE",0);L(nl,"MASK_INDETERMINATE",2147483647);new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;new be;const Ys=new hi,Sq=new hi,Pq=new hi,$g=new hi,CA=new hi;function Aq(e,t={}){const n=VL.EPSILON20,r=10;let o=0,l=0;const s=Sq,p=Pq;s.identity(),p.copy(e);const g=n*Cq(p);for(;l<r&&Iq(p)>g;)Mq(p,$g),CA.copy($g).transpose(),p.multiplyRight($g),p.multiplyLeft(CA),s.multiplyRight($g),++o>2&&(++l,o=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=p.toTarget(t.diagonal),t}function Cq(e){let t=0;for(let n=0;n<9;++n){const r=e[n];t+=r*r}return Math.sqrt(t)}const V1=[1,0,0],j1=[2,2,1];function Iq(e){let t=0;for(let n=0;n<3;++n){const r=e[Ys.getElementIndex(j1[n],V1[n])];t+=2*r*r}return Math.sqrt(t)}function Mq(e,t){const n=VL.EPSILON15;let r=0,o=1;for(let _=0;_<3;++_){const w=Math.abs(e[Ys.getElementIndex(j1[_],V1[_])]);w>r&&(o=_,r=w)}const l=V1[o],s=j1[o];let p=1,g=0;if(Math.abs(e[Ys.getElementIndex(s,l)])>n){const _=e[Ys.getElementIndex(s,s)],w=e[Ys.getElementIndex(l,l)],P=e[Ys.getElementIndex(s,l)],A=(_-w)/2/P;let M;A<0?M=-1/(-A+Math.sqrt(1+A*A)):M=1/(A+Math.sqrt(1+A*A)),p=1/Math.sqrt(1+M*M),g=M*p}return hi.IDENTITY.to(t),t[Ys.getElementIndex(l,l)]=t[Ys.getElementIndex(s,s)]=p,t[Ys.getElementIndex(s,l)]=g,t[Ys.getElementIndex(l,s)]=-g,t}const Nl=new be,Lq=new be,kq=new be,Oq=new be,Rq=new be,zq=new hi,Dq={diagonal:new hi,unitary:new hi};function Fq(e,t=new Uw){if(!e||e.length===0)return t.halfAxes=new hi([0,0,0,0,0,0,0,0,0]),t.center=new be,t;const n=e.length,r=new be(0,0,0);for(const kt of e)r.add(kt);const o=1/n;r.multiplyByScalar(o);let l=0,s=0,p=0,g=0,_=0,w=0;for(const kt of e){const qt=Nl.copy(kt).subtract(r);l+=qt.x*qt.x,s+=qt.x*qt.y,p+=qt.x*qt.z,g+=qt.y*qt.y,_+=qt.y*qt.z,w+=qt.z*qt.z}l*=o,s*=o,p*=o,g*=o,_*=o,w*=o;const P=zq;P[0]=l,P[1]=s,P[2]=p,P[3]=s,P[4]=g,P[5]=_,P[6]=p,P[7]=_,P[8]=w;const{unitary:A}=Aq(P,Dq),M=t.halfAxes.copy(A);let F=M.getColumn(0,kq),X=M.getColumn(1,Oq),B=M.getColumn(2,Rq),U=-Number.MAX_VALUE,H=-Number.MAX_VALUE,tt=-Number.MAX_VALUE,st=Number.MAX_VALUE,pt=Number.MAX_VALUE,_t=Number.MAX_VALUE;for(const kt of e)Nl.copy(kt),U=Math.max(Nl.dot(F),U),H=Math.max(Nl.dot(X),H),tt=Math.max(Nl.dot(B),tt),st=Math.min(Nl.dot(F),st),pt=Math.min(Nl.dot(X),pt),_t=Math.min(Nl.dot(B),_t);F=F.multiplyByScalar(.5*(st+U)),X=X.multiplyByScalar(.5*(pt+H)),B=B.multiplyByScalar(.5*(_t+tt)),t.center.copy(F).add(X).add(B);const Ot=Lq.set(U-st,H-pt,tt-_t).multiplyByScalar(.5),Dt=new hi([Ot[0],0,0,0,Ot[1],0,0,0,Ot[2]]);return t.halfAxes.multiplyRight(Dt),t}const Gh=512,IA=3,Uk=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Vk=Uk.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Nq=Vk.concat([[.25,.5],[.75,.5]]);class Wh{constructor(t,n,r){L(this,"x",void 0),L(this,"y",void 0),L(this,"z",void 0),L(this,"childVisible",void 0),L(this,"selected",void 0),L(this,"_children",void 0),this.x=t,this.y=n,this.z=r}get children(){if(!this._children){const t=this.x*2,n=this.y*2,r=this.z+1;this._children=[new Wh(t,n,r),new Wh(t,n+1,r),new Wh(t+1,n,r),new Wh(t+1,n+1,r)]}return this._children}update(t){const{viewport:n,cullingVolume:r,elevationBounds:o,minZ:l,maxZ:s,bounds:p,offset:g,project:_}=t,w=this.getBoundingVolume(o,g,_);if(p&&!this.insideBounds(p)||r.computeVisibility(w)<0)return!1;if(!this.childVisible){let{z:A}=this;if(A<s&&A>=l){const M=w.distanceTo(n.cameraPosition)*n.scale/n.height;A+=Math.floor(Math.log2(M))}if(A>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const A of this.children)A.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const n of this._children)n.getSelected(t);return t}insideBounds([t,n,r,o]){const l=Math.pow(2,this.z),s=Gh/l;return this.x*s<r&&this.y*s<o&&(this.x+1)*s>t&&(this.y+1)*s>n}getBoundingVolume(t,n,r){if(r){const g=this.z<1?Nq:this.z<2?Vk:Uk,_=[];for(const w of g){const P=G1(this.x+w[0],this.y+w[1],this.z);P[2]=t[0],_.push(r(P)),t[0]!==t[1]&&(P[2]=t[1],_.push(r(P)))}return Fq(_)}const o=Math.pow(2,this.z),l=Gh/o,s=this.x*l+n*Gh,p=Gh-(this.y+1)*l;return new Nw([s,p,t[0]],[s+l,p+l,t[1]])}}function Bq(e,t,n,r){const o=e instanceof mW&&e.resolution?e.projectPosition:null,l=Object.values(e.getFrustumPlanes()).map(({normal:M,distance:F})=>new yf(M.clone().negate(),F)),s=new nl(l),p=e.distanceScales.unitsPerMeter[2],g=n&&n[0]*p||0,_=n&&n[1]*p||0,w=e instanceof la&&e.pitch<=60?t:0;if(r){const[M,F,X,B]=r,U=Uo([M,B]),H=Uo([X,F]);r=[U[0],Gh-U[1],H[0],Gh-H[1]]}const P=new Wh(0,0,0),A={viewport:e,project:o,cullingVolume:s,elevationBounds:[g,_],minZ:w,maxZ:t,bounds:r,offset:0};if(P.update(A),e instanceof la&&e.subViewports&&e.subViewports.length>1){for(A.offset=-1;P.update(A)&&!(--A.offset<-IA););for(A.offset=1;P.update(A)&&!(++A.offset>IA););}return P.getSelected()}const ll=512,Uq=[-1/0,-1/0,1/0,1/0],Vq={type:"url",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(n=>typeof n=="string"),equals:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}};function jk(e,t){const n=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...n.map(o=>o[0])),Math.min(...n.map(o=>o[1])),Math.max(...n.map(o=>o[0])),Math.max(...n.map(o=>o[1]))]}function jq(e){return Math.abs(e.split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0)|0,0))}function Gk(e,t){if(!e||!e.length)return null;const{index:n,id:r}=t;if(Array.isArray(e)){const l=jq(r)%e.length;e=e[l]}let o=e;for(const l of Object.keys(n)){const s=new RegExp("{".concat(l,"}"),"g");o=o.replace(s,String(n[l]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(o=o.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),o}function Gq(e,t,n){let r;if(t&&t.length===2){const[o,l]=t,s=e.getBounds({z:o}),p=e.getBounds({z:l});r=[Math.min(s[0],p[0]),Math.min(s[1],p[1]),Math.max(s[2],p[2]),Math.max(s[3],p[3])]}else r=e.getBounds();return e.isGeospatial?[Math.max(r[0],n[0]),Math.max(r[1],n[1]),Math.min(r[2],n[2]),Math.min(r[3],n[3])]:[Math.max(Math.min(r[0],n[2]),n[0]),Math.max(Math.min(r[1],n[3]),n[1]),Math.min(Math.max(r[2],n[0]),n[2]),Math.min(Math.max(r[3],n[1]),n[3])]}function Sv({viewport:e,z:t,cullRect:n}){const r=n.x-e.x,o=n.y-e.y,{width:l,height:s}=n;if(!Array.isArray(t)){const _={targetZ:t||0},w=e.unproject([r,o],_),P=e.unproject([r+l,o],_),A=e.unproject([r,o+s],_),M=e.unproject([r+l,o+s],_);return[Math.min(w[0],P[0],A[0],M[0]),Math.min(w[1],P[1],A[1],M[1]),Math.max(w[0],P[0],A[0],M[0]),Math.max(w[1],P[1],A[1],M[1])]}const p=Sv({viewport:e,z:t[0],cullRect:n}),g=Sv({viewport:e,z:t[1],cullRect:n});return[Math.min(p[0],g[0]),Math.min(p[1],g[1]),Math.max(p[2],g[2]),Math.max(p[3],g[3])]}function Wq(e,t,n){return n?jk(e,n).map(o=>o*t/ll):e.map(r=>r*t/ll)}function Vw(e,t){return Math.pow(2,e)*ll/t}function G1(e,t,n){const r=Vw(n,ll),o=e/r*360-180,l=Math.PI-2*Math.PI*t/r,s=180/Math.PI*Math.atan(.5*(Math.exp(l)-Math.exp(-l)));return[o,s]}function MA(e,t,n,r){const o=Vw(n,r);return[e/o*ll,t/o*ll]}function Hq(e,t,n,r,o=ll){if(e.isGeospatial){const[_,w]=G1(t,n,r),[P,A]=G1(t+1,n+1,r);return{west:_,north:w,east:P,south:A}}const[l,s]=MA(t,n,r,o),[p,g]=MA(t+1,n+1,r,o);return{left:l,top:s,right:p,bottom:g}}function qq(e,t,n,r,o){const l=Gq(e,null,r),s=Vw(t,n),[p,g,_,w]=Wq(l,s,o),P=[];for(let A=Math.floor(p);A<_;A++)for(let M=Math.floor(g);M<w;M++)P.push({x:A,y:M,z:t});return P}function Zq({viewport:e,maxZoom:t,minZoom:n,zRange:r,extent:o,tileSize:l=ll,modelMatrix:s,modelMatrixInverse:p,zoomOffset:g=0}){let _=e.isGeospatial?Math.round(e.zoom+Math.log2(ll/l))+g:Math.ceil(e.zoom)+g;if(typeof n=="number"&&Number.isFinite(n)&&_<n){if(!o)return[];_=n}typeof t=="number"&&Number.isFinite(t)&&_>t&&(_=t);let w=o;return s&&p&&o&&!e.isGeospatial&&(w=jk(o,s)),e.isGeospatial?Bq(e,_,r,o):qq(e,_,l,w||Uq,p)}function Xq(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function $q(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}const LA=1,a_=2,Yq="never",Kq="no-overlap",jw="best-available",Jq=5,Qq={[jw]:eZ,[Kq]:nZ,[Yq]:()=>{}};class tZ{constructor(t){L(this,"opts",void 0),L(this,"_requestScheduler",void 0),L(this,"_cache",void 0),L(this,"_dirty",void 0),L(this,"_tiles",void 0),L(this,"_cacheByteSize",void 0),L(this,"_viewport",void 0),L(this,"_zRange",void 0),L(this,"_selectedTiles",void 0),L(this,"_frameNumber",void 0),L(this,"_modelMatrix",void 0),L(this,"_modelMatrixInverse",void 0),L(this,"_maxZoom",void 0),L(this,"_minZoom",void 0),L(this,"onTileLoad",void 0),L(this,"_getCullBounds",$d(Sv)),this.opts=t,this.onTileLoad=n=>{this.opts.onTileLoad(n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new h4({maxRequests:t.maxRequests,throttleRequests:t.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new fi,this._modelMatrixInverse=new fi,this.setOptions(t)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const n=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(t):n.setNeedsReload()}}update(t,{zRange:n,modelMatrix:r}={}){const o=new fi(r),l=!o.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!oa(this._zRange,n)||l){l&&(this._modelMatrixInverse=o.clone().invert(),this._modelMatrix=o),this._viewport=t,this._zRange=n;const p=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=p.map(g=>this._getTile(g,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(p=>this._getTile(p.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(t,n){if(!t.isVisible)return!1;if(n&&this._viewport){const[r,o,l,s]=Sv({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:p}=t;if("west"in p)return p.west<l&&p.east>r&&p.south<s&&p.north>o;const g=Math.min(p.top,p.bottom),_=Math.max(p.top,p.bottom);return p.left<l&&p.right>r&&g<s&&_>o}return!0}getTileIndices({viewport:t,maxZoom:n,minZoom:r,zRange:o,modelMatrix:l,modelMatrixInverse:s}){const{tileSize:p,extent:g,zoomOffset:_}=this.opts;return Zq({viewport:t,maxZoom:n,minZoom:r,zRange:o,tileSize:p,extent:g,modelMatrix:l,modelMatrixInverse:s,zoomOffset:_})}getTileId(t){return"".concat(t.x,"-").concat(t.y,"-").concat(t.z)}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:n}=this.opts;return{bbox:Hq(this._viewport,t.x,t.y,t.z,n)}}getParentIndex(t){const n=Math.floor(t.x/2),r=Math.floor(t.y/2),o=t.z-1;return{x:n,y:r,z:o}}updateTileStates(){const t=this.opts.refinementStrategy||jw,n=new Array(this._cache.size);let r=0;for(const o of this._cache.values())n[r++]=o.isVisible,o.isSelected=!1,o.isVisible=!1;for(const o of this._selectedTiles)o.isSelected=!0,o.isVisible=!0;(typeof t=="function"?t:Qq[t])(Array.from(this._cache.values())),r=0;for(const o of this._cache.values())if(n[r++]!==o.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t}=this.opts,n=[];let r=0;for(const o of this._cache.values())o.isLoading&&(r++,!o.isSelected&&!o.isVisible&&n.push(o));for(;t>0&&r>t&&n.length>0;)n.shift().abort(),r--}_rebuildTree(){const{_cache:t}=this;for(const n of t.values())n.parent=null,n.children&&(n.children.length=0);for(const n of t.values()){const r=this._getNearestAncestor(n);n.parent=r,r!=null&&r.children&&r.children.push(n)}}_resizeCache(){const{_cache:t,opts:n}=this,r=n.maxCacheSize||(n.maxCacheByteSize?1/0:Jq*this.selectedTiles.length),o=n.maxCacheByteSize||1/0;if(t.size>r||this._cacheByteSize>o){for(const[s,p]of t)if(!p.isVisible&&!p.isSelected&&(this._cacheByteSize-=n.maxCacheByteSize?p.byteLength:0,t.delete(s),this.opts.onTileUnload(p)),t.size<=r&&this._cacheByteSize<=o)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((s,p)=>s.zoom-p.zoom),this._dirty=!1)}_getTile(t,n){const r=this.getTileId(t);let o=this._cache.get(r),l=!1;return!o&&n?(o=new vq(t),Object.assign(o,this.getTileMetadata(o.index)),Object.assign(o,{id:r,zoom:this.getTileZoom(o.index)}),l=!0,this._cache.set(r,o),this._dirty=!0):o&&o.needsReload&&(l=!0),o&&l&&o.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),o}_getNearestAncestor(t){const{_minZoom:n=0}=this;let r=t.index;for(;this.getTileZoom(r)>n;){r=this.getParentIndex(r);const o=this._getTile(r);if(o)return o}return null}}function eZ(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!Wk(t)&&Gw(t);for(const t of e)t.isVisible=Boolean(t.state&a_)}function nZ(e){for(const n of e)n.state=0;for(const n of e)n.isSelected&&Wk(n);const t=Array.from(e).sort((n,r)=>n.zoom-r.zoom);for(const n of t)if(n.isVisible=Boolean(n.state&a_),n.children&&(n.isVisible||n.state&LA))for(const r of n.children)r.state=LA;else n.isSelected&&Gw(n)}function Wk(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=a_,!0;t=t.parent}return!1}function Gw(e){for(const t of e.children)t.isLoaded||t.content?t.state|=a_:Gw(t)}const rZ={TilesetClass:tZ,data:{type:"data",value:[]},dataComparator:Vq.equals,renderSubLayers:{type:"function",value:e=>new tm(e),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:e=>{},compare:!1},onTileUnload:{type:"function",value:e=>{},compare:!1},onTileError:{type:"function",value:e=>console.error(e),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:jw,zRange:null,maxRequests:6,zoomOffset:0};class Ww extends e_{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,n;(t=this.state)===null||t===void 0||(n=t.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var t,n;return(t=this.state)===null||t===void 0||(n=t.tileset)===null||n===void 0?void 0:n.selectedTiles.every(r=>r.isLoaded&&r.layers&&r.layers.every(o=>o.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:n}=this.state;const r=t.propsOrDataChanged||t.updateTriggersChanged,o=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);n?r&&(n.setOptions(this._getTilesetOptions()),o?n.reloadAll():this.state.tileset.tiles.forEach(l=>{l.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:n,maxCacheByteSize:r,refinementStrategy:o,extent:l,maxZoom:s,minZoom:p,maxRequests:g,zoomOffset:_}=this.props;return{maxCacheSize:n,maxCacheByteSize:r,maxZoom:s,minZoom:p,tileSize:t,refinementStrategy:o,extent:l,maxRequests:g,zoomOffset:_,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:t}=this.state,{zRange:n,modelMatrix:r}=this.props,o=t.update(this.context.viewport,{zRange:n,modelMatrix:r}),{isLoaded:l}=t,s=this.state.isLoaded!==l,p=this.state.frameNumber!==o;l&&(s||p)&&this._onViewportLoad(),p&&this.setState({frameNumber:o}),this.state.isLoaded=l}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:n}=this.props;n&&n(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,n){this.props.onTileError(t),n.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:n,getTileData:r,fetch:o}=this.props,{signal:l}=t;return t.url=typeof n=="string"||Array.isArray(n)?Gk(n,t):null,r?r(t):o&&t.url?o(t.url,{propName:"data",layer:this,signal:l}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo({info:t,sourceLayer:n}){return t.picked&&(t.tile=n.props.tile),t}_updateAutoHighlight(t){t.sourceLayer&&t.sourceLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const n=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)n&&t.layers[0]&&Object.keys(n).some(r=>t.layers[0].props[r]!==n[r])&&(t.layers=t.layers.map(r=>r.clone(n)));else{const r=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(t.id),data:t.content,_offset:0,tile:t});t.layers=Jv(r,Boolean).map(o=>o.clone({tile:t,...n}))}return t.layers})}filterSubLayer({layer:t,cullRect:n}){const{tile:r}=t.props;return this.state.tileset.isTileVisible(r,n)}}L(Ww,"defaultProps",rZ);L(Ww,"layerName","TileLayer");const iZ={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}};class Pv extends i_{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:n,trailLength:r,currentTime:o}=this.props;t.uniforms={...t.uniforms,fadeTrail:n,trailLength:r,currentTime:o},super.draw(t)}}L(Pv,"layerName","TripsLayer");L(Pv,"defaultProps",iZ);function oZ(e,t,n){const r=sZ(e),o=Object.keys(r).filter(l=>r[l]!==Array);return aZ(e,{propArrayTypes:r,...t},{numericPropKeys:n&&n.numericPropKeys||o,PositionDataType:n?n.PositionDataType:Float32Array})}function sZ(e){const t={};for(const n of e)if(n.properties)for(const r in n.properties){const o=n.properties[r];t[r]=pZ(o,t[r])}return t}function aZ(e,t,n){const{pointPositionsCount:r,pointFeaturesCount:o,linePositionsCount:l,linePathsCount:s,lineFeaturesCount:p,polygonPositionsCount:g,polygonObjectsCount:_,polygonRingsCount:w,polygonFeaturesCount:P,propArrayTypes:A,coordLength:M}=t,{numericPropKeys:F=[],PositionDataType:X=Float32Array}=n,B=e[0]&&"id"in e[0],U=e.length>65535?Uint32Array:Uint16Array,H={type:"Point",positions:new X(r*M),globalFeatureIds:new U(r),featureIds:o>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},tt={type:"LineString",pathIndices:l>65535?new Uint32Array(s+1):new Uint16Array(s+1),positions:new X(l*M),globalFeatureIds:new U(l),featureIds:p>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]},st={type:"Polygon",polygonIndices:g>65535?new Uint32Array(_+1):new Uint16Array(_+1),primitivePolygonIndices:g>65535?new Uint32Array(w+1):new Uint16Array(w+1),positions:new X(g*M),triangles:[],globalFeatureIds:new U(g),featureIds:P>65535?new Uint32Array(g):new Uint16Array(g),numericProps:{},properties:[],fields:[]};for(const _t of[H,tt,st])for(const Ot of F){const Dt=A[Ot];_t.numericProps[Ot]=new Dt(_t.positions.length/M)}tt.pathIndices[s]=l,st.polygonIndices[_]=g,st.primitivePolygonIndices[w]=g;const pt={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const _t of e){const Ot=_t.geometry,Dt=_t.properties||{};switch(Ot.type){case"Point":lZ(Ot,H,pt,M,Dt),H.properties.push(J0(Dt,F)),B&&H.fields.push({id:_t.id}),pt.pointFeature++;break;case"LineString":uZ(Ot,tt,pt,M,Dt),tt.properties.push(J0(Dt,F)),B&&tt.fields.push({id:_t.id}),pt.lineFeature++;break;case"Polygon":cZ(Ot,st,pt,M,Dt),st.properties.push(J0(Dt,F)),B&&st.fields.push({id:_t.id}),pt.polygonFeature++;break;default:throw new Error("Invalid geometry type")}pt.feature++}return fZ(H,tt,st,M)}function lZ(e,t,n,r,o){t.positions.set(e.data,n.pointPosition*r);const l=e.data.length/r;Hw(t,o,n.pointPosition,l),t.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+l),t.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+l),n.pointPosition+=l}function uZ(e,t,n,r,o){t.positions.set(e.data,n.linePosition*r);const l=e.data.length/r;Hw(t,o,n.linePosition,l),t.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+l),t.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+l);for(let s=0,p=e.indices.length;s<p;++s){const g=e.indices[s],_=s===p-1?e.data.length:e.indices[s+1];t.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(_-g)/r}}function cZ(e,t,n,r,o){t.positions.set(e.data,n.polygonPosition*r);const l=e.data.length/r;Hw(t,o,n.polygonPosition,l),t.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+l),t.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+l);for(let s=0,p=e.indices.length;s<p;++s){const g=n.polygonPosition;t.polygonIndices[n.polygonObject++]=g;const _=e.areas[s],w=e.indices[s],P=e.indices[s+1];for(let M=0,F=w.length;M<F;++M){const X=w[M],B=M===F-1?P===void 0?e.data.length:P[0]:w[M+1];t.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(B-X)/r}const A=n.polygonPosition;hZ(t,_,w,{startPosition:g,endPosition:A,coordLength:r})}}function hZ(e,t,n,{startPosition:r,endPosition:o,coordLength:l}){const s=r*l,p=o*l,g=e.positions.subarray(s,p),_=n[0],w=n.slice(1).map(A=>(A-_)/l),P=kW(g,w,l,t);for(let A=0,M=P.length;A<M;++A)e.triangles.push(r+P[A])}function K0(e,t){const n={};for(const r in e)n[r]={value:e[r],size:t};return n}function fZ(e,t,n,r){return{points:{...e,positions:{value:e.positions,size:r},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:K0(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:r},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:K0(t.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:r},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(n.triangles),size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:K0(n.numericProps,1)}}}function Hw(e,t,n,r){for(const o in e.numericProps)if(o in t){const l=t[o];e.numericProps[o].fill(l,n,n+r)}}function J0(e,t){const n={};for(const r in e)t.includes(r)||(n[r]=e[r]);return n}function pZ(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function kA(e,t){const n=t==null?void 0:t.globalFeatureId;return n!==void 0?dZ(e,n):mZ(e,t==null?void 0:t.type)}function dZ(e,t){const n=Hk(e);for(const r of n){let o=0,l=r.featureIds.value[0];for(let s=0;s<r.featureIds.value.length;s++){const p=r.featureIds.value[s];if(p!==l){if(t===r.globalFeatureIds.value[o])return Av(r,o,s);o=s,l=p}}if(t===r.globalFeatureIds.value[o])return Av(r,o,r.featureIds.value.length)}throw new Error("featureId:".concat(t," not found"))}function mZ(e,t){const n=Hk(e,t);return yZ(n)}function gZ(e,t,n){switch(e.type){case"Point":return bZ(e,t,n);case"LineString":return xZ(e,t,n);case"Polygon":return qk(e,t,n);default:const r=e;throw new Error("Unsupported geometry type: ".concat(r==null?void 0:r.type))}}function Hk(e,t){if(!Boolean(e.points||e.lines||e.polygons))return e.type=t||wZ(e),[e];const r=[];return e.points&&(e.points.type="Point",r.push(e.points)),e.lines&&(e.lines.type="LineString",r.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",r.push(e.polygons)),r}function yZ(e){const t=[];for(const n of e){if(n.featureIds.value.length===0)continue;let r=0,o=n.featureIds.value[0];for(let l=0;l<n.featureIds.value.length;l++){const s=n.featureIds.value[l];s!==o&&(t.push(Av(n,r,l)),r=l,o=s)}t.push(Av(n,r,n.featureIds.value.length))}return t}function Av(e,t,n){const r=gZ(e,t,n),o=_Z(e,t),l=vZ(e,t);return{type:"Feature",geometry:r,properties:o,...l}}function vZ(e,t=0,n){return e.fields&&e.fields[e.featureIds.value[t]]}function _Z(e,t=0,n){const r=Object.assign({},e.properties[e.featureIds.value[t]]);for(const o in e.numericProps)r[o]=e.numericProps[o].value[t];return r}function qk(e,t=-1/0,n=1/0){const{positions:r}=e,o=e.polygonIndices.value.filter(g=>g>=t&&g<=n),l=e.primitivePolygonIndices.value.filter(g=>g>=t&&g<=n);if(!(o.length>2)){const g=[];for(let _=0;_<l.length-1;_++){const w=l[_],P=l[_+1],A=Cv(r,w,P);g.push(A)}return{type:"Polygon",coordinates:g}}const p=[];for(let g=0;g<o.length-1;g++){const _=o[g],w=o[g+1],P=qk(e,_,w).coordinates;p.push(P)}return{type:"MultiPolygon",coordinates:p}}function xZ(e,t=-1/0,n=1/0){const{positions:r}=e,o=e.pathIndices.value.filter(p=>p>=t&&p<=n);if(!(o.length>2))return{type:"LineString",coordinates:Cv(r,o[0],o[1])};const s=[];for(let p=0;p<o.length-1;p++){const g=Cv(r,o[p],o[p+1]);s.push(g)}return{type:"MultiLineString",coordinates:s}}function bZ(e,t,n){const{positions:r}=e,o=Cv(r,t,n);return o.length>1?{type:"MultiPoint",coordinates:o}:{type:"Point",coordinates:o[0]}}function Cv(e,t,n){t=t||0,n=n||e.value.length/e.size;const r=[];for(let o=t;o<n;o++){const l=Array();for(let s=o*e.size;s<(o+1)*e.size;s++)l.push(Number(e.value[s]));r.push(l)}return r}function wZ(e){return e.pathIndices?"LineString":e.polygonIndices?"Polygon":"Point"}var qw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */qw.read=function(e,t,n,r,o){var l,s,p=o*8-r-1,g=(1<<p)-1,_=g>>1,w=-7,P=n?o-1:0,A=n?-1:1,M=e[t+P];for(P+=A,l=M&(1<<-w)-1,M>>=-w,w+=p;w>0;l=l*256+e[t+P],P+=A,w-=8);for(s=l&(1<<-w)-1,l>>=-w,w+=r;w>0;s=s*256+e[t+P],P+=A,w-=8);if(l===0)l=1-_;else{if(l===g)return s?NaN:(M?-1:1)*(1/0);s=s+Math.pow(2,r),l=l-_}return(M?-1:1)*s*Math.pow(2,l-r)};qw.write=function(e,t,n,r,o,l){var s,p,g,_=l*8-o-1,w=(1<<_)-1,P=w>>1,A=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=r?0:l-1,F=r?1:-1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,s=w):(s=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-s))<1&&(s--,g*=2),s+P>=1?t+=A/g:t+=A*Math.pow(2,1-P),t*g>=2&&(s++,g/=2),s+P>=w?(p=0,s=w):s+P>=1?(p=(t*g-1)*Math.pow(2,o),s=s+P):(p=t*Math.pow(2,P-1)*Math.pow(2,o),s=0));o>=8;e[n+M]=p&255,M+=F,p/=256,o-=8);for(s=s<<o|p,_+=o;_>0;e[n+M]=s&255,M+=F,s/=256,_-=8);e[n+M-F]|=X*128};var Zk=Pn,Yg=qw;function Pn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pn.Varint=0;Pn.Fixed64=1;Pn.Bytes=2;Pn.Fixed32=5;var W1=(1<<16)*(1<<16),OA=1/W1,TZ=12,Xk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Pn.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),o=r>>3,l=this.pos;this.type=r&7,e(o,t,this),this.pos===l&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Kg(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=zA(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Kg(this.buf,this.pos)+Kg(this.buf,this.pos+4)*W1;return this.pos+=8,e},readSFixed64:function(){var e=Kg(this.buf,this.pos)+zA(this.buf,this.pos+4)*W1;return this.pos+=8,e},readFloat:function(){var e=Yg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Yg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,n,r;return r=t[this.pos++],n=r&127,r<128||(r=t[this.pos++],n|=(r&127)<<7,r<128)||(r=t[this.pos++],n|=(r&127)<<14,r<128)||(r=t[this.pos++],n|=(r&127)<<21,r<128)?n:(r=t[this.pos],n|=(r&15)<<28,EZ(n,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=TZ&&Xk?NZ(this.buf,t,e):FZ(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Pn.Bytes)return e.push(this.readVarint(t));var n=Wa(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Pn.Bytes)return e.push(this.readSVarint());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Pn.Bytes)return e.push(this.readBoolean());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Pn.Bytes)return e.push(this.readFloat());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Pn.Bytes)return e.push(this.readDouble());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Pn.Bytes)return e.push(this.readFixed32());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Pn.Bytes)return e.push(this.readSFixed32());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Pn.Bytes)return e.push(this.readFixed64());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Pn.Bytes)return e.push(this.readSFixed64());var t=Wa(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===Pn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pn.Fixed32)this.pos+=4;else if(t===Pn.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ih(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ih(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ih(this.buf,e&-1,this.pos),Ih(this.buf,Math.floor(e*OA),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ih(this.buf,e&-1,this.pos),Ih(this.buf,Math.floor(e*OA),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){SZ(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=BZ(this.buf,e,this.pos);var n=this.pos-t;n>=128&&RA(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Yg.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Yg.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&RA(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,Pn.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,CZ,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,IZ,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,kZ,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,MZ,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,LZ,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,OZ,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,RZ,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,zZ,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,DZ,t)},writeBytesField:function(e,t){this.writeTag(e,Pn.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pn.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pn.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pn.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pn.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pn.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function EZ(e,t,n){var r=n.buf,o,l;if(l=r[n.pos++],o=(l&112)>>4,l<128||(l=r[n.pos++],o|=(l&127)<<3,l<128)||(l=r[n.pos++],o|=(l&127)<<10,l<128)||(l=r[n.pos++],o|=(l&127)<<17,l<128)||(l=r[n.pos++],o|=(l&127)<<24,l<128)||(l=r[n.pos++],o|=(l&1)<<31,l<128))return Ch(e,o,t);throw new Error("Expected varint not more than 10 bytes")}function Wa(e){return e.type===Pn.Bytes?e.readVarint()+e.pos:e.pos+1}function Ch(e,t,n){return n?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function SZ(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),n^4294967295?n=n+1|0:(n=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),PZ(n,r,t),AZ(r,t)}function PZ(e,t,n){n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos]=e&127}function AZ(e,t){var n=(e&7)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function RA(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));n.realloc(r);for(var o=n.pos-1;o>=e;o--)n.buf[o+r]=n.buf[o]}function CZ(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function IZ(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function MZ(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function LZ(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function kZ(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function OZ(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function RZ(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function zZ(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function DZ(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Kg(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function Ih(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function zA(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function FZ(e,t,n){for(var r="",o=t;o<n;){var l=e[o],s=null,p=l>239?4:l>223?3:l>191?2:1;if(o+p>n)break;var g,_,w;p===1?l<128&&(s=l):p===2?(g=e[o+1],(g&192)===128&&(s=(l&31)<<6|g&63,s<=127&&(s=null))):p===3?(g=e[o+1],_=e[o+2],(g&192)===128&&(_&192)===128&&(s=(l&15)<<12|(g&63)<<6|_&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):p===4&&(g=e[o+1],_=e[o+2],w=e[o+3],(g&192)===128&&(_&192)===128&&(w&192)===128&&(s=(l&15)<<18|(g&63)<<12|(_&63)<<6|w&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,p=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),o+=p}return r}function NZ(e,t,n){return Xk.decode(e.subarray(t,n))}function BZ(e,t,n){for(var r=0,o,l;r<t.length;r++){if(o=t.charCodeAt(r),o>55295&&o<57344)if(l)if(o<56320){e[n++]=239,e[n++]=191,e[n++]=189,l=o;continue}else o=l-55296<<10|o-56320|65536,l=null;else{o>56319||r+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):l=o;continue}else l&&(e[n++]=239,e[n++]=191,e[n++]=189,l=null);o<128?e[n++]=o:(o<2048?e[n++]=o>>6|192:(o<65536?e[n++]=o>>12|224:(e[n++]=o>>18|240,e[n++]=o>>12&63|128),e[n++]=o>>6&63|128),e[n++]=o&63|128)}return n}function UZ(e){const t=e.length;if(t<=1)return[e];const n=[];let r,o;for(let l=0;l<t;l++){const s=VZ(e[l]);s!==0&&(o===void 0&&(o=s<0),o===s<0?(r&&n.push(r),r=[e[l]]):r&&r.push(e[l]))}return r&&n.push(r),n}function VZ(e){let t=0;for(let n=0,r=e.length-1,o,l;n<e.length;r=n++)o=e[n],l=e[r],t+=(l[0]-o[0])*(o[1]+l[1]);return t}function jZ(e,t,n){t&&n&&(e===1?t.id=n.readVarint():e===2?GZ(n,t):e===3?t.type=n.readVarint():e===4&&(t._geometry=n.pos))}function GZ(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const r=t._keys[e.readVarint()],o=t._values[e.readVarint()];t.properties[r]=o}}let $k=class{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(t,n,r,o,l){L(this,"properties",void 0),L(this,"extent",void 0),L(this,"type",void 0),L(this,"id",void 0),L(this,"_pbf",void 0),L(this,"_geometry",void 0),L(this,"_keys",void 0),L(this,"_values",void 0),this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=o,this._values=l,t.readFields(jZ,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let r=1,o=0,l=0,s=0;const p=[];let g;for(;t.pos<n;){if(o<=0){const _=t.readVarint();r=_&7,o=_>>3}if(o--,r===1||r===2)l+=t.readSVarint(),s+=t.readSVarint(),r===1&&(g&&p.push(g),g=[]),g&&g.push([l,s]);else if(r===7)g&&g.push(g[0].slice());else throw new Error("unknown command ".concat(r))}return g&&p.push(g),p}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let r=1,o=0,l=0,s=0,p=1/0,g=-1/0,_=1/0,w=-1/0;for(;t.pos<n;){if(o<=0){const P=t.readVarint();r=P&7,o=P>>3}if(o--,r===1||r===2)l+=t.readSVarint(),s+=t.readSVarint(),l<p&&(p=l),l>g&&(g=l),s<_&&(_=s),s>w&&(w=s);else if(r!==7)throw new Error("unknown command ".concat(r))}return[p,_,g,w]}_toGeoJSON(t){let n=this.loadGeometry(),r=$k.types[this.type],o,l;switch(this.type){case 1:const p=[];for(o=0;o<n.length;o++)p[o]=n[o][0];n=p,t(n,this);break;case 2:for(o=0;o<n.length;o++)t(n[o],this);break;case 3:for(n=UZ(n),o=0;o<n.length;o++)for(l=0;l<n[o].length;l++)t(n[o][l],this);break}n.length===1?n=n[0]:r="Multi".concat(r);const s={type:"Feature",geometry:{type:r,coordinates:n},properties:this.properties};return this.id!==null&&(s.id=this.id),s}toGeoJSON(t){if(typeof t=="function")return this._toGeoJSON(t);const{x:n,y:r,z:o}=t,l=this.extent*Math.pow(2,o),s=this.extent*n,p=this.extent*r;function g(_){for(let w=0;w<_.length;w++){const P=_[w];P[0]=(P[0]+s)*360/l-180;const A=180-(P[1]+p)*360/l;P[1]=360/Math.PI*Math.atan(Math.exp(A*Math.PI/180))-90}}return this._toGeoJSON(g)}},WZ=class{constructor(t,n){L(this,"version",void 0),L(this,"name",void 0),L(this,"extent",void 0),L(this,"length",void 0),L(this,"_pbf",void 0),L(this,"_keys",void 0),L(this,"_values",void 0),L(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(HZ,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new $k(this._pbf,n,this.extent,this._keys,this._values)}};function HZ(e,t,n){t&&n&&(e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(qZ(n)))}function qZ(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}let ZZ=class{constructor(t,n){L(this,"layers",void 0),this.layers=t.readFields(XZ,{},n)}};function XZ(e,t,n){if(e===3&&n){const r=new WZ(n,n.readVarint()+n.pos);r.length&&t&&(t[r.name]=r)}}function $Z(e){const t=e.indices.length,n="Polygon";if(t<=1)return{type:n,data:e.data,areas:[[xv(e.data)]],indices:[e.indices]};const r=[],o=[];let l=[],s=[],p,g=0;for(let _,w=0,P;w<t;w++){P=e.indices[w]-g,_=e.indices[w+1]-g||e.data.length;const A=e.data.slice(P,_),M=xv(A);if(M===0){const F=e.data.slice(0,P),X=e.data.slice(_);e.data=F.concat(X),g+=_-P;continue}p===void 0&&(p=M<0),p===M<0?(s.length&&(r.push(l),o.push(s)),s=[P],l=[M]):(l.push(M),s.push(P))}return l&&r.push(l),s.length&&o.push(s),{type:n,areas:r,indices:o,data:e.data}}function YZ(e,t,n,r){for(let o=0,l=e.length;o<l;o+=2){e[o]=(e[o]+t)*360/r-180;const s=180-(e[o+1]+n)*360/r;e[o+1]=360/Math.PI*Math.atan(Math.exp(s*Math.PI/180))-90}}function KZ(e,t,n){t&&n&&(e===1?t.id=n.readVarint():e===2?JZ(n,t):e===3?t.type=n.readVarint():e===4&&(t._geometry=n.pos))}function JZ(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const r=t._keys[e.readVarint()],o=t._values[e.readVarint()];t.properties[r]=o}}let DA,qu,Q0,Jg,tx,ex,Rp;class QZ{constructor(t,n,r,o,l,s){L(this,"properties",void 0),L(this,"extent",void 0),L(this,"type",void 0),L(this,"id",void 0),L(this,"_pbf",void 0),L(this,"_geometry",void 0),L(this,"_keys",void 0),L(this,"_values",void 0),L(this,"_geometryInfo",void 0),this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=o,this._values=l,this._geometryInfo=s,t.readFields(KZ,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry,DA=t.readVarint()+t.pos,qu=1,Jg=0,tx=0,ex=0,Rp=0;const n=[],r=[];for(;t.pos<DA;)if(Jg<=0&&(Q0=t.readVarint(),qu=Q0&7,Jg=Q0>>3),Jg--,qu===1||qu===2)tx+=t.readSVarint(),ex+=t.readSVarint(),qu===1&&n.push(Rp),r.push(tx,ex),Rp+=2;else if(qu===7){if(Rp>0){const o=n[n.length-1];r.push(r[o],r[o+1]),Rp+=2}}else throw new Error("unknown command ".concat(qu));return{data:r,indices:n}}_toBinaryCoordinates(t){const n=this.loadGeometry();let r;t(n.data,this);const o=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,r={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/o,r={type:"LineString",...n};break;case 3:r=$Z(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=r.indices.length;for(const s of r.indices)this._geometryInfo.polygonRingsCount+=s.length;this._geometryInfo.polygonPositionsCount+=r.data.length/o;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const l={type:"Feature",geometry:r,properties:this.properties};return this.id!==null&&(l.id=this.id),l}toBinaryCoordinates(t){if(typeof t=="function")return this._toBinaryCoordinates(t);const{x:n,y:r,z:o}=t,l=this.extent*Math.pow(2,o),s=this.extent*n,p=this.extent*r;return this._toBinaryCoordinates(g=>YZ(g,s,p,l))}}class tX{constructor(t,n){L(this,"version",void 0),L(this,"name",void 0),L(this,"extent",void 0),L(this,"length",void 0),L(this,"_pbf",void 0),L(this,"_keys",void 0),L(this,"_values",void 0),L(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(eX,this,n),this.length=this._features.length}feature(t,n){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new QZ(this._pbf,r,this.extent,this._keys,this._values,n)}}function eX(e,t,n){t&&n&&(e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(nX(n)))}function nX(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}class rX{constructor(t,n){L(this,"layers",void 0),this.layers=t.readFields(iX,{},n)}}function iX(e,t,n){if(e===3&&n){const r=new tX(n,n.readVarint()+n.pos);r.length&&t&&(t[r.name]=r)}}function FA(e,t){var n,r;const o=sX(t),l=(t==null||(n=t.gis)===null||n===void 0?void 0:n.format)||(t==null||(r=t.mvt)===null||r===void 0?void 0:r.shape);switch(l){case"columnar-table":return{shape:"columnar-table",data:nx(e,o)};case"geojson-row-table":return{shape:"geojson-row-table",data:NA(e,o)};case"geojson":return NA(e,o);case"binary-geometry":return nx(e,o);case"binary":return nx(e,o);default:throw new Error(l)}}function nx(e,t){const[n,r]=oX(e,t),o=oZ(n,r);return o.byteLength=e.byteLength,o}function oX(e,t){const n=[],r={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(e.byteLength<=0)return[n,r];const o=new rX(new Zk(e));return(t&&Array.isArray(t.layers)?t.layers:Object.keys(o.layers)).forEach(s=>{const p=o.layers[s];if(p)for(let g=0;g<p.length;g++){const _=p.feature(g,r),w=lX(_,t,s);n.push(w)}}),[n,r]}function NA(e,t){if(e.byteLength<=0)return[];const n=[],r=new ZZ(new Zk(e));return(Array.isArray(t.layers)?t.layers:Object.keys(r.layers)).forEach(l=>{const s=r.layers[l];if(s)for(let p=0;p<s.length;p++){const g=s.feature(p),_=aX(g,t,l);n.push(_)}}),n}function sX(e){var t;if(!(e!=null&&e.mvt))throw new Error("mvt options required");const n=((t=e.mvt)===null||t===void 0?void 0:t.coordinates)==="wgs84",{tileIndex:r}=e.mvt,o=r&&Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z);if(n&&!o)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return e.mvt}function aX(e,t,n){const r=e.toGeoJSON(t.coordinates==="wgs84"?t.tileIndex:uX);return t.layerProperty&&(r.properties[t.layerProperty]=n),r}function lX(e,t,n){const r=e.toBinaryCoordinates(t.coordinates==="wgs84"?t.tileIndex:cX);return t.layerProperty&&r.properties&&(r.properties[t.layerProperty]=n),r}function uX(e,t){const{extent:n}=t;for(let r=0;r<e.length;r++){const o=e[r];o[0]/=n,o[1]/=n}}function cX(e,t){const{extent:n}=t;for(let r=0,o=e.length;r<o;++r)e[r]/=n}const hX="3.2.13",fX={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},Yk={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:hX,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:fX};({...Yk});const Kk={clipBounds:[0,0,1,1]},Jk=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,pX={name:"clip-vs",vs:Jk},dX={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},mX={name:"clip-fs",fs:Jk},gX={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class Zw extends yk{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(t=this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[pX],inject:dX}:{modules:[mX],inject:gX}}draw({uniforms:t}){const{clipBounds:n=Kk.clipBounds}=this.props;if(this.state.clipByInstance)t.clip_bounds=n;else{const r=this.projectPosition([n[0],n[1],0]),o=this.projectPosition([n[2],n[3],0]);t.clip_bounds=[Math.min(r[0],o[0]),Math.min(r[1],o[1]),Math.max(r[0],o[0]),Math.max(r[1],o[1])]}}}L(Zw,"defaultProps",Kk);L(Zw,"extensionName","ClipExtension");const yX={Point:Qk,MultiPoint:vX,LineString:tO,MultiLineString:_X,Polygon:eO,MultiPolygon:xX};function Qk([e,t],[n,r],o){const l=mf(n[0],r[0],e),s=mf(n[1],r[1],t);return o.unprojectFlat([l,s])}function Xw(e,t,n){return e.map(r=>Qk(r,t,n))}function vX(e,t,n){return Xw(e,t,n)}function tO(e,t,n){return Xw(e,t,n)}function _X(e,t,n){return e.map(r=>tO(r,t,n))}function eO(e,t,n){return e.map(r=>Xw(r,t,n))}function xX(e,t,n){return e.map(r=>eO(r,t,n))}function bX(e,t,n){const r=n.projectFlat([t.west,t.north]),o=n.projectFlat([t.east,t.south]),l=[r,o];return{...e,coordinates:yX[e.type](e.coordinates,l,n)}}const wX=["points","lines","polygons"];function TX(e,t,n,r){for(const o of wX){const l=e[o]&&EX(e[o],t,n,r);if(l>=0)return l}return-1}function EX(e,t,n,r){const o=e.featureIds.value;if(!o.length)return-1;let l=0,s=o[o.length-1]+1;if(r){const g=SX(e,r);if(g)l=g[0],s=g[1]+1;else return-1}let p=-1;if(t in e.numericProps){const g=e.numericProps[t].value.findIndex((_,w)=>_===n&&o[w]>=l&&o[w]<s);return g>=0?e.globalFeatureIds.value[g]:-1}else t?p=BA(e.properties,g=>g[t]===n,l,s):e.fields&&(p=BA(e.fields,g=>g.id===n,l,s));return p>=0?PX(e,p):-1}function SX(e,t){if(!e.__layers){const n={},{properties:r}=e;for(let o=0;o<r.length;o++){const{layerName:l}=r[o];l&&(n[l]?n[l][1]=o:n[l]=[o,o])}e.__layers=n}return e.__layers[t]}function PX(e,t){if(!e.__ids){const n=[],r=e.featureIds.value,o=e.globalFeatureIds.value;for(let l=0;l<r.length;l++)n[r[l]]=o[l];e.__ids=n}return e.__ids[t]}function BA(e,t,n,r){for(let o=n;o<r;o++)if(t(e[o],o))return o;return-1}const rx=512,AX={...tm.defaultProps,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[Yk],binary:!0};class $w extends Ww{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:t,oldProps:n,context:r,changeFlags:o}){var l;o.dataChanged&&this._updateTileData(),(l=this.state)!==null&&l!==void 0&&l.data&&(super.updateState({props:t,oldProps:n,context:r,changeFlags:o}),this._setWGS84PropertyForTiles());const{highlightColor:s}=t;s!==n.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let t=this.props.data,n=null;if(typeof t=="string"&&!Xq(t)){const{onDataLoad:r,fetch:o}=this.props;this.setState({data:null,tileJSON:null});try{n=await o(t,{propName:"data",layer:this,loaders:[]})}catch(l){this.raiseError(l,"loading TileJSON"),t=null}r&&r(n,{propName:"data",layer:this})}else t.tilejson&&(n=t);n&&(t=n.tiles),this.setState({data:t,tileJSON:n})}_getTilesetOptions(){const t=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:r,maxZoom:o}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>r&&(t.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(o)||n.maxzoom<o)&&(t.maxZoom=n.maxzoom)),t}renderLayers(){var t;return(t=this.state)!==null&&t!==void 0&&t.data?super.renderLayers():null}getTileData(t){var n;const{data:r,binary:o}=this.state,{index:l,signal:s}=t,p=Gk(r,t);if(!p)return Promise.reject("Invalid URL");let g=this.getLoadOptions();const{fetch:_}=this.props;return g={...g,mimeType:"application/x-protobuf",mvt:{...(n=g)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:l},gis:o?{format:"binary"}:{}},_(p,{propName:"data",layer:this,loadOptions:g,signal:s})}renderSubLayers(t){const{x:n,y:r,z:o}=t.tile.index,l=Math.pow(2,o),s=rx/l,p=-s,g=rx*n/l,_=rx*(1-r/l),w=new fi().scale([s,p,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=w,t.coordinateOrigin=[g,_,0],t.coordinateSystem=bn.CARTESIAN,t.extensions=[...t.extensions||[],new Zw]);const P=super.renderSubLayers(t);return this.state.binary&&!(P instanceof tm)&&cn.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),P}_updateAutoHighlight(t){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:r,hoveredFeatureLayerName:o}=this.state,l=t.object;let s,p;l&&(s=ix(l,n),p=UA(l));let{highlightColor:g}=this.props;typeof g=="function"&&(g=g(t)),(r!==s||o!==p)&&this.setState({highlightColor:g,hoveredFeatureId:s,hoveredFeatureLayerName:p})}getPickingInfo(t){const n=super.getPickingInfo(t),r=Boolean(this.context.viewport.resolution);if(this.state.binary&&n.index!==-1){const{data:o}=t.sourceLayer.props;n.object=kA(o,{globalFeatureId:n.index})}return n.object&&!r&&(n.object=jA(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:n,hoveredFeatureLayerName:r,binary:o}=this.state,{uniqueIdProperty:l,highlightedFeatureId:s}=this.props,p=t.content,g=VA(s);if(!(VA(n)||g))return-1;const w=g?s:n;return Array.isArray(p)?p.findIndex(P=>{const A=ix(P,l)===w,M=g||UA(P)===r;return A&&M}):p&&o?TX(p,l,w,g?"":r):-1}_pickObjects(t){const{deck:n,viewport:r}=this.context,o=r.width,l=r.height,s=r.x,p=r.y,g=[this.id];return n.pickObjects({x:s,y:p,width:o,height:l,layerIds:g,maxObjects:t})}getRenderedFeatures(t=null){const n=this._pickObjects(t),r=new Set,o=[];for(const l of n){const s=ix(l.object,this.props.uniqueIdProperty);s===void 0?o.push(l.object):r.has(s)||(r.add(s),o.push(l.object))}return o}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(r=>{r.hasOwnProperty(t)||Object.defineProperty(r,t,{get:()=>{if(!r.content)return null;if(this.state.binary&&Array.isArray(r.content)&&!r.content.length)return[];const{bbox:o}=r;if(r._contentWGS84===void 0&&$q(o)){const l=this.state.binary?kA(r.content):r.content;r._contentWGS84=l.map(s=>jA(s,o,this.context.viewport))}return r._contentWGS84}})})}}L($w,"layerName","MVTLayer");L($w,"defaultProps",AX);function ix(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function UA(e){var t;return((t=e.properties)===null||t===void 0?void 0:t.layerName)||null}function VA(e){return e!=null&&e!==""}function jA(e,t,n){const r={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>bX(e.geometry,t,n).coordinates}),r}const CX=typeof window<"u"?Rt.useLayoutEffect:Rt.useEffect,IX=CX;function Iv(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const MX={position:"absolute",zIndex:-1};function nO(e,t){if(typeof e=="function")return e(t);if(Array.isArray(e))return e.map(n=>nO(n,t));if(l_(e)){if(LX(e))return t.style=MX,Rt.cloneElement(e,t);if(kX(e))return Rt.cloneElement(e,t)}return e}function l_(e){return e&&typeof e=="object"&&"type"in e||!1}function LX(e){const t=e.type,n=t&&t.defaultProps;return n&&n.mapStyle}function kX(e){const t=e.type;return t&&t.deckGLViewProps}function H1(e){if(typeof e=="function")return Rt.createElement(_c,{},e);if(Array.isArray(e))return e.map(H1);if(l_(e)){if(e.type===Rt.Fragment)return H1(e.props.children);if(Iv(e.type,_c))return e}return e}function OX({children:e,layers:t=[],views:n=null}){const r=[],o=[],l={};return Rt.Children.forEach(H1(e),s=>{if(l_(s)){const p=s.type;if(Iv(p,pl)){const g=RX(p,s.props);o.push(g)}else r.push(s);if(Iv(p,_c)&&p!==_c&&s.props.id){const g=new p(s.props);l[g.id]=g}}else s&&r.push(s)}),Object.keys(l).length>0&&(Array.isArray(n)?n.forEach(s=>{l[s.id]=s}):n&&(l[n.id]=n),n=Object.values(l)),t=o.length>0?[...o,...t]:t,{layers:t,children:r,views:n}}function RX(e,t){const n={},r=e.defaultProps||{};for(const o in t)r[o]!==t[o]&&(n[o]=t[o]);return new e(n)}function zX({children:e,deck:t,ContextProvider:n}){const{viewManager:r}=t||{};if(!r||!r.views.length)return[];const o={},l=r.views[0].id;for(const s of e){let p=l,g=s;l_(s)&&Iv(s.type,_c)&&(p=s.props.id||l,g=s.props.children);const _=r.getViewport(p),w=r.getViewState(p);if(_){w.padding=_.padding;const{x:P,y:A,width:M,height:F}=_;g=nO(g,{x:P,y:A,width:M,height:F,viewport:_,viewState:w}),o[p]||(o[p]={viewport:_,children:[]}),o[p].children.push(g)}}return Object.keys(o).map(s=>{const{viewport:p,children:g}=o[s],{x:_,y:w,width:P,height:A}=p,M={position:"absolute",left:_,top:w,width:P,height:A},F="view-".concat(s),X=Rt.createElement("div",{key:F,id:F,style:M},...g);if(n){const B={viewport:p,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:U=>{U.viewId=s,t._onViewStateChange(U)}};return Rt.createElement(n,{key:F,value:B},X)}return X})}const DX={mixBlendMode:null};function FX({width:e,height:t,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},o={left:0,top:0};if(n)for(const l in n)l in DX?o[l]=n[l]:r[l]=n[l];return{containerStyle:r,canvasStyle:o}}function NX(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}function rO(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function BX(e,t,n){const r=new t({...n,_customRender:o=>{e.redrawReason=o;const l=r.getViewports();e.lastRenderedViewports!==l?e.forceUpdate():rO(e)}});return r}const iO=Rt.forwardRef((e,t)=>{const[n,r]=Rt.useState(0),l=Rt.useRef({control:null,version:n,forceUpdate:()=>r(pt=>pt+1)}).current,s=Rt.useRef(null),p=Rt.useRef(null),g=Rt.useMemo(()=>OX(e),[e.layers,e.views,e.children]);let _=!0;const w=pt=>{var _t;return _&&e.viewState?(l.viewStateUpdateRequested=pt,null):(l.viewStateUpdateRequested=null,(_t=e.onViewStateChange)===null||_t===void 0?void 0:_t.call(e,pt))},P=pt=>{if(_)l.interactionStateUpdateRequested=pt;else{var _t;l.interactionStateUpdateRequested=null,(_t=e.onInteractionStateChange)===null||_t===void 0||_t.call(e,pt)}},A=Rt.useMemo(()=>{const pt={...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:p.current,layers:g.layers,views:g.views,onViewStateChange:w,onInteractionStateChange:P};return delete pt._customRender,l.deck&&l.deck.setProps(pt),pt},[e]);Rt.useEffect(()=>{const pt=e.Deck||Qv;return l.deck=BX(l,pt,{...A,parent:s.current,canvas:p.current}),()=>{var _t;return(_t=l.deck)===null||_t===void 0?void 0:_t.finalize()}},[]),IX(()=>{rO(l);const{viewStateUpdateRequested:pt,interactionStateUpdateRequested:_t}=l;pt&&w(pt),_t&&P(_t)}),Rt.useImperativeHandle(t,()=>NX(l),[]);const M=l.deck&&l.deck.isInitialized?l.deck.getViewports():void 0,{ContextProvider:F,width:X,height:B,id:U,style:H}=e,{containerStyle:tt,canvasStyle:st}=Rt.useMemo(()=>FX({width:X,height:B,style:H}),[X,B,H]);if(!l.viewStateUpdateRequested&&l.lastRenderedViewports===M||l.version!==n){l.lastRenderedViewports=M,l.version=n;const pt=zX({children:g.children,deck:l.deck,ContextProvider:F}),_t=Rt.createElement("canvas",{key:"canvas",id:U||"deckgl-overlay",ref:p,style:st});l.control=Rt.createElement("div",{id:"".concat(U||"deckgl","-wrapper"),ref:s,style:tt},[_t,pt])}return _=!1,l.control});iO.defaultProps=Qv.defaultProps;const UX=iO;function VX(e){const n=e.filter(_=>[_.x,_.y].some(w=>!isNaN(w)));function r(_){return[...new Set(_.map(w=>+w.time))].sort((w,P)=>w-P)}const o=r(n);function l(_,w,P){return _.map(A=>{const M=[A.longitude,A.latitude];return{path:p(M,[M[0]+A.x/w,M[1]+A.y/w]),times:s(P.indexOf(+A.time)-.2)}})}function s(_){return[_,_+2]}function p(_,w){let P=[..._];return P.push(...w),P}return l(n,20,o)}const jX={latitude:49,longitude:-124,zoom:10},GX="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",WX={position:"absolute",top:10,left:10};function HX(){const[e,t]=Rt.useState(1);Rt.useEffect(()=>{setTimeout(()=>t((e+.05)%1.3),70)},[e]);const n={mvt:{coordinates:"wgs84",tileIndex:{x:0,y:0,z:0}}},r=new $w({data:["/currents-react-mapbox-deckgl//tiles/{z}/{x}/{y}.pbf"],maxRequests:20,binary:!1,loadOptions:n,minZoom:6,maxZoom:11,tileSize:512,renderSubLayers:o=>{if(o.data){const l=o.data.map(p=>({time:p.properties.time,x:p.properties.curr_x,y:p.properties.curr_y,longitude:p.properties.lon1,latitude:p.properties.lat1})),s=VX(l);return[new Pv({id:"layer-trips-x-1",data:s,getPath:p=>p.path,positionFormat:"XY",getTimestamps:p=>p.times,getColor:[25,82,189],opacity:1,minZoom:7,widthMinPixels:2,fadeTrail:!0,trailLength:.5,currentTime:e}),new Pv({id:"layer-trips-x-2",data:s,getPath:p=>p.path,positionFormat:"XY",getTimestamps:p=>p.times,getColor:[25,82,189],opacity:.6,minZoom:7,widthMinPixels:2,fadeTrail:!0,trailLength:.3,currentTime:(e+.5)%1.3})]}}});return zp.createElement("div",null,zp.createElement(UX,{initialViewState:jX,controller:!0,layers:r,ContextProvider:Tc.Provider},zp.createElement(cl,{mapStyle:GX}),zp.createElement(FB,{style:WX})))}lx.render(zp.createElement(HX,null),document.body.appendChild(document.createElement("div")));
